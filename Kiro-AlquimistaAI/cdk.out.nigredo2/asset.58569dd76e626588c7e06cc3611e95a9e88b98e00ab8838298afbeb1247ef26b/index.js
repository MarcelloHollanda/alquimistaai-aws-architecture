"use strict";var Bm=Object.create;var Fr=Object.defineProperty;var Fm=Object.getOwnPropertyDescriptor;var jm=Object.getOwnPropertyNames;var Um=Object.getPrototypeOf,Vm=Object.prototype.hasOwnProperty;var eu=r=>{throw TypeError(r)};var Wm=(r,e,t)=>e in r?Fr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),tu=(r,e)=>{for(var t in e)Fr(r,t,{get:e[t],enumerable:!0})},ru=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of jm(e))!Vm.call(r,n)&&n!==t&&Fr(r,n,{get:()=>e[n],enumerable:!(s=Fm(e,n))||s.enumerable});return r};var He=(r,e,t)=>(t=r!=null?Bm(Um(r)):{},ru(e||!r||!r.__esModule?Fr(t,"default",{value:r,enumerable:!0}):t,r)),Gm=r=>ru(Fr({},"__esModule",{value:!0}),r);var x=(r,e,t)=>Wm(r,typeof e!="symbol"?e+"":e,t),yi=(r,e,t)=>e.has(r)||eu("Cannot "+t);var p=(r,e,t)=>(yi(r,e,"read from private field"),t?t.call(r):e.get(r)),k=(r,e,t)=>e.has(r)?eu("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),J=(r,e,t,s)=>(yi(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),q=(r,e,t)=>(yi(r,e,"access private method"),t);var Ni=f((Gr,sr)=>{var tg=200,qu="__lodash_hash_undefined__",rg=800,sg=16,Du=9007199254740991,$u="[object Arguments]",ng="[object Array]",ig="[object AsyncFunction]",ag="[object Boolean]",og="[object Date]",ug="[object Error]",Bu="[object Function]",cg="[object GeneratorFunction]",lg="[object Map]",dg="[object Number]",fg="[object Null]",Fu="[object Object]",hg="[object Proxy]",pg="[object RegExp]",mg="[object Set]",gg="[object String]",yg="[object Undefined]",_g="[object WeakMap]",vg="[object ArrayBuffer]",Sg="[object DataView]",Eg="[object Float32Array]",bg="[object Float64Array]",wg="[object Int8Array]",Tg="[object Int16Array]",Ag="[object Int32Array]",Cg="[object Uint8Array]",xg="[object Uint8ClampedArray]",Rg="[object Uint16Array]",Ig="[object Uint32Array]",Og=/[\\^$.*+?()[\]{}|]/g,Lg=/^\[object .+?Constructor\]$/,kg=/^(?:0|[1-9]\d*)$/,U={};U[Eg]=U[bg]=U[wg]=U[Tg]=U[Ag]=U[Cg]=U[xg]=U[Rg]=U[Ig]=!0;U[$u]=U[ng]=U[vg]=U[ag]=U[Sg]=U[og]=U[ug]=U[Bu]=U[lg]=U[dg]=U[Fu]=U[pg]=U[mg]=U[gg]=U[_g]=!1;var ju=typeof global=="object"&&global&&global.Object===Object&&global,Ng=typeof self=="object"&&self&&self.Object===Object&&self,Xr=ju||Ng||Function("return this")(),Uu=typeof Gr=="object"&&Gr&&!Gr.nodeType&&Gr,Qr=Uu&&typeof sr=="object"&&sr&&!sr.nodeType&&sr,Vu=Qr&&Qr.exports===Uu,wi=Vu&&ju.process,xu=function(){try{var r=Qr&&Qr.require&&Qr.require("util").types;return r||wi&&wi.binding&&wi.binding("util")}catch{}}(),Ru=xu&&xu.isTypedArray;function Mg(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function Pg(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}function qg(r){return function(e){return r(e)}}function Dg(r,e){return r?.[e]}function $g(r,e){return function(t){return r(e(t))}}var Bg=Array.prototype,Fg=Function.prototype,Xs=Object.prototype,Ti=Xr["__core-js_shared__"],zs=Fg.toString,Ke=Xs.hasOwnProperty,Iu=function(){var r=/[^.]+$/.exec(Ti&&Ti.keys&&Ti.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Wu=Xs.toString,jg=zs.call(Object),Ug=RegExp("^"+zs.call(Ke).replace(Og,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Qs=Vu?Xr.Buffer:void 0,Ou=Xr.Symbol,Lu=Xr.Uint8Array,ku=Qs?Qs.allocUnsafe:void 0,Gu=$g(Object.getPrototypeOf,Object),Nu=Object.create,Vg=Xs.propertyIsEnumerable,Wg=Bg.splice,Tt=Ou?Ou.toStringTag:void 0,Hs=function(){try{var r=Oi(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Gg=Qs?Qs.isBuffer:void 0,Mu=Math.max,Qg=Date.now,Qu=Oi(Xr,"Map"),Hr=Oi(Object,"create"),Hg=function(){function r(){}return function(e){if(!Ct(e))return{};if(Nu)return Nu(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function At(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Xg(){this.__data__=Hr?Hr(null):{},this.size=0}function zg(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function Kg(r){var e=this.__data__;if(Hr){var t=e[r];return t===qu?void 0:t}return Ke.call(e,r)?e[r]:void 0}function Yg(r){var e=this.__data__;return Hr?e[r]!==void 0:Ke.call(e,r)}function Zg(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Hr&&e===void 0?qu:e,this}At.prototype.clear=Xg;At.prototype.delete=zg;At.prototype.get=Kg;At.prototype.has=Yg;At.prototype.set=Zg;function Ye(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Jg(){this.__data__=[],this.size=0}function ey(r){var e=this.__data__,t=Ks(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():Wg.call(e,t,1),--this.size,!0}function ty(r){var e=this.__data__,t=Ks(e,r);return t<0?void 0:e[t][1]}function ry(r){return Ks(this.__data__,r)>-1}function sy(r,e){var t=this.__data__,s=Ks(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}Ye.prototype.clear=Jg;Ye.prototype.delete=ey;Ye.prototype.get=ty;Ye.prototype.has=ry;Ye.prototype.set=sy;function nr(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function ny(){this.size=0,this.__data__={hash:new At,map:new(Qu||Ye),string:new At}}function iy(r){var e=Zs(this,r).delete(r);return this.size-=e?1:0,e}function ay(r){return Zs(this,r).get(r)}function oy(r){return Zs(this,r).has(r)}function uy(r,e){var t=Zs(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}nr.prototype.clear=ny;nr.prototype.delete=iy;nr.prototype.get=ay;nr.prototype.has=oy;nr.prototype.set=uy;function ir(r){var e=this.__data__=new Ye(r);this.size=e.size}function cy(){this.__data__=new Ye,this.size=0}function ly(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function dy(r){return this.__data__.get(r)}function fy(r){return this.__data__.has(r)}function hy(r,e){var t=this.__data__;if(t instanceof Ye){var s=t.__data__;if(!Qu||s.length<tg-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new nr(s)}return t.set(r,e),this.size=t.size,this}ir.prototype.clear=cy;ir.prototype.delete=ly;ir.prototype.get=dy;ir.prototype.has=fy;ir.prototype.set=hy;function py(r,e){var t=Ri(r),s=!t&&xi(r),n=!t&&!s&&Ku(r),i=!t&&!s&&!n&&Zu(r),a=t||s||n||i,o=a?Pg(r.length,String):[],u=o.length;for(var c in r)(e||Ke.call(r,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Xu(c,u)))&&o.push(c);return o}function Ai(r,e,t){(t!==void 0&&!Js(r[e],t)||t===void 0&&!(e in r))&&Ii(r,e,t)}function my(r,e,t){var s=r[e];(!(Ke.call(r,e)&&Js(s,t))||t===void 0&&!(e in r))&&Ii(r,e,t)}function Ks(r,e){for(var t=r.length;t--;)if(Js(r[t][0],e))return t;return-1}function Ii(r,e,t){e=="__proto__"&&Hs?Hs(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var gy=Iy();function Ys(r){return r==null?r===void 0?yg:fg:Tt&&Tt in Object(r)?Oy(r):qy(r)}function Pu(r){return zr(r)&&Ys(r)==$u}function yy(r){if(!Ct(r)||My(r))return!1;var e=ki(r)?Ug:Lg;return e.test(Fy(r))}function _y(r){return zr(r)&&Yu(r.length)&&!!U[Ys(r)]}function vy(r){if(!Ct(r))return Py(r);var e=zu(r),t=[];for(var s in r)s=="constructor"&&(e||!Ke.call(r,s))||t.push(s);return t}function Hu(r,e,t,s,n){r!==e&&gy(e,function(i,a){if(n||(n=new ir),Ct(i))Sy(r,e,a,t,Hu,s,n);else{var o=s?s(Ci(r,a),i,a+"",r,e,n):void 0;o===void 0&&(o=i),Ai(r,a,o)}},Ju)}function Sy(r,e,t,s,n,i,a){var o=Ci(r,t),u=Ci(e,t),c=a.get(u);if(c){Ai(r,t,c);return}var l=i?i(o,u,t+"",r,e,a):void 0,d=l===void 0;if(d){var m=Ri(u),h=!m&&Ku(u),b=!m&&!h&&Zu(u);l=u,m||h||b?Ri(o)?l=o:jy(o)?l=Cy(o):h?(d=!1,l=wy(u,!0)):b?(d=!1,l=Ay(u,!0)):l=[]:Uy(u)||xi(u)?(l=o,xi(o)?l=Vy(o):(!Ct(o)||ki(o))&&(l=Ly(u))):d=!1}d&&(a.set(u,l),n(l,u,s,i,a),a.delete(u)),Ai(r,t,l)}function Ey(r,e){return $y(Dy(r,e,ec),r+"")}var by=Hs?function(r,e){return Hs(r,"toString",{configurable:!0,enumerable:!1,value:Gy(e),writable:!0})}:ec;function wy(r,e){if(e)return r.slice();var t=r.length,s=ku?ku(t):new r.constructor(t);return r.copy(s),s}function Ty(r){var e=new r.constructor(r.byteLength);return new Lu(e).set(new Lu(r)),e}function Ay(r,e){var t=e?Ty(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function Cy(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}function xy(r,e,t,s){var n=!t;t||(t={});for(var i=-1,a=e.length;++i<a;){var o=e[i],u=s?s(t[o],r[o],o,t,r):void 0;u===void 0&&(u=r[o]),n?Ii(t,o,u):my(t,o,u)}return t}function Ry(r){return Ey(function(e,t){var s=-1,n=t.length,i=n>1?t[n-1]:void 0,a=n>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,a&&ky(t[0],t[1],a)&&(i=n<3?void 0:i,n=1),e=Object(e);++s<n;){var o=t[s];o&&r(e,o,s,i)}return e})}function Iy(r){return function(e,t,s){for(var n=-1,i=Object(e),a=s(e),o=a.length;o--;){var u=a[r?o:++n];if(t(i[u],u,i)===!1)break}return e}}function Zs(r,e){var t=r.__data__;return Ny(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Oi(r,e){var t=Dg(r,e);return yy(t)?t:void 0}function Oy(r){var e=Ke.call(r,Tt),t=r[Tt];try{r[Tt]=void 0;var s=!0}catch{}var n=Wu.call(r);return s&&(e?r[Tt]=t:delete r[Tt]),n}function Ly(r){return typeof r.constructor=="function"&&!zu(r)?Hg(Gu(r)):{}}function Xu(r,e){var t=typeof r;return e=e??Du,!!e&&(t=="number"||t!="symbol"&&kg.test(r))&&r>-1&&r%1==0&&r<e}function ky(r,e,t){if(!Ct(t))return!1;var s=typeof e;return(s=="number"?Li(t)&&Xu(e,t.length):s=="string"&&e in t)?Js(t[e],r):!1}function Ny(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function My(r){return!!Iu&&Iu in r}function zu(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Xs;return r===t}function Py(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function qy(r){return Wu.call(r)}function Dy(r,e,t){return e=Mu(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,i=Mu(s.length-e,0),a=Array(i);++n<i;)a[n]=s[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=s[n];return o[e]=t(a),Mg(r,this,o)}}function Ci(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var $y=By(by);function By(r){var e=0,t=0;return function(){var s=Qg(),n=sg-(s-t);if(t=s,n>0){if(++e>=rg)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function Fy(r){if(r!=null){try{return zs.call(r)}catch{}try{return r+""}catch{}}return""}function Js(r,e){return r===e||r!==r&&e!==e}var xi=Pu(function(){return arguments}())?Pu:function(r){return zr(r)&&Ke.call(r,"callee")&&!Vg.call(r,"callee")},Ri=Array.isArray;function Li(r){return r!=null&&Yu(r.length)&&!ki(r)}function jy(r){return zr(r)&&Li(r)}var Ku=Gg||Qy;function ki(r){if(!Ct(r))return!1;var e=Ys(r);return e==Bu||e==cg||e==ig||e==hg}function Yu(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Du}function Ct(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function zr(r){return r!=null&&typeof r=="object"}function Uy(r){if(!zr(r)||Ys(r)!=Fu)return!1;var e=Gu(r);if(e===null)return!0;var t=Ke.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&zs.call(t)==jg}var Zu=Ru?qg(Ru):_y;function Vy(r){return xy(r,Ju(r))}function Ju(r){return Li(r)?py(r,!0):vy(r)}var Wy=Ry(function(r,e,t){Hu(r,e,t)});function Gy(r){return function(){return r}}function ec(r){return r}function Qy(){return!1}sr.exports=Wy});var Ui=f(hc=>{"use strict";hc.parse=function(r,e){return new ji(r,e).parse()};var ji=class r{constructor(e,t){this.source=e,this.transform=t||Xy,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,s,n;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new r(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(t.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(n&&this.newEntry(!0),n=!n):t.value===","&&!n?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Xy(r){return r}});var Vi=f((TR,pc)=>{var zy=Ui();pc.exports={create:function(r,e){return{parse:function(){return zy.parse(r,e)}}}}});var yc=f((AR,gc)=>{"use strict";var Ky=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Yy=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Zy=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Jy=/^-?infinity$/;gc.exports=function(e){if(Jy.test(e))return Number(e.replace("i","I"));var t=Ky.exec(e);if(!t)return e_(e)||null;var s=!!t[8],n=parseInt(t[1],10);s&&(n=mc(n));var i=parseInt(t[2],10)-1,a=t[3],o=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),l=t[7];l=l?1e3*parseFloat(l):0;var d,m=t_(e);return m!=null?(d=new Date(Date.UTC(n,i,a,o,u,c,l)),Wi(n)&&d.setUTCFullYear(n),m!==0&&d.setTime(d.getTime()-m)):(d=new Date(n,i,a,o,u,c,l),Wi(n)&&d.setFullYear(n)),d};function e_(r){var e=Yy.exec(r);if(e){var t=parseInt(e[1],10),s=!!e[4];s&&(t=mc(t));var n=parseInt(e[2],10)-1,i=e[3],a=new Date(t,n,i);return Wi(t)&&a.setFullYear(t),a}}function t_(r){if(r.endsWith("+00"))return 0;var e=Zy.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var s=t==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}function mc(r){return-(r-1)}function Wi(r){return r>=0&&r<100}});var vc=f((CR,_c)=>{_c.exports=s_;var r_=Object.prototype.hasOwnProperty;function s_(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)r_.call(t,s)&&(r[s]=t[s])}return r}});var bc=f((xR,Ec)=>{"use strict";var n_=vc();Ec.exports=lr;function lr(r){if(!(this instanceof lr))return new lr(r);n_(this,g_(r))}var i_=["seconds","minutes","hours","days","months","years"];lr.prototype.toPostgres=function(){var r=i_.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var a_={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},o_=["years","months","days"],u_=["hours","minutes","seconds"];lr.prototype.toISOString=lr.prototype.toISO=function(){var r=o_.map(t,this).join(""),e=u_.map(t,this).join("");return"P"+r+"T"+e;function t(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+a_[s]}};var Gi="([+-]?\\d+)",c_=Gi+"\\s+years?",l_=Gi+"\\s+mons?",d_=Gi+"\\s+days?",f_="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",h_=new RegExp([c_,l_,d_,f_].map(function(r){return"("+r+")?"}).join("\\s*")),Sc={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},p_=["hours","minutes","seconds","milliseconds"];function m_(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function g_(r){if(!r)return{};var e=h_.exec(r),t=e[8]==="-";return Object.keys(Sc).reduce(function(s,n){var i=Sc[n],a=e[i];return!a||(a=n==="milliseconds"?m_(a):parseInt(a,10),!a)||(t&&~p_.indexOf(n)&&(a*=-1),s[n]=a),s},{})}});var Tc=f((RR,wc)=>{"use strict";wc.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",s=0;s<e.length;)if(e[s]!=="\\")t+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))t+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var i=0;i<Math.floor(n/2);++i)t+="\\";s+=Math.floor(n/2)*2}return new Buffer(t,"binary")}});var Lc=f((IR,Oc)=>{var ss=Ui(),ns=Vi(),an=yc(),Cc=bc(),xc=Tc();function on(r){return function(t){return t===null?t:r(t)}}function Rc(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function y_(r){return r?ss.parse(r,Rc):null}function __(r){return parseInt(r,10)}function Qi(r){return r?ss.parse(r,on(__)):null}function v_(r){return r?ss.parse(r,on(function(e){return Ic(e).trim()})):null}var S_=function(r){if(!r)return null;var e=ns.create(r,function(t){return t!==null&&(t=Ki(t)),t});return e.parse()},Hi=function(r){if(!r)return null;var e=ns.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},Te=function(r){if(!r)return null;var e=ns.create(r);return e.parse()},Xi=function(r){if(!r)return null;var e=ns.create(r,function(t){return t!==null&&(t=an(t)),t});return e.parse()},E_=function(r){if(!r)return null;var e=ns.create(r,function(t){return t!==null&&(t=Cc(t)),t});return e.parse()},b_=function(r){return r?ss.parse(r,on(xc)):null},zi=function(r){return parseInt(r,10)},Ic=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},Ac=function(r){return r?ss.parse(r,on(JSON.parse)):null},Ki=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},w_=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",s=!1,n=2;n<r.length-1;n++){if(s||(e+=r[n]),r[n]===")"){s=!0;continue}else if(!s)continue;r[n]!==","&&(t+=r[n])}var i=Ki(e);return i.radius=parseFloat(t),i},T_=function(r){r(20,Ic),r(21,zi),r(23,zi),r(26,zi),r(700,parseFloat),r(701,parseFloat),r(16,Rc),r(1082,an),r(1114,an),r(1184,an),r(600,Ki),r(651,Te),r(718,w_),r(1e3,y_),r(1001,b_),r(1005,Qi),r(1007,Qi),r(1028,Qi),r(1016,v_),r(1017,S_),r(1021,Hi),r(1022,Hi),r(1231,Hi),r(1014,Te),r(1015,Te),r(1008,Te),r(1009,Te),r(1040,Te),r(1041,Te),r(1115,Xi),r(1182,Xi),r(1185,Xi),r(1186,Cc),r(1187,E_),r(17,xc),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,Ac),r(3807,Ac),r(3907,Te),r(2951,Te),r(791,Te),r(1183,Te),r(1270,Te)};Oc.exports={init:T_}});var Nc=f((OR,kc)=>{"use strict";var _e=1e6;function A_(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),s="";e<0&&(e=~e+(t===0),t=~t+1>>>0,s="-");var n="",i,a,o,u,c,l;{if(i=e%_e,e=e/_e>>>0,a=4294967296*i+t,t=a/_e>>>0,o=""+(a-_e*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}{if(i=e%_e,e=e/_e>>>0,a=4294967296*i+t,t=a/_e>>>0,o=""+(a-_e*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}{if(i=e%_e,e=e/_e>>>0,a=4294967296*i+t,t=a/_e>>>0,o=""+(a-_e*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}return i=e%_e,a=4294967296*i+t,o=""+a%_e,s+o+n}kc.exports=A_});var $c=f((LR,Dc)=>{var C_=Nc(),K=function(r,e,t,s,n){t=t||0,s=s||!1,n=n||function(h,b,T){return h*Math.pow(2,T)+b};var i=t>>3,a=function(h){return s?~h&255:h},o=255,u=8-t%8;e<u&&(o=255<<8-e&255,u=e),t&&(o=o>>t%8);var c=0;t%8+e>=8&&(c=n(0,a(r[i])&o,u));for(var l=e+t>>3,d=i+1;d<l;d++)c=n(c,a(r[d]),8);var m=(e+t)%8;return m>0&&(c=n(c,a(r[l])>>8-m,m)),c},qc=function(r,e,t){var s=Math.pow(2,t-1)-1,n=K(r,1),i=K(r,t,1);if(i===0)return 0;var a=1,o=function(c,l,d){c===0&&(c=1);for(var m=1;m<=d;m++)a/=2,(l&1<<d-m)>0&&(c+=a);return c},u=K(r,e,t+1,!1,o);return i==Math.pow(2,t+1)-1?u===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,i-s)*u},x_=function(r){return K(r,1)==1?-1*(K(r,15,1,!0)+1):K(r,15,1)},Mc=function(r){return K(r,1)==1?-1*(K(r,31,1,!0)+1):K(r,31,1)},R_=function(r){return qc(r,23,8)},I_=function(r){return qc(r,52,11)},O_=function(r){var e=K(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,K(r,16,16)),s=0,n=[],i=K(r,16),a=0;a<i;a++)s+=K(r,16,64+16*a)*t,t/=1e4;var o=Math.pow(10,K(r,16,48));return(e===0?1:-1)*Math.round(s*o)/o},Pc=function(r,e){var t=K(e,1),s=K(e,63,1),n=new Date((t===0?1:-1)*s/1e3+9466848e5);return r||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(i){this.usec=i},n.getUTCMicroSeconds=function(){return this.usec},n},is=function(r){for(var e=K(r,32),t=K(r,32,32),s=K(r,32,64),n=96,i=[],a=0;a<e;a++)i[a]=K(r,32,n),n+=32,n+=32;var o=function(c){var l=K(r,32,n);if(n+=32,l==4294967295)return null;var d;if(c==23||c==20)return d=K(r,l*8,n),n+=l*8,d;if(c==25)return d=r.toString(this.encoding,n>>3,(n+=l<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var d=[],m;if(c.length>1){var h=c.shift();for(m=0;m<h;m++)d[m]=u(c,l);c.unshift(h)}else for(m=0;m<c[0];m++)d[m]=o(l);return d};return u(i,s)},L_=function(r){return r.toString("utf8")},k_=function(r){return r===null?null:K(r,8)>0},N_=function(r){r(20,C_),r(21,x_),r(23,Mc),r(26,Mc),r(1700,O_),r(700,R_),r(701,I_),r(16,k_),r(1114,Pc.bind(null,!1)),r(1184,Pc.bind(null,!0)),r(1e3,is),r(1007,is),r(1016,is),r(1008,is),r(1009,is),r(25,L_)};Dc.exports={init:N_}});var Fc=f((kR,Bc)=>{Bc.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var us=f(os=>{var M_=Lc(),P_=$c(),q_=Vi(),D_=Fc();os.getTypeParser=$_;os.setTypeParser=B_;os.arrayParser=q_;os.builtins=D_;var as={text:{},binary:{}};function jc(r){return String(r)}function $_(r,e){return e=e||"text",as[e]&&as[e][r]||jc}function B_(r,e,t){typeof e=="function"&&(t=e,e="text"),as[e][r]=t}M_.init(function(r,e){as.text[r]=e});P_.init(function(r,e){as.binary[r]=e})});var cs=f((MR,Yi)=>{"use strict";Yi.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var dr=us(),F_=dr.getTypeParser(20,"text"),j_=dr.getTypeParser(1016,"text");Yi.exports.__defineSetter__("parseInt8",function(r){dr.setTypeParser(20,"text",r?dr.getTypeParser(23,"text"):F_),dr.setTypeParser(1016,"text",r?dr.getTypeParser(1007,"text"):j_)})});var fr=f((PR,Wc)=>{"use strict";var U_=cs(),Uc=require("util"),{isDate:V_}=Uc.types||Uc;function W_(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Vc(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+Vc(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof Buffer)){let n=Buffer.from(s.buffer,s.byteOffset,s.byteLength);n.length===s.byteLength?s=n:s=n.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=W_(un(r[t]));return e=e+"}",e}var un=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return V_(r)?U_.parseInputDatesAsUTC?H_(r):Q_(r):Array.isArray(r)?Vc(r):G_(r,e)}return r.toString()};function G_(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),un(r.toPostgres(un),e)}return JSON.stringify(r)}function Q_(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),s=t<1;s&&(t=Math.abs(t)+1);let n=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(n+="-",e*=-1):n+="+",n+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),s&&(n+=" BC"),n}function H_(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let s=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return s+="+00:00",t&&(s+=" BC"),s}function X_(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var z_=function(r){return'"'+r.replace(/"/g,'""')+'"'},K_=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let s=0;s<r.length;s++){let n=r[s];n==="'"?t+=n+n:n==="\\"?(t+=n+n,e=!0):t+=n}return t+="'",e===!0&&(t=" E"+t),t};Wc.exports={prepareValue:function(e){return un(e)},normalizeQueryConfig:X_,escapeIdentifier:z_,escapeLiteral:K_}});var Qc=f((qR,Gc)=>{"use strict";var hr=require("crypto");function Zi(r){return hr.createHash("md5").update(r,"utf-8").digest("hex")}function Y_(r,e,t){let s=Zi(e+r);return"md5"+Zi(Buffer.concat([Buffer.from(s),t]))}function Z_(r){return hr.createHash("sha256").update(r).digest()}function J_(r,e){return r=r.replace(/(\D)-/,"$1"),hr.createHash(r).update(e).digest()}function ev(r,e){return hr.createHmac("sha256",r).update(e).digest()}async function tv(r,e,t){return hr.pbkdf2Sync(r,e,t,32,"sha256")}Gc.exports={postgresMd5PasswordHash:Y_,randomBytes:hr.randomBytes,deriveKey:tv,sha256:Z_,hashByName:J_,hmacSha256:ev,md5:Zi}});var Kc=f((DR,zc)=>{var Hc=require("crypto");zc.exports={postgresMd5PasswordHash:sv,randomBytes:rv,deriveKey:ov,sha256:nv,hashByName:iv,hmacSha256:av,md5:Ji};var Xc=Hc.webcrypto||globalThis.crypto,Lt=Xc.subtle,ea=new TextEncoder;function rv(r){return Xc.getRandomValues(Buffer.alloc(r))}async function Ji(r){try{return Hc.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?ea.encode(r):r,s=await Lt.digest("MD5",t);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}}async function sv(r,e,t){let s=await Ji(e+r);return"md5"+await Ji(Buffer.concat([Buffer.from(s),t]))}async function nv(r){return await Lt.digest("SHA-256",r)}async function iv(r,e){return await Lt.digest(r,e)}async function av(r,e){let t=await Lt.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Lt.sign("HMAC",t,ea.encode(e))}async function ov(r,e,t){let s=await Lt.importKey("raw",ea.encode(r),"PBKDF2",!1,["deriveBits"]),n={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await Lt.deriveBits(n,s,32*8,["deriveBits"])}});var ra=f(($R,ta)=>{"use strict";var uv=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;uv?ta.exports=Qc():ta.exports=Kc()});var Jc=f((BR,Zc)=>{function kt(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function sa(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let s=t&127;if(s>4)throw kt("bad length",r);t=0;for(let n=0;n<s;n++)t=t<<8|r[e++];return{length:t,index:e}}function Yc(r,e){if(r[e++]!==6)throw kt("non-OID data",r);let{length:t,index:s}=sa(r,e);e=s;let n=e+t,i=r[e++],a=(i/40>>0)+"."+i%40;for(;e<n;){let o=0;for(;e<n;){let u=r[e++];if(o=o<<7|u&127,u<128)break}a+="."+o}return{oid:a,index:e}}function ls(r,e){if(r[e++]!==48)throw kt("non-sequence data",r);return sa(r,e)}function cv(r,e){e===void 0&&(e=0),e=ls(r,e).index;let{length:t,index:s}=ls(r,e);e=s+t,e=ls(r,e).index;let{oid:n,index:i}=Yc(r,e);switch(n){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=i,e=ls(r,e).index,r[e++]!==160)throw kt("non-tag data",r);e=sa(r,e).index,e=ls(r,e).index;let{oid:a}=Yc(r,e);switch(a){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw kt("unknown hash OID "+a,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw kt("Ed448 certificate channel binding is not currently supported by Postgres")}throw kt("unknown OID "+n,r)}Zc.exports={signatureAlgorithmHashFromCertificate:cv}});var sl=f((FR,rl)=>{"use strict";var ft=ra(),{signatureAlgorithmHashFromCertificate:lv}=Jc();function dv(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let s=t.find(a=>r.includes(a));if(!s)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(s==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let n=ft.randomBytes(18).toString("base64");return{mechanism:s,clientNonce:n,response:(s==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+n,message:"SASLInitialResponse"}}async function fv(r,e,t,s){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=mv(t);if(n.nonce.startsWith(r.clientNonce)){if(n.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let i="n=*,r="+r.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o=s?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let G=s.getPeerCertificate().raw,ae=lv(G);(ae==="MD5"||ae==="SHA-1")&&(ae="SHA-256");let j=await ft.hashByName(ae,G);o=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(j)]).toString("base64")}let u="c="+o+",r="+n.nonce,c=i+","+a+","+u,l=Buffer.from(n.salt,"base64"),d=await ft.deriveKey(e,l,n.iteration),m=await ft.hmacSha256(d,"Client Key"),h=await ft.sha256(m),b=await ft.hmacSha256(h,c),T=yv(Buffer.from(m),Buffer.from(b)).toString("base64"),B=await ft.hmacSha256(d,"Server Key"),fe=await ft.hmacSha256(B,c);r.message="SASLResponse",r.serverSignature=Buffer.from(fe).toString("base64"),r.response=u+",p="+T}function hv(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=gv(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function pv(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function el(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function tl(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],s=e.substring(2);return[t,s]}))}function mv(r){let e=tl(r),t=e.get("r");if(t){if(!pv(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!el(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let i=parseInt(n,10);return{nonce:t,salt:s,iteration:i}}function gv(r){let t=tl(r).get("v");if(t){if(!el(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function yv(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,s)=>r[s]^e[s]))}rl.exports={startSession:dv,continueSession:fv,finalizeSession:hv}});var ln=f((jR,nl)=>{"use strict";var _v=us();function cn(r){this._types=r||_v,this.text={},this.binary={}}cn.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};cn.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};cn.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};nl.exports=cn});var ol=f((UR,al)=>{"use strict";function pr(r,e={}){if(r.charAt(0)==="/"){let u=r.split(" ");return{host:u[0],database:u[1]}}let t={},s,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{s=new URL(r,"postgres://base")}catch{s=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of s.searchParams.entries())t[u[0]]=u[1];if(t.user=t.user||decodeURIComponent(s.username),t.password=t.password||decodeURIComponent(s.password),s.protocol=="socket:")return t.host=decodeURI(s.pathname),t.database=s.searchParams.get("db"),t.client_encoding=s.searchParams.get("encoding"),t;let i=n?"":s.hostname;t.host?i&&/^%2f/i.test(i)&&(s.pathname=i+s.pathname):t.host=decodeURIComponent(i),t.port||(t.port=s.port);let a=s.pathname.slice(1)||null;t.database=a?decodeURI(a):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let o=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=o.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=o.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=o.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function vv(r){return Object.entries(r).reduce((t,[s,n])=>(n!=null&&(t[s]=n),t),{})}function il(r){return Object.entries(r).reduce((t,[s,n])=>{if(s==="ssl"){let i=n;typeof i=="boolean"&&(t[s]=i),typeof i=="object"&&(t[s]=vv(i))}else if(n!=null)if(s==="port"){if(n!==""){let i=parseInt(n,10);if(isNaN(i))throw new Error(`Invalid ${s}: ${n}`);t[s]=i}}else t[s]=n;return t},{})}function Sv(r){return il(pr(r))}al.exports=pr;pr.parse=pr;pr.toClientConfig=il;pr.parseIntoClientConfig=Sv});var ia=f((VR,ll)=>{"use strict";var Ev=require("dns"),cl=cs(),ul=ol().parse,he=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||cl[r]},bv=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return cl.ssl},mr=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},Ae=function(r,e,t){let s=e[t];s!=null&&r.push(t+"="+mr(s))},na=class{constructor(e){e=typeof e=="string"?ul(e):e||{},e.connectionString&&(e=Object.assign({},e,ul(e.connectionString))),this.user=he("user",e),this.database=he("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(he("port",e),10),this.host=he("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:he("password",e)}),this.binary=he("binary",e),this.options=he("options",e),this.ssl=typeof e.ssl>"u"?bv():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=he("client_encoding",e),this.replication=he("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=he("application_name",e,"PGAPPNAME"),this.fallback_application_name=he("fallback_application_name",e,!1),this.statement_timeout=he("statement_timeout",e,!1),this.lock_timeout=he("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=he("idle_in_transaction_session_timeout",e,!1),this.query_timeout=he("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];Ae(t,this,"user"),Ae(t,this,"password"),Ae(t,this,"port"),Ae(t,this,"application_name"),Ae(t,this,"fallback_application_name"),Ae(t,this,"connect_timeout"),Ae(t,this,"options");let s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Ae(t,s,"sslmode"),Ae(t,s,"sslca"),Ae(t,s,"sslkey"),Ae(t,s,"sslcert"),Ae(t,s,"sslrootcert"),this.database&&t.push("dbname="+mr(this.database)),this.replication&&t.push("replication="+mr(this.replication)),this.host&&t.push("host="+mr(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+mr(this.client_encoding)),Ev.lookup(this.host,function(n,i){return n?e(n,null):(t.push("hostaddr="+mr(i)),e(null,t.join(" ")))})}};ll.exports=na});var oa=f((WR,fl)=>{"use strict";var wv=us(),dl=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,aa=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=dl.exec(e.text):t=dl.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let s=0,n=e.length;s<n;s++){let i=e[s];i!==null?t[s]=this._parsers[s](i):t[s]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let s=0,n=e.length;s<n;s++){let i=e[s],a=this.fields[s].name;if(i!==null){let o=this.fields[s].format==="binary"?Buffer.from(i):i;t[a]=this._parsers[s](o)}else t[a]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let s=0;s<e.length;s++){let n=e[s];t[n.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[s]=wv.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...t}}};fl.exports=aa});var gl=f((GR,ml)=>{"use strict";var{EventEmitter:Tv}=require("events"),hl=oa(),pl=fr(),ua=class extends Tv{constructor(e,t,s){super(),e=pl.normalizeQueryConfig(e,t,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new hl(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new hl(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:pl.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};ml.exports=ua});var wa=f(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.NoticeMessage=C.DataRowMessage=C.CommandCompleteMessage=C.ReadyForQueryMessage=C.NotificationResponseMessage=C.BackendKeyDataMessage=C.AuthenticationMD5Password=C.ParameterStatusMessage=C.ParameterDescriptionMessage=C.RowDescriptionMessage=C.Field=C.CopyResponse=C.CopyDataMessage=C.DatabaseError=C.copyDone=C.emptyQuery=C.replicationStart=C.portalSuspended=C.noData=C.closeComplete=C.bindComplete=C.parseComplete=void 0;C.parseComplete={name:"parseComplete",length:5};C.bindComplete={name:"bindComplete",length:5};C.closeComplete={name:"closeComplete",length:5};C.noData={name:"noData",length:5};C.portalSuspended={name:"portalSuspended",length:5};C.replicationStart={name:"replicationStart",length:4};C.emptyQuery={name:"emptyQuery",length:4};C.copyDone={name:"copyDone",length:4};var ca=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};C.DatabaseError=ca;var la=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};C.CopyDataMessage=la;var da=class{constructor(e,t,s,n){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(n)}};C.CopyResponse=da;var fa=class{constructor(e,t,s,n,i,a,o){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=a,this.format=o}};C.Field=fa;var ha=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};C.RowDescriptionMessage=ha;var pa=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};C.ParameterDescriptionMessage=pa;var ma=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};C.ParameterStatusMessage=ma;var ga=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};C.AuthenticationMD5Password=ga;var ya=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};C.BackendKeyDataMessage=ya;var _a=class{constructor(e,t,s,n){this.length=e,this.processId=t,this.channel=s,this.payload=n,this.name="notification"}};C.NotificationResponseMessage=_a;var va=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};C.ReadyForQueryMessage=va;var Sa=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};C.CommandCompleteMessage=Sa;var Ea=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};C.DataRowMessage=Ea;var ba=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};C.NoticeMessage=ba});var yl=f(dn=>{"use strict";Object.defineProperty(dn,"__esModule",{value:!0});dn.Writer=void 0;var Ta=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};dn.Writer=Ta});var vl=f(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.serialize=void 0;var Aa=yl(),Q=new Aa.Writer,Av=r=>{Q.addInt16(3).addInt16(0);for(let s of Object.keys(r))Q.addCString(s).addCString(r[s]);Q.addCString("client_encoding").addCString("UTF8");let e=Q.addCString("").flush(),t=e.length+4;return new Aa.Writer().addInt32(t).add(e).flush()},Cv=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},xv=r=>Q.addCString(r).flush(112),Rv=function(r,e){return Q.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),Q.flush(112)},Iv=function(r){return Q.addString(r).flush(112)},Ov=r=>Q.addCString(r).flush(81),_l=[],Lv=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||_l,s=t.length,n=Q.addCString(e).addCString(r.text).addInt16(s);for(let i=0;i<s;i++)n.addInt32(t[i]);return Q.flush(80)},gr=new Aa.Writer,kv=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(Q.addInt16(0),gr.addInt32(-1)):s instanceof Buffer?(Q.addInt16(1),gr.addInt32(s.length),gr.add(s)):(Q.addInt16(0),gr.addInt32(Buffer.byteLength(s)),gr.addString(s))}},Nv=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,n=r.values||_l,i=n.length;return Q.addCString(e).addCString(t),Q.addInt16(i),kv(n,r.valueMapper),Q.addInt16(i),Q.add(gr.flush()),Q.addInt16(1),Q.addInt16(s?1:0),Q.flush(66)},Mv=Buffer.from([69,0,0,0,9,0,0,0,0,0]),Pv=r=>{if(!r||!r.portal&&!r.rows)return Mv;let e=r.portal||"",t=r.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,i=Buffer.allocUnsafe(1+n);return i[0]=69,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[s+5]=0,i.writeUInt32BE(t,i.length-4),i},qv=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},Ca=(r,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=r,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},Dv=Q.addCString("P").flush(68),$v=Q.addCString("S").flush(68),Bv=r=>r.name?Ca(68,`${r.type}${r.name||""}`):r.type==="P"?Dv:$v,Fv=r=>{let e=`${r.type}${r.name||""}`;return Ca(67,e)},jv=r=>Q.add(r).flush(100),Uv=r=>Ca(102,r),fn=r=>Buffer.from([r,0,0,0,4]),Vv=fn(72),Wv=fn(83),Gv=fn(88),Qv=fn(99),Hv={startup:Av,password:xv,requestSsl:Cv,sendSASLInitialResponseMessage:Rv,sendSCRAMClientFinalMessage:Iv,query:Ov,parse:Lv,bind:Nv,execute:Pv,describe:Bv,close:Fv,flush:()=>Vv,sync:()=>Wv,end:()=>Gv,copyData:jv,copyDone:()=>Qv,copyFail:Uv,cancel:qv};hn.serialize=Hv});var Sl=f(pn=>{"use strict";Object.defineProperty(pn,"__esModule",{value:!0});pn.BufferReader=void 0;var Xv=Buffer.allocUnsafe(0),xa=class{constructor(e=0){this.offset=e,this.buffer=Xv,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};pn.BufferReader=xa});var wl=f(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.Parser=void 0;var Y=wa(),zv=Sl(),Ra=1,Kv=4,El=Ra+Kv,bl=Buffer.allocUnsafe(0),Ia=class{constructor(e){if(this.buffer=bl,this.bufferLength=0,this.bufferOffset=0,this.reader=new zv.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+El<=s;){let i=this.buffer[n],a=this.buffer.readUInt32BE(n+Ra),o=Ra+a;if(o+n<=s){let u=this.handlePacket(n+El,i,a,this.buffer);t(u),n+=o}else break}n===s?(this.buffer=bl,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let n;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let i=this.buffer.byteLength*2;for(;t>=i;)i*=2;n=Buffer.allocUnsafe(i)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,n){switch(t){case 50:return Y.bindComplete;case 49:return Y.parseComplete;case 51:return Y.closeComplete;case 110:return Y.noData;case 115:return Y.portalSuspended;case 99:return Y.copyDone;case 87:return Y.replicationStart;case 73:return Y.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:return new Y.DatabaseError("received invalid response: "+t.toString(16),s,"error")}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new Y.ReadyForQueryMessage(t,n)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new Y.CommandCompleteMessage(t,n)}parseCopyData(e,t,s){let n=s.slice(e,e+(t-4));return new Y.CopyDataMessage(t,n)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,n){this.reader.setBuffer(e,s);let i=this.reader.byte()!==0,a=this.reader.int16(),o=new Y.CopyResponse(t,n,i,a);for(let u=0;u<a;u++)o.columnTypes[u]=this.reader.int16();return o}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.cstring(),a=this.reader.cstring();return new Y.NotificationResponseMessage(t,n,i,a)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Y.RowDescriptionMessage(t,n);for(let a=0;a<n;a++)i.fields[a]=this.parseField();return i}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),s=this.reader.int16(),n=this.reader.uint32(),i=this.reader.int16(),a=this.reader.int32(),o=this.reader.int16()===0?"text":"binary";return new Y.Field(e,t,s,n,i,a,o)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Y.ParameterDescriptionMessage(t,n);for(let a=0;a<n;a++)i.dataTypeIDs[a]=this.reader.int32();return i}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Array(n);for(let a=0;a<n;a++){let o=this.reader.int32();i[a]=o===-1?null:this.reader.string(o)}return new Y.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),i=this.reader.cstring();return new Y.ParameterStatusMessage(t,n,i)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.int32();return new Y.BackendKeyDataMessage(t,n,i)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i={name:"authenticationOk",length:t};switch(n){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";let a=this.reader.bytes(4);return new Y.AuthenticationMD5Password(t,a)}break;case 10:{i.name="authenticationSASL",i.mechanisms=[];let a;do a=this.reader.cstring(),a&&i.mechanisms.push(a);while(a)}break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(t-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return i}parseErrorMessage(e,t,s,n){this.reader.setBuffer(e,s);let i={},a=this.reader.string(1);for(;a!=="\0";)i[a]=this.reader.cstring(),a=this.reader.string(1);let o=i.M,u=n==="notice"?new Y.NoticeMessage(t,o):new Y.DatabaseError(o,t,n);return u.severity=i.S,u.code=i.C,u.detail=i.D,u.hint=i.H,u.position=i.P,u.internalPosition=i.p,u.internalQuery=i.q,u.where=i.W,u.schema=i.s,u.table=i.t,u.column=i.c,u.dataType=i.d,u.constraint=i.n,u.file=i.F,u.line=i.L,u.routine=i.R,u}};mn.Parser=Ia});var Oa=f(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});ht.DatabaseError=ht.serialize=ht.parse=void 0;var Yv=wa();Object.defineProperty(ht,"DatabaseError",{enumerable:!0,get:function(){return Yv.DatabaseError}});var Zv=vl();Object.defineProperty(ht,"serialize",{enumerable:!0,get:function(){return Zv.serialize}});var Jv=wl();function eS(r,e){let t=new Jv.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}ht.parse=eS});var Tl=f(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.default={}});var Cl=f((JR,Al)=>{var{getStream:tS,getSecureStream:rS}=aS();Al.exports={getStream:tS,getSecureStream:rS};function sS(){function r(t){let s=require("net");return new s.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function nS(){function r(t){let{CloudflareSocket:s}=Tl();return new s(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function iS(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function aS(){return iS()?nS():sS()}});var Na=f((eI,xl)=>{"use strict";var oS=require("events").EventEmitter,{parse:uS,serialize:re}=Oa(),{getStream:cS,getSecureStream:lS}=Cl(),dS=re.flush(),fS=re.sync(),hS=re.end(),ka=class extends oS{constructor(e){super(),e=e||{},this.stream=e.stream||cS(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(s){s==="message"&&(t._emitMessage=!0)})}connect(e,t){let s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=function(i){s._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||s.emit("error",i)};if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){switch(i.toString("utf8")){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let o={socket:s.stream};s.ssl!==!0&&(Object.assign(o,s.ssl),"key"in s.ssl&&(o.key=s.ssl.key));let u=require("net");u.isIP&&u.isIP(t)===0&&(o.servername=t);try{s.stream=lS(o)}catch(c){return s.emit("error",c)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){uS(e,t=>{let s=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(s,t)})}requestSsl(){this.stream.write(re.requestSsl())}startup(e){this.stream.write(re.startup(e))}cancel(e,t){this._send(re.cancel(e,t))}password(e){this._send(re.password(e))}sendSASLInitialResponseMessage(e,t){this._send(re.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(re.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(re.query(e))}parse(e){this._send(re.parse(e))}bind(e){this._send(re.bind(e))}execute(e){this._send(re.execute(e))}flush(){this.stream.writable&&this.stream.write(dS)}sync(){this._ending=!0,this._send(fS)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(hS,()=>{this.stream.end()})}close(e){this._send(re.close(e))}describe(e){this._send(re.describe(e))}sendCopyFromChunk(e){this._send(re.copyData(e))}endCopyFrom(){this._send(re.copyDone())}sendCopyFail(e){this._send(re.copyFail(e))}};xl.exports=ka});var Ll=f((tI,Ol)=>{"use strict";var{Transform:pS}=require("stream"),{StringDecoder:mS}=require("string_decoder"),pt=Symbol("last"),gn=Symbol("decoder");function gS(r,e,t){let s;if(this.overflow){if(s=this[gn].write(r).split(this.matcher),s.length===1)return t();s.shift(),this.overflow=!1}else this[pt]+=this[gn].write(r),s=this[pt].split(this.matcher);this[pt]=s.pop();for(let n=0;n<s.length;n++)try{Il(this,this.mapper(s[n]))}catch(i){return t(i)}if(this.overflow=this[pt].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function yS(r){if(this[pt]+=this[gn].end(),this[pt])try{Il(this,this.mapper(this[pt]))}catch(e){return r(e)}r()}function Il(r,e){e!==void 0&&r.push(e)}function Rl(r){return r}function _S(r,e,t){switch(r=r||/\r?\n/,e=e||Rl,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=Rl)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=gS,t.flush=yS,t.readableObjectMode=!0;let s=new pS(t);return s[pt]="",s[gn]=new mS("utf8"),s.matcher=r,s.mapper=e,s.maxLength=t.maxLength,s.skipOverflow=t.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,i){this._writableState.errorEmitted=!1,i(n)},s}Ol.exports=_S});var Ml=f((rI,Je)=>{"use strict";var kl=require("path"),vS=require("stream").Stream,SS=Ll(),Nl=require("util"),ES=5432,yn=process.platform==="win32",ds=process.stderr,bS=56,wS=7,TS=61440,AS=32768;function CS(r){return(r&TS)==AS}var yr=["host","port","database","user","password"],Ma=yr.length,xS=yr[Ma-1];function Pa(){var r=ds instanceof vS&&ds.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);ds.write(Nl.format.apply(Nl,e))}}Object.defineProperty(Je.exports,"isWin",{get:function(){return yn},set:function(r){yn=r}});Je.exports.warnTo=function(r){var e=ds;return ds=r,e};Je.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(yn?kl.join(e.APPDATA||"./","postgresql","pgpass.conf"):kl.join(e.HOME||"./",".pgpass"));return t};Je.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:yn?!0:(e=e||"<unkn>",CS(r.mode)?r.mode&(bS|wS)?(Pa('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Pa('WARNING: password file "%s" is not a plain file',e),!1))};var RS=Je.exports.match=function(r,e){return yr.slice(0,-1).reduce(function(t,s,n){return n==1&&Number(r[s]||ES)===Number(e[s])?t&&!0:t&&(e[s]==="*"||e[s]===r[s])},!0)};Je.exports.getPassword=function(r,e,t){var s,n=e.pipe(SS());function i(u){var c=IS(u);c&&OS(c)&&RS(r,c)&&(s=c[xS],n.end())}var a=function(){e.destroy(),t(s)},o=function(u){e.destroy(),Pa("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",o),n.on("data",i).on("end",a).on("error",o)};var IS=Je.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",s=0,n=0,i=0,a={},o=!1,u=function(l,d,m){var h=r.substring(d,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(h=h.replace(/\\([:\\])/g,"$1")),a[yr[l]]=h},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),o=s==Ma-1,o){u(s,n);break}c>=0&&e==":"&&t!=="\\"&&(u(s,n,c+1),n=c+2,s+=1)}return a=Object.keys(a).length===Ma?a:null,a},OS=Je.exports.isValidEntry=function(r){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},t=0;t<yr.length;t+=1){var s=e[t],n=r[yr[t]]||"",i=s(n);if(!i)return!1}return!0}});var ql=f((nI,qa)=>{"use strict";var sI=require("path"),Pl=require("fs"),_n=Ml();qa.exports=function(r,e){var t=_n.getFileName();Pl.stat(t,function(s,n){if(s||!_n.usePgPass(n,t))return e(void 0);var i=Pl.createReadStream(t);_n.getPassword(r,i,e)})};qa.exports.warnTo=_n.warnTo});var Fl=f((iI,Bl)=>{"use strict";var LS=require("events").EventEmitter,Dl=fr(),Da=sl(),kS=ln(),NS=ia(),$l=gl(),MS=cs(),PS=Na(),qS=ra(),vn=class extends LS{constructor(e){super(),this.connectionParameters=new NS(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new kS(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new PS({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||MS.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){t.ssl?s.requestSsl():s.startup(t.getStartupConf())}),s.on("sslconnect",function(){s.startup(t.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,s)=>{this._connect(n=>{n?s(n):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{t.emit("error",s)});else if(this.password!==null)e();else try{ql()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await qS.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Da.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await Da.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{Da.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(t.application_name=s),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,s){return this._types.setTypeParser(e,t,s)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return Dl.escapeIdentifier(e)}escapeLiteral(e){return Dl.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,s){let n,i,a,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,typeof t=="function"&&(n.callback=n.callback||t)):(a=e.query_timeout||this.connectionParameters.query_timeout,n=new $l(e,t,s),n.callback||(i=new this._Promise((c,l)=>{n.callback=(d,m)=>d?l(d):c(m)}).catch(c=>{throw Error.captureStackTrace(c),c}))),a&&(u=n.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{n.handleError(c,this.connection)}),u(c),n.callback=()=>{};let l=this.queryQueue.indexOf(n);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(n),this._pulseQueryQueue(),i):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};vn.Query=$l;Bl.exports=vn});var Wl=f((aI,Vl)=>{"use strict";var DS=require("events").EventEmitter,jl=function(){},Ul=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},$a=class{constructor(e,t,s){this.client=e,this.idleListener=t,this.timeoutId=s}},_r=class{constructor(e){this.callback=e}};function $S(){throw new Error("Release called on client which has already been released to the pool.")}function Sn(r,e){if(e)return{callback:e,result:void 0};let t,s,n=function(a,o){a?t(a):s(o)},i=new r(function(a,o){s=a,t=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:n,result:i}}function BS(r,e){return function t(s){s.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",s)}),r._remove(e),r.emit("error",s,e)}}var Ba=class extends DS{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||Fa().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let s=t.client;s.ref&&s.ref();let n=t.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let s=Ul(this._idle,i=>i.client===e);s!==void 0&&clearTimeout(s.timeoutId),this._clients=this._clients.filter(i=>i!==e);let n=this;e.end(()=>{n.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let t=Sn(this.Promise,e),s=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new _r(t.callback)),s;let n=(o,u,c)=>{clearTimeout(a),t.callback(o,u,c)},i=new _r(n),a=setTimeout(()=>{Ul(this._pendingQueue,o=>o.callback===n),i.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(i),s}return this.newClient(new _r(t.callback)),s}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let s=BS(this,t);this.log("checking client timeout");let n,i=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),i=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(a=>{if(n&&clearTimeout(n),t.on("error",s),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==t),i&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,jl);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new _r((c,l,d)=>d()),s,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),t.once("end",()=>clearTimeout(o))}return this._acquireClient(t,e,s,!0)}})}_acquireClient(e,t,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),t.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,i=>{if(i)return e.release(i),t.callback(i,void 0,jl);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let s=!1;return n=>{s&&$S(),s=!0,this._release(e,t,n)}}_release(e,t,s){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let i;this.options.idleTimeoutMillis&&this._isAboveMin()&&(i=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&i.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new $a(e,t,i)),this._pulseQueue()}query(e,t,s){if(typeof e=="function"){let i=Sn(this.Promise,e);return setImmediate(function(){return i.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),i.result}typeof t=="function"&&(s=t,t=void 0);let n=Sn(this.Promise,s);return s=n.callback,this.connect((i,a)=>{if(i)return s(i);let o=!1,u=c=>{o||(o=!0,a.release(c),s(c))};a.once("error",u),this.log("dispatching query");try{a.query(e,t,(c,l)=>{if(this.log("query dispatched"),a.removeListener("error",u),!o)return o=!0,a.release(c),c?s(c):s(void 0,l)})}catch(c){return a.release(c),s(c)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let t=Sn(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Vl.exports=Ba});var Hl=f((oI,Ql)=>{"use strict";var Gl=require("events").EventEmitter,FS=require("util"),ja=fr(),vr=Ql.exports=function(r,e,t){Gl.call(this),r=ja.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};FS.inherits(vr,Gl);var jS={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};vr.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let s=jS[t]||t;r[s]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};vr.prototype.then=function(r,e){return this._getPromise().then(r,e)};vr.prototype.catch=function(r){return this._getPromise().catch(r)};vr.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};vr.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(s,n,i){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(i.length>1?n.forEach((a,o)=>{a.forEach(u=>{e.emit("row",u,i[o])})}):n.forEach(function(a){e.emit("row",a,i)})),e.state="end",e.emit("end",i),e.callback&&e.callback(null,i)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let s=(this.values||[]).map(ja.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let n=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(n)}return r.native.execute(this.name,s,t)}return r.native.prepare(this.name,this.text,s.length,function(n){return n?t(n):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,s,t))})}else if(this.values){if(!Array.isArray(this.values)){let n=new Error("Query values must be an array");return t(n)}let s=this.values.map(ja.prepareValue);r.native.query(this.text,s,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var Zl=f((uI,Yl)=>{"use strict";var Xl;try{Xl=require("pg-native")}catch(r){throw r}var US=ln(),zl=require("events").EventEmitter,VS=require("util"),WS=ia(),Kl=Hl(),ve=Yl.exports=function(r){zl.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new US(r.types),this.native=new Xl({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new WS(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};ve.Query=Kl;VS.inherits(ve,zl);ve.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};ve.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(s,function(n){if(n)return e.native.end(),r(n);e._connected=!0,e.native.on("error",function(i){e._queryable=!1,e._errorAllQueries(i),e.emit("error",i)}),e.native.on("notification",function(i){e.emit("notification",{channel:i.relname,payload:i.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};ve.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(s=>{s?t(s):e()})})};ve.prototype.query=function(r,e,t){let s,n,i,a,o;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")i=r.query_timeout||this.connectionParameters.query_timeout,n=s=r,typeof e=="function"&&(r.callback=e);else if(i=r.query_timeout||this.connectionParameters.query_timeout,s=new Kl(r,e,t),!s.callback){let u,c;n=new this._Promise((l,d)=>{u=l,c=d}).catch(l=>{throw Error.captureStackTrace(l),l}),s.callback=(l,d)=>l?c(l):u(d)}return i&&(o=s.callback,a=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),o(u),s.callback=()=>{};let c=this._queryQueue.indexOf(s);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},i),s.callback=(u,c)=>{clearTimeout(a),o(u,c)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};ve.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(s,n){r=i=>i?n(i):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};ve.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};ve.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};ve.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};ve.prototype.ref=function(){};ve.prototype.unref=function(){};ve.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};ve.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var Ua=f((cI,Jl)=>{"use strict";Jl.exports=Zl()});var Fa=f((dI,fs)=>{"use strict";var GS=Fl(),QS=cs(),HS=Na(),XS=oa(),zS=fr(),KS=Wl(),YS=ln(),{DatabaseError:ZS}=Oa(),{escapeIdentifier:JS,escapeLiteral:eE}=fr(),tE=r=>class extends KS{constructor(t){super(t,r)}},Va=function(r){this.defaults=QS,this.Client=r,this.Query=this.Client.Query,this.Pool=tE(this.Client),this._pools=[],this.Connection=HS,this.types=us(),this.DatabaseError=ZS,this.TypeOverrides=YS,this.escapeIdentifier=JS,this.escapeLiteral=eE,this.Result=XS,this.utils=zS};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?fs.exports=new Va(Ua()):(fs.exports=new Va(GS),Object.defineProperty(fs.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new Va(Ua())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(fs.exports,"native",{value:r}),r}}))});var nd=f((wI,sd)=>{"use strict";function Wa(r){return typeof r=="function"}var pe=console.error.bind(console);function hs(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function ps(r){r&&r.logger&&(Wa(r.logger)?pe=r.logger:pe("new logger isn't a function, not replacing"))}function td(r,e,t){if(!r||!r[e]){pe("no original function "+e+" to wrap");return}if(!t){pe("no wrapper function"),pe(new Error().stack);return}if(!Wa(r[e])||!Wa(t)){pe("original object and wrapper must be functions");return}var s=r[e],n=t(s,e);return hs(n,"__original",s),hs(n,"__unwrap",function(){r[e]===n&&hs(r,e,s)}),hs(n,"__wrapped",!0),hs(r,e,n),n}function rE(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{pe("must provide one or more modules to patch"),pe(new Error().stack);return}if(!(e&&Array.isArray(e))){pe("must provide one or more functions to wrap on modules");return}r.forEach(function(s){e.forEach(function(n){td(s,n,t)})})}function rd(r,e){if(!r||!r[e]){pe("no function to unwrap."),pe(new Error().stack);return}if(!r[e].__unwrap)pe("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function sE(r,e){if(r)Array.isArray(r)||(r=[r]);else{pe("must provide one or more modules to patch"),pe(new Error().stack);return}if(!(e&&Array.isArray(e))){pe("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(s){rd(t,s)})})}ps.wrap=td;ps.massWrap=rE;ps.unwrap=rd;ps.massUnwrap=sE;sd.exports=ps});var cd=f((TI,ud)=>{"use strict";var ad=nd(),Sr=ad.wrap,En=ad.unwrap,et="wrap@before";function bn(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function nE(r,e){for(var t=e.length,s=0;s<t;s++){var n=e[s],i=r[et];if(typeof i=="function")i(n);else if(Array.isArray(i))for(var a=i.length,o=0;o<a;o++)i[o](n)}}function od(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function iE(r,e,t){var s=od(r,e),n=s.filter(function(i){return t.indexOf(i)===-1});n.length>0&&nE(r,n)}function id(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var s=0;s<r.length;s++)t[s]=e(r[s])}return t}}ud.exports=function(e,t,s){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!s)throw new Error("must have function to wrap listeners when emitting");function n(a){return function(u,c){var l=od(this,u).slice();try{var d=a.call(this,u,c);return iE(this,u,l),d}finally{this.on.__wrapped||Sr(this,"on",n),this.addListener.__wrapped||Sr(this,"addListener",n)}}}function i(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=id(c,s)}}}Sr(this,"removeListener",l);try{return this._events[u]=id(c,s),a.apply(this,arguments)}finally{En(this,"removeListener"),this._events[u]=c}}}e[et]?typeof e[et]=="function"?bn(e,et,[e[et],t]):Array.isArray(e[et])&&e[et].push(t):bn(e,et,t),e.__wrapped||(Sr(e,"addListener",n),Sr(e,"on",n),Sr(e,"emit",i),bn(e,"__unwrap",function(){En(e,"addListener"),En(e,"on"),En(e,"emit"),delete e[et],delete e.__wrapped}),bn(e,"__wrapped",!0))}});var hd=f((AI,fd)=>{"use strict";var M=require("util"),tt=require("assert"),aE=cd(),V=require("async_hooks"),ms="cls@contexts",gs="error@context",Z=process.env.DEBUG_CLS_HOOKED,N=-1;fd.exports={getNamespace:ld,createNamespace:oE,destroyNamespace:dd,reset:uE,ERROR_SYMBOL:gs};function xe(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}xe.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,Z){let s=" ".repeat(this._indent<0?0:this._indent);H(s+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+N+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};xe.prototype.get=function(e){if(!this.active){if(Z){let t=V.currentId(),s=V.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);H(`${n}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length}`)}return}if(Z){let t=V.executionAsyncId(),s=V.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);H(n+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+N+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),H(`${n}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} active:${M.inspect(this.active)}`)}return this.active[e]};xe.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=N,Z){let t=V.executionAsyncId(),s=V.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);H(`${n}CONTEXT-CREATED Context: (${this.name}) currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} context:${M.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};xe.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(Z){let s=V.triggerAsyncId(),n=V.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);H(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} context:${M.inspect(t)}`)}return e(t),t}catch(s){throw s&&(s[gs]=t),s}finally{if(Z){let s=V.triggerAsyncId(),n=V.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);H(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${M.inspect(t)}`)}this.exit(t)}};xe.prototype.runAndReturn=function(e){let t;return this.run(function(s){t=e(s)}),t};xe.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let s=e(t);if(!s||!s.then||!s.catch)throw new Error("fn must return a promise.");return Z&&H("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),s.then(n=>(Z&&H("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),this.exit(t),n)).catch(n=>{throw n[gs]=t,Z&&H("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),this.exit(t),n})};xe.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let s=this;return function(){s.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[gs]=t),i}finally{s.exit(t)}}};xe.prototype.enter=function(e){if(tt.ok(e,"context must be provided for entering"),Z){let t=V.executionAsyncId(),s=V.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);H(`${n}CONTEXT-ENTER: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${t} len:${this._set.length} ${M.inspect(e)}`)}this._set.push(this.active),this.active=e};xe.prototype.exit=function(e){if(tt.ok(e,"context must be provided for exiting"),Z){let s=V.executionAsyncId(),n=V.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);H(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${N} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${M.inspect(e)}`)}if(this.active===e){tt.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(Z&&H("??ERROR?? context exiting but not entered - ignoring: "+M.inspect(e)),tt.ok(t>=0,`context not currently entered; can't exit. 
`+M.inspect(this)+`
`+M.inspect(e))):(tt.ok(t,"can't remove top context"),this._set.splice(t,1))};xe.prototype.bindEmitter=function(e){tt.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,s="context@"+this.name;function n(a){a&&(a[ms]||(a[ms]=Object.create(null)),a[ms][s]={namespace:t,context:t.active})}function i(a){if(!(a&&a[ms]))return a;let o=a,u=a[ms];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}aE(e,n,i)};xe.prototype.fromException=function(e){return e[gs]};function ld(r){return process.namespaces[r]}function oE(r){tt.ok(r,"namespace must be given a name."),Z&&H(`NS-CREATING NAMESPACE (${r})`);let e=new xe(r);return e.id=N,V.createHook({init(s,n,i,a){if(N=V.executionAsyncId(),e.active){if(e._contexts.set(s,e.active),Z){let o=" ".repeat(e._indent<0?0:e._indent);H(`${o}INIT [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(N===0){let o=V.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(s,u),Z){let c=" ".repeat(e._indent<0?0:e._indent);H(`${c}INIT USING CONTEXT FROM TRIGGERID [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(Z){let c=" ".repeat(e._indent<0?0:e._indent);H(`${c}INIT MISSING CONTEXT [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(Z&&n==="PROMISE"){H(M.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);H(`${u}INIT RESOURCE-PROMISE [${n}] (${r}) parentId:${o} asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(s){N=V.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(N),n){if(Z){let i=V.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);H(`${a}BEFORE (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`),e._indent+=2}e.enter(n)}else if(Z){let i=V.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);H(`${a}BEFORE MISSING CONTEXT (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${M.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(s){N=V.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(N),n){if(Z){let i=V.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);H(`${a}AFTER (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`)}e.exit(n)}else if(Z){let i=V.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);H(`${a}AFTER MISSING CONTEXT (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`)}},destroy(s){if(N=V.executionAsyncId(),Z){let n=V.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);H(`${i}DESTROY (${r}) currentUid:${N} asyncId:${s} triggerId:${n} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(e._contexts.get(N))}`)}e._contexts.delete(s)}}).enable(),process.namespaces[r]=e,e}function dd(r){let e=ld(r);tt.ok(e,`can't delete nonexistent namespace! "`+r+'"'),tt.ok(e.id,"don't assign to process.namespaces directly! "+M.inspect(e)),process.namespaces[r]=null}function uE(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){dd(r)}),process.namespaces=Object.create(null)}process.namespaces={};function H(...r){Z&&process._rawDebug(`${M.format(...r)}`)}});var X=f((CI,gd)=>{"use strict";var Ga=["debug","info","warn","error","silent"],pd=Ga.indexOf("error"),cE=lE(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),md={error:wn("error"),info:wn("info"),warn:wn("warn"),debug:wn("debug")};function wn(r){var e=Ga.indexOf(r),t=console[r]||console.log||(()=>{});return e>=cE?(s,n)=>{(s||n)&&t(hE(r,s,n))}:()=>{}}function lE(r){if(r){var e=r.toLowerCase(),t=Ga.indexOf(e);return t>=0?t:pd}return pd}function dE(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",s=function(n){var i=Math.floor(Math.abs(n));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+s(e/60)+":"+s(e%60)}function fE(){return process.env.LAMBDA_TASK_ROOT!==void 0}function hE(r,e,t){var s=[];fE()||(s.push(dE(new Date)),s.push(`[${r.toUpperCase()}]`)),e&&s.push(e);var n=s.join(" "),i=pE(t);return[n,i].filter(a=>a.length>0).join(`
  `)}function pE(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var mE={setLogger:function(e){md=e},getLogger:function(){return md}};gd.exports=mE});var Qa=f((xI,_d)=>{"use strict";var gE=require("crypto");function yd(r,e){this.init(r,e)}yd.prototype.init=function(e,t){var s=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=s.message,this.type=s.name,this.stack=[],this.remote=!!t,this.id=gE.randomBytes(8).toString("hex"),s.stack){var n=s.stack.split(`
`);n.shift(),n.forEach(i=>{var a=i.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};_d.exports=yd});var Sd=f((RI,vd)=>{vd.exports=yE;function yE(r){var e=!1,t=null,s=null,n=null;return a;function i(o){n&&SE(n,o),e=!1,n=s;var u=t;if(t=null,s=null,!u||!u.length){if(!n||!n.length){n=null;return}u||(u=[])}e=!0,r(u,i)}function a(o,u){e?(t||(t=[],s=[]),_E(t,o),u&&s.push(u)):(u&&(n=[u]),e=!0,r(Array.isArray(o)?o:[o],i))}}function _E(r,e){Array.isArray(e)?vE(r,e):r.push(e)}function vE(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function SE(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Tn=f((II,wd)=>{"use strict";var Ed=X(),$e={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?Ed.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(bd(e),Ed.getLogger().info("Configured daemon address to "+e+"."))}},bd=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var s=e.split(":");if(!s[0])throw new Error("Invalid Daemon Address. You must specify an ip.");$e.udp_ip=s[0],$e.tcp_ip=s[0],$e.udp_port=s[1],$e.tcp_port=s[1]}else if(t.length===2){var n=t[0].split(":"),i=t[1].split(":"),a={};if(a[n[0]]=n,a[i[0]]=i,$e.udp_ip=a.udp[1],$e.udp_port=parseInt(a.udp[2]),$e.tcp_ip=a.tcp[1],$e.tcp_port=parseInt(a.tcp[2]),!$e.udp_port||!$e.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&bd(process.env.AWS_XRAY_DAEMON_ADDRESS);wd.exports=$e});var Cn=f((OI,Id)=>{"use strict";var Cd=require("dgram"),EE=Sd(),An=X(),Td='{"format":"json","version":1}',Ad=`
`;function bE(r,e){var t=Cd.createSocket("udp4");xd(t,r,0,function(){try{t.close()}finally{e()}})}function xd(r,e,t,s){if(t>=e.length){s();return}wE(r,e[t],function(){xd(r,e,t+1,s)})}function wE(r,e,t){var s=e.msg,n=e.offset,i=e.length,a=e.port,o=e.address,u=e.callback;r.send(s,n,i,a,o,function(c){try{u(c)}finally{t()}})}function Rd(){this.batchSend=EE(bE)}Rd.prototype.send=function(r,e,t,s,n,i){var a={msg:r,offset:e,length:t,port:s,address:n,callback:i};this.batchSend(a)};var TE={daemonConfig:Tn(),format:function(e){return Td+Ad+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new Rd:this.socket=Cd.createSocket("udp4").unref());var t=this.socket,s=e.format(),n=Td+Ad+s,i=Buffer.from(n),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?An.getLogger().error(o+" too large to send: "+a+" ("+i.length+" bytes)."):An.getLogger().error("Error occured sending segment: ",u):(An.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),An.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};Id.exports=TE});var Rn=f((LI,Od)=>{"use strict";var AE=require("crypto"),xn=X(),Ha=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||AE.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var s=new r,n,i;if(!e||typeof e!="string")return xn.getLogger().error("Empty or non-string trace ID provided"),s;let a=e.trim().split(t);return a.length!==3?(xn.getLogger().error("Unrecognized trace ID format"),s):(n=parseInt(a[0]),isNaN(n)||n<1?(xn.getLogger().error("Trace ID version must be positive integer"),s):(i=parseInt(a[1],16).toString(16),i==="NaN"?(xn.getLogger().error("Trace ID timestamp must be a hex-encoded value"),s):(i=i.padStart(8,"0"),s.version=n,s.timestamp=i,s.id=a[2],s)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};Od.exports=Ha});var oe=f((kI,Ld)=>{"use strict";var CE=require("crypto"),ys=X(),xE=Rn(),Xa={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var s=e.length,n=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===s-1){var a=function(){for(var m=0,h=0;h<s;h++){var b=e.charAt(h);if(b==="*")return!0;if(b==="?"){if(m===n)return!1;m++}else{if(m>=n||b!=t.charAt(m))return!1;m++}}return m===n};return a()}var o=[];o[0]=!0;for(var u=0;u<s;u++){var c,l=e.charAt(u);if(l!="*")for(c=n-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=n&&!o[c];)c++;for(c;c<=n;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[n]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=Xa.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){ys.getLogger().debug("Lambda trace data found: "+e);let t=Xa.processTraceData(e);var s=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,s=!0):!t.root||!t.parent||!t.sampled?ys.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):s=!0:(t={},ys.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=xE.FromString(t.root).toString(),r.id=t.parent||CE.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(ys.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),s=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),ys.getLogger().debug("Segment started: "+JSON.stringify(t)),s}},processTraceData:function(e){var t={},s={},n=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),d=n.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(s[u]=c,i-=u.length+c.length)}}}),t.data=s),t},objectWithoutProperties:function(e,t,s){t=Array.isArray(t)?t:[],s=typeof s=="boolean"?s:!1;var n=s?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};Ld.exports=Xa});var mt=f((NI,Md)=>{"use strict";var{safeParseInt:kd}=oe(),Nd=X(),RE=100,za={streamingThreshold:RE,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(za.streamingThreshold=e,Nd.getLogger().debug("Subsegment streaming threshold set to: "+e)):Nd.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return za.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=kd(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=kd(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};Md.exports=za});var Dd=f((MI,qd)=>{"use strict";var{getHttpResponseData:IE}=mt(),{stripQueryStringFromPath:OE}=oe();function Pd(r,e,t){this.init(r,e,t)}Pd.prototype.init=function(e,t,s){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+OE(e.path):"",method:e.method||""},s&&(this.request.traced=!0),t&&(this.response=IE(t))};qd.exports=Pd});var _s=f((PI,$d)=>{"use strict";var LE=require("crypto"),kE=Qa(),NE=Dd(),ME=Cn(),In=mt(),PE=oe(),rt=X();function P(r){this.init(r)}P.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=LE.randomBytes(8).toString("hex"),this.name=e,this.start_time=In.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};P.prototype.addNewSubsegment=function(e){let t=new P(e);return this.addSubsegment(t),t};P.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};P.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new P(e);return this.addSubsegment(t),t.notTraced=!0,t};P.prototype.addSubsegment=function(r){if(!(r instanceof P))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};P.prototype.removeSubsegment=function(e){if(!(e instanceof P))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};P.prototype.addAttribute=function(e,t){this[e]=t};P.prototype.addPrecursorId=function(r){typeof r!="string"&&rt.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};P.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){rt.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){rt.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};P.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){rt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){rt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};P.prototype.addSqlData=function(e){this.sql=e};P.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){rt.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new kE(e,t))};P.prototype.addRemoteRequestData=function(e,t,s){this.http=new NE(e,t,s),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};P.prototype.addFaultFlag=function(){this.fault=!0};P.prototype.addErrorFlag=function(){this.error=!0};P.prototype.addThrottleFlag=function(){this.throttle=!0};P.prototype.close=function(e,t){var s=this.segment;this.end_time=In.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),s&&s.counter>In.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};P.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};P.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};P.prototype.isClosed=function(){return!this.in_progress};P.prototype.flush=function(){if(!this.parent||!this.segment){rt.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?ME.send(this):rt.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):rt.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};P.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};P.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};P.prototype.toString=function(){return this.serialize()};P.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=PE.objectWithoutProperties(this,e,!1);return t};P.prototype.serialize=function(e){return JSON.stringify(e??this,In.getJsonStringifyReplacer())};$d.exports=P});var vs=f((qI,jd)=>{"use strict";var qE=require("crypto"),DE=Qa(),$E=Cn(),Re=mt(),On=_s(),Bd=Rn(),Fd=oe(),gt=X();function F(r,e,t){this.init(r,e,t)}F.prototype.init=function(e,t,s){if(typeof e!="string")throw new Error("Segment name must be of type string.");var n;t&&typeof t=="string"?n=Bd.FromString(t):n=new Bd;var i=qE.randomBytes(8).toString("hex"),a=Re.getCurrentTime();this.trace_id=n.toString(),this.id=i,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,s&&(this.parent_id=s),Re.serviceData&&this.setServiceData(Re.serviceData),Re.pluginData&&this.addPluginData(Re.pluginData),Re.origin&&(this.origin=Re.origin),Re.sdkData&&this.setSDKData(Re.sdkData)};F.prototype.addIncomingRequestData=function(e){this.http=e};F.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){gt.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){gt.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};F.prototype.setUser=function(r){typeof r!="string"&&gt.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};F.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){gt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){gt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};F.prototype.setSDKData=function(e){if(!e){gt.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};F.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};F.prototype.setServiceData=function(e){if(!e){gt.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};F.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};F.prototype.addNewSubsegment=function(e){var t=new On(e);return this.addSubsegment(t),t};F.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};F.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new On(e);return this.addSubsegment(t),t.notTraced=!0,t};F.prototype.addSubsegment=function(e){if(!(e instanceof On))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};F.prototype.removeSubsegment=function(e){if(!(e instanceof On))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};F.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){gt.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new DE(e,t))};F.prototype.addFaultFlag=function(){this.fault=!0};F.prototype.addErrorFlag=function(){this.error=!0};F.prototype.addThrottleFlag=function(){this.throttle=!0};F.prototype.isClosed=function(){return!this.in_progress};F.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>Re.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(s){s.streamSubsegments()||t.push(s)}),this.subsegments=t}};F.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};F.prototype.close=function(r,e){this.end_time||(this.end_time=Re.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};F.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Fd.objectWithoutProperties(this,["counter","notTraced"],!0);$E.send(e)}};F.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=Fd.objectWithoutProperties(this,e,!1);return this.serialize(t)};F.prototype.toString=function(){return this.serialize()};F.prototype.serialize=function(e){return JSON.stringify(e??this,Re.getJsonStringifyReplacer())};jd.exports=F});var _t=f((DI,Gd)=>{"use strict";var Ss=hd(),Be=X(),Ka=vs(),Ud=_s(),st=!0,yt="AWSXRay",Vd="segment",Wd=!1,ue={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);Be.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!ue.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,s=e.Segment,n=null;return t&&(t instanceof Ka||t instanceof Ud)?(n=t,delete e.XRaySegment,delete e.XraySegment):s&&(s instanceof Ka||s instanceof Ud)&&(n=s,delete e.Segment),n}},getNamespace:function(){return Ss.getNamespace(yt)||Ss.createNamespace(yt)},resolveSegment:function(e){if(st)return this.getSegment();if(e&&!st)return e;!e&&!st&&ue.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(st){var e=ue.getNamespace(yt).get(Vd);return e?e instanceof Ka&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():ue.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else ue.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){st?ue.getNamespace(yt).set(Vd,e)||Be.getLogger().warn("Failed to set the current sub/segment on the context."):ue.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return st},enableAutomaticMode:function(){st=!0,ue.getNamespace(yt),Be.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){st=!1,Ss.getNamespace(yt)&&Ss.destroyNamespace(yt),Be.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Wd)Be.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=ue.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)ue.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Be.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Be.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(ue.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")ue.contextMissingStrategy.contextMissing=e,Be.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(st=!1,Be.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(Ss.createNamespace(yt),Be.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(ue.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Wd=!0):(ue.contextMissingStrategy.contextMissing=ue.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Be.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Gd.exports=ue});var Za=f(($I,Qd)=>{"use strict";var{getHttpResponseData:BE}=mt();function Ya(r){this.init(r)}Ya.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],s;e.connection&&(s=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:FE(e)||"",url:s||""},t&&(this.request.x_forwarded_for=t)};var FE=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};Ya.prototype.close=function(e){this.response=BE(e)};Qd.exports=Ya});var Xd=f((BI,Hd)=>{"use strict";function Ja(r,e){this.init(r,e)}Ja.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Ja.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Hd.exports=Ja});var zd=f((FI,jE)=>{jE.exports={default:{fixed_target:1,rate:.05},version:2}});var to=f((jI,ef)=>{"use strict";var UE=require("fs"),Kd=Xd(),eo=oe(),VE=zd(),Ln=X(),Zd={shouldSample:function(e){var t=e.host,s=e.httpMethod,n=e.urlPath,i="{ http_method: "+s+", host: "+t+", url_path: "+n+" }",a;return this.rules.some(function(o){if(o.default||t==null||eo.wildcardMatch(o.host,t)&&(s==null||eo.wildcardMatch(o.http_method,s))&&(n==null||eo.wildcardMatch(o.url_path,n)))return a=o.reservoir,Ln.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(Ln.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Ln.getLogger().info("Using custom sampling rules file: "+e),this.rules=Yd(JSON.parse(UE.readFileSync(e,"utf8")))):(Ln.getLogger().info("Using custom sampling rules source."),this.rules=Yd(e)):this.rules=Jd(VE)}},Yd=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Jd(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Jd=function(e){var t,s=[];if(e.default){var n=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&n.push("fixed_target"),typeof e.default.rate>"u"&&n.push("rate"),n.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+n+".");t={default:!0,reservoir:new Kd(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var d=o;d.reservoir=new Kd(a.fixed_target,a.rate),s.push(d)}),s.push(t),s};Zd.setLocalRules();ef.exports=Zd});var rf=f((UI,tf)=>{"use strict";function Er(){this.init()}Er.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Er.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Er.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Er.prototype.loadNewQuota=function(e,t,s){e&&(this.quota=e),t&&(this.TTL=t),s&&(this.reportInterval=s/10)};Er.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};tf.exports=Er});var nf=f((VI,sf)=>{"use strict";var Es=oe(),WE=rf();function se(r,e,t,s,n,i,a,o,u){this.init(r,e,t,s,n,i,a,o,u)}se.prototype.init=function(e,t,s,n,i,a,o,u,c){this.name=e,this.priority=t,this.rate=s,this.host=i,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new WE,this.borrow=!!n,this.resetStatistics()};se.prototype.match=function(e){var t=e.host,s=e.httpMethod,n=e.serviceName,i=e.urlPath,a=e.serviceType;return this.isDefault()||(!t||Es.wildcardMatch(this.host,t))&&(!s||Es.wildcardMatch(this.httpMethod,s))&&(!n||Es.wildcardMatch(this.serviceName,n))&&(!i||Es.wildcardMatch(this.urlPath,i))&&(!a||Es.wildcardMatch(this.serviceType,a))};se.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};se.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};se.prototype.isDefault=function(){return this.name==="Default"};se.prototype.incrementRequestCount=function(){this.requestCount++};se.prototype.incrementBorrowCount=function(){this.borrowCount++};se.prototype.incrementSampledCount=function(){this.sampledCount++};se.prototype.setRate=function(e){this.rate=e};se.prototype.getRate=function(){return this.rate};se.prototype.getName=function(){return this.name};se.prototype.getPriority=function(){return this.priority};se.prototype.getReservoir=function(){return this.reservoir};se.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};se.prototype.canBorrow=function(){return this.borrow};se.prototype.everMatched=function(){return this.requestCount>0};se.prototype.timeToReport=function(){return this.reservoir.timeToReport()};sf.exports=se});var ro=f((WI,cf)=>{"use strict";var GE=require("crypto"),QE=X(),HE=nf(),kn=Tn(),XE=require("util"),zE=require("http"),of={clientId:GE.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:QE,httpClient:zE,fetchSamplingRules:function(e){let t="{}",s=af(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=YE(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let s=JSON.stringify(KE(e)),n=af(this.samplingTargetsPath,s.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{t(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){t(m);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=ZE(c),d=uf(c.LastRuleModification);t(null,l,d)})});a.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling targets.`))}),a.write(s),a.end()}},KE=function(e){var t=[],s=Math.floor(new Date().getTime()/1e3);return e.forEach(function(n){var i=n.snapshotStatistics(),a={RuleName:n.getName(),ClientID:of.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:s};t.push(a)}),{SamplingStatisticsDocuments:t}},YE=function(e){var t=[],s=e.SamplingRuleRecords||[];return s.forEach(function(n){if(n=n.SamplingRule,JE(n)){var i=new HE(n.RuleName,n.Priority,n.FixedRate,n.ReservoirSize,n.Host,n.HTTPMethod,n.URLPath,n.ServiceName,n.ServiceType);t.push(i)}}),t},ZE=function(e){var t=e.SamplingTargetDocuments||[],s={};return t.forEach(function(n){var i={rate:n.FixedRate,quota:n.ReservoirQuota,TTL:uf(n.ReservoirQuotaTTL),interval:n.Interval};s[n.RuleName]=i}),s},JE=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},uf=function(e){return new Date(e).getTime()/1e3},af=function(e,t){return{hostname:kn.tcp_ip,port:kn.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:XE.format("%s:%d",kn.tcp_ip,kn.tcp_port)}}};cf.exports=of});var Nn=f((GI,lf)=>{"use strict";var eb=3600,so={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(tb(t))return null;var s;return this.rules.forEach(function(n){!s&&n.match(e)&&(s=n),n.isDefault()&&!s&&(s=n)}),s},loadRules:function(e){var t={};this.rules.forEach(function(s){t[s.getName()]=s}),this.rules=e,this.rules.forEach(function(s){var n=t[s.getName()];n&&s.merge(n)}),this.rules.sort(function(s,n){var i=s.getPriority()-n.getPriority();return i!==0?i:s.getName()>n.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var s=e[t.getName()];s&&(t.getReservoir().loadNewQuota(s.quota,s.TTL,s.interval),t.setRate(s.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},tb=function(e){return so.getLastUpdated()?e>so.getLastUpdated()+eb:!0};lf.exports=so});var io=f((QI,pf)=>{"use strict";var no=X(),rb=ro(),df=Nn(),sb=5*60*1e3,nb={start:function(){this.poller&&clearInterval(this.poller),ff(!1),this.poller=setInterval(ff,sb),this.poller.unref()}},ff=function(e){if(e=typeof e>"u"?!0:e,e){var t=ab();setTimeout(hf,t)}else hf()},hf=function(){try{ib()}catch(e){no.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},ib=function(){var e=Math.floor(new Date().getTime()/1e3);rb.fetchSamplingRules(function(t,s){t?no.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):s.length!==0&&(df.loadRules(s),df.timestamp(e),no.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},ab=function(){return Math.random()*5};pf.exports=nb});var _f=f((HI,yf)=>{"use strict";var ob=io(),ub=ro(),ao=Nn(),Mn=X(),mf=10*1e3,gf={interval:mf,start:function(){this.poller=setInterval(cb,mf+fb()),this.poller.unref()}},cb=function(){try{lb()}catch(e){Mn.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},lb=function(){var e=db();e&&e.length>0&&ub.fetchTargets(e,function(t,s,n){if(t){Mn.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}ao.loadTargets(s),n>ao.getLastUpdated()&&(Mn.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),ob.start()),Mn.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},db=function(){var e=ao.getRules(),t=[];return e.forEach(function(s){s.everMatched()&&s.timeToReport()&&t.push(s)}),t},fb=function(){return Math.random()/gf.interval};yf.exports=gf});var Sf=f((XI,vf)=>{"use strict";var oo=X(),hb=require("util"),pb=mt(),mb={localSampler:to(),rulePoller:io(),targetPoller:_f(),ruleCache:Nn(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=pb.origin);var t=Math.floor(new Date().getTime()/1e3),s=this.ruleCache.getMatchedRule(e,t);return s?(oo.getLogger().debug(hb.format("Rule %s is matched.",s.getName())),gb(s,t)):(oo.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(n){oo.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+n)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},gb=function(e,t){e.incrementRequestCount();var s=e.getReservoir(),n=!0,i=s.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():n=!1,n?e.getName():!1};vf.exports=mb});var co=f((zI,Ef)=>{"use strict";var yb=vs(),_b=Za(),vb=X(),Sb=oe(),Eb=oe().wildcardMatch,bb=oe().processTraceData,uo="x-amzn-trace-id",wb=!!process.env.AWS_XRAY_TRACING_NAME,Tb={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:Sf(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[uo]&&(t=bb(e.headers[uo])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?Eb(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,s){var n;if(e.sampled==="1")n=!0;else if(e.sampled==="0")n=!1;else{var i={host:s.req.headers.host,httpMethod:s.req.method,urlPath:s.req.url,serviceName:t.name};n=this.sampler.shouldSample(i),(n instanceof String||typeof n=="string")&&(t.setMatchedSamplingRule(n),n=!0)}e.sampled==="?"&&s.header&&s.header(uo,"Root="+e.root+";Sampled="+(n?"1":"0")),n||(t.notTraced=!0)},setDefaultName:function(e){wb||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=to()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,s){vb.getLogger().debug(e+": { url: "+t+", name: "+s.name+", trace_id: "+s.trace_id+", id: "+s.id+", sampled: "+!s.notTraced+" }")},traceRequestResponseCycle:function(e,t){var s=this.processHeaders(e),n=this.resolveName(e.headers.host),i=new yb(n,s.root,s.parent);t.req||(t.req=e),this.resolveSampling(s,i,t),i.addIncomingRequestData(new _b(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,o=!1,u=function(){if(o)return;o=!0,t.statusCode===429&&i.addThrottleFlag();let c=Sb.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),a("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};Ef.exports=Tb});var bf=f(qn=>{"use strict";Object.defineProperty(qn,"__esModule",{value:!0});qn.InvokeStore=void 0;var Ab=require("async_hooks"),lo=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";lo||(globalThis.awslambda=globalThis.awslambda||{});var Cb={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},bs=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let s=this.storage.getStore();s&&(s[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};x(bs,"storage",new Ab.AsyncLocalStorage),x(bs,"PROTECTED_KEYS",Cb);var Pn;!lo&&globalThis.awslambda?.InvokeStore?Pn=globalThis.awslambda.InvokeStore:(Pn=bs,!lo&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=Pn));qn.InvokeStore=Pn});var Af=f((ZI,Tf)=>{"use strict";var Dn=_t(),xb=co(),fo=oe().LambdaUtils,Rb=vs(),Ib=Cn(),Ob=mt(),po=X(),wf=Rn(),{InvokeStore:Lb}=bf(),ho=null;Tf.exports.init=function(){Dn.enableManualMode=function(){po.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Ib.disableReusableSocket(),Ob.setStreamingThreshold(0),po.getLogger().info("Disabling centralized sampling in Lambda environment."),xb.disableCentralizedSampling();var e=Dn.getNamespace();e.enter(e.createContext()),Dn.setSegment(kb())};var kb=function(){var e=new Rb("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],s=["incrementCounter","decrementCounter","isClosed","close","format","flush"],n=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(s.indexOf(i)===-1?e[i]=function(){var a=i;return function(){po.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=wf.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=wf.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let o=Lb.getXRayTraceId(),u=process.env._X_AMZN_TRACE_ID;var c=o??u;c?c!=ho&&(this.reset(),fo.populateTraceData(e,c)&&(ho=c)):(this.reset(),Dn.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},fo.validTraceData(n)&&fo.populateTraceData(e,n)&&(ho=n),e}});var Cf=f((JI,Nb)=>{Nb.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var If=f((eO,Rf)=>{"use strict";var mo=require("http"),xf={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var n=5,i=function(){var a=mo.__request?mo.__request:mo.request,o=a(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else n>0&&Math.floor(this.statusCode/100)===5?(n--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(xf.METADATA_TIMEOUT),o.end()};i()}};Rf.exports=xf});var Mf=f((tO,Nf)=>{"use strict";var Lf=If(),Of=X(),go=require("http"),Mb={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(s){let n=kf(e,"GET",s?{"X-aws-ec2-metadata-token":s}:{});Lf.getPluginMetadata(n,function(i,a){if(i||!a){Of.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};r(o)})}Pb(function(s){s===null&&Of.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(s)})},originName:"AWS::EC2::Instance"};function Pb(r){let e=go.__request?go.__request:go.request,n=kf("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(n,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?r(o):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(Lf.METADATA_TIMEOUT),i.end()}function kf(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}Nf.exports=Mb});var qf=f((rO,Pf)=>{"use strict";var qb=require("os"),Db={getData:function(r){r({ecs:{container:qb.hostname()}})},originName:"AWS::ECS::Container"};Pf.exports=Db});var $f=f((sO,Df)=>{"use strict";var $b=require("fs"),Bb=X(),Fb="/var/elasticbeanstalk/xray/environment.conf",jb={getData:function(r){$b.readFile(Fb,"utf8",function(e,t){if(e)Bb.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var s=JSON.parse(t),n={elastic_beanstalk:{environment:s.environment_name,version_label:s.version_label,deployment_id:s.deployment_id}};r(n)}})},originName:"AWS::ElasticBeanstalk::Environment"};Df.exports=jb});var Bf=f((nO,Ub)=>{Ub.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Gf=f((iO,Wf)=>{"use strict";var Uf=require("fs"),br=X(),Vb=Bf(),$n={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Fn(r){this.init(r)}Fn.prototype.init=function(e){e?typeof e=="string"?(br.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Bn(JSON.parse(Uf.readFileSync(e,"utf8")))):(br.getLogger().info("Using custom AWS whitelist source."),this.services=Bn(e)):this.services=Vb.services};Fn.prototype.append=function(e){var t={};typeof e=="string"?(br.getLogger().info("Appending AWS whitelist with custom file: "+e),t=Bn(JSON.parse(Uf.readFileSync(e,"utf8")))):(br.getLogger().info("Appending AWS whitelist with a custom source."),t=Bn(e));for(var s in t)this.services[s]=t[s]};Fn.prototype.capture=function(e,t){var s=t.request.operation,n=this.services[e]!==void 0?this.services[e].operations[s]:null;if(n===null){br.getLogger().debug('Call "'+e+"."+s+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var a in n){var o=n[a];a===$n.REQ_PARAMS?Ff(o,t.request.params,i):a===$n.REQ_DESC?jf(o,t.request.params,i):a===$n.RES_PARAMS?t.data&&Ff(o,t.data,i):a===$n.RES_DESC?t.data&&jf(o,t.data,i):br.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function Ff(r,e,t){r.forEach(function(s){if(typeof e[s]<"u"){var n=Vf(s);this[n]=e[s]}},t)}function jf(r,e,t){for(var s in r){var n=r[s];if(typeof e[s]<"u"){var i;if(n.list&&n.get_count?i=e[s]?e[s].length:0:i=n.get_keys===!0?Object.keys(e[s]):e[s],typeof n.rename_to=="string")t[n.rename_to]=i;else{var a=Vf(s);t[a]=i}}}}function Vf(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function Bn(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Wf.exports=Fn});var ws=f((aO,jn)=>{"use strict";var Qf=Gf(),yo=new Qf;function _o(r,e){this.init(r,e)}_o.prototype.init=function(e,t){this.operation=Qb(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(yo.capture(t.toLowerCase(),e))};_o.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var Wb=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");yo=new Qf(e)},Gb=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");yo.append(e)};function Qb(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}jn.exports=_o;jn.exports.appendAWSWhitelist=Gb;jn.exports.setAWSWhitelist=Wb});var Vn=f((oO,Un)=>{"use strict";var Nt=_t(),Ts=X(),Hf=function(e,t,s){vo(e,t);var n,i,a=Nt.resolveSegment(s);if(!a)return Ts.getLogger().warn("Failed to capture function."),t();n=a.addNewSubsegment(e),i=Xf(t,n);try{let o=i(n);return n.close(),o}catch(o){throw n.close(o),o}},Hb=function(e,t,s){vo(e,t);var n,i,a=Nt.resolveSegment(s);if(!a)return Ts.getLogger().warn("Failed to capture async function."),t();n=a.addNewSubsegment(e),i=Xf(t,n);try{return i(n)}catch(o){throw n.close(o),o}},Xb=function(e,t,s){vo(e,t);var n=Nt.resolveSegment(s);return n?(n.incrementCounter(),function(){var i=Nt.resolveSegment(s),a=Array.prototype.slice.call(arguments);Hf(e,t.bind.apply(t,[null].concat(a)),i),n.decrementCounter()}.bind(this)):(Ts.getLogger().warn("Failed to capture callback function."),t)};function Xf(r,e){var t;if(Nt.isAutomaticMode()){var s=Nt.getNamespace(),n=function(){var i;return s.run(function(){Nt.setSegment(e),i=r(e)}),i};t=n}else t=r;return t}function vo(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',Ts.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',Ts.getLogger().error(t),new Error(t)}Un.exports.captureFunc=Hf;Un.exports.captureAsyncFunc=Hb;Un.exports.captureCallbackFunc=Xb});var As=f((uO,zf)=>{"use strict";var zb="2.0.0",Kb=Number.MAX_SAFE_INTEGER||9007199254740991,Yb=16,Zb=250,Jb=["major","premajor","minor","preminor","patch","prepatch","prerelease"];zf.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Yb,MAX_SAFE_BUILD_LENGTH:Zb,MAX_SAFE_INTEGER:Kb,RELEASE_TYPES:Jb,SEMVER_SPEC_VERSION:zb,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Cs=f((cO,Kf)=>{"use strict";var ew=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Kf.exports=ew});var wr=f((Ve,Yf)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:So,MAX_SAFE_BUILD_LENGTH:tw,MAX_LENGTH:rw}=As(),sw=Cs();Ve=Yf.exports={};var nw=Ve.re=[],iw=Ve.safeRe=[],v=Ve.src=[],aw=Ve.safeSrc=[],S=Ve.t={},ow=0,Eo="[a-zA-Z0-9-]",uw=[["\\s",1],["\\d",rw],[Eo,tw]],cw=r=>{for(let[e,t]of uw)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},R=(r,e,t)=>{let s=cw(e),n=ow++;sw(r,n,e),S[r]=n,v[n]=e,aw[n]=s,nw[n]=new RegExp(e,t?"g":void 0),iw[n]=new RegExp(s,t?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*");R("NUMERICIDENTIFIERLOOSE","\\d+");R("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Eo}*`);R("MAINVERSION",`(${v[S.NUMERICIDENTIFIER]})\\.(${v[S.NUMERICIDENTIFIER]})\\.(${v[S.NUMERICIDENTIFIER]})`);R("MAINVERSIONLOOSE",`(${v[S.NUMERICIDENTIFIERLOOSE]})\\.(${v[S.NUMERICIDENTIFIERLOOSE]})\\.(${v[S.NUMERICIDENTIFIERLOOSE]})`);R("PRERELEASEIDENTIFIER",`(?:${v[S.NONNUMERICIDENTIFIER]}|${v[S.NUMERICIDENTIFIER]})`);R("PRERELEASEIDENTIFIERLOOSE",`(?:${v[S.NONNUMERICIDENTIFIER]}|${v[S.NUMERICIDENTIFIERLOOSE]})`);R("PRERELEASE",`(?:-(${v[S.PRERELEASEIDENTIFIER]}(?:\\.${v[S.PRERELEASEIDENTIFIER]})*))`);R("PRERELEASELOOSE",`(?:-?(${v[S.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${v[S.PRERELEASEIDENTIFIERLOOSE]})*))`);R("BUILDIDENTIFIER",`${Eo}+`);R("BUILD",`(?:\\+(${v[S.BUILDIDENTIFIER]}(?:\\.${v[S.BUILDIDENTIFIER]})*))`);R("FULLPLAIN",`v?${v[S.MAINVERSION]}${v[S.PRERELEASE]}?${v[S.BUILD]}?`);R("FULL",`^${v[S.FULLPLAIN]}$`);R("LOOSEPLAIN",`[v=\\s]*${v[S.MAINVERSIONLOOSE]}${v[S.PRERELEASELOOSE]}?${v[S.BUILD]}?`);R("LOOSE",`^${v[S.LOOSEPLAIN]}$`);R("GTLT","((?:<|>)?=?)");R("XRANGEIDENTIFIERLOOSE",`${v[S.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);R("XRANGEIDENTIFIER",`${v[S.NUMERICIDENTIFIER]}|x|X|\\*`);R("XRANGEPLAIN",`[v=\\s]*(${v[S.XRANGEIDENTIFIER]})(?:\\.(${v[S.XRANGEIDENTIFIER]})(?:\\.(${v[S.XRANGEIDENTIFIER]})(?:${v[S.PRERELEASE]})?${v[S.BUILD]}?)?)?`);R("XRANGEPLAINLOOSE",`[v=\\s]*(${v[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[S.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[S.XRANGEIDENTIFIERLOOSE]})(?:${v[S.PRERELEASELOOSE]})?${v[S.BUILD]}?)?)?`);R("XRANGE",`^${v[S.GTLT]}\\s*${v[S.XRANGEPLAIN]}$`);R("XRANGELOOSE",`^${v[S.GTLT]}\\s*${v[S.XRANGEPLAINLOOSE]}$`);R("COERCEPLAIN",`(^|[^\\d])(\\d{1,${So}})(?:\\.(\\d{1,${So}}))?(?:\\.(\\d{1,${So}}))?`);R("COERCE",`${v[S.COERCEPLAIN]}(?:$|[^\\d])`);R("COERCEFULL",v[S.COERCEPLAIN]+`(?:${v[S.PRERELEASE]})?(?:${v[S.BUILD]})?(?:$|[^\\d])`);R("COERCERTL",v[S.COERCE],!0);R("COERCERTLFULL",v[S.COERCEFULL],!0);R("LONETILDE","(?:~>?)");R("TILDETRIM",`(\\s*)${v[S.LONETILDE]}\\s+`,!0);Ve.tildeTrimReplace="$1~";R("TILDE",`^${v[S.LONETILDE]}${v[S.XRANGEPLAIN]}$`);R("TILDELOOSE",`^${v[S.LONETILDE]}${v[S.XRANGEPLAINLOOSE]}$`);R("LONECARET","(?:\\^)");R("CARETTRIM",`(\\s*)${v[S.LONECARET]}\\s+`,!0);Ve.caretTrimReplace="$1^";R("CARET",`^${v[S.LONECARET]}${v[S.XRANGEPLAIN]}$`);R("CARETLOOSE",`^${v[S.LONECARET]}${v[S.XRANGEPLAINLOOSE]}$`);R("COMPARATORLOOSE",`^${v[S.GTLT]}\\s*(${v[S.LOOSEPLAIN]})$|^$`);R("COMPARATOR",`^${v[S.GTLT]}\\s*(${v[S.FULLPLAIN]})$|^$`);R("COMPARATORTRIM",`(\\s*)${v[S.GTLT]}\\s*(${v[S.LOOSEPLAIN]}|${v[S.XRANGEPLAIN]})`,!0);Ve.comparatorTrimReplace="$1$2$3";R("HYPHENRANGE",`^\\s*(${v[S.XRANGEPLAIN]})\\s+-\\s+(${v[S.XRANGEPLAIN]})\\s*$`);R("HYPHENRANGELOOSE",`^\\s*(${v[S.XRANGEPLAINLOOSE]})\\s+-\\s+(${v[S.XRANGEPLAINLOOSE]})\\s*$`);R("STAR","(<|>)?=?\\s*\\*");R("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");R("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Wn=f((lO,Zf)=>{"use strict";var lw=Object.freeze({loose:!0}),dw=Object.freeze({}),fw=r=>r?typeof r!="object"?lw:r:dw;Zf.exports=fw});var bo=f((dO,th)=>{"use strict";var Jf=/^[0-9]+$/,eh=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Jf.test(r),s=Jf.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},hw=(r,e)=>eh(e,r);th.exports={compareIdentifiers:eh,rcompareIdentifiers:hw}});var ce=f((fO,sh)=>{"use strict";var Gn=Cs(),{MAX_LENGTH:rh,MAX_SAFE_INTEGER:Qn}=As(),{safeRe:Hn,t:Xn}=wr(),pw=Wn(),{compareIdentifiers:wo}=bo(),To=class r{constructor(e,t){if(t=pw(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>rh)throw new TypeError(`version is longer than ${rh} characters`);Gn("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?Hn[Xn.LOOSE]:Hn[Xn.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Qn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Qn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Qn||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<Qn)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Gn("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(Gn("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return wo(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(Gn("build compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return wo(s,n)}while(++t)}inc(e,t,s){if(e.startsWith("pre")){if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?Hn[Xn.PRERELEASELOOSE]:Hn[Xn.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),wo(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};sh.exports=To});var Mt=f((hO,ih)=>{"use strict";var nh=ce(),mw=(r,e,t=!1)=>{if(r instanceof nh)return r;try{return new nh(r,e)}catch(s){if(!t)return null;throw s}};ih.exports=mw});var oh=f((pO,ah)=>{"use strict";var gw=Mt(),yw=(r,e)=>{let t=gw(r,e);return t?t.version:null};ah.exports=yw});var ch=f((mO,uh)=>{"use strict";var _w=Mt(),vw=(r,e)=>{let t=_w(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};uh.exports=vw});var fh=f((gO,dh)=>{"use strict";var lh=ce(),Sw=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new lh(r instanceof lh?r.version:r,t).inc(e,s,n).version}catch{return null}};dh.exports=Sw});var mh=f((yO,ph)=>{"use strict";var hh=Mt(),Ew=(r,e)=>{let t=hh(r,null,!0),s=hh(e,null,!0),n=t.compare(s);if(n===0)return null;let i=n>0,a=i?t:s,o=i?s:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};ph.exports=Ew});var yh=f((_O,gh)=>{"use strict";var bw=ce(),ww=(r,e)=>new bw(r,e).major;gh.exports=ww});var vh=f((vO,_h)=>{"use strict";var Tw=ce(),Aw=(r,e)=>new Tw(r,e).minor;_h.exports=Aw});var Eh=f((SO,Sh)=>{"use strict";var Cw=ce(),xw=(r,e)=>new Cw(r,e).patch;Sh.exports=xw});var wh=f((EO,bh)=>{"use strict";var Rw=Mt(),Iw=(r,e)=>{let t=Rw(r,e);return t&&t.prerelease.length?t.prerelease:null};bh.exports=Iw});var Ie=f((bO,Ah)=>{"use strict";var Th=ce(),Ow=(r,e,t)=>new Th(r,t).compare(new Th(e,t));Ah.exports=Ow});var xh=f((wO,Ch)=>{"use strict";var Lw=Ie(),kw=(r,e,t)=>Lw(e,r,t);Ch.exports=kw});var Ih=f((TO,Rh)=>{"use strict";var Nw=Ie(),Mw=(r,e)=>Nw(r,e,!0);Rh.exports=Mw});var zn=f((AO,Lh)=>{"use strict";var Oh=ce(),Pw=(r,e,t)=>{let s=new Oh(r,t),n=new Oh(e,t);return s.compare(n)||s.compareBuild(n)};Lh.exports=Pw});var Nh=f((CO,kh)=>{"use strict";var qw=zn(),Dw=(r,e)=>r.sort((t,s)=>qw(t,s,e));kh.exports=Dw});var Ph=f((xO,Mh)=>{"use strict";var $w=zn(),Bw=(r,e)=>r.sort((t,s)=>$w(s,t,e));Mh.exports=Bw});var xs=f((RO,qh)=>{"use strict";var Fw=Ie(),jw=(r,e,t)=>Fw(r,e,t)>0;qh.exports=jw});var Kn=f((IO,Dh)=>{"use strict";var Uw=Ie(),Vw=(r,e,t)=>Uw(r,e,t)<0;Dh.exports=Vw});var Ao=f((OO,$h)=>{"use strict";var Ww=Ie(),Gw=(r,e,t)=>Ww(r,e,t)===0;$h.exports=Gw});var Co=f((LO,Bh)=>{"use strict";var Qw=Ie(),Hw=(r,e,t)=>Qw(r,e,t)!==0;Bh.exports=Hw});var Yn=f((kO,Fh)=>{"use strict";var Xw=Ie(),zw=(r,e,t)=>Xw(r,e,t)>=0;Fh.exports=zw});var Zn=f((NO,jh)=>{"use strict";var Kw=Ie(),Yw=(r,e,t)=>Kw(r,e,t)<=0;jh.exports=Yw});var xo=f((MO,Uh)=>{"use strict";var Zw=Ao(),Jw=Co(),e0=xs(),t0=Yn(),r0=Kn(),s0=Zn(),n0=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Zw(r,t,s);case"!=":return Jw(r,t,s);case">":return e0(r,t,s);case">=":return t0(r,t,s);case"<":return r0(r,t,s);case"<=":return s0(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};Uh.exports=n0});var Wh=f((PO,Vh)=>{"use strict";var i0=ce(),a0=Mt(),{safeRe:Jn,t:ei}=wr(),o0=(r,e)=>{if(r instanceof i0)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?Jn[ei.COERCEFULL]:Jn[ei.COERCE]);else{let u=e.includePrerelease?Jn[ei.COERCERTLFULL]:Jn[ei.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let s=t[2],n=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return a0(`${s}.${n}.${i}${a}${o}`,e)};Vh.exports=o0});var Qh=f((qO,Gh)=>{"use strict";var Ro=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(e,t)}return this}};Gh.exports=Ro});var Oe=f((DO,Kh)=>{"use strict";var u0=/\s+/g,Io=class r{constructor(e,t){if(t=l0(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Oo)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(u0," "),this.set=this.raw.split("||").map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let s=this.set[0];if(this.set=this.set.filter(n=>!Xh(n[0])),this.set.length===0)this.set=[s];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&y0(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let s=0;s<t.length;s++)s>0&&(this.formatted+=" "),this.formatted+=t[s].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let s=((this.options.includePrerelease&&m0)|(this.options.loose&&g0))+":"+e,n=Hh.get(s);if(n)return n;let i=this.options.loose,a=i?me[le.HYPHENRANGELOOSE]:me[le.HYPHENRANGE];e=e.replace(a,x0(this.options.includePrerelease)),W("hyphen replace",e),e=e.replace(me[le.COMPARATORTRIM],f0),W("comparator trim",e),e=e.replace(me[le.TILDETRIM],h0),W("tilde trim",e),e=e.replace(me[le.CARETTRIM],p0),W("caret trim",e);let o=e.split(" ").map(d=>_0(d,this.options)).join(" ").split(/\s+/).map(d=>C0(d,this.options));i&&(o=o.filter(d=>(W("loose invalid filter",d,this.options),!!d.match(me[le.COMPARATORLOOSE])))),W("range list",o);let u=new Map,c=o.map(d=>new Oo(d,this.options));for(let d of c){if(Xh(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return Hh.set(s,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>zh(s,t)&&e.set.some(n=>zh(n,t)&&s.every(i=>n.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new d0(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(R0(this.set[t],e,this.options))return!0;return!1}};Kh.exports=Io;var c0=Qh(),Hh=new c0,l0=Wn(),Oo=Rs(),W=Cs(),d0=ce(),{safeRe:me,t:le,comparatorTrimReplace:f0,tildeTrimReplace:h0,caretTrimReplace:p0}=wr(),{FLAG_INCLUDE_PRERELEASE:m0,FLAG_LOOSE:g0}=As(),Xh=r=>r.value==="<0.0.0-0",y0=r=>r.value==="",zh=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(i=>n.intersects(i,e)),n=s.pop();return t},_0=(r,e)=>(r=r.replace(me[le.BUILD],""),W("comp",r,e),r=E0(r,e),W("caret",r),r=v0(r,e),W("tildes",r),r=w0(r,e),W("xrange",r),r=A0(r,e),W("stars",r),r),ge=r=>!r||r.toLowerCase()==="x"||r==="*",v0=(r,e)=>r.trim().split(/\s+/).map(t=>S0(t,e)).join(" "),S0=(r,e)=>{let t=e.loose?me[le.TILDELOOSE]:me[le.TILDE];return r.replace(t,(s,n,i,a,o)=>{W("tilde",r,s,n,i,a,o);let u;return ge(n)?u="":ge(i)?u=`>=${n}.0.0 <${+n+1}.0.0-0`:ge(a)?u=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:o?(W("replaceTilde pr",o),u=`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`):u=`>=${n}.${i}.${a} <${n}.${+i+1}.0-0`,W("tilde return",u),u})},E0=(r,e)=>r.trim().split(/\s+/).map(t=>b0(t,e)).join(" "),b0=(r,e)=>{W("caret",r,e);let t=e.loose?me[le.CARETLOOSE]:me[le.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,i,a,o,u)=>{W("caret",r,n,i,a,o,u);let c;return ge(i)?c="":ge(a)?c=`>=${i}.0.0${s} <${+i+1}.0.0-0`:ge(o)?i==="0"?c=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.0${s} <${+i+1}.0.0-0`:u?(W("replaceCaret pr",u),i==="0"?a==="0"?c=`>=${i}.${a}.${o}-${u} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}-${u} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o}-${u} <${+i+1}.0.0-0`):(W("no pr"),i==="0"?a==="0"?c=`>=${i}.${a}.${o}${s} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),W("caret return",c),c})},w0=(r,e)=>(W("replaceXRanges",r,e),r.split(/\s+/).map(t=>T0(t,e)).join(" ")),T0=(r,e)=>{r=r.trim();let t=e.loose?me[le.XRANGELOOSE]:me[le.XRANGE];return r.replace(t,(s,n,i,a,o,u)=>{W("xRange",r,s,n,i,a,o,u);let c=ge(i),l=c||ge(a),d=l||ge(o),m=d;return n==="="&&m&&(n=""),u=e.includePrerelease?"-0":"",c?n===">"||n==="<"?s="<0.0.0-0":s="*":n&&m?(l&&(a=0),o=0,n===">"?(n=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):n==="<="&&(n="<",l?i=+i+1:a=+a+1),n==="<"&&(u="-0"),s=`${n+i}.${a}.${o}${u}`):l?s=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(s=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),W("xRange return",s),s})},A0=(r,e)=>(W("replaceStars",r,e),r.trim().replace(me[le.STAR],"")),C0=(r,e)=>(W("replaceGTE0",r,e),r.trim().replace(me[e.includePrerelease?le.GTE0PRE:le.GTE0],"")),x0=r=>(e,t,s,n,i,a,o,u,c,l,d,m)=>(ge(s)?t="":ge(n)?t=`>=${s}.0.0${r?"-0":""}`:ge(i)?t=`>=${s}.${n}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,ge(c)?u="":ge(l)?u=`<${+c+1}.0.0-0`:ge(d)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${d}-${m}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),R0=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(W(r[s].semver),r[s].semver!==Oo.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}});var Rs=f(($O,rp)=>{"use strict";var Is=Symbol("SemVer ANY"),No=class r{static get ANY(){return Is}constructor(e,t){if(t=Yh(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),ko("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Is?this.value="":this.value=this.operator+this.semver.version,ko("comp",this)}parse(e){let t=this.options.loose?Zh[Jh.COMPARATORLOOSE]:Zh[Jh.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new ep(s[2],this.options.loose):this.semver=Is}toString(){return this.value}test(e){if(ko("Comparator.test",e,this.options.loose),this.semver===Is||e===Is)return!0;if(typeof e=="string")try{e=new ep(e,this.options)}catch{return!1}return Lo(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new tp(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new tp(this.value,t).test(e.semver):(t=Yh(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Lo(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Lo(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};rp.exports=No;var Yh=Wn(),{safeRe:Zh,t:Jh}=wr(),Lo=xo(),ko=Cs(),ep=ce(),tp=Oe()});var Os=f((BO,sp)=>{"use strict";var I0=Oe(),O0=(r,e,t)=>{try{e=new I0(e,t)}catch{return!1}return e.test(r)};sp.exports=O0});var ip=f((FO,np)=>{"use strict";var L0=Oe(),k0=(r,e)=>new L0(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));np.exports=k0});var op=f((jO,ap)=>{"use strict";var N0=ce(),M0=Oe(),P0=(r,e,t)=>{let s=null,n=null,i=null;try{i=new M0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===-1)&&(s=a,n=new N0(s,t))}),s};ap.exports=P0});var cp=f((UO,up)=>{"use strict";var q0=ce(),D0=Oe(),$0=(r,e,t)=>{let s=null,n=null,i=null;try{i=new D0(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===1)&&(s=a,n=new q0(s,t))}),s};up.exports=$0});var fp=f((VO,dp)=>{"use strict";var Mo=ce(),B0=Oe(),lp=xs(),F0=(r,e)=>{r=new B0(r,e);let t=new Mo("0.0.0");if(r.test(t)||(t=new Mo("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){let n=r.set[s],i=null;n.forEach(a=>{let o=new Mo(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||lp(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||lp(t,i))&&(t=i)}return t&&r.test(t)?t:null};dp.exports=F0});var pp=f((WO,hp)=>{"use strict";var j0=Oe(),U0=(r,e)=>{try{return new j0(r,e).range||"*"}catch{return null}};hp.exports=U0});var ti=f((GO,_p)=>{"use strict";var V0=ce(),yp=Rs(),{ANY:W0}=yp,G0=Oe(),Q0=Os(),mp=xs(),gp=Kn(),H0=Zn(),X0=Yn(),z0=(r,e,t,s)=>{r=new V0(r,s),e=new G0(e,s);let n,i,a,o,u;switch(t){case">":n=mp,i=H0,a=gp,o=">",u=">=";break;case"<":n=gp,i=X0,a=mp,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Q0(r,e,s))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,m=null;if(l.forEach(h=>{h.semver===W0&&(h=new yp(">=0.0.0")),d=d||h,m=m||h,n(h.semver,d.semver,s)?d=h:a(h.semver,m.semver,s)&&(m=h)}),d.operator===o||d.operator===u||(!m.operator||m.operator===o)&&i(r,m.semver))return!1;if(m.operator===u&&a(r,m.semver))return!1}return!0};_p.exports=z0});var Sp=f((QO,vp)=>{"use strict";var K0=ti(),Y0=(r,e,t)=>K0(r,e,">",t);vp.exports=Y0});var bp=f((HO,Ep)=>{"use strict";var Z0=ti(),J0=(r,e,t)=>Z0(r,e,"<",t);Ep.exports=J0});var Ap=f((XO,Tp)=>{"use strict";var wp=Oe(),eT=(r,e,t)=>(r=new wp(r,t),e=new wp(e,t),r.intersects(e,t));Tp.exports=eT});var xp=f((zO,Cp)=>{"use strict";var tT=Os(),rT=Ie();Cp.exports=(r,e,t)=>{let s=[],n=null,i=null,a=r.sort((l,d)=>rT(l,d,t));for(let l of a)tT(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);let o=[];for(let[l,d]of s)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Np=f((KO,kp)=>{"use strict";var Rp=Oe(),qo=Rs(),{ANY:Po}=qo,Ls=Os(),Do=Ie(),sT=(r,e,t={})=>{if(r===e)return!0;r=new Rp(r,t),e=new Rp(e,t);let s=!1;e:for(let n of r.set){for(let i of e.set){let a=iT(n,i,t);if(s=s||a!==null,a)continue e}if(s)return!1}return!0},nT=[new qo(">=0.0.0-0")],Ip=[new qo(">=0.0.0")],iT=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Po){if(e.length===1&&e[0].semver===Po)return!0;t.includePrerelease?r=nT:r=Ip}if(e.length===1&&e[0].semver===Po){if(t.includePrerelease)return!0;e=Ip}let s=new Set,n,i;for(let h of r)h.operator===">"||h.operator===">="?n=Op(n,h,t):h.operator==="<"||h.operator==="<="?i=Lp(i,h,t):s.add(h.semver);if(s.size>1)return null;let a;if(n&&i){if(a=Do(n.semver,i.semver,t),a>0)return null;if(a===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let h of s){if(n&&!Ls(h,String(n),t)||i&&!Ls(h,String(i),t))return null;for(let b of e)if(!Ls(h,String(b),t))return!1;return!0}let o,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",n){if(m&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===m.major&&h.semver.minor===m.minor&&h.semver.patch===m.patch&&(m=!1),h.operator===">"||h.operator===">="){if(o=Op(n,h,t),o===h&&o!==n)return!1}else if(n.operator===">="&&!Ls(n.semver,String(h),t))return!1}if(i){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(u=Lp(i,h,t),u===h&&u!==i)return!1}else if(i.operator==="<="&&!Ls(i.semver,String(h),t))return!1}if(!h.operator&&(i||n)&&a!==0)return!1}return!(n&&c&&!i&&a!==0||i&&l&&!n&&a!==0||m||d)},Op=(r,e,t)=>{if(!r)return e;let s=Do(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},Lp=(r,e,t)=>{if(!r)return e;let s=Do(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};kp.exports=sT});var Dp=f((YO,qp)=>{"use strict";var $o=wr(),Mp=As(),aT=ce(),Pp=bo(),oT=Mt(),uT=oh(),cT=ch(),lT=fh(),dT=mh(),fT=yh(),hT=vh(),pT=Eh(),mT=wh(),gT=Ie(),yT=xh(),_T=Ih(),vT=zn(),ST=Nh(),ET=Ph(),bT=xs(),wT=Kn(),TT=Ao(),AT=Co(),CT=Yn(),xT=Zn(),RT=xo(),IT=Wh(),OT=Rs(),LT=Oe(),kT=Os(),NT=ip(),MT=op(),PT=cp(),qT=fp(),DT=pp(),$T=ti(),BT=Sp(),FT=bp(),jT=Ap(),UT=xp(),VT=Np();qp.exports={parse:oT,valid:uT,clean:cT,inc:lT,diff:dT,major:fT,minor:hT,patch:pT,prerelease:mT,compare:gT,rcompare:yT,compareLoose:_T,compareBuild:vT,sort:ST,rsort:ET,gt:bT,lt:wT,eq:TT,neq:AT,gte:CT,lte:xT,cmp:RT,coerce:IT,Comparator:OT,Range:LT,satisfies:kT,toComparators:NT,maxSatisfying:MT,minSatisfying:PT,minVersion:qT,validRange:DT,outside:$T,gtr:BT,ltr:FT,intersects:jT,simplifyRange:UT,subset:VT,SemVer:aT,re:$o.re,src:$o.src,tokens:$o.t,SEMVER_SPEC_VERSION:Mp.SEMVER_SPEC_VERSION,RELEASE_TYPES:Mp.RELEASE_TYPES,compareIdentifiers:Pp.compareIdentifiers,rcompareIdentifiers:Pp.rcompareIdentifiers}});var Fo=f((ZO,Bo)=>{"use strict";var WT=Dp(),GT=ws(),Tr=_t(),$p=oe(),Bp=X(),Fp="2.7.15",QT=function(){return!1},HT=function(e){if(!WT.gte(e.VERSION,Fp))throw new Error("AWS SDK version "+Fp+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var s=e[t];s.prototype.customizeRequests(jp)}return e},XT=function(e){return e.customizeRequests(jp),e};function jp(r){var e=Tr.resolveSegment(Tr.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return Tr.isAutomaticMode()?Bp.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):Bp.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var s=this.throttledError||QT,n=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+a+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(o!=null)for(let[m,h]of Object.entries(o))d+=";"+m+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new GT(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new Up(d)),(d.statusCode===429||l.error&&s(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:n};d&&d.statusCode?($p.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(d&&d.statusCode){var h=$p.getCauseTypeFromHttpStatus(d.statusCode);h&&(i[h]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(Tr.isAutomaticMode()){var d=Tr.getNamespace();d.run(function(){Tr.setSegment(i),r.__send(l)})}else r.__send(l)})}function Up(r){this.init(r)}Up.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};Bo.exports.captureAWSClient=XT;Bo.exports.captureAWS=HT});var Hp=f((JO,Qp)=>{var ri=Object.defineProperty,zT=Object.getOwnPropertyDescriptor,KT=Object.getOwnPropertyNames,YT=Object.prototype.hasOwnProperty,Ar=(r,e)=>ri(r,"name",{value:e,configurable:!0}),ZT=(r,e)=>{for(var t in e)ri(r,t,{get:e[t],enumerable:!0})},JT=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of KT(e))!YT.call(r,n)&&n!==t&&ri(r,n,{get:()=>e[n],enumerable:!(s=zT(e,n))||s.enumerable});return r},eA=r=>JT(ri({},"__esModule",{value:!0}),r),Vp={};ZT(Vp,{isClockSkewCorrectedError:()=>Wp,isClockSkewError:()=>oA,isRetryableByTrait:()=>aA,isServerError:()=>cA,isThrottlingError:()=>uA,isTransientError:()=>Gp});Qp.exports=eA(Vp);var tA=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],rA=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],sA=["TimeoutError","RequestTimeout","RequestTimeoutException"],nA=[500,502,503,504],iA=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],aA=Ar(r=>r.$retryable!==void 0,"isRetryableByTrait"),oA=Ar(r=>tA.includes(r.name),"isClockSkewError"),Wp=Ar(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),uA=Ar(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||rA.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Gp=Ar(r=>{var e;return Wp(r)||sA.includes(r.name)||iA.includes(r?.code||"")||nA.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),cA=Ar(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Gp(r)}return!1},"isServerError")});var Jp=f(Cr=>{"use strict";var Yp=Cr&&Cr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Cr,"__esModule",{value:!0});Cr.captureAWSClient=void 0;var lA=Hp(),dA=Yp(ws()),fA=require("querystring"),hA=Yp(_s()),jo=_t(),Xp=X(),{safeParseInt:si}=oe(),pA=oe(),Zp="XRaySDKInstrumentation",zp=async(r,e,t,s,n,i)=>{var a,o,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:m}=((a=n?.output)===null||a===void 0?void 0:a.$metadata)||i?.$metadata,h=new dA.default({extendedRequestId:c,requestId:l,retryCount:m,data:n?.output,request:{operation:e,params:s,httpRequest:{region:t,statusCode:d}}},r),b={};return d&&(b.response={},b.response.status=d),!((o=n?.response)===null||o===void 0)&&o.headers&&((u=n?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(b.response||(b.response={}),b.response.content_length=si(n.response.headers["content-length"])),[h,b]};function Kp(r,e,t){var s,n,i;(t&&(0,lA.isThrottlingError)(t)||si((s=r.response)===null||s===void 0?void 0:s.status)===429||si((n=t?.$metadata)===null||n===void 0?void 0:n.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,pA.getCauseTypeFromHttpStatus)(si((i=r.response)===null||i===void 0?void 0:i.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var mA=(r,e)=>(t,s)=>async n=>{var i;let a=jo.isAutomaticMode()?jo.resolveSegment():e,{clientName:o,commandName:u}=s,c=(i=n?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),m=o.slice(0,-6);if(!a){let G=m+"."+d;return jo.isAutomaticMode()?Xp.getLogger().info("Call "+G+" is missing the sub/segment context for automatic mode. Ignoring."):Xp.getLogger().info("Call "+G+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(n)}let h;a.notTraced?h=a.addNewSubsegmentWithoutSampling(m):h=a.addNewSubsegment(m),h.addAttribute("namespace","aws");let b=a instanceof hA.default?a.segment:a,T=b.segment?b.segment.additionalTraceData:b.additionalTraceData,B=(0,fA.stringify)({Root:b.trace_id,Parent:h.id,Sampled:h.notTraced?"0":"1"},";");if(T!=null)for(let[G,ae]of Object.entries(T))B+=";"+G+"="+ae;a.noOp||(n.request.headers["X-Amzn-Trace-Id"]=B);let fe;try{if(fe=await t(n),!fe)throw new Error("Failed to get response from instrumented AWS Client.");let[G,ae]=await zp(m,d,await r.region(),c,fe,null);return h.addAttribute("aws",G),h.addAttribute("http",ae),Kp(ae,h),h.close(),fe}catch(G){if(G.$metadata){let[j,be]=await zp(m,d,await r.region(),c,null,G);h.addAttribute("aws",j),h.addAttribute("http",be),Kp(be,h,G)}let ae={message:G.message,name:G.name,stack:G.stack||new Error().stack};throw h.close(ae,!0),G}},gA={name:Zp,step:"build"},yA=(r,e)=>({applyToStack:t=>{t.add(mA(r,e),gA)}});function _A(r,e){return r.middlewareStack.remove(Zp),r.middlewareStack.use(yA(r.config,e)),r}Cr.captureAWSClient=_A});var Vo=f((tL,Uo)=>{"use strict";var em=require("url"),xr=_t(),ni=oe(),tm=X(),vA=require("events"),SA=function(e,t,s){e.__request||rm(e,t,s)},EA=function(e,t,s){if(e.__request)return e;var n={};return Object.keys(e).forEach(function(i){n[i]=e[i]}),rm(n,t,s),n};function rm(r,e,t){function s(a,...o){let u,c,l,d,m=o[0];if(typeof o[1]=="object"?(l=!0,d=typeof m=="string"?new em.URL(m):m,u=o[1],c=o[2]):(l=!1,u=m,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new em.URL(u)),l||(d=u);let h=xr.resolveSegment(xr.resolveManualSegmentParams(u)),b=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!h){let j="[ host: "+b;return j=u.method?j+", method: "+u.method:j,j+=", path: "+(d.pathname||ni.stripQueryStringFromPath(u.path))+" ]",xr.isAutomaticMode()?tm.getLogger().info("Options for request "+j+" is missing the sub/segment context for automatic mode. Ignoring."):tm.getLogger().info("Options for request "+j+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let T;h.notTraced?T=h.addNewSubsegmentWithoutSampling(b):T=h.addNewSubsegment(b);let B=h.segment?h.segment:h;T.namespace="remote",u.headers||(u.headers={}),h.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+B.trace_id+";Parent="+T.id+";Sampled="+(T.notTraced?"0":"1"));let fe=function(be){if(t&&t(T,this,null,be),T.http&&T.http.response)ni.getCauseTypeFromHttpStatus(T.http.response.status)==="error"&&T.addErrorFlag(),T.close(be,!0);else{let $m=be.code!=="ECONNREFUSED";T.addRemoteRequestData(this,null,$m&&e),T.close(be)}},G=ni.objectWithoutProperties(u,["Segment"],!0),ae=a(...l?[m,G]:[u],function(j){j.on("end",function(){t&&t(T,this.req,j),j.statusCode===429&&T.addThrottleFlag();let be=ni.getCauseTypeFromHttpStatus(j.statusCode);be&&(T[be]=!0),T.addRemoteRequestData(j.req,j,!!e),T.close()}),typeof c=="function"?xr.isAutomaticMode()?xr.getNamespace().run(function(){xr.setSegment(T),c(j)}):c(j):j.req&&j.req.listenerCount("response")===0&&j.resume()});return ae.on(vA.errorMonitor||"error",fe),ae}r.__request=r.request;function n(...a){return s(r.__request,...a)}r.__get=r.get;function i(...a){return s(r.__get,...a)}Object.defineProperties(r,{request:{value:n,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}Uo.exports.captureHTTPsGlobal=SA;Uo.exports.captureHTTPs=EA});var am=f((rL,Wo)=>{"use strict";var ks=_t(),ii=Symbol("original then"),ai=Symbol("original catch");function nm(r){let e=r.prototype.then;e[ii]||(r.prototype.then=function(s,n){if(ks.isAutomaticMode()&&sm()){let i=ks.getNamespace();s=s&&i.bind(s),n=n&&i.bind(n)}return e.call(this,s,n)},r.prototype.then[ii]=e);let t=r.prototype.catch;t&&!t[ai]&&(r.prototype.catch=function(s){if(ks.isAutomaticMode()&&sm()){let n=ks.getNamespace();s=s&&n.bind(s)}return t.call(this,s)},r.prototype.catch[ai]=t)}function bA(r){let e=r.prototype.then;e[ii]&&(r.prototype.then=e[ii]);let t=r.prototype.catch;t&&t[ai]&&(r.prototype.catch=t[ai])}function sm(){try{return ks.getSegment()}catch{return}}function im(){nm(Promise)}function wA(){bA(Promise)}im.patchThirdPartyPromise=nm;Wo.exports.capturePromise=im;Wo.exports.uncapturePromise=wA});var cm=f((sL,um)=>{"use strict";function om(r,e,t,s,n){this.init(r,e,t,s,n)}om.prototype.init=function(e,t,s,n,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=n,this.user=s};um.exports=om});var fm=f((nL,dm)=>{"use strict";var nt=_t(),Go=X(),Rr=mt(),TA=oe(),AA=Af(),Ms={};try{Ms=Cf()}catch(r){Go.getLogger().debug("Failed to load SDK data:",r)}var Ns="unknown",lm={plugins:{EC2Plugin:Mf(),ECSPlugin:qf(),ElasticBeanstalkPlugin:$f()},config:function(r){var e={};r.forEach(function(t){t.getData(function(s){if(s)for(var n in s)e[n]=s[n]}),Rr.setOrigin(t.originName),Rr.setPluginData(e)})},setAWSWhitelist:ws().setAWSWhitelist,appendAWSWhitelist:ws().appendAWSWhitelist,setStreamingThreshold:Rr.setStreamingThreshold,setLogger:Go.setLogger,getLogger:Go.getLogger,setDaemonAddress:Tn().setDaemonAddress,captureFunc:Vn().captureFunc,captureAsyncFunc:Vn().captureAsyncFunc,captureCallbackFunc:Vn().captureCallbackFunc,captureAWS:Fo().captureAWS,captureAWSClient:Fo().captureAWSClient,captureAWSv3Client:Jp().captureAWSClient,captureHTTPs:Vo().captureHTTPs,captureHTTPsGlobal:Vo().captureHTTPsGlobal,capturePromise:am().capturePromise,utils:TA,database:{SqlData:cm()},middleware:co(),getNamespace:nt.getNamespace,resolveSegment:nt.resolveSegment,resolveManualSegmentParams:nt.resolveManualSegmentParams,getSegment:nt.getSegment,setSegment:nt.setSegment,isAutomaticMode:nt.isAutomaticMode,enableAutomaticMode:nt.enableAutomaticMode,enableManualMode:nt.enableManualMode,setContextMissingStrategy:nt.setContextMissingStrategy,Segment:vs(),Subsegment:_s(),SegmentUtils:Rr};lm.middleware.IncomingRequestData=Za(),function(){var r={runtime:process.release&&process.release.name?process.release.name:Ns,runtime_version:process.version,version:process.env.npm_package_version||Ns,name:process.env.npm_package_name||Ns},e={sdk:"X-Ray for Node.js",sdk_version:Ms.version?Ms.version:Ns,package:Ms.name?Ms.name:Ns};Rr.setSDKData(e),Rr.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&AA.init()}();dm.exports=lm});var Qo=f((iL,hm)=>{"use strict";hm.exports=fm()});var tx={};tu(tx,{handler:()=>ex});module.exports=Gm(tx);var su="ColdStart",nu="default_namespace";var je={Seconds:"Seconds",Microseconds:"Microseconds",Milliseconds:"Milliseconds",Bytes:"Bytes",Kilobytes:"Kilobytes",Megabytes:"Megabytes",Gigabytes:"Gigabytes",Terabytes:"Terabytes",Bits:"Bits",Kilobits:"Kilobits",Megabits:"Megabits",Gigabits:"Gigabits",Terabits:"Terabits",Percent:"Percent",Count:"Count",BytesPerSecond:"Bytes/Second",KilobytesPerSecond:"Kilobytes/Second",MegabytesPerSecond:"Megabytes/Second",GigabytesPerSecond:"Gigabytes/Second",TerabytesPerSecond:"Terabytes/Second",BitsPerSecond:"Bits/Second",KilobitsPerSecond:"Kilobits/Second",MegabitsPerSecond:"Megabits/Second",GigabitsPerSecond:"Gigabits/Second",TerabitsPerSecond:"Terabits/Second",CountPerSecond:"Count/Second",NoUnit:"None"},Zt={Standard:60,High:1};var Su=require("console");var lt="2.28.1";var _i=process.env.AWS_EXECUTION_ENV||"NA",Qm={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},iu=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",Hm=r=>e=>async t=>{let s=t.request.headers["user-agent"]||"";if(s.includes("PT/NO-OP")){let n=s.replace("PT/NO-OP",`PT/${r}/${lt} PTEnv/${_i}`);return t.request.headers["user-agent"]=n,await e(t)}return s.includes("PT/")?await e(t):(t.request.headers["user-agent"]=s===""?`PT/${r}/${lt} PTEnv/${_i}`:`${s} PT/${r}/${lt} PTEnv/${_i}`,await e(t))},Xm=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},vi=(r,e)=>{try{if(iu(r)){if(Xm(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(Hm(e),Qm)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var Bs="powertools-for-aws",au=`${Bs}.tracer`,ou=`${Bs}.metrics`,uu=`${Bs}.logger`,cu=`${Bs}.idempotency`;var Jt=r=>typeof r=="string",Fs=r=>typeof r=="number",js=r=>Fs(r)&&Number.isInteger(r);var lu=r=>Object.is(r,null),Us=r=>lu(r)||Object.is(r,void 0),er=r=>!!(Us(r)||!Jt(r)||r.trim().length===0);var tr,Xe=class{constructor(){k(this,tr);x(this,"coldStart",!0);x(this,"defaultServiceName","service_undefined");J(this,tr,this.getInitializationType()),p(this,tr)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return p(this,tr)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};tr=new WeakMap;var du=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${lt}/PTEnv/${du}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${lt}/PTEnv/${du}`;var fu="POWERTOOLS_DEV",hu="POWERTOOLS_SERVICE_NAME",pu="_X_AMZN_TRACE_ID";var z=({key:r,defaultValue:e,errorMessage:t})=>{let s=process.env[r];if(s===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return s.trim()},mu=({key:r,defaultValue:e,errorMessage:t})=>{let s=z({key:r,defaultValue:String(e),errorMessage:t}),n=Number(s);if(Number.isNaN(n))throw new TypeError(`Environment variable ${r} must be a number`);return n},zm=new Set(["1","y","yes","t","true","on"]),Km=new Set(["0","n","no","f","false","off"]),jr=({key:r,defaultValue:e,errorMessage:t,extendedParsing:s})=>{let i=z({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(s){if(zm.has(i))return!0;if(Km.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},wt=()=>{try{return jr({key:fu,extendedParsing:!0})}catch{return!1}},Vs=()=>z({key:hu,defaultValue:""}),gu=()=>{let r=z({key:pu,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[s,n]=t.split("=");e[s]=n}return e},yu=()=>gu()?.Sampled==="1",ze=()=>gu()?.Root;var we,ye,Vr,Pe,Eu,bu,wu,Si,Ei=class Ei extends Xe{constructor(t={}){super();k(this,Pe);x(this,"console");x(this,"customConfigService");x(this,"defaultDimensions",{});x(this,"dimensions",{});x(this,"dimensionSets",[]);x(this,"functionName");k(this,we);x(this,"isSingleMetric",!1);x(this,"metadata",{});x(this,"namespace");x(this,"shouldThrowOnEmptyMetrics",!1);x(this,"storedMetrics",{});x(this,"disabled",!1);k(this,ye,{namespace:"",functionName:"",serviceName:"",disabled:!1,devMode:!1});k(this,Vr);this.dimensions={},this.setEnvConfig(),this.setConsole(),J(this,we,t.logger||this.console),this.setOptions(t)}addDimension(t,s){if(er(t)||er(s)){p(this,we).warn(`The dimension ${t} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);return}if(29<=this.getCurrentDimensionsCount())throw new RangeError(`The number of metric dimensions must be lower than ${29}`);(Object.hasOwn(this.dimensions,t)||Object.hasOwn(this.defaultDimensions,t))&&p(this,we).warn(`Dimension "${t}" has already been added. The previous value will be overwritten.`),this.dimensions[t]=s}addDimensions(t){let s=q(this,Pe,Si).call(this,t),n=this.getCurrentDimensionsCount(),i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.dimensionSets.push(s)}addMetadata(t,s){this.metadata[t]=s}addMetric(t,s,n,i=Zt.Standard){this.storeMetric(t,s,n,i),this.isSingleMetric&&this.publishStoredMetrics()}captureColdStartMetric(t){if(!this.getColdStart())return;let s=this.singleMetric(),n=this.functionName?.trim()??t?.trim();n&&n.length>0&&s.addDimension("function_name",n),s.addMetric(su,je.Count,1)}clearDefaultDimensions(){this.defaultDimensions={}}clearDimensions(){this.dimensions={},this.dimensionSets=[]}clearMetadata(){this.metadata={}}clearMetrics(){this.storedMetrics={}}hasStoredMetrics(){return Object.keys(this.storedMetrics).length>0}isDisabled(){return this.disabled}logMetrics(t={}){let{throwOnEmptyMetrics:s,defaultDimensions:n,captureColdStartMetric:i}=t;return s&&this.setThrowOnEmptyMetrics(s),n!==void 0&&this.setDefaultDimensions(n),(a,o,u)=>{let c=u.value,l=this;return u.value=async function(...d){i&&l.captureColdStartMetric(d[1].functionName);let m;try{m=await c.apply(this,d)}finally{l.publishStoredMetrics()}return m},u}}publishStoredMetrics(){let t=this.hasStoredMetrics();if(!this.shouldThrowOnEmptyMetrics&&!t&&p(this,we).warn("No application metrics to publish. The cold-start metric may be published if enabled. If application metrics should never be empty, consider using `throwOnEmptyMetrics`"),!this.disabled){let s=this.serializeMetrics();t&&this.console.log(JSON.stringify(s))}this.clearMetrics(),this.clearDimensions(),this.clearMetadata()}setTimestamp(t){q(this,Pe,bu).call(this,t)||p(this,we).warn("This metric doesn't meet the requirements and will be skipped by Amazon CloudWatch. Ensure the timestamp is within 14 days in the past or up to 2 hours in the future and is also a valid number or Date object."),J(this,Vr,q(this,Pe,wu).call(this,t))}serializeMetrics(){let t=Object.values(this.storedMetrics).map(a=>({Name:a.name,Unit:a.unit,...a.resolution===Zt.High?{StorageResolution:a.resolution}:{}}));if(t.length===0&&this.shouldThrowOnEmptyMetrics)throw new RangeError("The number of metrics recorded must be higher than zero");this.namespace||p(this,we).warn("Namespace should be defined, default used");let s=Object.values(this.storedMetrics).reduce((a,{name:o,value:u})=>(a[o]=u,a),{}),n=[],i=new Set([...Object.keys(this.defaultDimensions),...Object.keys(this.dimensions)]);Object.keys(this.dimensions).length>0&&n.push([...i]);for(let a of this.dimensionSets){let o=new Set([...Object.keys(this.defaultDimensions),...Object.keys(a)]);n.push([...o])}return n.length===0&&Object.keys(this.defaultDimensions).length>0&&n.push([...Object.keys(this.defaultDimensions)]),{_aws:{Timestamp:p(this,Vr)??Date.now(),CloudWatchMetrics:[{Namespace:this.namespace||nu,Dimensions:n,Metrics:t}]},...this.defaultDimensions,...this.dimensions,...this.dimensionSets.reduce((a,o)=>{for(let[u,c]of Object.entries(o))a[u]=c;return a},{}),...s,...this.metadata}}setDefaultDimensions(t){let s=q(this,Pe,Si).call(this,t),n=Object.keys(this.defaultDimensions).length,i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.defaultDimensions={...this.defaultDimensions,...s}}setFunctionName(t){this.functionName=t}setThrowOnEmptyMetrics(t){this.shouldThrowOnEmptyMetrics=t}singleMetric(){return new Ei({namespace:this.namespace,defaultDimensions:this.defaultDimensions,singleMetric:!0,logger:p(this,we)})}throwOnEmptyMetrics(){this.shouldThrowOnEmptyMetrics=!0}getCurrentDimensionsCount(){let t=this.dimensionSets.reduce((s,n)=>s+Object.keys(n).length,0);return Object.keys(this.dimensions).length+Object.keys(this.defaultDimensions).length+t}getCustomConfigService(){return this.customConfigService}isNewMetric(t,s){if(this.storedMetrics[t]){if(this.storedMetrics[t].unit!==s){let n=this.storedMetrics[t].unit;throw new Error(`Metric "${t}" has already been added with unit "${n}", but we received unit "${s}". Did you mean to use metric unit "${n}"?`)}return!1}return!0}setConsole(){p(this,ye).devMode?this.console=console:this.console=new Su.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(t){this.customConfigService=t||void 0}setEnvConfig(){p(this,ye).namespace=z({key:"POWERTOOLS_METRICS_NAMESPACE",defaultValue:""}),p(this,ye).functionName=z({key:"POWERTOOLS_METRICS_FUNCTION_NAME",defaultValue:""}),p(this,ye).serviceName=Vs(),p(this,ye).disabled=jr({key:"POWERTOOLS_METRICS_DISABLED",defaultValue:!1,extendedParsing:!0}),p(this,ye).devMode=wt()}setFunctionNameForColdStartMetric(t){let s=t?.trim()??p(this,ye).functionName;s&&s.length>0&&(this.functionName=s)}setNamespace(t){this.namespace=t||this.getCustomConfigService()?.getNamespace()||p(this,ye).namespace}setDisabled(){if("POWERTOOLS_METRICS_DISABLED"in process.env&&process.env.POWERTOOLS_METRICS_DISABLED!==void 0){this.disabled=p(this,ye).disabled;return}this.disabled=p(this,ye).devMode}setOptions(t){let{customConfigService:s,namespace:n,serviceName:i,singleMetric:a,defaultDimensions:o,functionName:u}=t;this.setCustomConfigService(s),this.setDisabled(),this.setNamespace(n);let c=q(this,Pe,Eu).call(this,i);return this.setDefaultDimensions(o?{service:c,...o}:{service:c}),this.setFunctionNameForColdStartMetric(u),this.isSingleMetric=a||!1,this}storeMetric(t,s,n,i){if(!Jt(t))throw new Error(`${t} is not a valid string`);if(t.length<1||t.length>255)throw new RangeError(`The metric name should be between ${1} and ${255} characters`);if(!Fs(n))throw new RangeError(`${n} is not a valid number`);if(!Object.values(je).includes(s))throw new RangeError(`Invalid metric unit '${s}', expected either option: ${Object.values(je).join(",")}`);if(!Object.values(Zt).includes(i))throw new RangeError(`Invalid metric resolution '${i}', expected either option: ${Object.values(Zt).join(",")}`);if(Object.keys(this.storedMetrics).length>=100&&this.publishStoredMetrics(),this.isNewMetric(t,s))this.storedMetrics[t]={unit:s,value:n,name:t,resolution:i};else{let a=this.storedMetrics[t];Array.isArray(a.value)||(a.value=[a.value]),a.value.push(n),a.value.length===100&&this.publishStoredMetrics()}}};we=new WeakMap,ye=new WeakMap,Vr=new WeakMap,Pe=new WeakSet,Eu=function(t){return t||this.getCustomConfigService()?.getServiceName()||p(this,ye).serviceName||this.defaultServiceName},bu=function(t){let s=t instanceof Date;if(!s&&!js(t))return!1;let n=s?t.getTime():t,i=Date.now(),a=i-12096e5,o=i+72e5;return n>=a&&n<=o},wu=function(t){return js(t)?t:t instanceof Date?t.getTime():0},Si=function(t){let s={};for(let[n,i]of Object.entries(t)){if(er(n)||er(i)){p(this,we).warn(`The dimension ${n} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);continue}(Object.hasOwn(this.dimensions,n)||Object.hasOwn(this.defaultDimensions,n)||Object.hasOwn(s,n))&&p(this,we).warn(`Dimension "${n}" has already been added. The previous value will be overwritten.`),s[n]=i}return s};var Ur=Ei;var bi={PRETTY:4,COMPACT:0};var D={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},Tu=["level","message","sampling_rate","service","timestamp"],Au="Uncaught error detected, flushing log buffer before exit";var Ws,Gs,Cu,Wr=class{constructor(){k(this,Gs);k(this,Ws,e=>{let t="2-digit",s=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:s})})}formatError(e){let{name:t,message:s,stack:n,cause:i,...a}=e,o={name:t,location:this.getCodeLocation(e.stack),message:s,stack:wt()&&typeof n=="string"?n?.split(`
`):n,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(o[u]=a[u]);return o}formatTimestamp(e){let t="UTC",s=z({key:"TZ",defaultValue:""});return s&&!s.includes(t)?q(this,Gs,Cu).call(this,e,s):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),s=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let n of t){let i=s.exec(n);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};Ws=new WeakMap,Gs=new WeakSet,Cu=function(e,t){let{year:s,month:n,day:i,hour:a,minute:o,second:u}=p(this,Ws).call(this,t).formatToParts(e).reduce((B,fe)=>(B[fe.type]=fe.value,B),{}),c=`${s}-${n}-${i}T${a}:${o}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",m=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),h=Math.abs(l%60).toString().padStart(2,"0"),b=e.getMilliseconds().toString().padStart(3,"0"),T=`${d}${m}:${h}`;return`${c}.${b}${T}`};var tc=He(Ni(),1);var ar=class{constructor(e){x(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,tc.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let s in e)e[s]!==void 0&&e[s]!==""&&e[s]!==null&&(t[s]=e[s]);return t}setAttributes(e){this.attributes=e}};var sc=require("console"),nc=require("crypto");var Kr=He(Ni(),1);var or,en=class extends Wr{constructor(t){super();k(this,or);J(this,or,t?.logRecordOrder)}formatAttributes(t,s){let n={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(p(this,or)===void 0)return new ar({attributes:n}).addAttributes(s);let i={};for(let o of p(this,or))o in n&&!(o in i)?i[o]=n[o]:o in s&&!(o in i)&&(i[o]=s[o]);for(let o in n)o in i||(i[o]=n[o]);for(let o in s)o in i||(i[o]=s[o]);return new ar({attributes:i})}};or=new WeakMap;var Mi=class{constructor(e,t){x(this,"value");x(this,"logLevel");x(this,"byteSize");if(!Jt(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},Pi=class extends Set{constructor(){super(...arguments);x(this,"currentBytesSize",0);x(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let s=super.delete(t);return s&&(this.currentBytesSize-=t.byteSize),s}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},xt,ur,rn,rc,tn=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:s}){super();k(this,rn);k(this,xt);k(this,ur);J(this,xt,t),J(this,ur,s)}setItem(t,s,n){let i=new Mi(s,n);if(i.byteSize>p(this,xt))throw new Error("Item too big");let a=this.get(t)||new Pi;return a.currentBytesSize+i.byteSize>=p(this,xt)&&(q(this,rn,rc).call(this,a,i),p(this,ur)&&p(this,ur).call(this)),a.add(i),super.set(t,a),this}};xt=new WeakMap,ur=new WeakMap,rn=new WeakSet,rc=function(t,s){for(;t.currentBytesSize+s.byteSize>=p(this,xt);)t.shift(),t.hasEvictedLog=!0};var qe,cr,es,De,dt,Rt,te,Ue,It,Ze,ts,$,Yr,qi,ic,ac,oc,uc,Di,Zr,cc,$i=class $i extends Xe{constructor(t={}){super();k(this,$);x(this,"console");x(this,"customConfigService");x(this,"logEvent",!1);x(this,"logFormatter");x(this,"logIndentation",bi.COMPACT);x(this,"logLevel",D.INFO);k(this,qe);x(this,"persistentLogAttributes",{});x(this,"powertoolsLogData",{sampleRateValue:0});x(this,"temporaryLogAttributes",{});k(this,cr,[]);k(this,es,!1);k(this,De,new Map);k(this,dt,D.INFO);k(this,Rt);k(this,te,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:D.DEBUG});k(this,Ue);k(this,It);k(this,Ze,{sampleRateValue:0,refreshedTimes:0});k(this,ts,new Map);let{customConfigService:s,...n}=t;this.customConfigService=s||void 0,this.setOptions(n),J(this,es,!0);for(let[i,a]of p(this,cr))this.printLog(i,this.createAndPopulateLogItem(...a));J(this,cr,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){q(this,$,qi).call(this,t,"temp")}appendPersistentKeys(t){q(this,$,qi).call(this,t,"persistent")}createChild(t={}){let s=this.createLogger((0,Kr.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:p(this,Ze).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:p(this,Rt),correlationIdSearchFn:p(this,It),...p(this,te).enabled&&{logBufferOptions:{maxBytes:p(this,te).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(p(this,te).bufferAtVerbosity),flushOnErrorLog:p(this,te).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&s.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&s.appendKeys(this.temporaryLogAttributes),s}critical(t,...s){this.processLogItem(D.CRITICAL,t,s)}debug(t,...s){this.processLogItem(D.DEBUG,t,s)}error(t,...s){p(this,te).enabled&&p(this,te).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(D.ERROR,t,s)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...s){this.processLogItem(D.INFO,t,s)}injectLambdaContext(t){return(s,n,i)=>{let a=i.value,o=this;i.value=async function(...u){o.refreshSampleRateCalculation(),o.addContext(u[1]),o.logEventIfEnabled(u[0],t?.logEvent),t?.correlationIdPath&&o.setCorrelationId(u[0],t?.correlationIdPath);try{return await a.apply(this,u)}catch(c){throw t?.flushBufferOnUncaughtError&&(o.flushBuffer(),o.error({message:Au,error:c})),c}finally{(t?.clearState||t?.resetKeys)&&o.resetKeys(),o.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,s,n){n&&(n.clearState||n?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,s,n,i){t.addContext(n),t.logEventIfEnabled(s,i?.logEvent)}logEventIfEnabled(t,s){this.shouldLogEvent(s)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(p(this,Ze).refreshedTimes===0){p(this,Ze).refreshedTimes++;return}q(this,$,Di).call(this)&&this.logLevel>D.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(p(this,dt)))}removeKeys(t){for(let s of t)this.temporaryLogAttributes[s]=void 0,this.persistentLogAttributes[s]?p(this,De).set(s,"persistent"):p(this,De).delete(s)}removePersistentKeys(t){for(let s of t)this.persistentLogAttributes[s]=void 0,this.temporaryLogAttributes[s]?p(this,De).set(s,"temp"):p(this,De).delete(s)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?p(this,De).set(t,"persistent"):p(this,De).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=D[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...s){this.processLogItem(D.TRACE,t,s)}warn(t,...s){this.processLogItem(D.WARN,t,s)}createLogger(t){return new $i(t)}getJsonReplacer(){let t=new WeakSet;return(s,n)=>{var a;let i=n;if(p(this,Rt)&&(i=(a=p(this,Rt))==null?void 0:a.call(this,s,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,Kr.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return p(this,qe)!==void 0?(this.logLevel=D[p(this,qe)],this.isValidLogLevel(t)&&this.logLevel>D[t]&&q(this,$,Yr).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${p(this,qe)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,s,n){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:ze(),...this.getPowertoolsLogData(),message:""},a=q(this,$,ic).call(this);return q(this,$,ac).call(this,s,i,a),q(this,$,oc).call(this,n,a),this.getLogFormatter().formatAttributes(i,a)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let s;for(let[n,i]of Object.entries(D))if(i===t){s=n;break}return s}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in D}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,s){s.prepareForPrint();let n=t===D.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[n](JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,s,n){let i=ze();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,s,n),t)}catch(a){this.printLog(D.WARN,this.createAndPopulateLogItem(D.WARN,`Unable to buffer log: ${a.message}`,[a])),this.printLog(t,this.createAndPopulateLogItem(t,s,n))}return}t>=this.logLevel&&(p(this,es)?this.printLog(t,this.createAndPopulateLogItem(t,s,n)):p(this,cr).push([t,[t,s,n]]))}setConsole(){wt()?this.console=console:this.console=new sc.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...s)=>{this.console.log(t,...s)}}setInitialLogLevel(t){let s=t?.toUpperCase();if(this.awsLogLevelShortCircuit(s)){J(this,dt,this.logLevel);return}if(this.isValidLogLevel(s)){this.logLevel=D[s],J(this,dt,this.logLevel);return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=D[n],J(this,dt,this.logLevel);return}let i=z({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),a=z({key:"LOG_LEVEL",defaultValue:""}),o=i!==""?i:a;this.isValidLogLevel(o)&&(this.logLevel=D[o],J(this,dt,this.logLevel))}setInitialSampleRate(t){let s=t,n=this.getCustomConfigService()?.getSampleRateValue(),i=mu({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let a of[s,n,i])if(this.isValidSampleRate(a)){p(this,Ze).sampleRateValue=a,this.powertoolsLogData.sampleRateValue=a,q(this,$,Di).call(this)&&this.logLevel>D.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=jr({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,s){this.logFormatter=t??new en({logRecordOrder:s})}setLogIndentation(){wt()&&(this.logIndentation=bi.PRETTY)}setOptions(t){let{logLevel:s,serviceName:n,sampleRateValue:i,logFormatter:a,persistentKeys:o,persistentLogAttributes:u,environment:c,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:m,correlationIdSearchFn:h}=t;u&&Object.keys(u).length>0&&o&&Object.keys(o).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(n,c,o||u);let b=z({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),T=b==="FATAL"?"CRITICAL":b;return this.isValidLogLevel(T)&&J(this,qe,T),this.setLogEvent(),this.setInitialLogLevel(s),this.setInitialSampleRate(i),this.setLogFormatter(a,d),this.setConsole(),this.setLogIndentation(),J(this,Rt,l),q(this,$,cc).call(this,m),J(this,It,h),this}setPowertoolsLogData(t,s,n){this.addToPowertoolsLogData({awsRegion:z({key:"AWS_REGION",defaultValue:""}),environment:s||this.getCustomConfigService()?.getCurrentEnvironment()||z({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||z({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),n&&this.appendPersistentKeys(n)}bufferLogItem(t,s,n){s.prepareForPrint(),p(this,Ue)?.has(t)===!1&&p(this,Ue)?.clear(),p(this,Ue)?.setItem(t,JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation),n)}flushBuffer(){let t=ze();if(t===void 0)return;let s=p(this,Ue)?.get(t);if(s!==void 0){for(let n of s){let i=this.getLogLevelNameFromNumber(n.logLevel).toLowerCase();this.console[i](n.value)}s.hasEvictedLog&&this.printLog(D.WARN,this.createAndPopulateLogItem(D.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),p(this,qe)!==void 0&&D[p(this,qe)]>p(this,te).bufferAtVerbosity&&q(this,$,Yr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),p(this,Ue)?.delete(t)}}clearBuffer(){let t=ze();t!==void 0&&p(this,Ue)?.delete(t)}shouldBufferLog(t,s){return p(this,te).enabled&&t!==void 0&&s<=p(this,te).bufferAtVerbosity}setCorrelationId(t,s){if(typeof s=="string"){if(!p(this,It)){q(this,$,Yr).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let n=p(this,It).call(this,s,t);n&&this.appendKeys({correlation_id:n});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};qe=new WeakMap,cr=new WeakMap,es=new WeakMap,De=new WeakMap,dt=new WeakMap,Rt=new WeakMap,te=new WeakMap,Ue=new WeakMap,It=new WeakMap,Ze=new WeakMap,ts=new WeakMap,$=new WeakSet,Yr=function(t){p(this,ts).has(t)||(p(this,ts).set(t,!0),this.warn(t))},qi=function(t,s){for(let n of Object.keys(t))q(this,$,Zr).call(this,n)===!1&&p(this,De).set(n,s);s==="temp"?(0,Kr.default)(this.temporaryLogAttributes,t):(0,Kr.default)(this.persistentLogAttributes,t)},ic=function(){let t={};for(let[s,n]of p(this,De))q(this,$,Zr).call(this,s)||(t[s]=n==="persistent"?this.persistentLogAttributes[s]:this.temporaryLogAttributes[s]);return t},ac=function(t,s,n){if(typeof t=="string"){s.message=t;return}let{message:i,...a}=t;s.message=i;for(let[o,u]of Object.entries(a))q(this,$,Zr).call(this,o)||(n[o]=u)},oc=function(t,s){for(let n of t)Us(n)||(n instanceof Error?s.error=n:typeof n=="string"?s.extra=n:q(this,$,uc).call(this,n,s))},uc=function(t,s){for(let[n,i]of Object.entries(t))q(this,$,Zr).call(this,n)||(s[n]=i)},Di=function(){return p(this,Ze).sampleRateValue&&(0,nc.randomInt)(0,100)/100<=p(this,Ze).sampleRateValue},Zr=function(t){return Tu.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},cc=function(t){if(t===void 0||(p(this,te).enabled=t?.enabled!==!1,p(this,te).enabled===!1))return;t?.maxBytes!==void 0&&(p(this,te).maxBytes=t.maxBytes),J(this,Ue,new tn({maxBytesSize:p(this,te).maxBytes})),t?.flushOnErrorLog===!1&&(p(this,te).flushOnErrorLog=!1);let s=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(s)&&(p(this,te).bufferAtVerbosity=D[s]),p(this,qe)!==void 0&&D[p(this,qe)]>p(this,te).bufferAtVerbosity&&q(this,$,Yr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var Jr=$i;var ne=[];for(let r=0;r<256;++r)ne.push((r+256).toString(16).slice(1));function lc(r,e=0){return(ne[r[e+0]]+ne[r[e+1]]+ne[r[e+2]]+ne[r[e+3]]+"-"+ne[r[e+4]]+ne[r[e+5]]+"-"+ne[r[e+6]]+ne[r[e+7]]+"-"+ne[r[e+8]]+ne[r[e+9]]+"-"+ne[r[e+10]]+ne[r[e+11]]+ne[r[e+12]]+ne[r[e+13]]+ne[r[e+14]]+ne[r[e+15]]).toLowerCase()}var dc=He(require("crypto")),nn=new Uint8Array(256),sn=nn.length;function Bi(){return sn>nn.length-16&&(dc.default.randomFillSync(nn),sn=0),nn.slice(sn,sn+=16)}var fc=He(require("crypto")),Fi={randomUUID:fc.default.randomUUID};function Hy(r,e,t){if(Fi.randomUUID&&!e&&!r)return Fi.randomUUID();r=r||{};let s=r.random||(r.rng||Bi)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=s[n];return e}return lc(s)}var rs=Hy;var Ot=class r{constructor(e,t){this.logger=new Jr({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||rs(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,s){let n=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...n,...s})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,s){this.info(`Custom metric: ${e}`,{metric:e,value:t,...s})}logApiRequest(e,t,s){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...s})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};var ER=new Ot;var Ce=He(Fa(),1),fI=Ce.default.Client,ed=Ce.default.Pool,hI=Ce.default.Connection,pI=Ce.default.types,mI=Ce.default.Query,gI=Ce.default.DatabaseError,yI=Ce.default.escapeIdentifier,_I=Ce.default.escapeLiteral,vI=Ce.default.Result,SI=Ce.default.TypeOverrides,EI=Ce.default.defaults;var Am=require("aws-sdk");var bm=He(Qo(),1);var vm=He(Qo(),1),oi=require("diagnostics_channel"),Sm=He(require("http"),1),Em=He(require("https"),1);var Ho=require("url"),pm=new TextDecoder,mm=(r,e)=>{let t=-1;for(let s=0;s<r.length;s+=2)if(pm.decode(r[s]).toLowerCase()===e){t=s;break}return t===-1?null:pm.decode(r[t+1])},Xo=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",gm=r=>{if(typeof r.origin=="string")return new Ho.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof Ho.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:CA,captureAWSClient:xA,captureAWSv3Client:RA,captureAsyncFunc:IA,captureFunc:OA,captureHTTPsGlobal:ym,getNamespace:LA,getSegment:kA,setSegment:NA,Segment:_m,setContextMissingStrategy:MA,setDaemonAddress:PA,setLogger:qA}=vm.default,ui=class{captureAWS(e){return CA(e)}captureAWSClient(e){return xA(e)}captureAWSv3Client(e){return vi(e,"tracer"),RA(e)}captureAsyncFunc(e,t,s){return IA(e,t)}captureFunc(e,t,s){return OA(e,t)}captureHTTPsGlobal(){ym(Sm.default),ym(Em.default)}getNamespace(){return LA()}getSegment(){return kA()}instrumentFetch(){let e=n=>{let{request:i}=n,a=i.method;if(a==="CONNECT")return;let o=this.getSegment(),u=gm(i);if(o&&u){let c=o.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${ze()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:a}},this.setSegment(c)}},t=n=>{let{response:i}=n,a=this.getSegment();if(Xo(a)){let o=i.statusCode,u=mm(i.headers,"content-length");a.http={...a.http,response:{status:o,...u&&{content_length:Number.parseInt(u,10)}}},o===429&&a.addThrottleFlag(),o>=400&&o<500?a.addErrorFlag():o>=500&&o<600&&a.addFaultFlag(),a.close(),this.setSegment(a.parent)}},s=n=>{let{error:i}=n,a=this.getSegment();Xo(a)&&(a.addErrorFlag(),i instanceof Error&&a.addError(i,!0),a.close(),this.setSegment(a.parent))};(0,oi.subscribe)("undici:request:create",e),(0,oi.subscribe)("undici:request:headers",t),(0,oi.subscribe)("undici:request:error",s)}putAnnotation(e,t){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(s instanceof _m){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}s.addAnnotation(e,t)}putMetadata(e,t,s){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(n instanceof _m){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}n.addMetadata(e,t,s)}setContextMissingStrategy(e){MA(e)}setDaemonAddress(e){PA(e)}setLogger(e){qA(e)}setSegment(e){NA(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:DA}=bm.default,ee,ci,wm,Ps=class extends Xe{constructor(t={}){super();k(this,ci);x(this,"provider");x(this,"captureError",!0);x(this,"captureHTTPsRequests",!0);x(this,"captureResponse",!0);x(this,"customConfigService");k(this,ee,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});x(this,"serviceName");x(this,"tracingEnabled",!0);q(this,ci,wm).call(this),this.setOptions(t),this.provider=new ui,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,s){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(t,s||!1)}}addResponseAsMetadata(t,s){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${s} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(s){try{return this.provider.captureAWSClient(t.service),t}catch{throw s}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){return o.isTracingEnabled()?o.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async c=>{o.annotateColdStart(),o.addServiceNameAnnotation();let l;try{l=await a.apply(this,u),(t?.captureResponse??!0)&&o.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw o.addErrorAsMetadata(d),d}finally{try{c?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",c?.name,d)}}return l}):a.apply(this,u)},i}}captureMethod(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){if(!o.isTracingEnabled())return a.apply(this,[...u]);let c=String(n),l=t?.subSegmentName?t.subSegmentName:`### ${c}`;return o.provider.captureAsyncFunc(l,async d=>{let m;try{m=await a.apply(this,[...u]),(t?.captureResponse??!0)&&o.addResponseAsMetadata(m,c)}catch(h){throw o.addErrorAsMetadata(h),h}finally{try{d?.close()}catch(h){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,h)}}return m})},i}}getRootXrayTraceId(){return ze()}getSegment(){if(!this.isTracingEnabled())return new DA("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?yu():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,s){this.isTracingEnabled()&&this.provider.putAnnotation(t,s)}putMetadata(t,s,n){this.isTracingEnabled()&&this.provider.putMetadata(t,s,n||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return p(this,ee).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return p(this,ee).awsExecutionEnv!==""}isLambdaSamCli(){return p(this,ee).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(p(this,ee).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let s=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(s!==void 0&&s.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}p(this,ee).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(p(this,ee).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:s,serviceName:n,captureHTTPsRequests:i,customConfigService:a}=t;return this.setCustomConfigService(a),this.setTracingEnabled(s),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let s=this.getCustomConfigService()?.getServiceName();if(s!==void 0&&this.isValidServiceName(s)){this.serviceName=s;return}if(p(this,ee).serviceName!==void 0&&this.isValidServiceName(p(this,ee).serviceName)){this.serviceName=p(this,ee).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let s=this.getCustomConfigService()?.getTracingEnabled();if(s!==void 0&&s.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(p(this,ee).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};ee=new WeakMap,ci=new WeakSet,wm=function(){p(this,ee).awsExecutionEnv=z({key:"AWS_EXECUTION_ENV",defaultValue:""}),p(this,ee).samLocal=z({key:"AWS_SAM_LOCAL",defaultValue:""}),p(this,ee).captureError=z({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),p(this,ee).captureHTTPsRequests=z({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),p(this,ee).captureResponse=z({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),p(this,ee).tracingEnabled=z({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),p(this,ee).serviceName=Vs()};var $A=new Ps({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service"});function zo(){try{return $A.getSegment()}catch(r){console.warn("Failed to get X-Ray segment:",r);return}}function BA(r,e,t){try{let s=zo();if(!s)return;let n=s.addNewSubsegment(r);if(e)for(let[i,a]of Object.entries(e))a!==void 0&&n.addAnnotation(i,a);if(t)for(let[i,a]of Object.entries(t))n.addMetadata(i,a);return n}catch(s){console.warn("Failed to create X-Ray subsegment:",s);return}}function Tm(r,e="success",t){if(r)try{r.addAnnotation("status",e),t&&(r.addError(t),r.addMetadata("error",{name:t.name,message:t.message,stack:t.stack})),r.close()}catch(s){console.warn("Failed to close X-Ray subsegment:",s)}}async function Ir(r,e,t,s){let n=BA(r,t,s);try{let i=await e();return Tm(n,"success"),i}catch(i){throw Tm(n,"error",i),i}}function Or(r){try{let e=zo();if(!e)return;for(let[t,s]of Object.entries(r))s!==void 0&&e.addAnnotation(t,s)}catch(e){console.warn("Failed to add X-Ray annotations:",e)}}function li(r,e){try{let t=zo();if(!t)return;if(e)t.addMetadata(e,r);else for(let[s,n]of Object.entries(r))t.addMetadata(s,n)}catch(t){console.warn("Failed to add X-Ray metadata:",t)}}async function di(r,e,t){return Ir(`DB:${r}`,e,{operation:"database"},{queryParams:t})}var Pt=new Ot("database"),FA=new Am.SecretsManager,Ko=class{constructor(e){this.pool=null;this.credentials=null;this.secretArn=e||process.env.DB_SECRET_ARN||""}async getCredentials(){if(this.credentials)return this.credentials;try{Pt.info("Fetching database credentials from Secrets Manager",{secretArn:this.secretArn});let e=await FA.getSecretValue({SecretId:this.secretArn}).promise();if(!e.SecretString)throw new Error("Secret string is empty");let t=JSON.parse(e.SecretString);return this.credentials={username:t.username,password:t.password,host:t.host,port:t.port||5432,dbname:t.dbname||"fibonacci"},Pt.info("Database credentials fetched successfully"),this.credentials}catch(e){throw Pt.error("Failed to fetch database credentials",e),e}}async initializePool(){if(this.pool)return this.pool;let e=await this.getCredentials();return Pt.info("Initializing database connection pool",{host:e.host,port:e.port,database:e.dbname}),this.pool=new ed({user:e.username,password:e.password,host:e.host,port:e.port,database:e.dbname,max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4,ssl:{rejectUnauthorized:!1}}),this.pool.on("error",t=>{Pt.error("Unexpected error on idle database client",t)}),Pt.info("Database connection pool initialized"),this.pool}async getPool(){return await this.initializePool()}async close(){this.pool&&(Pt.info("Closing database connection pool"),await this.pool.end(),this.pool=null,this.credentials=null)}},jA=new Ko;async function Cm(){return await(await jA.getPool()).connect()}var Me={};tu(Me,{BRAND:()=>hC,DIRTY:()=>qt,EMPTY_PATH:()=>GA,INVALID:()=>w,NEVER:()=>YC,OK:()=>de,ParseStatus:()=>ie,Schema:()=>O,ZodAny:()=>Et,ZodArray:()=>ut,ZodBigInt:()=>$t,ZodBoolean:()=>Bt,ZodBranded:()=>Ds,ZodCatch:()=>Kt,ZodDate:()=>Ft,ZodDefault:()=>zt,ZodDiscriminatedUnion:()=>pi,ZodEffects:()=>Ne,ZodEnum:()=>Ht,ZodError:()=>Se,ZodFirstPartyTypeKind:()=>A,ZodFunction:()=>gi,ZodIntersection:()=>Wt,ZodIssueCode:()=>g,ZodLazy:()=>Gt,ZodLiteral:()=>Qt,ZodMap:()=>qr,ZodNaN:()=>$r,ZodNativeEnum:()=>Xt,ZodNever:()=>Fe,ZodNull:()=>Ut,ZodNullable:()=>Qe,ZodNumber:()=>Dt,ZodObject:()=>Ee,ZodOptional:()=>Le,ZodParsedType:()=>_,ZodPipeline:()=>$s,ZodPromise:()=>bt,ZodReadonly:()=>Yt,ZodRecord:()=>mi,ZodSchema:()=>O,ZodSet:()=>Dr,ZodString:()=>St,ZodSymbol:()=>Mr,ZodTransformer:()=>Ne,ZodTuple:()=>Ge,ZodType:()=>O,ZodUndefined:()=>jt,ZodUnion:()=>Vt,ZodUnknown:()=>ot,ZodVoid:()=>Pr,addIssueToContext:()=>y,any:()=>bC,array:()=>CC,bigint:()=>yC,boolean:()=>Dm,coerce:()=>KC,custom:()=>Mm,date:()=>_C,datetimeRegex:()=>km,defaultErrorMap:()=>it,discriminatedUnion:()=>OC,effect:()=>UC,enum:()=>BC,function:()=>qC,getErrorMap:()=>Lr,getParsedType:()=>We,instanceof:()=>mC,intersection:()=>LC,isAborted:()=>fi,isAsync:()=>kr,isDirty:()=>hi,isValid:()=>vt,late:()=>pC,lazy:()=>DC,literal:()=>$C,makeIssue:()=>qs,map:()=>MC,nan:()=>gC,nativeEnum:()=>FC,never:()=>TC,null:()=>EC,nullable:()=>WC,number:()=>qm,object:()=>xC,objectUtil:()=>Yo,oboolean:()=>zC,onumber:()=>XC,optional:()=>VC,ostring:()=>HC,pipeline:()=>QC,preprocess:()=>GC,promise:()=>jC,quotelessJson:()=>UA,record:()=>NC,set:()=>PC,setErrorMap:()=>WA,strictObject:()=>RC,string:()=>Pm,symbol:()=>vC,transformer:()=>UC,tuple:()=>kC,undefined:()=>SC,union:()=>IC,unknown:()=>wC,util:()=>L,void:()=>AC});var L;(function(r){r.assertEqual=n=>{};function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{let i={};for(let a of n)i[a]=a;return i},r.getValidEnumValues=n=>{let i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(let o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(let a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(L||(L={}));var Yo;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(Yo||(Yo={}));var _=L.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),We=r=>{switch(typeof r){case"undefined":return _.undefined;case"string":return _.string;case"number":return Number.isNaN(r)?_.nan:_.number;case"boolean":return _.boolean;case"function":return _.function;case"bigint":return _.bigint;case"symbol":return _.symbol;case"object":return Array.isArray(r)?_.array:r===null?_.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?_.promise:typeof Map<"u"&&r instanceof Map?_.map:typeof Set<"u"&&r instanceof Set?_.set:typeof Date<"u"&&r instanceof Date?_.date:_.object;default:return _.unknown}};var g=L.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),UA=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Se=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return n(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,L.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];t[i]=t[i]||[],t[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};Se.create=r=>new Se(r);var VA=(r,e)=>{let t;switch(r.code){case g.invalid_type:r.received===_.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case g.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,L.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:t=`Unrecognized key(s) in object: ${L.joinValues(r.keys,", ")}`;break;case g.invalid_union:t="Invalid input";break;case g.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${L.joinValues(r.options)}`;break;case g.invalid_enum_value:t=`Invalid enum value. Expected ${L.joinValues(r.options)}, received '${r.received}'`;break;case g.invalid_arguments:t="Invalid function arguments";break;case g.invalid_return_type:t="Invalid function return type";break;case g.invalid_date:t="Invalid date";break;case g.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:L.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case g.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case g.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case g.custom:t="Invalid input";break;case g.invalid_intersection_types:t="Intersection results could not be merged";break;case g.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case g.not_finite:t="Number must be finite";break;default:t=e.defaultError,L.assertNever(r)}return{message:t}},it=VA;var xm=it;function WA(r){xm=r}function Lr(){return xm}var qs=r=>{let{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="",u=s.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},GA=[];function y(r,e){let t=Lr(),s=qs({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===it?void 0:it].filter(n=>!!n)});r.common.issues.push(s)}var ie=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let n of t){if(n.status==="aborted")return w;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let n of t){let i=await n.key,a=await n.value;s.push({key:i,value:a})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let n of t){let{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return w;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}},w=Object.freeze({status:"aborted"}),qt=r=>({status:"dirty",value:r}),de=r=>({status:"valid",value:r}),fi=r=>r.status==="aborted",hi=r=>r.status==="dirty",vt=r=>r.status==="valid",kr=r=>typeof Promise<"u"&&r instanceof Promise;var E;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(E||(E={}));var ke=class{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Rm=(r,e)=>{if(vt(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Se(r.common.issues);return this._error=t,this._error}}};function I(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??s??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:n}}var O=class{get description(){return this._def.description}_getType(e){return We(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:We(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ie,ctx:{common:e.parent.common,data:e.data,parsedType:We(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(kr(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:We(e)},n=this._parseSync({data:e,path:s.path,parent:s});return Rm(s,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:We(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return vt(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>vt(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:We(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(kr(n)?n:Promise.resolve(n));return Rm(s,i)}refine(e,t){let s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{let a=e(n),o=()=>i.addIssue({code:g.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new Ne({schema:this,typeName:A.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Le.create(this,this._def)}nullable(){return Qe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ut.create(this)}promise(){return bt.create(this,this._def)}or(e){return Vt.create([this,e],this._def)}and(e){return Wt.create(this,e,this._def)}transform(e){return new Ne({...I(this._def),schema:this,typeName:A.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new zt({...I(this._def),innerType:this,defaultValue:t,typeName:A.ZodDefault})}brand(){return new Ds({typeName:A.ZodBranded,type:this,...I(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Kt({...I(this._def),innerType:this,catchValue:t,typeName:A.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return $s.create(this,e)}readonly(){return Yt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},QA=/^c[^\s-]{8,}$/i,HA=/^[0-9a-z]+$/,XA=/^[0-9A-HJKMNP-TV-Z]{26}$/i,zA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,KA=/^[a-z0-9_-]{21}$/i,YA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ZA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,JA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,eC="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Zo,tC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rC=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,sC=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,nC=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,iC=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,aC=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Om="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",oC=new RegExp(`^${Om}$`);function Lm(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function uC(r){return new RegExp(`^${Lm(r)}$`)}function km(r){let e=`${Om}T${Lm(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function cC(r,e){return!!((e==="v4"||!e)&&tC.test(r)||(e==="v6"||!e)&&sC.test(r))}function lC(r,e){if(!YA.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function dC(r,e){return!!((e==="v4"||!e)&&rC.test(r)||(e==="v6"||!e)&&nC.test(r))}var St=class r extends O{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==_.string){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.string,received:i.parsedType}),w}let s=new ie,n;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?y(n,{code:g.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&y(n,{code:g.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")JA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"email",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")Zo||(Zo=new RegExp(eC,"u")),Zo.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"emoji",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")zA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"uuid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")KA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"nanoid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")QA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cuid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")HA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cuid2",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")XA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"ulid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),y(n,{validation:"url",code:g.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"regex",code:g.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?km(i).test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?oC.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?uC(i).test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?ZA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"duration",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?cC(e.data,i.version)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"ip",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?lC(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"jwt",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?dC(e.data,i.version)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cidr",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?iC.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"base64",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?aC.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"base64url",code:g.invalid_string,message:i.message}),s.dirty()):L.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:g.invalid_string,...E.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...E.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...E.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...E.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...E.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...E.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...E.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...E.errToObj(t)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};St.create=r=>new St({checks:[],typeName:A.ZodString,coerce:r?.coerce??!1,...I(r)});function fC(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=Number.parseInt(r.toFixed(n).replace(".","")),a=Number.parseInt(e.toFixed(n).replace(".",""));return i%a/10**n}var Dt=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==_.number){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.number,received:i.parsedType}),w}let s,n=new ie;for(let i of this._def.checks)i.kind==="int"?L.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:g.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?fC(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_finite,message:i.message}),n.dirty()):L.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:E.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:E.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&L.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Dt.create=r=>new Dt({checks:[],typeName:A.ZodNumber,coerce:r?.coerce||!1,...I(r)});var $t=class r extends O{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==_.bigint)return this._getInvalidInput(e);let s,n=new ie;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):L.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return y(t,{code:g.invalid_type,expected:_.bigint,received:t.parsedType}),w}gte(e,t){return this.setLimit("min",e,!0,E.toString(t))}gt(e,t){return this.setLimit("min",e,!1,E.toString(t))}lte(e,t){return this.setLimit("max",e,!0,E.toString(t))}lt(e,t){return this.setLimit("max",e,!1,E.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:E.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};$t.create=r=>new $t({checks:[],typeName:A.ZodBigInt,coerce:r?.coerce??!1,...I(r)});var Bt=class extends O{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==_.boolean){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.boolean,received:s.parsedType}),w}return de(e.data)}};Bt.create=r=>new Bt({typeName:A.ZodBoolean,coerce:r?.coerce||!1,...I(r)});var Ft=class r extends O{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==_.date){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.date,received:i.parsedType}),w}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_date}),w}let s=new ie,n;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):L.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Ft.create=r=>new Ft({checks:[],coerce:r?.coerce||!1,typeName:A.ZodDate,...I(r)});var Mr=class extends O{_parse(e){if(this._getType(e)!==_.symbol){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.symbol,received:s.parsedType}),w}return de(e.data)}};Mr.create=r=>new Mr({typeName:A.ZodSymbol,...I(r)});var jt=class extends O{_parse(e){if(this._getType(e)!==_.undefined){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.undefined,received:s.parsedType}),w}return de(e.data)}};jt.create=r=>new jt({typeName:A.ZodUndefined,...I(r)});var Ut=class extends O{_parse(e){if(this._getType(e)!==_.null){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.null,received:s.parsedType}),w}return de(e.data)}};Ut.create=r=>new Ut({typeName:A.ZodNull,...I(r)});var Et=class extends O{constructor(){super(...arguments),this._any=!0}_parse(e){return de(e.data)}};Et.create=r=>new Et({typeName:A.ZodAny,...I(r)});var ot=class extends O{constructor(){super(...arguments),this._unknown=!0}_parse(e){return de(e.data)}};ot.create=r=>new ot({typeName:A.ZodUnknown,...I(r)});var Fe=class extends O{_parse(e){let t=this._getOrReturnCtx(e);return y(t,{code:g.invalid_type,expected:_.never,received:t.parsedType}),w}};Fe.create=r=>new Fe({typeName:A.ZodNever,...I(r)});var Pr=class extends O{_parse(e){if(this._getType(e)!==_.undefined){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.void,received:s.parsedType}),w}return de(e.data)}};Pr.create=r=>new Pr({typeName:A.ZodVoid,...I(r)});var ut=class r extends O{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==_.array)return y(t,{code:g.invalid_type,expected:_.array,received:t.parsedType}),w;if(n.exactLength!==null){let a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(y(t,{code:a?g.too_big:g.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(y(t,{code:g.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(y(t,{code:g.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new ke(t,a,t.path,o)))).then(a=>ie.mergeArray(s,a));let i=[...t.data].map((a,o)=>n.type._parseSync(new ke(t,a,t.path,o)));return ie.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:E.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:E.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:E.toString(t)}})}nonempty(e){return this.min(1,e)}};ut.create=(r,e)=>new ut({type:r,minLength:null,maxLength:null,exactLength:null,typeName:A.ZodArray,...I(e)});function Nr(r){if(r instanceof Ee){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=Le.create(Nr(s))}return new Ee({...r._def,shape:()=>e})}else return r instanceof ut?new ut({...r._def,type:Nr(r.element)}):r instanceof Le?Le.create(Nr(r.unwrap())):r instanceof Qe?Qe.create(Nr(r.unwrap())):r instanceof Ge?Ge.create(r.items.map(e=>Nr(e))):r}var Ee=class r extends O{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=L.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==_.object){let c=this._getOrReturnCtx(e);return y(c,{code:g.invalid_type,expected:_.object,received:c.parsedType}),w}let{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Fe&&this._def.unknownKeys==="strip"))for(let c in n.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=n.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new ke(n,d,n.path,c)),alwaysSet:c in n.data})}if(this._def.catchall instanceof Fe){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(c==="strict")o.length>0&&(y(n,{code:g.unrecognized_keys,keys:o}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=n.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new ke(n,d,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key,m=await l.value;c.push({key:d,value:m,alwaysSet:l.alwaysSet})}return c}).then(c=>ie.mergeObjectSync(s,c)):ie.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let n=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:E.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:A.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of L.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of L.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return Nr(this)}partial(e){let t={};for(let s of L.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of L.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof Le;)i=i._def.innerType;t[s]=i}return new r({...this._def,shape:()=>t})}keyof(){return Nm(L.objectKeys(this.shape))}};Ee.create=(r,e)=>new Ee({shape:()=>r,unknownKeys:"strip",catchall:Fe.create(),typeName:A.ZodObject,...I(e)});Ee.strictCreate=(r,e)=>new Ee({shape:()=>r,unknownKeys:"strict",catchall:Fe.create(),typeName:A.ZodObject,...I(e)});Ee.lazycreate=(r,e)=>new Ee({shape:r,unknownKeys:"strip",catchall:Fe.create(),typeName:A.ZodObject,...I(e)});var Vt=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Se(o.ctx.common.issues));return y(t,{code:g.invalid_union,unionErrors:a}),w}if(t.common.async)return Promise.all(s.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i,a=[];for(let u of s){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Se(u));return y(t,{code:g.invalid_union,unionErrors:o}),w}}get options(){return this._def.options}};Vt.create=(r,e)=>new Vt({options:r,typeName:A.ZodUnion,...I(e)});var at=r=>r instanceof Gt?at(r.schema):r instanceof Ne?at(r.innerType()):r instanceof Qt?[r.value]:r instanceof Ht?r.options:r instanceof Xt?L.objectValues(r.enum):r instanceof zt?at(r._def.innerType):r instanceof jt?[void 0]:r instanceof Ut?[null]:r instanceof Le?[void 0,...at(r.unwrap())]:r instanceof Qe?[null,...at(r.unwrap())]:r instanceof Ds||r instanceof Yt?at(r.unwrap()):r instanceof Kt?at(r._def.innerType):[],pi=class r extends O{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.object)return y(t,{code:g.invalid_type,expected:_.object,received:t.parsedType}),w;let s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(y(t,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),w)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let n=new Map;for(let i of t){let a=at(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new r({typeName:A.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...I(s)})}};function Jo(r,e){let t=We(r),s=We(e);if(r===e)return{valid:!0,data:r};if(t===_.object&&s===_.object){let n=L.objectKeys(e),i=L.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=Jo(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===_.array&&s===_.array){if(r.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=Jo(a,o);if(!u.valid)return{valid:!1};n.push(u.data)}return{valid:!0,data:n}}else return t===_.date&&s===_.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Wt=class extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(fi(i)||fi(a))return w;let o=Jo(i.value,a.value);return o.valid?((hi(i)||hi(a))&&t.dirty(),{status:t.value,value:o.data}):(y(s,{code:g.invalid_intersection_types}),w)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Wt.create=(r,e,t)=>new Wt({left:r,right:e,typeName:A.ZodIntersection,...I(t)});var Ge=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.array)return y(s,{code:g.invalid_type,expected:_.array,received:s.parsedType}),w;if(s.data.length<this._def.items.length)return y(s,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),w;!this._def.rest&&s.data.length>this._def.items.length&&(y(s,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new ke(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>ie.mergeArray(t,a)):ie.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Ge.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ge({items:r,typeName:A.ZodTuple,rest:null,...I(e)})};var mi=class r extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.object)return y(s,{code:g.invalid_type,expected:_.object,received:s.parsedType}),w;let n=[],i=this._def.keyType,a=this._def.valueType;for(let o in s.data)n.push({key:i._parse(new ke(s,o,s.path,o)),value:a._parse(new ke(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?ie.mergeObjectAsync(t,n):ie.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof O?new r({keyType:e,valueType:t,typeName:A.ZodRecord,...I(s)}):new r({keyType:St.create(),valueType:e,typeName:A.ZodRecord,...I(t)})}},qr=class extends O{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.map)return y(s,{code:g.invalid_type,expected:_.map,received:s.parsedType}),w;let n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,u],c)=>({key:n._parse(new ke(s,o,s.path,[c,"key"])),value:i._parse(new ke(s,u,s.path,[c,"value"]))}));if(s.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return w;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return w;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};qr.create=(r,e,t)=>new qr({valueType:e,keyType:r,typeName:A.ZodMap,...I(t)});var Dr=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.set)return y(s,{code:g.invalid_type,expected:_.set,received:s.parsedType}),w;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(y(s,{code:g.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(y(s,{code:g.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return w;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...s.data.values()].map((u,c)=>i._parse(new ke(s,u,s.path,c)));return s.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:E.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:E.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Dr.create=(r,e)=>new Dr({valueType:r,minSize:null,maxSize:null,typeName:A.ZodSet,...I(e)});var gi=class r extends O{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.function)return y(t,{code:g.invalid_type,expected:_.function,received:t.parsedType}),w;function s(o,u){return qs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Lr(),it].filter(c=>!!c),issueData:{code:g.invalid_arguments,argumentsError:u}})}function n(o,u){return qs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Lr(),it].filter(c=>!!c),issueData:{code:g.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof bt){let o=this;return de(async function(...u){let c=new Se([]),l=await o._def.args.parseAsync(u,i).catch(h=>{throw c.addIssue(s(u,h)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(h=>{throw c.addIssue(n(d,h)),c})})}else{let o=this;return de(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Se([s(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new Se([n(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Ge.create(e).rest(ot.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||Ge.create([]).rest(ot.create()),returns:t||ot.create(),typeName:A.ZodFunction,...I(s)})}},Gt=class extends O{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Gt.create=(r,e)=>new Gt({getter:r,typeName:A.ZodLazy,...I(e)});var Qt=class extends O{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return y(t,{received:t.data,code:g.invalid_literal,expected:this._def.value}),w}return{status:"valid",value:e.data}}get value(){return this._def.value}};Qt.create=(r,e)=>new Qt({value:r,typeName:A.ZodLiteral,...I(e)});function Nm(r,e){return new Ht({values:r,typeName:A.ZodEnum,...I(e)})}var Ht=class r extends O{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return y(t,{expected:L.joinValues(s),received:t.parsedType,code:g.invalid_type}),w}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return y(t,{received:t.data,code:g.invalid_enum_value,options:s}),w}return de(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Ht.create=Nm;var Xt=class extends O{_parse(e){let t=L.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==_.string&&s.parsedType!==_.number){let n=L.objectValues(t);return y(s,{expected:L.joinValues(n),received:s.parsedType,code:g.invalid_type}),w}if(this._cache||(this._cache=new Set(L.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=L.objectValues(t);return y(s,{received:s.data,code:g.invalid_enum_value,options:n}),w}return de(e.data)}get enum(){return this._def.values}};Xt.create=(r,e)=>new Xt({values:r,typeName:A.ZodNativeEnum,...I(e)});var bt=class extends O{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.promise&&t.common.async===!1)return y(t,{code:g.invalid_type,expected:_.promise,received:t.parsedType}),w;let s=t.parsedType===_.promise?t.data:Promise.resolve(t.data);return de(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};bt.create=(r,e)=>new bt({type:r,typeName:A.ZodPromise,...I(e)});var Ne=class extends O{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===A.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{y(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return w;let u=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return u.status==="aborted"?w:u.status==="dirty"?qt(u.value):t.value==="dirty"?qt(u.value):u});{if(t.value==="aborted")return w;let o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?w:o.status==="dirty"?qt(o.value):t.value==="dirty"?qt(o.value):o}}if(n.type==="refinement"){let a=o=>{let u=n.refinement(o,i);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?w:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!vt(a))return w;let o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>vt(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):w);L.assertNever(n)}};Ne.create=(r,e,t)=>new Ne({schema:r,typeName:A.ZodEffects,effect:e,...I(t)});Ne.createWithPreprocess=(r,e,t)=>new Ne({schema:e,effect:{type:"preprocess",transform:r},typeName:A.ZodEffects,...I(t)});var Le=class extends O{_parse(e){return this._getType(e)===_.undefined?de(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Le.create=(r,e)=>new Le({innerType:r,typeName:A.ZodOptional,...I(e)});var Qe=class extends O{_parse(e){return this._getType(e)===_.null?de(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Qe.create=(r,e)=>new Qe({innerType:r,typeName:A.ZodNullable,...I(e)});var zt=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===_.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};zt.create=(r,e)=>new zt({innerType:r,typeName:A.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...I(e)});var Kt=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return kr(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Se(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Se(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Kt.create=(r,e)=>new Kt({innerType:r,typeName:A.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...I(e)});var $r=class extends O{_parse(e){if(this._getType(e)!==_.nan){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.nan,received:s.parsedType}),w}return{status:"valid",value:e.data}}};$r.create=r=>new $r({typeName:A.ZodNaN,...I(r)});var hC=Symbol("zod_brand"),Ds=class extends O{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},$s=class r extends O{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?w:i.status==="dirty"?(t.dirty(),qt(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?w:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:A.ZodPipeline})}},Yt=class extends O{_parse(e){let t=this._def.innerType._parse(e),s=n=>(vt(n)&&(n.value=Object.freeze(n.value)),n);return kr(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}};Yt.create=(r,e)=>new Yt({innerType:r,typeName:A.ZodReadonly,...I(e)});function Im(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Mm(r,e={},t){return r?Et.create().superRefine((s,n)=>{let i=r(s);if(i instanceof Promise)return i.then(a=>{if(!a){let o=Im(e,s),u=o.fatal??t??!0;n.addIssue({code:"custom",...o,fatal:u})}});if(!i){let a=Im(e,s),o=a.fatal??t??!0;n.addIssue({code:"custom",...a,fatal:o})}}):Et.create()}var pC={object:Ee.lazycreate},A;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(A||(A={}));var mC=(r,e={message:`Input not instance of ${r.name}`})=>Mm(t=>t instanceof r,e),Pm=St.create,qm=Dt.create,gC=$r.create,yC=$t.create,Dm=Bt.create,_C=Ft.create,vC=Mr.create,SC=jt.create,EC=Ut.create,bC=Et.create,wC=ot.create,TC=Fe.create,AC=Pr.create,CC=ut.create,xC=Ee.create,RC=Ee.strictCreate,IC=Vt.create,OC=pi.create,LC=Wt.create,kC=Ge.create,NC=mi.create,MC=qr.create,PC=Dr.create,qC=gi.create,DC=Gt.create,$C=Qt.create,BC=Ht.create,FC=Xt.create,jC=bt.create,UC=Ne.create,VC=Le.create,WC=Qe.create,GC=Ne.createWithPreprocess,QC=$s.create,HC=()=>Pm().optional(),XC=()=>qm().optional(),zC=()=>Dm().optional(),KC={string:r=>St.create({...r,coerce:!0}),number:r=>Dt.create({...r,coerce:!0}),boolean:r=>Bt.create({...r,coerce:!0}),bigint:r=>$t.create({...r,coerce:!0}),date:r=>Ft.create({...r,coerce:!0})};var YC=w;var Br=new Ur({namespace:"Nigredo/Prospecting",serviceName:"nigredo-list-leads"}),ct=new Ot("nigredo-list-leads"),ZC=process.env.DEFAULT_TENANT_ID||"00000000-0000-0000-0000-000000000000",JC=Me.object({page:Me.coerce.number().int().min(1).default(1),limit:Me.coerce.number().int().min(1).max(100).default(20),status:Me.string().optional(),source:Me.string().optional(),from_date:Me.string().datetime().optional(),to_date:Me.string().datetime().optional(),search:Me.string().min(2).max(100).optional()}),ex=async(r,e)=>{let t=rs();ct.updateContext({traceId:t,requestId:e.awsRequestId,functionName:e.functionName}),Or({correlationId:t,service:"nigredo-prospecting",operation:"list-leads"});let s=Date.now();try{ct.info("Processing list leads request",{correlationId:t,requestId:e.awsRequestId});let n=await Ir("ExtractTenantId",()=>{let b=ZC;return ct.info("Tenant ID extracted",{correlationId:t,tenantId:b}),Or({tenantId:b}),b},{operation:"extract_tenant"}),i=await Ir("ValidateQueryParams",()=>{let b=r.queryStringParameters||{};try{let T=JC.parse(b);return ct.info("Query parameters validated",{correlationId:t,params:T}),li({queryParams:T},"request"),T}catch(T){throw T instanceof Me.ZodError?(ct.warn("Query parameter validation failed",{correlationId:t,errors:T.errors}),new Error("Invalid query parameters")):T}},{operation:"validate_params"}),{query:a,countQuery:o,values:u}=await Ir("BuildQuery",()=>{let b=["tenant_id = $1"],T=[n],B=2;i.status&&(b.push(`status = $${B}`),T.push(i.status),B++),i.source&&(b.push(`source = $${B}`),T.push(i.source),B++),i.from_date&&(b.push(`created_at >= $${B}`),T.push(i.from_date),B++),i.to_date&&(b.push(`created_at <= $${B}`),T.push(i.to_date),B++),i.search&&(b.push(`(
            name ILIKE $${B} OR 
            email ILIKE $${B} OR 
            company ILIKE $${B}
          )`),T.push(`%${i.search}%`),B++);let fe=b.join(" AND "),G=(i.page-1)*i.limit,ae=`
          SELECT 
            id, name, email, phone, company, message,
            source, utm_source, utm_medium, utm_campaign,
            status, created_at, updated_at
          FROM nigredo_leads.leads
          WHERE ${fe}
          ORDER BY created_at DESC
          LIMIT $${B} OFFSET $${B+1}
        `,j=`
          SELECT COUNT(*) as total
          FROM nigredo_leads.leads
          WHERE ${fe}
        `;return T.push(i.limit,G),ct.info("Query built",{correlationId:t,conditions:b.length,hasSearch:!!i.search}),{query:ae,countQuery:j,values:T}},{operation:"build_query"}),{leads:c,total:l}=await Ir("QueryDatabase",async()=>{let b=await Cm();try{let T=await di("CountLeads",()=>b.query(o,u.slice(0,-2)),{tenantId:n}),B=parseInt(T.rows[0].total,10),G=(await di("SelectLeads",()=>b.query(a,u),{tenantId:n,page:i.page,limit:i.limit})).rows;return ct.info("Leads queried successfully",{correlationId:t,count:G.length,total:B}),{leads:G,total:B}}finally{b.release()}},{operation:"database",tenantId:n}),d=Math.ceil(l/i.limit),m={leads:c,pagination:{page:i.page,limit:i.limit,total:l,total_pages:d,has_next:i.page<d,has_prev:i.page>1}},h=Date.now()-s;return Br.addMetric("ListLeadsSuccess",je.Count,1),Br.addMetric("ListLeadsDuration",je.Milliseconds,h),Br.addMetric("LeadsReturned",je.Count,c.length),Br.publishStoredMetrics(),Or({status:"success",leadsCount:c.length}),li({pagination:m.pagination},"response"),ct.info("List leads completed successfully",{correlationId:t,count:c.length,total:l,durationMs:h}),{statusCode:200,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify(m)}}catch(n){return ct.error("Error listing leads",n,{correlationId:t}),Or({error:!0,status:"error"}),Br.addMetric("ListLeadsError",je.Count,1),Br.publishStoredMetrics(),n.message==="Invalid query parameters"?{statusCode:400,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Bad Request",message:"Invalid query parameters",requestId:t})}:{statusCode:500,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Internal Server Error",message:"Failed to list leads",requestId:t})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
