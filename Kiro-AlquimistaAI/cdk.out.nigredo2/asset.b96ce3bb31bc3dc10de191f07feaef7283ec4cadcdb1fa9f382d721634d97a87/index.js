"use strict";var fg=Object.create;var Gr=Object.defineProperty;var hg=Object.getOwnPropertyDescriptor;var pg=Object.getOwnPropertyNames;var mg=Object.getPrototypeOf,gg=Object.prototype.hasOwnProperty;var ou=r=>{throw TypeError(r)};var yg=(r,e,t)=>e in r?Gr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),uu=(r,e)=>{for(var t in e)Gr(r,t,{get:e[t],enumerable:!0})},cu=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of pg(e))!gg.call(r,n)&&n!==t&&Gr(r,n,{get:()=>e[n],enumerable:!(s=hg(e,n))||s.enumerable});return r};var Fe=(r,e,t)=>(t=r!=null?fg(mg(r)):{},cu(e||!r||!r.__esModule?Gr(t,"default",{value:r,enumerable:!0}):t,r)),_g=r=>cu(Gr({},"__esModule",{value:!0}),r);var A=(r,e,t)=>yg(r,typeof e!="symbol"?e+"":e,t),Ti=(r,e,t)=>e.has(r)||ou("Cannot "+t);var p=(r,e,t)=>(Ti(r,e,"read from private field"),t?t.call(r):e.get(r)),k=(r,e,t)=>e.has(r)?ou("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),te=(r,e,t,s)=>(Ti(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),q=(r,e,t)=>(Ti(r,e,"access private method"),t);var Fi=h((Kr,cr)=>{var xg=200,Wu="__lodash_hash_undefined__",Ig=800,Lg=16,Vu=9007199254740991,Gu="[object Arguments]",Og="[object Array]",kg="[object AsyncFunction]",Ng="[object Boolean]",Mg="[object Date]",Pg="[object Error]",Hu="[object Function]",qg="[object GeneratorFunction]",Dg="[object Map]",$g="[object Number]",Bg="[object Null]",Xu="[object Object]",Fg="[object Proxy]",Ug="[object RegExp]",jg="[object Set]",Wg="[object String]",Vg="[object Undefined]",Gg="[object WeakMap]",Hg="[object ArrayBuffer]",Xg="[object DataView]",Qg="[object Float32Array]",zg="[object Float64Array]",Kg="[object Int8Array]",Yg="[object Int16Array]",Zg="[object Int32Array]",Jg="[object Uint8Array]",ey="[object Uint8ClampedArray]",ty="[object Uint16Array]",ry="[object Uint32Array]",sy=/[\\^$.*+?()[\]{}|]/g,ny=/^\[object .+?Constructor\]$/,iy=/^(?:0|[1-9]\d*)$/,F={};F[Qg]=F[zg]=F[Kg]=F[Yg]=F[Zg]=F[Jg]=F[ey]=F[ty]=F[ry]=!0;F[Gu]=F[Og]=F[Hg]=F[Ng]=F[Xg]=F[Mg]=F[Pg]=F[Hu]=F[Dg]=F[$g]=F[Xu]=F[Ug]=F[jg]=F[Wg]=F[Gg]=!1;var Qu=typeof global=="object"&&global&&global.Object===Object&&global,ay=typeof self=="object"&&self&&self.Object===Object&&self,Jr=Qu||ay||Function("return this")(),zu=typeof Kr=="object"&&Kr&&!Kr.nodeType&&Kr,Yr=zu&&typeof cr=="object"&&cr&&!cr.nodeType&&cr,Ku=Yr&&Yr.exports===zu,Li=Ku&&Qu.process,Mu=function(){try{var r=Yr&&Yr.require&&Yr.require("util").types;return r||Li&&Li.binding&&Li.binding("util")}catch{}}(),Pu=Mu&&Mu.isTypedArray;function oy(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function uy(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}function cy(r){return function(e){return r(e)}}function ly(r,e){return r?.[e]}function dy(r,e){return function(t){return r(e(t))}}var fy=Array.prototype,hy=Function.prototype,en=Object.prototype,Oi=Jr["__core-js_shared__"],tn=hy.toString,tt=en.hasOwnProperty,qu=function(){var r=/[^.]+$/.exec(Oi&&Oi.keys&&Oi.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Yu=en.toString,py=tn.call(Object),my=RegExp("^"+tn.call(tt).replace(sy,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zs=Ku?Jr.Buffer:void 0,Du=Jr.Symbol,$u=Jr.Uint8Array,Bu=Zs?Zs.allocUnsafe:void 0,Zu=dy(Object.getPrototypeOf,Object),Fu=Object.create,gy=en.propertyIsEnumerable,yy=fy.splice,Ot=Du?Du.toStringTag:void 0,Js=function(){try{var r=Di(Object,"defineProperty");return r({},"",{}),r}catch{}}(),_y=Zs?Zs.isBuffer:void 0,Uu=Math.max,vy=Date.now,Ju=Di(Jr,"Map"),Zr=Di(Object,"create"),by=function(){function r(){}return function(e){if(!Nt(e))return{};if(Fu)return Fu(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function kt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Sy(){this.__data__=Zr?Zr(null):{},this.size=0}function Ey(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function wy(r){var e=this.__data__;if(Zr){var t=e[r];return t===Wu?void 0:t}return tt.call(e,r)?e[r]:void 0}function Ty(r){var e=this.__data__;return Zr?e[r]!==void 0:tt.call(e,r)}function Cy(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Zr&&e===void 0?Wu:e,this}kt.prototype.clear=Sy;kt.prototype.delete=Ey;kt.prototype.get=wy;kt.prototype.has=Ty;kt.prototype.set=Cy;function rt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Ay(){this.__data__=[],this.size=0}function Ry(r){var e=this.__data__,t=rn(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():yy.call(e,t,1),--this.size,!0}function xy(r){var e=this.__data__,t=rn(e,r);return t<0?void 0:e[t][1]}function Iy(r){return rn(this.__data__,r)>-1}function Ly(r,e){var t=this.__data__,s=rn(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}rt.prototype.clear=Ay;rt.prototype.delete=Ry;rt.prototype.get=xy;rt.prototype.has=Iy;rt.prototype.set=Ly;function lr(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Oy(){this.size=0,this.__data__={hash:new kt,map:new(Ju||rt),string:new kt}}function ky(r){var e=nn(this,r).delete(r);return this.size-=e?1:0,e}function Ny(r){return nn(this,r).get(r)}function My(r){return nn(this,r).has(r)}function Py(r,e){var t=nn(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}lr.prototype.clear=Oy;lr.prototype.delete=ky;lr.prototype.get=Ny;lr.prototype.has=My;lr.prototype.set=Py;function dr(r){var e=this.__data__=new rt(r);this.size=e.size}function qy(){this.__data__=new rt,this.size=0}function Dy(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function $y(r){return this.__data__.get(r)}function By(r){return this.__data__.has(r)}function Fy(r,e){var t=this.__data__;if(t instanceof rt){var s=t.__data__;if(!Ju||s.length<xg-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new lr(s)}return t.set(r,e),this.size=t.size,this}dr.prototype.clear=qy;dr.prototype.delete=Dy;dr.prototype.get=$y;dr.prototype.has=By;dr.prototype.set=Fy;function Uy(r,e){var t=Pi(r),s=!t&&Mi(r),n=!t&&!s&&sc(r),i=!t&&!s&&!n&&ic(r),a=t||s||n||i,o=a?uy(r.length,String):[],u=o.length;for(var c in r)(e||tt.call(r,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||tc(c,u)))&&o.push(c);return o}function ki(r,e,t){(t!==void 0&&!an(r[e],t)||t===void 0&&!(e in r))&&qi(r,e,t)}function jy(r,e,t){var s=r[e];(!(tt.call(r,e)&&an(s,t))||t===void 0&&!(e in r))&&qi(r,e,t)}function rn(r,e){for(var t=r.length;t--;)if(an(r[t][0],e))return t;return-1}function qi(r,e,t){e=="__proto__"&&Js?Js(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Wy=r_();function sn(r){return r==null?r===void 0?Vg:Bg:Ot&&Ot in Object(r)?s_(r):c_(r)}function ju(r){return es(r)&&sn(r)==Gu}function Vy(r){if(!Nt(r)||o_(r))return!1;var e=Bi(r)?my:ny;return e.test(h_(r))}function Gy(r){return es(r)&&nc(r.length)&&!!F[sn(r)]}function Hy(r){if(!Nt(r))return u_(r);var e=rc(r),t=[];for(var s in r)s=="constructor"&&(e||!tt.call(r,s))||t.push(s);return t}function ec(r,e,t,s,n){r!==e&&Wy(e,function(i,a){if(n||(n=new dr),Nt(i))Xy(r,e,a,t,ec,s,n);else{var o=s?s(Ni(r,a),i,a+"",r,e,n):void 0;o===void 0&&(o=i),ki(r,a,o)}},ac)}function Xy(r,e,t,s,n,i,a){var o=Ni(r,t),u=Ni(e,t),c=a.get(u);if(c){ki(r,t,c);return}var l=i?i(o,u,t+"",r,e,a):void 0,d=l===void 0;if(d){var m=Pi(u),f=!m&&sc(u),I=!m&&!f&&ic(u);l=u,m||f||I?Pi(o)?l=o:p_(o)?l=Jy(o):f?(d=!1,l=Ky(u,!0)):I?(d=!1,l=Zy(u,!0)):l=[]:m_(u)||Mi(u)?(l=o,Mi(o)?l=g_(o):(!Nt(o)||Bi(o))&&(l=n_(u))):d=!1}d&&(a.set(u,l),n(l,u,s,i,a),a.delete(u)),ki(r,t,l)}function Qy(r,e){return d_(l_(r,e,oc),r+"")}var zy=Js?function(r,e){return Js(r,"toString",{configurable:!0,enumerable:!1,value:__(e),writable:!0})}:oc;function Ky(r,e){if(e)return r.slice();var t=r.length,s=Bu?Bu(t):new r.constructor(t);return r.copy(s),s}function Yy(r){var e=new r.constructor(r.byteLength);return new $u(e).set(new $u(r)),e}function Zy(r,e){var t=e?Yy(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function Jy(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}function e_(r,e,t,s){var n=!t;t||(t={});for(var i=-1,a=e.length;++i<a;){var o=e[i],u=s?s(t[o],r[o],o,t,r):void 0;u===void 0&&(u=r[o]),n?qi(t,o,u):jy(t,o,u)}return t}function t_(r){return Qy(function(e,t){var s=-1,n=t.length,i=n>1?t[n-1]:void 0,a=n>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,a&&i_(t[0],t[1],a)&&(i=n<3?void 0:i,n=1),e=Object(e);++s<n;){var o=t[s];o&&r(e,o,s,i)}return e})}function r_(r){return function(e,t,s){for(var n=-1,i=Object(e),a=s(e),o=a.length;o--;){var u=a[r?o:++n];if(t(i[u],u,i)===!1)break}return e}}function nn(r,e){var t=r.__data__;return a_(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Di(r,e){var t=ly(r,e);return Vy(t)?t:void 0}function s_(r){var e=tt.call(r,Ot),t=r[Ot];try{r[Ot]=void 0;var s=!0}catch{}var n=Yu.call(r);return s&&(e?r[Ot]=t:delete r[Ot]),n}function n_(r){return typeof r.constructor=="function"&&!rc(r)?by(Zu(r)):{}}function tc(r,e){var t=typeof r;return e=e??Vu,!!e&&(t=="number"||t!="symbol"&&iy.test(r))&&r>-1&&r%1==0&&r<e}function i_(r,e,t){if(!Nt(t))return!1;var s=typeof e;return(s=="number"?$i(t)&&tc(e,t.length):s=="string"&&e in t)?an(t[e],r):!1}function a_(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function o_(r){return!!qu&&qu in r}function rc(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||en;return r===t}function u_(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function c_(r){return Yu.call(r)}function l_(r,e,t){return e=Uu(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,i=Uu(s.length-e,0),a=Array(i);++n<i;)a[n]=s[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=s[n];return o[e]=t(a),oy(r,this,o)}}function Ni(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var d_=f_(zy);function f_(r){var e=0,t=0;return function(){var s=vy(),n=Lg-(s-t);if(t=s,n>0){if(++e>=Ig)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function h_(r){if(r!=null){try{return tn.call(r)}catch{}try{return r+""}catch{}}return""}function an(r,e){return r===e||r!==r&&e!==e}var Mi=ju(function(){return arguments}())?ju:function(r){return es(r)&&tt.call(r,"callee")&&!gy.call(r,"callee")},Pi=Array.isArray;function $i(r){return r!=null&&nc(r.length)&&!Bi(r)}function p_(r){return es(r)&&$i(r)}var sc=_y||v_;function Bi(r){if(!Nt(r))return!1;var e=sn(r);return e==Hu||e==qg||e==kg||e==Fg}function nc(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Vu}function Nt(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function es(r){return r!=null&&typeof r=="object"}function m_(r){if(!es(r)||sn(r)!=Xu)return!1;var e=Zu(r);if(e===null)return!0;var t=tt.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&tn.call(t)==py}var ic=Pu?cy(Pu):Gy;function g_(r){return e_(r,ac(r))}function ac(r){return $i(r)?Uy(r,!0):Hy(r)}var y_=t_(function(r,e,t){ec(r,e,t)});function __(r){return function(){return r}}function oc(r){return r}function v_(){return!1}cr.exports=y_});var zi=h(bc=>{"use strict";bc.parse=function(r,e){return new Qi(r,e).parse()};var Qi=class r{constructor(e,t){this.source=e,this.transform=t||S_,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,s,n;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new r(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(t.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(n&&this.newEntry(!0),n=!n):t.value===","&&!n?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function S_(r){return r}});var Ki=h((aI,Sc)=>{var E_=zi();Sc.exports={create:function(r,e){return{parse:function(){return E_.parse(r,e)}}}}});var Tc=h((oI,wc)=>{"use strict";var w_=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,T_=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,C_=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,A_=/^-?infinity$/;wc.exports=function(e){if(A_.test(e))return Number(e.replace("i","I"));var t=w_.exec(e);if(!t)return R_(e)||null;var s=!!t[8],n=parseInt(t[1],10);s&&(n=Ec(n));var i=parseInt(t[2],10)-1,a=t[3],o=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),l=t[7];l=l?1e3*parseFloat(l):0;var d,m=x_(e);return m!=null?(d=new Date(Date.UTC(n,i,a,o,u,c,l)),Yi(n)&&d.setUTCFullYear(n),m!==0&&d.setTime(d.getTime()-m)):(d=new Date(n,i,a,o,u,c,l),Yi(n)&&d.setFullYear(n)),d};function R_(r){var e=T_.exec(r);if(e){var t=parseInt(e[1],10),s=!!e[4];s&&(t=Ec(t));var n=parseInt(e[2],10)-1,i=e[3],a=new Date(t,n,i);return Yi(t)&&a.setFullYear(t),a}}function x_(r){if(r.endsWith("+00"))return 0;var e=C_.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var s=t==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}function Ec(r){return-(r-1)}function Yi(r){return r>=0&&r<100}});var Ac=h((uI,Cc)=>{Cc.exports=L_;var I_=Object.prototype.hasOwnProperty;function L_(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)I_.call(t,s)&&(r[s]=t[s])}return r}});var Ic=h((cI,xc)=>{"use strict";var O_=Ac();xc.exports=yr;function yr(r){if(!(this instanceof yr))return new yr(r);O_(this,W_(r))}var k_=["seconds","minutes","hours","days","months","years"];yr.prototype.toPostgres=function(){var r=k_.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var N_={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},M_=["years","months","days"],P_=["hours","minutes","seconds"];yr.prototype.toISOString=yr.prototype.toISO=function(){var r=M_.map(t,this).join(""),e=P_.map(t,this).join("");return"P"+r+"T"+e;function t(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+N_[s]}};var Zi="([+-]?\\d+)",q_=Zi+"\\s+years?",D_=Zi+"\\s+mons?",$_=Zi+"\\s+days?",B_="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",F_=new RegExp([q_,D_,$_,B_].map(function(r){return"("+r+")?"}).join("\\s*")),Rc={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},U_=["hours","minutes","seconds","milliseconds"];function j_(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function W_(r){if(!r)return{};var e=F_.exec(r),t=e[8]==="-";return Object.keys(Rc).reduce(function(s,n){var i=Rc[n],a=e[i];return!a||(a=n==="milliseconds"?j_(a):parseInt(a,10),!a)||(t&&~U_.indexOf(n)&&(a*=-1),s[n]=a),s},{})}});var Oc=h((lI,Lc)=>{"use strict";Lc.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",s=0;s<e.length;)if(e[s]!=="\\")t+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))t+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var i=0;i<Math.floor(n/2);++i)t+="\\";s+=Math.floor(n/2)*2}return new Buffer(t,"binary")}});var $c=h((dI,Dc)=>{var os=zi(),us=Ki(),fn=Tc(),Nc=Ic(),Mc=Oc();function hn(r){return function(t){return t===null?t:r(t)}}function Pc(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function V_(r){return r?os.parse(r,Pc):null}function G_(r){return parseInt(r,10)}function Ji(r){return r?os.parse(r,hn(G_)):null}function H_(r){return r?os.parse(r,hn(function(e){return qc(e).trim()})):null}var X_=function(r){if(!r)return null;var e=us.create(r,function(t){return t!==null&&(t=sa(t)),t});return e.parse()},ea=function(r){if(!r)return null;var e=us.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},Ie=function(r){if(!r)return null;var e=us.create(r);return e.parse()},ta=function(r){if(!r)return null;var e=us.create(r,function(t){return t!==null&&(t=fn(t)),t});return e.parse()},Q_=function(r){if(!r)return null;var e=us.create(r,function(t){return t!==null&&(t=Nc(t)),t});return e.parse()},z_=function(r){return r?os.parse(r,hn(Mc)):null},ra=function(r){return parseInt(r,10)},qc=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},kc=function(r){return r?os.parse(r,hn(JSON.parse)):null},sa=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},K_=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",s=!1,n=2;n<r.length-1;n++){if(s||(e+=r[n]),r[n]===")"){s=!0;continue}else if(!s)continue;r[n]!==","&&(t+=r[n])}var i=sa(e);return i.radius=parseFloat(t),i},Y_=function(r){r(20,qc),r(21,ra),r(23,ra),r(26,ra),r(700,parseFloat),r(701,parseFloat),r(16,Pc),r(1082,fn),r(1114,fn),r(1184,fn),r(600,sa),r(651,Ie),r(718,K_),r(1e3,V_),r(1001,z_),r(1005,Ji),r(1007,Ji),r(1028,Ji),r(1016,H_),r(1017,X_),r(1021,ea),r(1022,ea),r(1231,ea),r(1014,Ie),r(1015,Ie),r(1008,Ie),r(1009,Ie),r(1040,Ie),r(1041,Ie),r(1115,ta),r(1182,ta),r(1185,ta),r(1186,Nc),r(1187,Q_),r(17,Mc),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,kc),r(3807,kc),r(3907,Ie),r(2951,Ie),r(791,Ie),r(1183,Ie),r(1270,Ie)};Dc.exports={init:Y_}});var Fc=h((fI,Bc)=>{"use strict";var Se=1e6;function Z_(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),s="";e<0&&(e=~e+(t===0),t=~t+1>>>0,s="-");var n="",i,a,o,u,c,l;{if(i=e%Se,e=e/Se>>>0,a=4294967296*i+t,t=a/Se>>>0,o=""+(a-Se*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}{if(i=e%Se,e=e/Se>>>0,a=4294967296*i+t,t=a/Se>>>0,o=""+(a-Se*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}{if(i=e%Se,e=e/Se>>>0,a=4294967296*i+t,t=a/Se>>>0,o=""+(a-Se*t),t===0&&e===0)return s+o+n;for(u="",c=6-o.length,l=0;l<c;l++)u+="0";n=u+o+n}return i=e%Se,a=4294967296*i+t,o=""+a%Se,s+o+n}Bc.exports=Z_});var Gc=h((hI,Vc)=>{var J_=Fc(),z=function(r,e,t,s,n){t=t||0,s=s||!1,n=n||function(f,I,C){return f*Math.pow(2,C)+I};var i=t>>3,a=function(f){return s?~f&255:f},o=255,u=8-t%8;e<u&&(o=255<<8-e&255,u=e),t&&(o=o>>t%8);var c=0;t%8+e>=8&&(c=n(0,a(r[i])&o,u));for(var l=e+t>>3,d=i+1;d<l;d++)c=n(c,a(r[d]),8);var m=(e+t)%8;return m>0&&(c=n(c,a(r[l])>>8-m,m)),c},Wc=function(r,e,t){var s=Math.pow(2,t-1)-1,n=z(r,1),i=z(r,t,1);if(i===0)return 0;var a=1,o=function(c,l,d){c===0&&(c=1);for(var m=1;m<=d;m++)a/=2,(l&1<<d-m)>0&&(c+=a);return c},u=z(r,e,t+1,!1,o);return i==Math.pow(2,t+1)-1?u===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,i-s)*u},ev=function(r){return z(r,1)==1?-1*(z(r,15,1,!0)+1):z(r,15,1)},Uc=function(r){return z(r,1)==1?-1*(z(r,31,1,!0)+1):z(r,31,1)},tv=function(r){return Wc(r,23,8)},rv=function(r){return Wc(r,52,11)},sv=function(r){var e=z(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,z(r,16,16)),s=0,n=[],i=z(r,16),a=0;a<i;a++)s+=z(r,16,64+16*a)*t,t/=1e4;var o=Math.pow(10,z(r,16,48));return(e===0?1:-1)*Math.round(s*o)/o},jc=function(r,e){var t=z(e,1),s=z(e,63,1),n=new Date((t===0?1:-1)*s/1e3+9466848e5);return r||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(i){this.usec=i},n.getUTCMicroSeconds=function(){return this.usec},n},cs=function(r){for(var e=z(r,32),t=z(r,32,32),s=z(r,32,64),n=96,i=[],a=0;a<e;a++)i[a]=z(r,32,n),n+=32,n+=32;var o=function(c){var l=z(r,32,n);if(n+=32,l==4294967295)return null;var d;if(c==23||c==20)return d=z(r,l*8,n),n+=l*8,d;if(c==25)return d=r.toString(this.encoding,n>>3,(n+=l<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var d=[],m;if(c.length>1){var f=c.shift();for(m=0;m<f;m++)d[m]=u(c,l);c.unshift(f)}else for(m=0;m<c[0];m++)d[m]=o(l);return d};return u(i,s)},nv=function(r){return r.toString("utf8")},iv=function(r){return r===null?null:z(r,8)>0},av=function(r){r(20,J_),r(21,ev),r(23,Uc),r(26,Uc),r(1700,sv),r(700,tv),r(701,rv),r(16,iv),r(1114,jc.bind(null,!1)),r(1184,jc.bind(null,!0)),r(1e3,cs),r(1007,cs),r(1016,cs),r(1008,cs),r(1009,cs),r(25,nv)};Vc.exports={init:av}});var Xc=h((pI,Hc)=>{Hc.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var fs=h(ds=>{var ov=$c(),uv=Gc(),cv=Ki(),lv=Xc();ds.getTypeParser=dv;ds.setTypeParser=fv;ds.arrayParser=cv;ds.builtins=lv;var ls={text:{},binary:{}};function Qc(r){return String(r)}function dv(r,e){return e=e||"text",ls[e]&&ls[e][r]||Qc}function fv(r,e,t){typeof e=="function"&&(t=e,e="text"),ls[e][r]=t}ov.init(function(r,e){ls.text[r]=e});uv.init(function(r,e){ls.binary[r]=e})});var hs=h((gI,na)=>{"use strict";na.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var _r=fs(),hv=_r.getTypeParser(20,"text"),pv=_r.getTypeParser(1016,"text");na.exports.__defineSetter__("parseInt8",function(r){_r.setTypeParser(20,"text",r?_r.getTypeParser(23,"text"):hv),_r.setTypeParser(1016,"text",r?_r.getTypeParser(1007,"text"):pv)})});var vr=h((yI,Yc)=>{"use strict";var mv=hs(),zc=require("util"),{isDate:gv}=zc.types||zc;function yv(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Kc(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+Kc(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof Buffer)){let n=Buffer.from(s.buffer,s.byteOffset,s.byteLength);n.length===s.byteLength?s=n:s=n.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=yv(pn(r[t]));return e=e+"}",e}var pn=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return gv(r)?mv.parseInputDatesAsUTC?bv(r):vv(r):Array.isArray(r)?Kc(r):_v(r,e)}return r.toString()};function _v(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),pn(r.toPostgres(pn),e)}return JSON.stringify(r)}function vv(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),s=t<1;s&&(t=Math.abs(t)+1);let n=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(n+="-",e*=-1):n+="+",n+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),s&&(n+=" BC"),n}function bv(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let s=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return s+="+00:00",t&&(s+=" BC"),s}function Sv(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var Ev=function(r){return'"'+r.replace(/"/g,'""')+'"'},wv=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let s=0;s<r.length;s++){let n=r[s];n==="'"?t+=n+n:n==="\\"?(t+=n+n,e=!0):t+=n}return t+="'",e===!0&&(t=" E"+t),t};Yc.exports={prepareValue:function(e){return pn(e)},normalizeQueryConfig:Sv,escapeIdentifier:Ev,escapeLiteral:wv}});var Jc=h((_I,Zc)=>{"use strict";var br=require("crypto");function ia(r){return br.createHash("md5").update(r,"utf-8").digest("hex")}function Tv(r,e,t){let s=ia(e+r);return"md5"+ia(Buffer.concat([Buffer.from(s),t]))}function Cv(r){return br.createHash("sha256").update(r).digest()}function Av(r,e){return r=r.replace(/(\D)-/,"$1"),br.createHash(r).update(e).digest()}function Rv(r,e){return br.createHmac("sha256",r).update(e).digest()}async function xv(r,e,t){return br.pbkdf2Sync(r,e,t,32,"sha256")}Zc.exports={postgresMd5PasswordHash:Tv,randomBytes:br.randomBytes,deriveKey:xv,sha256:Cv,hashByName:Av,hmacSha256:Rv,md5:ia}});var sl=h((vI,rl)=>{var el=require("crypto");rl.exports={postgresMd5PasswordHash:Lv,randomBytes:Iv,deriveKey:Mv,sha256:Ov,hashByName:kv,hmacSha256:Nv,md5:aa};var tl=el.webcrypto||globalThis.crypto,Dt=tl.subtle,oa=new TextEncoder;function Iv(r){return tl.getRandomValues(Buffer.alloc(r))}async function aa(r){try{return el.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?oa.encode(r):r,s=await Dt.digest("MD5",t);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}}async function Lv(r,e,t){let s=await aa(e+r);return"md5"+await aa(Buffer.concat([Buffer.from(s),t]))}async function Ov(r){return await Dt.digest("SHA-256",r)}async function kv(r,e){return await Dt.digest(r,e)}async function Nv(r,e){let t=await Dt.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await Dt.sign("HMAC",t,oa.encode(e))}async function Mv(r,e,t){let s=await Dt.importKey("raw",oa.encode(r),"PBKDF2",!1,["deriveBits"]),n={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await Dt.deriveBits(n,s,32*8,["deriveBits"])}});var ca=h((bI,ua)=>{"use strict";var Pv=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Pv?ua.exports=Jc():ua.exports=sl()});var al=h((SI,il)=>{function $t(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function la(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let s=t&127;if(s>4)throw $t("bad length",r);t=0;for(let n=0;n<s;n++)t=t<<8|r[e++];return{length:t,index:e}}function nl(r,e){if(r[e++]!==6)throw $t("non-OID data",r);let{length:t,index:s}=la(r,e);e=s;let n=e+t,i=r[e++],a=(i/40>>0)+"."+i%40;for(;e<n;){let o=0;for(;e<n;){let u=r[e++];if(o=o<<7|u&127,u<128)break}a+="."+o}return{oid:a,index:e}}function ps(r,e){if(r[e++]!==48)throw $t("non-sequence data",r);return la(r,e)}function qv(r,e){e===void 0&&(e=0),e=ps(r,e).index;let{length:t,index:s}=ps(r,e);e=s+t,e=ps(r,e).index;let{oid:n,index:i}=nl(r,e);switch(n){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=i,e=ps(r,e).index,r[e++]!==160)throw $t("non-tag data",r);e=la(r,e).index,e=ps(r,e).index;let{oid:a}=nl(r,e);switch(a){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw $t("unknown hash OID "+a,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw $t("Ed448 certificate channel binding is not currently supported by Postgres")}throw $t("unknown OID "+n,r)}il.exports={signatureAlgorithmHashFromCertificate:qv}});var ll=h((EI,cl)=>{"use strict";var yt=ca(),{signatureAlgorithmHashFromCertificate:Dv}=al();function $v(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let s=t.find(a=>r.includes(a));if(!s)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(s==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let n=yt.randomBytes(18).toString("base64");return{mechanism:s,clientNonce:n,response:(s==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+n,message:"SASLInitialResponse"}}async function Bv(r,e,t,s){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=jv(t);if(n.nonce.startsWith(r.clientNonce)){if(n.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let i="n=*,r="+r.clientNonce,a="r="+n.nonce+",s="+n.salt+",i="+n.iteration,o=s?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let ee=s.getPeerCertificate().raw,le=Dv(ee);(le==="MD5"||le==="SHA-1")&&(le="SHA-256");let X=await yt.hashByName(le,ee);o=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(X)]).toString("base64")}let u="c="+o+",r="+n.nonce,c=i+","+a+","+u,l=Buffer.from(n.salt,"base64"),d=await yt.deriveKey(e,l,n.iteration),m=await yt.hmacSha256(d,"Client Key"),f=await yt.sha256(m),I=await yt.hmacSha256(f,c),C=Vv(Buffer.from(m),Buffer.from(I)).toString("base64"),re=await yt.hmacSha256(d,"Server Key"),Ae=await yt.hmacSha256(re,c);r.message="SASLResponse",r.serverSignature=Buffer.from(Ae).toString("base64"),r.response=u+",p="+C}function Fv(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=Wv(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function Uv(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function ol(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function ul(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],s=e.substring(2);return[t,s]}))}function jv(r){let e=ul(r),t=e.get("r");if(t){if(!Uv(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!ol(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let i=parseInt(n,10);return{nonce:t,salt:s,iteration:i}}function Wv(r){let t=ul(r).get("v");if(t){if(!ol(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function Vv(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,s)=>r[s]^e[s]))}cl.exports={startSession:$v,continueSession:Bv,finalizeSession:Fv}});var gn=h((wI,dl)=>{"use strict";var Gv=fs();function mn(r){this._types=r||Gv,this.text={},this.binary={}}mn.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};mn.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};mn.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};dl.exports=mn});var pl=h((TI,hl)=>{"use strict";function Sr(r,e={}){if(r.charAt(0)==="/"){let u=r.split(" ");return{host:u[0],database:u[1]}}let t={},s,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{s=new URL(r,"postgres://base")}catch{s=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of s.searchParams.entries())t[u[0]]=u[1];if(t.user=t.user||decodeURIComponent(s.username),t.password=t.password||decodeURIComponent(s.password),s.protocol=="socket:")return t.host=decodeURI(s.pathname),t.database=s.searchParams.get("db"),t.client_encoding=s.searchParams.get("encoding"),t;let i=n?"":s.hostname;t.host?i&&/^%2f/i.test(i)&&(s.pathname=i+s.pathname):t.host=decodeURIComponent(i),t.port||(t.port=s.port);let a=s.pathname.slice(1)||null;t.database=a?decodeURI(a):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let o=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=o.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=o.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=o.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function Hv(r){return Object.entries(r).reduce((t,[s,n])=>(n!=null&&(t[s]=n),t),{})}function fl(r){return Object.entries(r).reduce((t,[s,n])=>{if(s==="ssl"){let i=n;typeof i=="boolean"&&(t[s]=i),typeof i=="object"&&(t[s]=Hv(i))}else if(n!=null)if(s==="port"){if(n!==""){let i=parseInt(n,10);if(isNaN(i))throw new Error(`Invalid ${s}: ${n}`);t[s]=i}}else t[s]=n;return t},{})}function Xv(r){return fl(Sr(r))}hl.exports=Sr;Sr.parse=Sr;Sr.toClientConfig=fl;Sr.parseIntoClientConfig=Xv});var fa=h((CI,yl)=>{"use strict";var Qv=require("dns"),gl=hs(),ml=pl().parse,ge=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||gl[r]},zv=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return gl.ssl},Er=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},Le=function(r,e,t){let s=e[t];s!=null&&r.push(t+"="+Er(s))},da=class{constructor(e){e=typeof e=="string"?ml(e):e||{},e.connectionString&&(e=Object.assign({},e,ml(e.connectionString))),this.user=ge("user",e),this.database=ge("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(ge("port",e),10),this.host=ge("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:ge("password",e)}),this.binary=ge("binary",e),this.options=ge("options",e),this.ssl=typeof e.ssl>"u"?zv():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=ge("client_encoding",e),this.replication=ge("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=ge("application_name",e,"PGAPPNAME"),this.fallback_application_name=ge("fallback_application_name",e,!1),this.statement_timeout=ge("statement_timeout",e,!1),this.lock_timeout=ge("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=ge("idle_in_transaction_session_timeout",e,!1),this.query_timeout=ge("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];Le(t,this,"user"),Le(t,this,"password"),Le(t,this,"port"),Le(t,this,"application_name"),Le(t,this,"fallback_application_name"),Le(t,this,"connect_timeout"),Le(t,this,"options");let s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(Le(t,s,"sslmode"),Le(t,s,"sslca"),Le(t,s,"sslkey"),Le(t,s,"sslcert"),Le(t,s,"sslrootcert"),this.database&&t.push("dbname="+Er(this.database)),this.replication&&t.push("replication="+Er(this.replication)),this.host&&t.push("host="+Er(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+Er(this.client_encoding)),Qv.lookup(this.host,function(n,i){return n?e(n,null):(t.push("hostaddr="+Er(i)),e(null,t.join(" ")))})}};yl.exports=da});var pa=h((AI,vl)=>{"use strict";var Kv=fs(),_l=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,ha=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=_l.exec(e.text):t=_l.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let s=0,n=e.length;s<n;s++){let i=e[s];i!==null?t[s]=this._parsers[s](i):t[s]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let s=0,n=e.length;s<n;s++){let i=e[s],a=this.fields[s].name;if(i!==null){let o=this.fields[s].format==="binary"?Buffer.from(i):i;t[a]=this._parsers[s](o)}else t[a]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let s=0;s<e.length;s++){let n=e[s];t[n.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[s]=Kv.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...t}}};vl.exports=ha});var wl=h((RI,El)=>{"use strict";var{EventEmitter:Yv}=require("events"),bl=pa(),Sl=vr(),ma=class extends Yv{constructor(e,t,s){super(),e=Sl.normalizeQueryConfig(e,t,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new bl(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new bl(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Sl.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};El.exports=ma});var La=h(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.NoticeMessage=T.DataRowMessage=T.CommandCompleteMessage=T.ReadyForQueryMessage=T.NotificationResponseMessage=T.BackendKeyDataMessage=T.AuthenticationMD5Password=T.ParameterStatusMessage=T.ParameterDescriptionMessage=T.RowDescriptionMessage=T.Field=T.CopyResponse=T.CopyDataMessage=T.DatabaseError=T.copyDone=T.emptyQuery=T.replicationStart=T.portalSuspended=T.noData=T.closeComplete=T.bindComplete=T.parseComplete=void 0;T.parseComplete={name:"parseComplete",length:5};T.bindComplete={name:"bindComplete",length:5};T.closeComplete={name:"closeComplete",length:5};T.noData={name:"noData",length:5};T.portalSuspended={name:"portalSuspended",length:5};T.replicationStart={name:"replicationStart",length:4};T.emptyQuery={name:"emptyQuery",length:4};T.copyDone={name:"copyDone",length:4};var ga=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};T.DatabaseError=ga;var ya=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};T.CopyDataMessage=ya;var _a=class{constructor(e,t,s,n){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(n)}};T.CopyResponse=_a;var va=class{constructor(e,t,s,n,i,a,o){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=a,this.format=o}};T.Field=va;var ba=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};T.RowDescriptionMessage=ba;var Sa=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};T.ParameterDescriptionMessage=Sa;var Ea=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};T.ParameterStatusMessage=Ea;var wa=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};T.AuthenticationMD5Password=wa;var Ta=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};T.BackendKeyDataMessage=Ta;var Ca=class{constructor(e,t,s,n){this.length=e,this.processId=t,this.channel=s,this.payload=n,this.name="notification"}};T.NotificationResponseMessage=Ca;var Aa=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};T.ReadyForQueryMessage=Aa;var Ra=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};T.CommandCompleteMessage=Ra;var xa=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};T.DataRowMessage=xa;var Ia=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};T.NoticeMessage=Ia});var Tl=h(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.Writer=void 0;var Oa=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};yn.Writer=Oa});var Al=h(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.serialize=void 0;var ka=Tl(),V=new ka.Writer,Zv=r=>{V.addInt16(3).addInt16(0);for(let s of Object.keys(r))V.addCString(s).addCString(r[s]);V.addCString("client_encoding").addCString("UTF8");let e=V.addCString("").flush(),t=e.length+4;return new ka.Writer().addInt32(t).add(e).flush()},Jv=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},eb=r=>V.addCString(r).flush(112),tb=function(r,e){return V.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),V.flush(112)},rb=function(r){return V.addString(r).flush(112)},sb=r=>V.addCString(r).flush(81),Cl=[],nb=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||Cl,s=t.length,n=V.addCString(e).addCString(r.text).addInt16(s);for(let i=0;i<s;i++)n.addInt32(t[i]);return V.flush(80)},wr=new ka.Writer,ib=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(V.addInt16(0),wr.addInt32(-1)):s instanceof Buffer?(V.addInt16(1),wr.addInt32(s.length),wr.add(s)):(V.addInt16(0),wr.addInt32(Buffer.byteLength(s)),wr.addString(s))}},ab=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,n=r.values||Cl,i=n.length;return V.addCString(e).addCString(t),V.addInt16(i),ib(n,r.valueMapper),V.addInt16(i),V.add(wr.flush()),V.addInt16(1),V.addInt16(s?1:0),V.flush(66)},ob=Buffer.from([69,0,0,0,9,0,0,0,0,0]),ub=r=>{if(!r||!r.portal&&!r.rows)return ob;let e=r.portal||"",t=r.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,i=Buffer.allocUnsafe(1+n);return i[0]=69,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[s+5]=0,i.writeUInt32BE(t,i.length-4),i},cb=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},Na=(r,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=r,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},lb=V.addCString("P").flush(68),db=V.addCString("S").flush(68),fb=r=>r.name?Na(68,`${r.type}${r.name||""}`):r.type==="P"?lb:db,hb=r=>{let e=`${r.type}${r.name||""}`;return Na(67,e)},pb=r=>V.add(r).flush(100),mb=r=>Na(102,r),_n=r=>Buffer.from([r,0,0,0,4]),gb=_n(72),yb=_n(83),_b=_n(88),vb=_n(99),bb={startup:Zv,password:eb,requestSsl:Jv,sendSASLInitialResponseMessage:tb,sendSCRAMClientFinalMessage:rb,query:sb,parse:nb,bind:ab,execute:ub,describe:fb,close:hb,flush:()=>gb,sync:()=>yb,end:()=>_b,copyData:pb,copyDone:()=>vb,copyFail:mb,cancel:cb};vn.serialize=bb});var Rl=h(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.BufferReader=void 0;var Sb=Buffer.allocUnsafe(0),Ma=class{constructor(e=0){this.offset=e,this.buffer=Sb,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};bn.BufferReader=Ma});var Ll=h(Sn=>{"use strict";Object.defineProperty(Sn,"__esModule",{value:!0});Sn.Parser=void 0;var K=La(),Eb=Rl(),Pa=1,wb=4,xl=Pa+wb,Il=Buffer.allocUnsafe(0),qa=class{constructor(e){if(this.buffer=Il,this.bufferLength=0,this.bufferOffset=0,this.reader=new Eb.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+xl<=s;){let i=this.buffer[n],a=this.buffer.readUInt32BE(n+Pa),o=Pa+a;if(o+n<=s){let u=this.handlePacket(n+xl,i,a,this.buffer);t(u),n+=o}else break}n===s?(this.buffer=Il,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let n;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let i=this.buffer.byteLength*2;for(;t>=i;)i*=2;n=Buffer.allocUnsafe(i)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,n){switch(t){case 50:return K.bindComplete;case 49:return K.parseComplete;case 51:return K.closeComplete;case 110:return K.noData;case 115:return K.portalSuspended;case 99:return K.copyDone;case 87:return K.replicationStart;case 73:return K.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:return new K.DatabaseError("received invalid response: "+t.toString(16),s,"error")}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new K.ReadyForQueryMessage(t,n)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new K.CommandCompleteMessage(t,n)}parseCopyData(e,t,s){let n=s.slice(e,e+(t-4));return new K.CopyDataMessage(t,n)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,n){this.reader.setBuffer(e,s);let i=this.reader.byte()!==0,a=this.reader.int16(),o=new K.CopyResponse(t,n,i,a);for(let u=0;u<a;u++)o.columnTypes[u]=this.reader.int16();return o}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.cstring(),a=this.reader.cstring();return new K.NotificationResponseMessage(t,n,i,a)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new K.RowDescriptionMessage(t,n);for(let a=0;a<n;a++)i.fields[a]=this.parseField();return i}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),s=this.reader.int16(),n=this.reader.uint32(),i=this.reader.int16(),a=this.reader.int32(),o=this.reader.int16()===0?"text":"binary";return new K.Field(e,t,s,n,i,a,o)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new K.ParameterDescriptionMessage(t,n);for(let a=0;a<n;a++)i.dataTypeIDs[a]=this.reader.int32();return i}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Array(n);for(let a=0;a<n;a++){let o=this.reader.int32();i[a]=o===-1?null:this.reader.string(o)}return new K.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),i=this.reader.cstring();return new K.ParameterStatusMessage(t,n,i)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.int32();return new K.BackendKeyDataMessage(t,n,i)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i={name:"authenticationOk",length:t};switch(n){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";let a=this.reader.bytes(4);return new K.AuthenticationMD5Password(t,a)}break;case 10:{i.name="authenticationSASL",i.mechanisms=[];let a;do a=this.reader.cstring(),a&&i.mechanisms.push(a);while(a)}break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(t-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return i}parseErrorMessage(e,t,s,n){this.reader.setBuffer(e,s);let i={},a=this.reader.string(1);for(;a!=="\0";)i[a]=this.reader.cstring(),a=this.reader.string(1);let o=i.M,u=n==="notice"?new K.NoticeMessage(t,o):new K.DatabaseError(o,t,n);return u.severity=i.S,u.code=i.C,u.detail=i.D,u.hint=i.H,u.position=i.P,u.internalPosition=i.p,u.internalQuery=i.q,u.where=i.W,u.schema=i.s,u.table=i.t,u.column=i.c,u.dataType=i.d,u.constraint=i.n,u.file=i.F,u.line=i.L,u.routine=i.R,u}};Sn.Parser=qa});var Da=h(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.DatabaseError=_t.serialize=_t.parse=void 0;var Tb=La();Object.defineProperty(_t,"DatabaseError",{enumerable:!0,get:function(){return Tb.DatabaseError}});var Cb=Al();Object.defineProperty(_t,"serialize",{enumerable:!0,get:function(){return Cb.serialize}});var Ab=Ll();function Rb(r,e){let t=new Ab.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}_t.parse=Rb});var Ol=h($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.default={}});var Nl=h((PI,kl)=>{var{getStream:xb,getSecureStream:Ib}=Nb();kl.exports={getStream:xb,getSecureStream:Ib};function Lb(){function r(t){let s=require("net");return new s.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function Ob(){function r(t){let{CloudflareSocket:s}=Ol();return new s(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function kb(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function Nb(){return kb()?Ob():Lb()}});var Fa=h((qI,Ml)=>{"use strict";var Mb=require("events").EventEmitter,{parse:Pb,serialize:ae}=Da(),{getStream:qb,getSecureStream:Db}=Nl(),$b=ae.flush(),Bb=ae.sync(),Fb=ae.end(),Ba=class extends Mb{constructor(e){super(),e=e||{},this.stream=e.stream||qb(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(s){s==="message"&&(t._emitMessage=!0)})}connect(e,t){let s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=function(i){s._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||s.emit("error",i)};if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){switch(i.toString("utf8")){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let o={socket:s.stream};s.ssl!==!0&&(Object.assign(o,s.ssl),"key"in s.ssl&&(o.key=s.ssl.key));let u=require("net");u.isIP&&u.isIP(t)===0&&(o.servername=t);try{s.stream=Db(o)}catch(c){return s.emit("error",c)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){Pb(e,t=>{let s=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(s,t)})}requestSsl(){this.stream.write(ae.requestSsl())}startup(e){this.stream.write(ae.startup(e))}cancel(e,t){this._send(ae.cancel(e,t))}password(e){this._send(ae.password(e))}sendSASLInitialResponseMessage(e,t){this._send(ae.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(ae.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(ae.query(e))}parse(e){this._send(ae.parse(e))}bind(e){this._send(ae.bind(e))}execute(e){this._send(ae.execute(e))}flush(){this.stream.writable&&this.stream.write($b)}sync(){this._ending=!0,this._send(Bb)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(Fb,()=>{this.stream.end()})}close(e){this._send(ae.close(e))}describe(e){this._send(ae.describe(e))}sendCopyFromChunk(e){this._send(ae.copyData(e))}endCopyFrom(){this._send(ae.copyDone())}sendCopyFail(e){this._send(ae.copyFail(e))}};Ml.exports=Ba});var $l=h((DI,Dl)=>{"use strict";var{Transform:Ub}=require("stream"),{StringDecoder:jb}=require("string_decoder"),vt=Symbol("last"),En=Symbol("decoder");function Wb(r,e,t){let s;if(this.overflow){if(s=this[En].write(r).split(this.matcher),s.length===1)return t();s.shift(),this.overflow=!1}else this[vt]+=this[En].write(r),s=this[vt].split(this.matcher);this[vt]=s.pop();for(let n=0;n<s.length;n++)try{ql(this,this.mapper(s[n]))}catch(i){return t(i)}if(this.overflow=this[vt].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function Vb(r){if(this[vt]+=this[En].end(),this[vt])try{ql(this,this.mapper(this[vt]))}catch(e){return r(e)}r()}function ql(r,e){e!==void 0&&r.push(e)}function Pl(r){return r}function Gb(r,e,t){switch(r=r||/\r?\n/,e=e||Pl,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=Pl)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=Wb,t.flush=Vb,t.readableObjectMode=!0;let s=new Ub(t);return s[vt]="",s[En]=new jb("utf8"),s.matcher=r,s.mapper=e,s.maxLength=t.maxLength,s.skipOverflow=t.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,i){this._writableState.errorEmitted=!1,i(n)},s}Dl.exports=Gb});var Ul=h(($I,nt)=>{"use strict";var Bl=require("path"),Hb=require("stream").Stream,Xb=$l(),Fl=require("util"),Qb=5432,wn=process.platform==="win32",ms=process.stderr,zb=56,Kb=7,Yb=61440,Zb=32768;function Jb(r){return(r&Yb)==Zb}var Tr=["host","port","database","user","password"],Ua=Tr.length,eS=Tr[Ua-1];function ja(){var r=ms instanceof Hb&&ms.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);ms.write(Fl.format.apply(Fl,e))}}Object.defineProperty(nt.exports,"isWin",{get:function(){return wn},set:function(r){wn=r}});nt.exports.warnTo=function(r){var e=ms;return ms=r,e};nt.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(wn?Bl.join(e.APPDATA||"./","postgresql","pgpass.conf"):Bl.join(e.HOME||"./",".pgpass"));return t};nt.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:wn?!0:(e=e||"<unkn>",Jb(r.mode)?r.mode&(zb|Kb)?(ja('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(ja('WARNING: password file "%s" is not a plain file',e),!1))};var tS=nt.exports.match=function(r,e){return Tr.slice(0,-1).reduce(function(t,s,n){return n==1&&Number(r[s]||Qb)===Number(e[s])?t&&!0:t&&(e[s]==="*"||e[s]===r[s])},!0)};nt.exports.getPassword=function(r,e,t){var s,n=e.pipe(Xb());function i(u){var c=rS(u);c&&sS(c)&&tS(r,c)&&(s=c[eS],n.end())}var a=function(){e.destroy(),t(s)},o=function(u){e.destroy(),ja("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",o),n.on("data",i).on("end",a).on("error",o)};var rS=nt.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",s=0,n=0,i=0,a={},o=!1,u=function(l,d,m){var f=r.substring(d,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(f=f.replace(/\\([:\\])/g,"$1")),a[Tr[l]]=f},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),o=s==Ua-1,o){u(s,n);break}c>=0&&e==":"&&t!=="\\"&&(u(s,n,c+1),n=c+2,s+=1)}return a=Object.keys(a).length===Ua?a:null,a},sS=nt.exports.isValidEntry=function(r){for(var e={0:function(a){return a.length>0},1:function(a){return a==="*"?!0:(a=Number(a),isFinite(a)&&a>0&&a<9007199254740992&&Math.floor(a)===a)},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},t=0;t<Tr.length;t+=1){var s=e[t],n=r[Tr[t]]||"",i=s(n);if(!i)return!1}return!0}});var Wl=h((FI,Wa)=>{"use strict";var BI=require("path"),jl=require("fs"),Tn=Ul();Wa.exports=function(r,e){var t=Tn.getFileName();jl.stat(t,function(s,n){if(s||!Tn.usePgPass(n,t))return e(void 0);var i=jl.createReadStream(t);Tn.getPassword(r,i,e)})};Wa.exports.warnTo=Tn.warnTo});var Xl=h((UI,Hl)=>{"use strict";var nS=require("events").EventEmitter,Vl=vr(),Va=ll(),iS=gn(),aS=fa(),Gl=wl(),oS=hs(),uS=Fa(),cS=ca(),Cn=class extends nS{constructor(e){super(),this.connectionParameters=new aS(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new iS(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new uS({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||oS.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){t.ssl?s.requestSsl():s.startup(t.getStartupConf())}),s.on("sslconnect",function(){s.startup(t.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,s)=>{this._connect(n=>{n?s(n):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{t.emit("error",s)});else if(this.password!==null)e();else try{Wl()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await cS.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Va.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await Va.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{Va.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(t.application_name=s),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,s){return this._types.setTypeParser(e,t,s)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return Vl.escapeIdentifier(e)}escapeLiteral(e){return Vl.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,s){let n,i,a,o,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(a=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,typeof t=="function"&&(n.callback=n.callback||t)):(a=e.query_timeout||this.connectionParameters.query_timeout,n=new Gl(e,t,s),n.callback||(i=new this._Promise((c,l)=>{n.callback=(d,m)=>d?l(d):c(m)}).catch(c=>{throw Error.captureStackTrace(c),c}))),a&&(u=n.callback,o=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{n.handleError(c,this.connection)}),u(c),n.callback=()=>{};let l=this.queryQueue.indexOf(n);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},a),n.callback=(c,l)=>{clearTimeout(o),u(c,l)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(n),this._pulseQueryQueue(),i):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};Cn.Query=Gl;Hl.exports=Cn});var Yl=h((jI,Kl)=>{"use strict";var lS=require("events").EventEmitter,Ql=function(){},zl=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},Ga=class{constructor(e,t,s){this.client=e,this.idleListener=t,this.timeoutId=s}},Cr=class{constructor(e){this.callback=e}};function dS(){throw new Error("Release called on client which has already been released to the pool.")}function An(r,e){if(e)return{callback:e,result:void 0};let t,s,n=function(a,o){a?t(a):s(o)},i=new r(function(a,o){s=a,t=o}).catch(a=>{throw Error.captureStackTrace(a),a});return{callback:n,result:i}}function fS(r,e){return function t(s){s.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",s)}),r._remove(e),r.emit("error",s,e)}}var Ha=class extends lS{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||Xa().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let s=t.client;s.ref&&s.ref();let n=t.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let s=zl(this._idle,i=>i.client===e);s!==void 0&&clearTimeout(s.timeoutId),this._clients=this._clients.filter(i=>i!==e);let n=this;e.end(()=>{n.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let t=An(this.Promise,e),s=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Cr(t.callback)),s;let n=(o,u,c)=>{clearTimeout(a),t.callback(o,u,c)},i=new Cr(n),a=setTimeout(()=>{zl(this._pendingQueue,o=>o.callback===n),i.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return a.unref&&a.unref(),this._pendingQueue.push(i),s}return this.newClient(new Cr(t.callback)),s}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let s=fS(this,t);this.log("checking client timeout");let n,i=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),i=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(a=>{if(n&&clearTimeout(n),t.on("error",s),a)this.log("client failed to connect",a),this._clients=this._clients.filter(o=>o!==t),i&&(a=new Error("Connection terminated due to connection timeout",{cause:a})),this._pulseQueue(),e.timedOut||e.callback(a,void 0,Ql);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let o=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new Cr((c,l,d)=>d()),s,!1)},this.options.maxLifetimeSeconds*1e3);o.unref(),t.once("end",()=>clearTimeout(o))}return this._acquireClient(t,e,s,!0)}})}_acquireClient(e,t,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),t.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,i=>{if(i)return e.release(i),t.callback(i,void 0,Ql);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let s=!1;return n=>{s&&dS(),s=!0,this._release(e,t,n)}}_release(e,t,s){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let i;this.options.idleTimeoutMillis&&this._isAboveMin()&&(i=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&i.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Ga(e,t,i)),this._pulseQueue()}query(e,t,s){if(typeof e=="function"){let i=An(this.Promise,e);return setImmediate(function(){return i.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),i.result}typeof t=="function"&&(s=t,t=void 0);let n=An(this.Promise,s);return s=n.callback,this.connect((i,a)=>{if(i)return s(i);let o=!1,u=c=>{o||(o=!0,a.release(c),s(c))};a.once("error",u),this.log("dispatching query");try{a.query(e,t,(c,l)=>{if(this.log("query dispatched"),a.removeListener("error",u),!o)return o=!0,a.release(c),c?s(c):s(void 0,l)})}catch(c){return a.release(c),s(c)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let t=An(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Kl.exports=Ha});var ed=h((WI,Jl)=>{"use strict";var Zl=require("events").EventEmitter,hS=require("util"),Qa=vr(),Ar=Jl.exports=function(r,e,t){Zl.call(this),r=Qa.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};hS.inherits(Ar,Zl);var pS={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Ar.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let s=pS[t]||t;r[s]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};Ar.prototype.then=function(r,e){return this._getPromise().then(r,e)};Ar.prototype.catch=function(r){return this._getPromise().catch(r)};Ar.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};Ar.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(s,n,i){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(i.length>1?n.forEach((a,o)=>{a.forEach(u=>{e.emit("row",u,i[o])})}):n.forEach(function(a){e.emit("row",a,i)})),e.state="end",e.emit("end",i),e.callback&&e.callback(null,i)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let s=(this.values||[]).map(Qa.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let n=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(n)}return r.native.execute(this.name,s,t)}return r.native.prepare(this.name,this.text,s.length,function(n){return n?t(n):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,s,t))})}else if(this.values){if(!Array.isArray(this.values)){let n=new Error("Query values must be an array");return t(n)}let s=this.values.map(Qa.prepareValue);r.native.query(this.text,s,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var id=h((VI,nd)=>{"use strict";var td;try{td=require("pg-native")}catch(r){throw r}var mS=gn(),rd=require("events").EventEmitter,gS=require("util"),yS=fa(),sd=ed(),Ee=nd.exports=function(r){rd.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new mS(r.types),this.native=new td({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new yS(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};Ee.Query=sd;gS.inherits(Ee,rd);Ee.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};Ee.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(s,function(n){if(n)return e.native.end(),r(n);e._connected=!0,e.native.on("error",function(i){e._queryable=!1,e._errorAllQueries(i),e.emit("error",i)}),e.native.on("notification",function(i){e.emit("notification",{channel:i.relname,payload:i.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};Ee.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(s=>{s?t(s):e()})})};Ee.prototype.query=function(r,e,t){let s,n,i,a,o;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")i=r.query_timeout||this.connectionParameters.query_timeout,n=s=r,typeof e=="function"&&(r.callback=e);else if(i=r.query_timeout||this.connectionParameters.query_timeout,s=new sd(r,e,t),!s.callback){let u,c;n=new this._Promise((l,d)=>{u=l,c=d}).catch(l=>{throw Error.captureStackTrace(l),l}),s.callback=(l,d)=>l?c(l):u(d)}return i&&(o=s.callback,a=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),o(u),s.callback=()=>{};let c=this._queryQueue.indexOf(s);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},i),s.callback=(u,c)=>{clearTimeout(a),o(u,c)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};Ee.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(s,n){r=i=>i?n(i):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};Ee.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};Ee.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};Ee.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};Ee.prototype.ref=function(){};Ee.prototype.unref=function(){};Ee.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};Ee.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var za=h((GI,ad)=>{"use strict";ad.exports=id()});var Xa=h((XI,gs)=>{"use strict";var _S=Xl(),vS=hs(),bS=Fa(),SS=pa(),ES=vr(),wS=Yl(),TS=gn(),{DatabaseError:CS}=Da(),{escapeIdentifier:AS,escapeLiteral:RS}=vr(),xS=r=>class extends wS{constructor(t){super(t,r)}},Ka=function(r){this.defaults=vS,this.Client=r,this.Query=this.Client.Query,this.Pool=xS(this.Client),this._pools=[],this.Connection=bS,this.types=fs(),this.DatabaseError=CS,this.TypeOverrides=TS,this.escapeIdentifier=AS,this.escapeLiteral=RS,this.Result=SS,this.utils=ES};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?gs.exports=new Ka(za()):(gs.exports=new Ka(_S),Object.defineProperty(gs.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new Ka(za())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(gs.exports,"native",{value:r}),r}}))});var dd=h((iL,ld)=>{"use strict";function Ya(r){return typeof r=="function"}var ye=console.error.bind(console);function ys(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function _s(r){r&&r.logger&&(Ya(r.logger)?ye=r.logger:ye("new logger isn't a function, not replacing"))}function ud(r,e,t){if(!r||!r[e]){ye("no original function "+e+" to wrap");return}if(!t){ye("no wrapper function"),ye(new Error().stack);return}if(!Ya(r[e])||!Ya(t)){ye("original object and wrapper must be functions");return}var s=r[e],n=t(s,e);return ys(n,"__original",s),ys(n,"__unwrap",function(){r[e]===n&&ys(r,e,s)}),ys(n,"__wrapped",!0),ys(r,e,n),n}function IS(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{ye("must provide one or more modules to patch"),ye(new Error().stack);return}if(!(e&&Array.isArray(e))){ye("must provide one or more functions to wrap on modules");return}r.forEach(function(s){e.forEach(function(n){ud(s,n,t)})})}function cd(r,e){if(!r||!r[e]){ye("no function to unwrap."),ye(new Error().stack);return}if(!r[e].__unwrap)ye("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function LS(r,e){if(r)Array.isArray(r)||(r=[r]);else{ye("must provide one or more modules to patch"),ye(new Error().stack);return}if(!(e&&Array.isArray(e))){ye("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(s){cd(t,s)})})}_s.wrap=ud;_s.massWrap=IS;_s.unwrap=cd;_s.massUnwrap=LS;ld.exports=_s});var gd=h((aL,md)=>{"use strict";var hd=dd(),Rr=hd.wrap,Rn=hd.unwrap,it="wrap@before";function xn(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function OS(r,e){for(var t=e.length,s=0;s<t;s++){var n=e[s],i=r[it];if(typeof i=="function")i(n);else if(Array.isArray(i))for(var a=i.length,o=0;o<a;o++)i[o](n)}}function pd(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function kS(r,e,t){var s=pd(r,e),n=s.filter(function(i){return t.indexOf(i)===-1});n.length>0&&OS(r,n)}function fd(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var s=0;s<r.length;s++)t[s]=e(r[s])}return t}}md.exports=function(e,t,s){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!s)throw new Error("must have function to wrap listeners when emitting");function n(a){return function(u,c){var l=pd(this,u).slice();try{var d=a.call(this,u,c);return kS(this,u,l),d}finally{this.on.__wrapped||Rr(this,"on",n),this.addListener.__wrapped||Rr(this,"addListener",n)}}}function i(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=fd(c,s)}}}Rr(this,"removeListener",l);try{return this._events[u]=fd(c,s),a.apply(this,arguments)}finally{Rn(this,"removeListener"),this._events[u]=c}}}e[it]?typeof e[it]=="function"?xn(e,it,[e[it],t]):Array.isArray(e[it])&&e[it].push(t):xn(e,it,t),e.__wrapped||(Rr(e,"addListener",n),Rr(e,"on",n),Rr(e,"emit",i),xn(e,"__unwrap",function(){Rn(e,"addListener"),Rn(e,"on"),Rn(e,"emit"),delete e[it],delete e.__wrapped}),xn(e,"__wrapped",!0))}});var bd=h((oL,vd)=>{"use strict";var M=require("util"),at=require("assert"),NS=gd(),U=require("async_hooks"),vs="cls@contexts",bs="error@context",Y=process.env.DEBUG_CLS_HOOKED,N=-1;vd.exports={getNamespace:yd,createNamespace:MS,destroyNamespace:_d,reset:PS,ERROR_SYMBOL:bs};function ke(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}ke.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,Y){let s=" ".repeat(this._indent<0?0:this._indent);G(s+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+N+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};ke.prototype.get=function(e){if(!this.active){if(Y){let t=U.currentId(),s=U.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);G(`${n}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length}`)}return}if(Y){let t=U.executionAsyncId(),s=U.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);G(n+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+N+" active:"+M.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),G(`${n}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} active:${M.inspect(this.active)}`)}return this.active[e]};ke.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=N,Y){let t=U.executionAsyncId(),s=U.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);G(`${n}CONTEXT-CREATED Context: (${this.name}) currentUid:${N} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} context:${M.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};ke.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(Y){let s=U.triggerAsyncId(),n=U.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);G(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} context:${M.inspect(t)}`)}return e(t),t}catch(s){throw s&&(s[bs]=t),s}finally{if(Y){let s=U.triggerAsyncId(),n=U.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);G(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${M.inspect(t)}`)}this.exit(t)}};ke.prototype.runAndReturn=function(e){let t;return this.run(function(s){t=e(s)}),t};ke.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let s=e(t);if(!s||!s.then||!s.catch)throw new Error("fn must return a promise.");return Y&&G("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),s.then(n=>(Y&&G("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),this.exit(t),n)).catch(n=>{throw n[bs]=t,Y&&G("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+M.inspect(t)),this.exit(t),n})};ke.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let s=this;return function(){s.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[bs]=t),i}finally{s.exit(t)}}};ke.prototype.enter=function(e){if(at.ok(e,"context must be provided for entering"),Y){let t=U.executionAsyncId(),s=U.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);G(`${n}CONTEXT-ENTER: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${t} len:${this._set.length} ${M.inspect(e)}`)}this._set.push(this.active),this.active=e};ke.prototype.exit=function(e){if(at.ok(e,"context must be provided for exiting"),Y){let s=U.executionAsyncId(),n=U.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);G(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${N} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${M.inspect(e)}`)}if(this.active===e){at.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(Y&&G("??ERROR?? context exiting but not entered - ignoring: "+M.inspect(e)),at.ok(t>=0,`context not currently entered; can't exit. 
`+M.inspect(this)+`
`+M.inspect(e))):(at.ok(t,"can't remove top context"),this._set.splice(t,1))};ke.prototype.bindEmitter=function(e){at.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,s="context@"+this.name;function n(a){a&&(a[vs]||(a[vs]=Object.create(null)),a[vs][s]={namespace:t,context:t.active})}function i(a){if(!(a&&a[vs]))return a;let o=a,u=a[vs];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}NS(e,n,i)};ke.prototype.fromException=function(e){return e[bs]};function yd(r){return process.namespaces[r]}function MS(r){at.ok(r,"namespace must be given a name."),Y&&G(`NS-CREATING NAMESPACE (${r})`);let e=new ke(r);return e.id=N,U.createHook({init(s,n,i,a){if(N=U.executionAsyncId(),e.active){if(e._contexts.set(s,e.active),Y){let o=" ".repeat(e._indent<0?0:e._indent);G(`${o}INIT [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(N===0){let o=U.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(s,u),Y){let c=" ".repeat(e._indent<0?0:e._indent);G(`${c}INIT USING CONTEXT FROM TRIGGERID [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(Y){let c=" ".repeat(e._indent<0?0:e._indent);G(`${c}INIT MISSING CONTEXT [${n}] (${r}) asyncId:${s} currentUid:${N} triggerId:${o} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(Y&&n==="PROMISE"){G(M.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);G(`${u}INIT RESOURCE-PROMISE [${n}] (${r}) parentId:${o} asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(s){N=U.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(N),n){if(Y){let i=U.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);G(`${a}BEFORE (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`),e._indent+=2}e.enter(n)}else if(Y){let i=U.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);G(`${a}BEFORE MISSING CONTEXT (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${M.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(s){N=U.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(N),n){if(Y){let i=U.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);G(`${a}AFTER (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`)}e.exit(n)}else if(Y){let i=U.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);G(`${a}AFTER MISSING CONTEXT (${r}) asyncId:${s} currentUid:${N} triggerId:${i} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(n)}`)}},destroy(s){if(N=U.executionAsyncId(),Y){let n=U.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);G(`${i}DESTROY (${r}) currentUid:${N} asyncId:${s} triggerId:${n} active:${M.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${M.inspect(e._contexts.get(N))}`)}e._contexts.delete(s)}}).enable(),process.namespaces[r]=e,e}function _d(r){let e=yd(r);at.ok(e,`can't delete nonexistent namespace! "`+r+'"'),at.ok(e.id,"don't assign to process.namespaces directly! "+M.inspect(e)),process.namespaces[r]=null}function PS(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){_d(r)}),process.namespaces=Object.create(null)}process.namespaces={};function G(...r){Y&&process._rawDebug(`${M.format(...r)}`)}});var H=h((uL,wd)=>{"use strict";var Za=["debug","info","warn","error","silent"],Sd=Za.indexOf("error"),qS=DS(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),Ed={error:In("error"),info:In("info"),warn:In("warn"),debug:In("debug")};function In(r){var e=Za.indexOf(r),t=console[r]||console.log||(()=>{});return e>=qS?(s,n)=>{(s||n)&&t(FS(r,s,n))}:()=>{}}function DS(r){if(r){var e=r.toLowerCase(),t=Za.indexOf(e);return t>=0?t:Sd}return Sd}function $S(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",s=function(n){var i=Math.floor(Math.abs(n));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+s(e/60)+":"+s(e%60)}function BS(){return process.env.LAMBDA_TASK_ROOT!==void 0}function FS(r,e,t){var s=[];BS()||(s.push($S(new Date)),s.push(`[${r.toUpperCase()}]`)),e&&s.push(e);var n=s.join(" "),i=US(t);return[n,i].filter(a=>a.length>0).join(`
  `)}function US(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var jS={setLogger:function(e){Ed=e},getLogger:function(){return Ed}};wd.exports=jS});var Ja=h((cL,Cd)=>{"use strict";var WS=require("crypto");function Td(r,e){this.init(r,e)}Td.prototype.init=function(e,t){var s=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=s.message,this.type=s.name,this.stack=[],this.remote=!!t,this.id=WS.randomBytes(8).toString("hex"),s.stack){var n=s.stack.split(`
`);n.shift(),n.forEach(i=>{var a=i.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};Cd.exports=Td});var Rd=h((lL,Ad)=>{Ad.exports=VS;function VS(r){var e=!1,t=null,s=null,n=null;return a;function i(o){n&&XS(n,o),e=!1,n=s;var u=t;if(t=null,s=null,!u||!u.length){if(!n||!n.length){n=null;return}u||(u=[])}e=!0,r(u,i)}function a(o,u){e?(t||(t=[],s=[]),GS(t,o),u&&s.push(u)):(u&&(n=[u]),e=!0,r(Array.isArray(o)?o:[o],i))}}function GS(r,e){Array.isArray(e)?HS(r,e):r.push(e)}function HS(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function XS(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Ln=h((dL,Ld)=>{"use strict";var xd=H(),Ge={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?xd.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(Id(e),xd.getLogger().info("Configured daemon address to "+e+"."))}},Id=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var s=e.split(":");if(!s[0])throw new Error("Invalid Daemon Address. You must specify an ip.");Ge.udp_ip=s[0],Ge.tcp_ip=s[0],Ge.udp_port=s[1],Ge.tcp_port=s[1]}else if(t.length===2){var n=t[0].split(":"),i=t[1].split(":"),a={};if(a[n[0]]=n,a[i[0]]=i,Ge.udp_ip=a.udp[1],Ge.udp_port=parseInt(a.udp[2]),Ge.tcp_ip=a.tcp[1],Ge.tcp_port=parseInt(a.tcp[2]),!Ge.udp_port||!Ge.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&Id(process.env.AWS_XRAY_DAEMON_ADDRESS);Ld.exports=Ge});var kn=h((fL,qd)=>{"use strict";var Nd=require("dgram"),QS=Rd(),On=H(),Od='{"format":"json","version":1}',kd=`
`;function zS(r,e){var t=Nd.createSocket("udp4");Md(t,r,0,function(){try{t.close()}finally{e()}})}function Md(r,e,t,s){if(t>=e.length){s();return}KS(r,e[t],function(){Md(r,e,t+1,s)})}function KS(r,e,t){var s=e.msg,n=e.offset,i=e.length,a=e.port,o=e.address,u=e.callback;r.send(s,n,i,a,o,function(c){try{u(c)}finally{t()}})}function Pd(){this.batchSend=QS(zS)}Pd.prototype.send=function(r,e,t,s,n,i){var a={msg:r,offset:e,length:t,port:s,address:n,callback:i};this.batchSend(a)};var YS={daemonConfig:Ln(),format:function(e){return Od+kd+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new Pd:this.socket=Nd.createSocket("udp4").unref());var t=this.socket,s=e.format(),n=Od+kd+s,i=Buffer.from(n),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?On.getLogger().error(o+" too large to send: "+a+" ("+i.length+" bytes)."):On.getLogger().error("Error occured sending segment: ",u):(On.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),On.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};qd.exports=YS});var Mn=h((hL,Dd)=>{"use strict";var ZS=require("crypto"),Nn=H(),eo=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||ZS.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var s=new r,n,i;if(!e||typeof e!="string")return Nn.getLogger().error("Empty or non-string trace ID provided"),s;let a=e.trim().split(t);return a.length!==3?(Nn.getLogger().error("Unrecognized trace ID format"),s):(n=parseInt(a[0]),isNaN(n)||n<1?(Nn.getLogger().error("Trace ID version must be positive integer"),s):(i=parseInt(a[1],16).toString(16),i==="NaN"?(Nn.getLogger().error("Trace ID timestamp must be a hex-encoded value"),s):(i=i.padStart(8,"0"),s.version=n,s.timestamp=i,s.id=a[2],s)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};Dd.exports=eo});var de=h((pL,$d)=>{"use strict";var JS=require("crypto"),Ss=H(),eE=Mn(),to={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var s=e.length,n=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===s-1){var a=function(){for(var m=0,f=0;f<s;f++){var I=e.charAt(f);if(I==="*")return!0;if(I==="?"){if(m===n)return!1;m++}else{if(m>=n||I!=t.charAt(m))return!1;m++}}return m===n};return a()}var o=[];o[0]=!0;for(var u=0;u<s;u++){var c,l=e.charAt(u);if(l!="*")for(c=n-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=n&&!o[c];)c++;for(c;c<=n;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[n]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=to.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){Ss.getLogger().debug("Lambda trace data found: "+e);let t=to.processTraceData(e);var s=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,s=!0):!t.root||!t.parent||!t.sampled?Ss.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):s=!0:(t={},Ss.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=eE.FromString(t.root).toString(),r.id=t.parent||JS.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(Ss.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),s=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),Ss.getLogger().debug("Segment started: "+JSON.stringify(t)),s}},processTraceData:function(e){var t={},s={},n=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),d=n.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(s[u]=c,i-=u.length+c.length)}}}),t.data=s),t},objectWithoutProperties:function(e,t,s){t=Array.isArray(t)?t:[],s=typeof s=="boolean"?s:!1;var n=s?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};$d.exports=to});var bt=h((mL,Ud)=>{"use strict";var{safeParseInt:Bd}=de(),Fd=H(),tE=100,ro={streamingThreshold:tE,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(ro.streamingThreshold=e,Fd.getLogger().debug("Subsegment streaming threshold set to: "+e)):Fd.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return ro.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=Bd(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=Bd(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};Ud.exports=ro});var Vd=h((gL,Wd)=>{"use strict";var{getHttpResponseData:rE}=bt(),{stripQueryStringFromPath:sE}=de();function jd(r,e,t){this.init(r,e,t)}jd.prototype.init=function(e,t,s){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+sE(e.path):"",method:e.method||""},s&&(this.request.traced=!0),t&&(this.response=rE(t))};Wd.exports=jd});var Es=h((yL,Gd)=>{"use strict";var nE=require("crypto"),iE=Ja(),aE=Vd(),oE=kn(),Pn=bt(),uE=de(),ot=H();function P(r){this.init(r)}P.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=nE.randomBytes(8).toString("hex"),this.name=e,this.start_time=Pn.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};P.prototype.addNewSubsegment=function(e){let t=new P(e);return this.addSubsegment(t),t};P.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};P.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new P(e);return this.addSubsegment(t),t.notTraced=!0,t};P.prototype.addSubsegment=function(r){if(!(r instanceof P))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};P.prototype.removeSubsegment=function(e){if(!(e instanceof P))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};P.prototype.addAttribute=function(e,t){this[e]=t};P.prototype.addPrecursorId=function(r){typeof r!="string"&&ot.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};P.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){ot.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){ot.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};P.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ot.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ot.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};P.prototype.addSqlData=function(e){this.sql=e};P.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ot.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new iE(e,t))};P.prototype.addRemoteRequestData=function(e,t,s){this.http=new aE(e,t,s),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};P.prototype.addFaultFlag=function(){this.fault=!0};P.prototype.addErrorFlag=function(){this.error=!0};P.prototype.addThrottleFlag=function(){this.throttle=!0};P.prototype.close=function(e,t){var s=this.segment;this.end_time=Pn.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),s&&s.counter>Pn.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};P.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};P.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};P.prototype.isClosed=function(){return!this.in_progress};P.prototype.flush=function(){if(!this.parent||!this.segment){ot.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?oE.send(this):ot.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):ot.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};P.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};P.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};P.prototype.toString=function(){return this.serialize()};P.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=uE.objectWithoutProperties(this,e,!1);return t};P.prototype.serialize=function(e){return JSON.stringify(e??this,Pn.getJsonStringifyReplacer())};Gd.exports=P});var ws=h((_L,Qd)=>{"use strict";var cE=require("crypto"),lE=Ja(),dE=kn(),Ne=bt(),qn=Es(),Hd=Mn(),Xd=de(),St=H();function B(r,e,t){this.init(r,e,t)}B.prototype.init=function(e,t,s){if(typeof e!="string")throw new Error("Segment name must be of type string.");var n;t&&typeof t=="string"?n=Hd.FromString(t):n=new Hd;var i=cE.randomBytes(8).toString("hex"),a=Ne.getCurrentTime();this.trace_id=n.toString(),this.id=i,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,s&&(this.parent_id=s),Ne.serviceData&&this.setServiceData(Ne.serviceData),Ne.pluginData&&this.addPluginData(Ne.pluginData),Ne.origin&&(this.origin=Ne.origin),Ne.sdkData&&this.setSDKData(Ne.sdkData)};B.prototype.addIncomingRequestData=function(e){this.http=e};B.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){St.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){St.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};B.prototype.setUser=function(r){typeof r!="string"&&St.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};B.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){St.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){St.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};B.prototype.setSDKData=function(e){if(!e){St.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};B.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};B.prototype.setServiceData=function(e){if(!e){St.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};B.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};B.prototype.addNewSubsegment=function(e){var t=new qn(e);return this.addSubsegment(t),t};B.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};B.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new qn(e);return this.addSubsegment(t),t.notTraced=!0,t};B.prototype.addSubsegment=function(e){if(!(e instanceof qn))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};B.prototype.removeSubsegment=function(e){if(!(e instanceof qn))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};B.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){St.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new lE(e,t))};B.prototype.addFaultFlag=function(){this.fault=!0};B.prototype.addErrorFlag=function(){this.error=!0};B.prototype.addThrottleFlag=function(){this.throttle=!0};B.prototype.isClosed=function(){return!this.in_progress};B.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>Ne.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(s){s.streamSubsegments()||t.push(s)}),this.subsegments=t}};B.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};B.prototype.close=function(r,e){this.end_time||(this.end_time=Ne.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};B.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Xd.objectWithoutProperties(this,["counter","notTraced"],!0);dE.send(e)}};B.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=Xd.objectWithoutProperties(this,e,!1);return this.serialize(t)};B.prototype.toString=function(){return this.serialize()};B.prototype.serialize=function(e){return JSON.stringify(e??this,Ne.getJsonStringifyReplacer())};Qd.exports=B});var wt=h((vL,Zd)=>{"use strict";var Ts=bd(),He=H(),so=ws(),zd=Es(),ut=!0,Et="AWSXRay",Kd="segment",Yd=!1,fe={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);He.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!fe.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,s=e.Segment,n=null;return t&&(t instanceof so||t instanceof zd)?(n=t,delete e.XRaySegment,delete e.XraySegment):s&&(s instanceof so||s instanceof zd)&&(n=s,delete e.Segment),n}},getNamespace:function(){return Ts.getNamespace(Et)||Ts.createNamespace(Et)},resolveSegment:function(e){if(ut)return this.getSegment();if(e&&!ut)return e;!e&&!ut&&fe.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(ut){var e=fe.getNamespace(Et).get(Kd);return e?e instanceof so&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():fe.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else fe.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){ut?fe.getNamespace(Et).set(Kd,e)||He.getLogger().warn("Failed to set the current sub/segment on the context."):fe.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return ut},enableAutomaticMode:function(){ut=!0,fe.getNamespace(Et),He.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){ut=!1,Ts.getNamespace(Et)&&Ts.destroyNamespace(Et),He.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Yd)He.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=fe.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)fe.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?He.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):He.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(fe.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")fe.contextMissingStrategy.contextMissing=e,He.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(ut=!1,He.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(Ts.createNamespace(Et),He.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(fe.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Yd=!0):(fe.contextMissingStrategy.contextMissing=fe.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,He.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Zd.exports=fe});var io=h((bL,Jd)=>{"use strict";var{getHttpResponseData:fE}=bt();function no(r){this.init(r)}no.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],s;e.connection&&(s=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:hE(e)||"",url:s||""},t&&(this.request.x_forwarded_for=t)};var hE=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};no.prototype.close=function(e){this.response=fE(e)};Jd.exports=no});var tf=h((SL,ef)=>{"use strict";function ao(r,e){this.init(r,e)}ao.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};ao.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};ef.exports=ao});var rf=h((EL,pE)=>{pE.exports={default:{fixed_target:1,rate:.05},version:2}});var uo=h((wL,uf)=>{"use strict";var mE=require("fs"),sf=tf(),oo=de(),gE=rf(),Dn=H(),af={shouldSample:function(e){var t=e.host,s=e.httpMethod,n=e.urlPath,i="{ http_method: "+s+", host: "+t+", url_path: "+n+" }",a;return this.rules.some(function(o){if(o.default||t==null||oo.wildcardMatch(o.host,t)&&(s==null||oo.wildcardMatch(o.http_method,s))&&(n==null||oo.wildcardMatch(o.url_path,n)))return a=o.reservoir,Dn.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(Dn.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Dn.getLogger().info("Using custom sampling rules file: "+e),this.rules=nf(JSON.parse(mE.readFileSync(e,"utf8")))):(Dn.getLogger().info("Using custom sampling rules source."),this.rules=nf(e)):this.rules=of(gE)}},nf=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return of(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},of=function(e){var t,s=[];if(e.default){var n=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&n.push("fixed_target"),typeof e.default.rate>"u"&&n.push("rate"),n.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+n+".");t={default:!0,reservoir:new sf(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var d=o;d.reservoir=new sf(a.fixed_target,a.rate),s.push(d)}),s.push(t),s};af.setLocalRules();uf.exports=af});var lf=h((TL,cf)=>{"use strict";function xr(){this.init()}xr.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};xr.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};xr.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};xr.prototype.loadNewQuota=function(e,t,s){e&&(this.quota=e),t&&(this.TTL=t),s&&(this.reportInterval=s/10)};xr.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};cf.exports=xr});var ff=h((CL,df)=>{"use strict";var Cs=de(),yE=lf();function oe(r,e,t,s,n,i,a,o,u){this.init(r,e,t,s,n,i,a,o,u)}oe.prototype.init=function(e,t,s,n,i,a,o,u,c){this.name=e,this.priority=t,this.rate=s,this.host=i,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new yE,this.borrow=!!n,this.resetStatistics()};oe.prototype.match=function(e){var t=e.host,s=e.httpMethod,n=e.serviceName,i=e.urlPath,a=e.serviceType;return this.isDefault()||(!t||Cs.wildcardMatch(this.host,t))&&(!s||Cs.wildcardMatch(this.httpMethod,s))&&(!n||Cs.wildcardMatch(this.serviceName,n))&&(!i||Cs.wildcardMatch(this.urlPath,i))&&(!a||Cs.wildcardMatch(this.serviceType,a))};oe.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};oe.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};oe.prototype.isDefault=function(){return this.name==="Default"};oe.prototype.incrementRequestCount=function(){this.requestCount++};oe.prototype.incrementBorrowCount=function(){this.borrowCount++};oe.prototype.incrementSampledCount=function(){this.sampledCount++};oe.prototype.setRate=function(e){this.rate=e};oe.prototype.getRate=function(){return this.rate};oe.prototype.getName=function(){return this.name};oe.prototype.getPriority=function(){return this.priority};oe.prototype.getReservoir=function(){return this.reservoir};oe.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};oe.prototype.canBorrow=function(){return this.borrow};oe.prototype.everMatched=function(){return this.requestCount>0};oe.prototype.timeToReport=function(){return this.reservoir.timeToReport()};df.exports=oe});var co=h((AL,gf)=>{"use strict";var _E=require("crypto"),vE=H(),bE=ff(),$n=Ln(),SE=require("util"),EE=require("http"),pf={clientId:_E.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:vE,httpClient:EE,fetchSamplingRules:function(e){let t="{}",s=hf(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=TE(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let s=JSON.stringify(wE(e)),n=hf(this.samplingTargetsPath,s.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{t(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){t(m);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=CE(c),d=mf(c.LastRuleModification);t(null,l,d)})});a.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling targets.`))}),a.write(s),a.end()}},wE=function(e){var t=[],s=Math.floor(new Date().getTime()/1e3);return e.forEach(function(n){var i=n.snapshotStatistics(),a={RuleName:n.getName(),ClientID:pf.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:s};t.push(a)}),{SamplingStatisticsDocuments:t}},TE=function(e){var t=[],s=e.SamplingRuleRecords||[];return s.forEach(function(n){if(n=n.SamplingRule,AE(n)){var i=new bE(n.RuleName,n.Priority,n.FixedRate,n.ReservoirSize,n.Host,n.HTTPMethod,n.URLPath,n.ServiceName,n.ServiceType);t.push(i)}}),t},CE=function(e){var t=e.SamplingTargetDocuments||[],s={};return t.forEach(function(n){var i={rate:n.FixedRate,quota:n.ReservoirQuota,TTL:mf(n.ReservoirQuotaTTL),interval:n.Interval};s[n.RuleName]=i}),s},AE=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},mf=function(e){return new Date(e).getTime()/1e3},hf=function(e,t){return{hostname:$n.tcp_ip,port:$n.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:SE.format("%s:%d",$n.tcp_ip,$n.tcp_port)}}};gf.exports=pf});var Bn=h((RL,yf)=>{"use strict";var RE=3600,lo={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(xE(t))return null;var s;return this.rules.forEach(function(n){!s&&n.match(e)&&(s=n),n.isDefault()&&!s&&(s=n)}),s},loadRules:function(e){var t={};this.rules.forEach(function(s){t[s.getName()]=s}),this.rules=e,this.rules.forEach(function(s){var n=t[s.getName()];n&&s.merge(n)}),this.rules.sort(function(s,n){var i=s.getPriority()-n.getPriority();return i!==0?i:s.getName()>n.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var s=e[t.getName()];s&&(t.getReservoir().loadNewQuota(s.quota,s.TTL,s.interval),t.setRate(s.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},xE=function(e){return lo.getLastUpdated()?e>lo.getLastUpdated()+RE:!0};yf.exports=lo});var ho=h((xL,Sf)=>{"use strict";var fo=H(),IE=co(),_f=Bn(),LE=5*60*1e3,OE={start:function(){this.poller&&clearInterval(this.poller),vf(!1),this.poller=setInterval(vf,LE),this.poller.unref()}},vf=function(e){if(e=typeof e>"u"?!0:e,e){var t=NE();setTimeout(bf,t)}else bf()},bf=function(){try{kE()}catch(e){fo.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},kE=function(){var e=Math.floor(new Date().getTime()/1e3);IE.fetchSamplingRules(function(t,s){t?fo.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):s.length!==0&&(_f.loadRules(s),_f.timestamp(e),fo.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},NE=function(){return Math.random()*5};Sf.exports=OE});var Cf=h((IL,Tf)=>{"use strict";var ME=ho(),PE=co(),po=Bn(),Fn=H(),Ef=10*1e3,wf={interval:Ef,start:function(){this.poller=setInterval(qE,Ef+BE()),this.poller.unref()}},qE=function(){try{DE()}catch(e){Fn.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},DE=function(){var e=$E();e&&e.length>0&&PE.fetchTargets(e,function(t,s,n){if(t){Fn.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}po.loadTargets(s),n>po.getLastUpdated()&&(Fn.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),ME.start()),Fn.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},$E=function(){var e=po.getRules(),t=[];return e.forEach(function(s){s.everMatched()&&s.timeToReport()&&t.push(s)}),t},BE=function(){return Math.random()/wf.interval};Tf.exports=wf});var Rf=h((LL,Af)=>{"use strict";var mo=H(),FE=require("util"),UE=bt(),jE={localSampler:uo(),rulePoller:ho(),targetPoller:Cf(),ruleCache:Bn(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=UE.origin);var t=Math.floor(new Date().getTime()/1e3),s=this.ruleCache.getMatchedRule(e,t);return s?(mo.getLogger().debug(FE.format("Rule %s is matched.",s.getName())),WE(s,t)):(mo.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(n){mo.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+n)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},WE=function(e,t){e.incrementRequestCount();var s=e.getReservoir(),n=!0,i=s.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():n=!1,n?e.getName():!1};Af.exports=jE});var yo=h((OL,xf)=>{"use strict";var VE=ws(),GE=io(),HE=H(),XE=de(),QE=de().wildcardMatch,zE=de().processTraceData,go="x-amzn-trace-id",KE=!!process.env.AWS_XRAY_TRACING_NAME,YE={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:Rf(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[go]&&(t=zE(e.headers[go])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?QE(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,s){var n;if(e.sampled==="1")n=!0;else if(e.sampled==="0")n=!1;else{var i={host:s.req.headers.host,httpMethod:s.req.method,urlPath:s.req.url,serviceName:t.name};n=this.sampler.shouldSample(i),(n instanceof String||typeof n=="string")&&(t.setMatchedSamplingRule(n),n=!0)}e.sampled==="?"&&s.header&&s.header(go,"Root="+e.root+";Sampled="+(n?"1":"0")),n||(t.notTraced=!0)},setDefaultName:function(e){KE||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=uo()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,s){HE.getLogger().debug(e+": { url: "+t+", name: "+s.name+", trace_id: "+s.trace_id+", id: "+s.id+", sampled: "+!s.notTraced+" }")},traceRequestResponseCycle:function(e,t){var s=this.processHeaders(e),n=this.resolveName(e.headers.host),i=new VE(n,s.root,s.parent);t.req||(t.req=e),this.resolveSampling(s,i,t),i.addIncomingRequestData(new GE(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,o=!1,u=function(){if(o)return;o=!0,t.statusCode===429&&i.addThrottleFlag();let c=XE.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),a("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};xf.exports=YE});var If=h(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.InvokeStore=void 0;var ZE=require("async_hooks"),_o=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";_o||(globalThis.awslambda=globalThis.awslambda||{});var JE={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},As=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let s=this.storage.getStore();s&&(s[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};A(As,"storage",new ZE.AsyncLocalStorage),A(As,"PROTECTED_KEYS",JE);var Un;!_o&&globalThis.awslambda?.InvokeStore?Un=globalThis.awslambda.InvokeStore:(Un=As,!_o&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=Un));jn.InvokeStore=Un});var kf=h((ML,Of)=>{"use strict";var Wn=wt(),ew=yo(),vo=de().LambdaUtils,tw=ws(),rw=kn(),sw=bt(),So=H(),Lf=Mn(),{InvokeStore:nw}=If(),bo=null;Of.exports.init=function(){Wn.enableManualMode=function(){So.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},rw.disableReusableSocket(),sw.setStreamingThreshold(0),So.getLogger().info("Disabling centralized sampling in Lambda environment."),ew.disableCentralizedSampling();var e=Wn.getNamespace();e.enter(e.createContext()),Wn.setSegment(iw())};var iw=function(){var e=new tw("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],s=["incrementCounter","decrementCounter","isClosed","close","format","flush"],n=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(s.indexOf(i)===-1?e[i]=function(){var a=i;return function(){So.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=Lf.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=Lf.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let o=nw.getXRayTraceId(),u=process.env._X_AMZN_TRACE_ID;var c=o??u;c?c!=bo&&(this.reset(),vo.populateTraceData(e,c)&&(bo=c)):(this.reset(),Wn.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},vo.validTraceData(n)&&vo.populateTraceData(e,n)&&(bo=n),e}});var Nf=h((PL,aw)=>{aw.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var qf=h((qL,Pf)=>{"use strict";var Eo=require("http"),Mf={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var n=5,i=function(){var a=Eo.__request?Eo.__request:Eo.request,o=a(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else n>0&&Math.floor(this.statusCode/100)===5?(n--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(Mf.METADATA_TIMEOUT),o.end()};i()}};Pf.exports=Mf});var Uf=h((DL,Ff)=>{"use strict";var $f=qf(),Df=H(),wo=require("http"),ow={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(s){let n=Bf(e,"GET",s?{"X-aws-ec2-metadata-token":s}:{});$f.getPluginMetadata(n,function(i,a){if(i||!a){Df.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};r(o)})}uw(function(s){s===null&&Df.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(s)})},originName:"AWS::EC2::Instance"};function uw(r){let e=wo.__request?wo.__request:wo.request,n=Bf("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(n,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?r(o):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout($f.METADATA_TIMEOUT),i.end()}function Bf(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}Ff.exports=ow});var Wf=h(($L,jf)=>{"use strict";var cw=require("os"),lw={getData:function(r){r({ecs:{container:cw.hostname()}})},originName:"AWS::ECS::Container"};jf.exports=lw});var Gf=h((BL,Vf)=>{"use strict";var dw=require("fs"),fw=H(),hw="/var/elasticbeanstalk/xray/environment.conf",pw={getData:function(r){dw.readFile(hw,"utf8",function(e,t){if(e)fw.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var s=JSON.parse(t),n={elastic_beanstalk:{environment:s.environment_name,version_label:s.version_label,deployment_id:s.deployment_id}};r(n)}})},originName:"AWS::ElasticBeanstalk::Environment"};Vf.exports=pw});var Hf=h((FL,mw)=>{mw.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Zf=h((UL,Yf)=>{"use strict";var zf=require("fs"),Ir=H(),gw=Hf(),Vn={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Hn(r){this.init(r)}Hn.prototype.init=function(e){e?typeof e=="string"?(Ir.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Gn(JSON.parse(zf.readFileSync(e,"utf8")))):(Ir.getLogger().info("Using custom AWS whitelist source."),this.services=Gn(e)):this.services=gw.services};Hn.prototype.append=function(e){var t={};typeof e=="string"?(Ir.getLogger().info("Appending AWS whitelist with custom file: "+e),t=Gn(JSON.parse(zf.readFileSync(e,"utf8")))):(Ir.getLogger().info("Appending AWS whitelist with a custom source."),t=Gn(e));for(var s in t)this.services[s]=t[s]};Hn.prototype.capture=function(e,t){var s=t.request.operation,n=this.services[e]!==void 0?this.services[e].operations[s]:null;if(n===null){Ir.getLogger().debug('Call "'+e+"."+s+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var a in n){var o=n[a];a===Vn.REQ_PARAMS?Xf(o,t.request.params,i):a===Vn.REQ_DESC?Qf(o,t.request.params,i):a===Vn.RES_PARAMS?t.data&&Xf(o,t.data,i):a===Vn.RES_DESC?t.data&&Qf(o,t.data,i):Ir.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function Xf(r,e,t){r.forEach(function(s){if(typeof e[s]<"u"){var n=Kf(s);this[n]=e[s]}},t)}function Qf(r,e,t){for(var s in r){var n=r[s];if(typeof e[s]<"u"){var i;if(n.list&&n.get_count?i=e[s]?e[s].length:0:i=n.get_keys===!0?Object.keys(e[s]):e[s],typeof n.rename_to=="string")t[n.rename_to]=i;else{var a=Kf(s);t[a]=i}}}}function Kf(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function Gn(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Yf.exports=Hn});var Rs=h((jL,Xn)=>{"use strict";var Jf=Zf(),To=new Jf;function Co(r,e){this.init(r,e)}Co.prototype.init=function(e,t){this.operation=vw(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(To.capture(t.toLowerCase(),e))};Co.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var yw=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");To=new Jf(e)},_w=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");To.append(e)};function vw(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}Xn.exports=Co;Xn.exports.appendAWSWhitelist=_w;Xn.exports.setAWSWhitelist=yw});var zn=h((WL,Qn)=>{"use strict";var Bt=wt(),xs=H(),eh=function(e,t,s){Ao(e,t);var n,i,a=Bt.resolveSegment(s);if(!a)return xs.getLogger().warn("Failed to capture function."),t();n=a.addNewSubsegment(e),i=th(t,n);try{let o=i(n);return n.close(),o}catch(o){throw n.close(o),o}},bw=function(e,t,s){Ao(e,t);var n,i,a=Bt.resolveSegment(s);if(!a)return xs.getLogger().warn("Failed to capture async function."),t();n=a.addNewSubsegment(e),i=th(t,n);try{return i(n)}catch(o){throw n.close(o),o}},Sw=function(e,t,s){Ao(e,t);var n=Bt.resolveSegment(s);return n?(n.incrementCounter(),function(){var i=Bt.resolveSegment(s),a=Array.prototype.slice.call(arguments);eh(e,t.bind.apply(t,[null].concat(a)),i),n.decrementCounter()}.bind(this)):(xs.getLogger().warn("Failed to capture callback function."),t)};function th(r,e){var t;if(Bt.isAutomaticMode()){var s=Bt.getNamespace(),n=function(){var i;return s.run(function(){Bt.setSegment(e),i=r(e)}),i};t=n}else t=r;return t}function Ao(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',xs.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',xs.getLogger().error(t),new Error(t)}Qn.exports.captureFunc=eh;Qn.exports.captureAsyncFunc=bw;Qn.exports.captureCallbackFunc=Sw});var Is=h((VL,rh)=>{"use strict";var Ew="2.0.0",ww=Number.MAX_SAFE_INTEGER||9007199254740991,Tw=16,Cw=250,Aw=["major","premajor","minor","preminor","patch","prepatch","prerelease"];rh.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Tw,MAX_SAFE_BUILD_LENGTH:Cw,MAX_SAFE_INTEGER:ww,RELEASE_TYPES:Aw,SEMVER_SPEC_VERSION:Ew,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Ls=h((GL,sh)=>{"use strict";var Rw=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};sh.exports=Rw});var Lr=h((ze,nh)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Ro,MAX_SAFE_BUILD_LENGTH:xw,MAX_LENGTH:Iw}=Is(),Lw=Ls();ze=nh.exports={};var Ow=ze.re=[],kw=ze.safeRe=[],v=ze.src=[],Nw=ze.safeSrc=[],b=ze.t={},Mw=0,xo="[a-zA-Z0-9-]",Pw=[["\\s",1],["\\d",Iw],[xo,xw]],qw=r=>{for(let[e,t]of Pw)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},R=(r,e,t)=>{let s=qw(e),n=Mw++;Lw(r,n,e),b[r]=n,v[n]=e,Nw[n]=s,Ow[n]=new RegExp(e,t?"g":void 0),kw[n]=new RegExp(s,t?"g":void 0)};R("NUMERICIDENTIFIER","0|[1-9]\\d*");R("NUMERICIDENTIFIERLOOSE","\\d+");R("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${xo}*`);R("MAINVERSION",`(${v[b.NUMERICIDENTIFIER]})\\.(${v[b.NUMERICIDENTIFIER]})\\.(${v[b.NUMERICIDENTIFIER]})`);R("MAINVERSIONLOOSE",`(${v[b.NUMERICIDENTIFIERLOOSE]})\\.(${v[b.NUMERICIDENTIFIERLOOSE]})\\.(${v[b.NUMERICIDENTIFIERLOOSE]})`);R("PRERELEASEIDENTIFIER",`(?:${v[b.NONNUMERICIDENTIFIER]}|${v[b.NUMERICIDENTIFIER]})`);R("PRERELEASEIDENTIFIERLOOSE",`(?:${v[b.NONNUMERICIDENTIFIER]}|${v[b.NUMERICIDENTIFIERLOOSE]})`);R("PRERELEASE",`(?:-(${v[b.PRERELEASEIDENTIFIER]}(?:\\.${v[b.PRERELEASEIDENTIFIER]})*))`);R("PRERELEASELOOSE",`(?:-?(${v[b.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${v[b.PRERELEASEIDENTIFIERLOOSE]})*))`);R("BUILDIDENTIFIER",`${xo}+`);R("BUILD",`(?:\\+(${v[b.BUILDIDENTIFIER]}(?:\\.${v[b.BUILDIDENTIFIER]})*))`);R("FULLPLAIN",`v?${v[b.MAINVERSION]}${v[b.PRERELEASE]}?${v[b.BUILD]}?`);R("FULL",`^${v[b.FULLPLAIN]}$`);R("LOOSEPLAIN",`[v=\\s]*${v[b.MAINVERSIONLOOSE]}${v[b.PRERELEASELOOSE]}?${v[b.BUILD]}?`);R("LOOSE",`^${v[b.LOOSEPLAIN]}$`);R("GTLT","((?:<|>)?=?)");R("XRANGEIDENTIFIERLOOSE",`${v[b.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);R("XRANGEIDENTIFIER",`${v[b.NUMERICIDENTIFIER]}|x|X|\\*`);R("XRANGEPLAIN",`[v=\\s]*(${v[b.XRANGEIDENTIFIER]})(?:\\.(${v[b.XRANGEIDENTIFIER]})(?:\\.(${v[b.XRANGEIDENTIFIER]})(?:${v[b.PRERELEASE]})?${v[b.BUILD]}?)?)?`);R("XRANGEPLAINLOOSE",`[v=\\s]*(${v[b.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[b.XRANGEIDENTIFIERLOOSE]})(?:\\.(${v[b.XRANGEIDENTIFIERLOOSE]})(?:${v[b.PRERELEASELOOSE]})?${v[b.BUILD]}?)?)?`);R("XRANGE",`^${v[b.GTLT]}\\s*${v[b.XRANGEPLAIN]}$`);R("XRANGELOOSE",`^${v[b.GTLT]}\\s*${v[b.XRANGEPLAINLOOSE]}$`);R("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Ro}})(?:\\.(\\d{1,${Ro}}))?(?:\\.(\\d{1,${Ro}}))?`);R("COERCE",`${v[b.COERCEPLAIN]}(?:$|[^\\d])`);R("COERCEFULL",v[b.COERCEPLAIN]+`(?:${v[b.PRERELEASE]})?(?:${v[b.BUILD]})?(?:$|[^\\d])`);R("COERCERTL",v[b.COERCE],!0);R("COERCERTLFULL",v[b.COERCEFULL],!0);R("LONETILDE","(?:~>?)");R("TILDETRIM",`(\\s*)${v[b.LONETILDE]}\\s+`,!0);ze.tildeTrimReplace="$1~";R("TILDE",`^${v[b.LONETILDE]}${v[b.XRANGEPLAIN]}$`);R("TILDELOOSE",`^${v[b.LONETILDE]}${v[b.XRANGEPLAINLOOSE]}$`);R("LONECARET","(?:\\^)");R("CARETTRIM",`(\\s*)${v[b.LONECARET]}\\s+`,!0);ze.caretTrimReplace="$1^";R("CARET",`^${v[b.LONECARET]}${v[b.XRANGEPLAIN]}$`);R("CARETLOOSE",`^${v[b.LONECARET]}${v[b.XRANGEPLAINLOOSE]}$`);R("COMPARATORLOOSE",`^${v[b.GTLT]}\\s*(${v[b.LOOSEPLAIN]})$|^$`);R("COMPARATOR",`^${v[b.GTLT]}\\s*(${v[b.FULLPLAIN]})$|^$`);R("COMPARATORTRIM",`(\\s*)${v[b.GTLT]}\\s*(${v[b.LOOSEPLAIN]}|${v[b.XRANGEPLAIN]})`,!0);ze.comparatorTrimReplace="$1$2$3";R("HYPHENRANGE",`^\\s*(${v[b.XRANGEPLAIN]})\\s+-\\s+(${v[b.XRANGEPLAIN]})\\s*$`);R("HYPHENRANGELOOSE",`^\\s*(${v[b.XRANGEPLAINLOOSE]})\\s+-\\s+(${v[b.XRANGEPLAINLOOSE]})\\s*$`);R("STAR","(<|>)?=?\\s*\\*");R("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");R("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Kn=h((HL,ih)=>{"use strict";var Dw=Object.freeze({loose:!0}),$w=Object.freeze({}),Bw=r=>r?typeof r!="object"?Dw:r:$w;ih.exports=Bw});var Io=h((XL,uh)=>{"use strict";var ah=/^[0-9]+$/,oh=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=ah.test(r),s=ah.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},Fw=(r,e)=>oh(e,r);uh.exports={compareIdentifiers:oh,rcompareIdentifiers:Fw}});var he=h((QL,lh)=>{"use strict";var Yn=Ls(),{MAX_LENGTH:ch,MAX_SAFE_INTEGER:Zn}=Is(),{safeRe:Jn,t:ei}=Lr(),Uw=Kn(),{compareIdentifiers:Lo}=Io(),Oo=class r{constructor(e,t){if(t=Uw(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>ch)throw new TypeError(`version is longer than ${ch} characters`);Yn("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?Jn[ei.LOOSE]:Jn[ei.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Zn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Zn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Zn||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<Zn)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Yn("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(Yn("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Lo(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(Yn("build compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Lo(s,n)}while(++t)}inc(e,t,s){if(e.startsWith("pre")){if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?Jn[ei.PRERELEASELOOSE]:Jn[ei.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),Lo(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};lh.exports=Oo});var Ft=h((zL,fh)=>{"use strict";var dh=he(),jw=(r,e,t=!1)=>{if(r instanceof dh)return r;try{return new dh(r,e)}catch(s){if(!t)return null;throw s}};fh.exports=jw});var ph=h((KL,hh)=>{"use strict";var Ww=Ft(),Vw=(r,e)=>{let t=Ww(r,e);return t?t.version:null};hh.exports=Vw});var gh=h((YL,mh)=>{"use strict";var Gw=Ft(),Hw=(r,e)=>{let t=Gw(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};mh.exports=Hw});var vh=h((ZL,_h)=>{"use strict";var yh=he(),Xw=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new yh(r instanceof yh?r.version:r,t).inc(e,s,n).version}catch{return null}};_h.exports=Xw});var Eh=h((JL,Sh)=>{"use strict";var bh=Ft(),Qw=(r,e)=>{let t=bh(r,null,!0),s=bh(e,null,!0),n=t.compare(s);if(n===0)return null;let i=n>0,a=i?t:s,o=i?s:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};Sh.exports=Qw});var Th=h((eO,wh)=>{"use strict";var zw=he(),Kw=(r,e)=>new zw(r,e).major;wh.exports=Kw});var Ah=h((tO,Ch)=>{"use strict";var Yw=he(),Zw=(r,e)=>new Yw(r,e).minor;Ch.exports=Zw});var xh=h((rO,Rh)=>{"use strict";var Jw=he(),e0=(r,e)=>new Jw(r,e).patch;Rh.exports=e0});var Lh=h((sO,Ih)=>{"use strict";var t0=Ft(),r0=(r,e)=>{let t=t0(r,e);return t&&t.prerelease.length?t.prerelease:null};Ih.exports=r0});var Me=h((nO,kh)=>{"use strict";var Oh=he(),s0=(r,e,t)=>new Oh(r,t).compare(new Oh(e,t));kh.exports=s0});var Mh=h((iO,Nh)=>{"use strict";var n0=Me(),i0=(r,e,t)=>n0(e,r,t);Nh.exports=i0});var qh=h((aO,Ph)=>{"use strict";var a0=Me(),o0=(r,e)=>a0(r,e,!0);Ph.exports=o0});var ti=h((oO,$h)=>{"use strict";var Dh=he(),u0=(r,e,t)=>{let s=new Dh(r,t),n=new Dh(e,t);return s.compare(n)||s.compareBuild(n)};$h.exports=u0});var Fh=h((uO,Bh)=>{"use strict";var c0=ti(),l0=(r,e)=>r.sort((t,s)=>c0(t,s,e));Bh.exports=l0});var jh=h((cO,Uh)=>{"use strict";var d0=ti(),f0=(r,e)=>r.sort((t,s)=>d0(s,t,e));Uh.exports=f0});var Os=h((lO,Wh)=>{"use strict";var h0=Me(),p0=(r,e,t)=>h0(r,e,t)>0;Wh.exports=p0});var ri=h((dO,Vh)=>{"use strict";var m0=Me(),g0=(r,e,t)=>m0(r,e,t)<0;Vh.exports=g0});var ko=h((fO,Gh)=>{"use strict";var y0=Me(),_0=(r,e,t)=>y0(r,e,t)===0;Gh.exports=_0});var No=h((hO,Hh)=>{"use strict";var v0=Me(),b0=(r,e,t)=>v0(r,e,t)!==0;Hh.exports=b0});var si=h((pO,Xh)=>{"use strict";var S0=Me(),E0=(r,e,t)=>S0(r,e,t)>=0;Xh.exports=E0});var ni=h((mO,Qh)=>{"use strict";var w0=Me(),T0=(r,e,t)=>w0(r,e,t)<=0;Qh.exports=T0});var Mo=h((gO,zh)=>{"use strict";var C0=ko(),A0=No(),R0=Os(),x0=si(),I0=ri(),L0=ni(),O0=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return C0(r,t,s);case"!=":return A0(r,t,s);case">":return R0(r,t,s);case">=":return x0(r,t,s);case"<":return I0(r,t,s);case"<=":return L0(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};zh.exports=O0});var Yh=h((yO,Kh)=>{"use strict";var k0=he(),N0=Ft(),{safeRe:ii,t:ai}=Lr(),M0=(r,e)=>{if(r instanceof k0)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?ii[ai.COERCEFULL]:ii[ai.COERCE]);else{let u=e.includePrerelease?ii[ai.COERCERTLFULL]:ii[ai.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let s=t[2],n=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return N0(`${s}.${n}.${i}${a}${o}`,e)};Kh.exports=M0});var Jh=h((_O,Zh)=>{"use strict";var Po=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(e,t)}return this}};Zh.exports=Po});var Pe=h((vO,sp)=>{"use strict";var P0=/\s+/g,qo=class r{constructor(e,t){if(t=D0(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Do)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(P0," "),this.set=this.raw.split("||").map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let s=this.set[0];if(this.set=this.set.filter(n=>!tp(n[0])),this.set.length===0)this.set=[s];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&V0(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let s=0;s<t.length;s++)s>0&&(this.formatted+=" "),this.formatted+=t[s].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let s=((this.options.includePrerelease&&j0)|(this.options.loose&&W0))+":"+e,n=ep.get(s);if(n)return n;let i=this.options.loose,a=i?_e[pe.HYPHENRANGELOOSE]:_e[pe.HYPHENRANGE];e=e.replace(a,eT(this.options.includePrerelease)),j("hyphen replace",e),e=e.replace(_e[pe.COMPARATORTRIM],B0),j("comparator trim",e),e=e.replace(_e[pe.TILDETRIM],F0),j("tilde trim",e),e=e.replace(_e[pe.CARETTRIM],U0),j("caret trim",e);let o=e.split(" ").map(d=>G0(d,this.options)).join(" ").split(/\s+/).map(d=>J0(d,this.options));i&&(o=o.filter(d=>(j("loose invalid filter",d,this.options),!!d.match(_e[pe.COMPARATORLOOSE])))),j("range list",o);let u=new Map,c=o.map(d=>new Do(d,this.options));for(let d of c){if(tp(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return ep.set(s,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>rp(s,t)&&e.set.some(n=>rp(n,t)&&s.every(i=>n.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new $0(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(tT(this.set[t],e,this.options))return!0;return!1}};sp.exports=qo;var q0=Jh(),ep=new q0,D0=Kn(),Do=ks(),j=Ls(),$0=he(),{safeRe:_e,t:pe,comparatorTrimReplace:B0,tildeTrimReplace:F0,caretTrimReplace:U0}=Lr(),{FLAG_INCLUDE_PRERELEASE:j0,FLAG_LOOSE:W0}=Is(),tp=r=>r.value==="<0.0.0-0",V0=r=>r.value==="",rp=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(i=>n.intersects(i,e)),n=s.pop();return t},G0=(r,e)=>(r=r.replace(_e[pe.BUILD],""),j("comp",r,e),r=Q0(r,e),j("caret",r),r=H0(r,e),j("tildes",r),r=K0(r,e),j("xrange",r),r=Z0(r,e),j("stars",r),r),ve=r=>!r||r.toLowerCase()==="x"||r==="*",H0=(r,e)=>r.trim().split(/\s+/).map(t=>X0(t,e)).join(" "),X0=(r,e)=>{let t=e.loose?_e[pe.TILDELOOSE]:_e[pe.TILDE];return r.replace(t,(s,n,i,a,o)=>{j("tilde",r,s,n,i,a,o);let u;return ve(n)?u="":ve(i)?u=`>=${n}.0.0 <${+n+1}.0.0-0`:ve(a)?u=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:o?(j("replaceTilde pr",o),u=`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`):u=`>=${n}.${i}.${a} <${n}.${+i+1}.0-0`,j("tilde return",u),u})},Q0=(r,e)=>r.trim().split(/\s+/).map(t=>z0(t,e)).join(" "),z0=(r,e)=>{j("caret",r,e);let t=e.loose?_e[pe.CARETLOOSE]:_e[pe.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,i,a,o,u)=>{j("caret",r,n,i,a,o,u);let c;return ve(i)?c="":ve(a)?c=`>=${i}.0.0${s} <${+i+1}.0.0-0`:ve(o)?i==="0"?c=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.0${s} <${+i+1}.0.0-0`:u?(j("replaceCaret pr",u),i==="0"?a==="0"?c=`>=${i}.${a}.${o}-${u} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}-${u} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o}-${u} <${+i+1}.0.0-0`):(j("no pr"),i==="0"?a==="0"?c=`>=${i}.${a}.${o}${s} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),j("caret return",c),c})},K0=(r,e)=>(j("replaceXRanges",r,e),r.split(/\s+/).map(t=>Y0(t,e)).join(" ")),Y0=(r,e)=>{r=r.trim();let t=e.loose?_e[pe.XRANGELOOSE]:_e[pe.XRANGE];return r.replace(t,(s,n,i,a,o,u)=>{j("xRange",r,s,n,i,a,o,u);let c=ve(i),l=c||ve(a),d=l||ve(o),m=d;return n==="="&&m&&(n=""),u=e.includePrerelease?"-0":"",c?n===">"||n==="<"?s="<0.0.0-0":s="*":n&&m?(l&&(a=0),o=0,n===">"?(n=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):n==="<="&&(n="<",l?i=+i+1:a=+a+1),n==="<"&&(u="-0"),s=`${n+i}.${a}.${o}${u}`):l?s=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(s=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),j("xRange return",s),s})},Z0=(r,e)=>(j("replaceStars",r,e),r.trim().replace(_e[pe.STAR],"")),J0=(r,e)=>(j("replaceGTE0",r,e),r.trim().replace(_e[e.includePrerelease?pe.GTE0PRE:pe.GTE0],"")),eT=r=>(e,t,s,n,i,a,o,u,c,l,d,m)=>(ve(s)?t="":ve(n)?t=`>=${s}.0.0${r?"-0":""}`:ve(i)?t=`>=${s}.${n}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,ve(c)?u="":ve(l)?u=`<${+c+1}.0.0-0`:ve(d)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${d}-${m}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),tT=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(j(r[s].semver),r[s].semver!==Do.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}});var ks=h((bO,cp)=>{"use strict";var Ns=Symbol("SemVer ANY"),Fo=class r{static get ANY(){return Ns}constructor(e,t){if(t=np(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Bo("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ns?this.value="":this.value=this.operator+this.semver.version,Bo("comp",this)}parse(e){let t=this.options.loose?ip[ap.COMPARATORLOOSE]:ip[ap.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new op(s[2],this.options.loose):this.semver=Ns}toString(){return this.value}test(e){if(Bo("Comparator.test",e,this.options.loose),this.semver===Ns||e===Ns)return!0;if(typeof e=="string")try{e=new op(e,this.options)}catch{return!1}return $o(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new up(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new up(this.value,t).test(e.semver):(t=np(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||$o(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||$o(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};cp.exports=Fo;var np=Kn(),{safeRe:ip,t:ap}=Lr(),$o=Mo(),Bo=Ls(),op=he(),up=Pe()});var Ms=h((SO,lp)=>{"use strict";var rT=Pe(),sT=(r,e,t)=>{try{e=new rT(e,t)}catch{return!1}return e.test(r)};lp.exports=sT});var fp=h((EO,dp)=>{"use strict";var nT=Pe(),iT=(r,e)=>new nT(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));dp.exports=iT});var pp=h((wO,hp)=>{"use strict";var aT=he(),oT=Pe(),uT=(r,e,t)=>{let s=null,n=null,i=null;try{i=new oT(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===-1)&&(s=a,n=new aT(s,t))}),s};hp.exports=uT});var gp=h((TO,mp)=>{"use strict";var cT=he(),lT=Pe(),dT=(r,e,t)=>{let s=null,n=null,i=null;try{i=new lT(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===1)&&(s=a,n=new cT(s,t))}),s};mp.exports=dT});var vp=h((CO,_p)=>{"use strict";var Uo=he(),fT=Pe(),yp=Os(),hT=(r,e)=>{r=new fT(r,e);let t=new Uo("0.0.0");if(r.test(t)||(t=new Uo("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){let n=r.set[s],i=null;n.forEach(a=>{let o=new Uo(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||yp(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||yp(t,i))&&(t=i)}return t&&r.test(t)?t:null};_p.exports=hT});var Sp=h((AO,bp)=>{"use strict";var pT=Pe(),mT=(r,e)=>{try{return new pT(r,e).range||"*"}catch{return null}};bp.exports=mT});var oi=h((RO,Cp)=>{"use strict";var gT=he(),Tp=ks(),{ANY:yT}=Tp,_T=Pe(),vT=Ms(),Ep=Os(),wp=ri(),bT=ni(),ST=si(),ET=(r,e,t,s)=>{r=new gT(r,s),e=new _T(e,s);let n,i,a,o,u;switch(t){case">":n=Ep,i=bT,a=wp,o=">",u=">=";break;case"<":n=wp,i=ST,a=Ep,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(vT(r,e,s))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,m=null;if(l.forEach(f=>{f.semver===yT&&(f=new Tp(">=0.0.0")),d=d||f,m=m||f,n(f.semver,d.semver,s)?d=f:a(f.semver,m.semver,s)&&(m=f)}),d.operator===o||d.operator===u||(!m.operator||m.operator===o)&&i(r,m.semver))return!1;if(m.operator===u&&a(r,m.semver))return!1}return!0};Cp.exports=ET});var Rp=h((xO,Ap)=>{"use strict";var wT=oi(),TT=(r,e,t)=>wT(r,e,">",t);Ap.exports=TT});var Ip=h((IO,xp)=>{"use strict";var CT=oi(),AT=(r,e,t)=>CT(r,e,"<",t);xp.exports=AT});var kp=h((LO,Op)=>{"use strict";var Lp=Pe(),RT=(r,e,t)=>(r=new Lp(r,t),e=new Lp(e,t),r.intersects(e,t));Op.exports=RT});var Mp=h((OO,Np)=>{"use strict";var xT=Ms(),IT=Me();Np.exports=(r,e,t)=>{let s=[],n=null,i=null,a=r.sort((l,d)=>IT(l,d,t));for(let l of a)xT(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);let o=[];for(let[l,d]of s)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Fp=h((kO,Bp)=>{"use strict";var Pp=Pe(),Wo=ks(),{ANY:jo}=Wo,Ps=Ms(),Vo=Me(),LT=(r,e,t={})=>{if(r===e)return!0;r=new Pp(r,t),e=new Pp(e,t);let s=!1;e:for(let n of r.set){for(let i of e.set){let a=kT(n,i,t);if(s=s||a!==null,a)continue e}if(s)return!1}return!0},OT=[new Wo(">=0.0.0-0")],qp=[new Wo(">=0.0.0")],kT=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===jo){if(e.length===1&&e[0].semver===jo)return!0;t.includePrerelease?r=OT:r=qp}if(e.length===1&&e[0].semver===jo){if(t.includePrerelease)return!0;e=qp}let s=new Set,n,i;for(let f of r)f.operator===">"||f.operator===">="?n=Dp(n,f,t):f.operator==="<"||f.operator==="<="?i=$p(i,f,t):s.add(f.semver);if(s.size>1)return null;let a;if(n&&i){if(a=Vo(n.semver,i.semver,t),a>0)return null;if(a===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let f of s){if(n&&!Ps(f,String(n),t)||i&&!Ps(f,String(i),t))return null;for(let I of e)if(!Ps(f,String(I),t))return!1;return!0}let o,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(l=l||f.operator===">"||f.operator===">=",c=c||f.operator==="<"||f.operator==="<=",n){if(m&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===m.major&&f.semver.minor===m.minor&&f.semver.patch===m.patch&&(m=!1),f.operator===">"||f.operator===">="){if(o=Dp(n,f,t),o===f&&o!==n)return!1}else if(n.operator===">="&&!Ps(n.semver,String(f),t))return!1}if(i){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(u=$p(i,f,t),u===f&&u!==i)return!1}else if(i.operator==="<="&&!Ps(i.semver,String(f),t))return!1}if(!f.operator&&(i||n)&&a!==0)return!1}return!(n&&c&&!i&&a!==0||i&&l&&!n&&a!==0||m||d)},Dp=(r,e,t)=>{if(!r)return e;let s=Vo(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},$p=(r,e,t)=>{if(!r)return e;let s=Vo(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};Bp.exports=LT});var Vp=h((NO,Wp)=>{"use strict";var Go=Lr(),Up=Is(),NT=he(),jp=Io(),MT=Ft(),PT=ph(),qT=gh(),DT=vh(),$T=Eh(),BT=Th(),FT=Ah(),UT=xh(),jT=Lh(),WT=Me(),VT=Mh(),GT=qh(),HT=ti(),XT=Fh(),QT=jh(),zT=Os(),KT=ri(),YT=ko(),ZT=No(),JT=si(),eC=ni(),tC=Mo(),rC=Yh(),sC=ks(),nC=Pe(),iC=Ms(),aC=fp(),oC=pp(),uC=gp(),cC=vp(),lC=Sp(),dC=oi(),fC=Rp(),hC=Ip(),pC=kp(),mC=Mp(),gC=Fp();Wp.exports={parse:MT,valid:PT,clean:qT,inc:DT,diff:$T,major:BT,minor:FT,patch:UT,prerelease:jT,compare:WT,rcompare:VT,compareLoose:GT,compareBuild:HT,sort:XT,rsort:QT,gt:zT,lt:KT,eq:YT,neq:ZT,gte:JT,lte:eC,cmp:tC,coerce:rC,Comparator:sC,Range:nC,satisfies:iC,toComparators:aC,maxSatisfying:oC,minSatisfying:uC,minVersion:cC,validRange:lC,outside:dC,gtr:fC,ltr:hC,intersects:pC,simplifyRange:mC,subset:gC,SemVer:NT,re:Go.re,src:Go.src,tokens:Go.t,SEMVER_SPEC_VERSION:Up.SEMVER_SPEC_VERSION,RELEASE_TYPES:Up.RELEASE_TYPES,compareIdentifiers:jp.compareIdentifiers,rcompareIdentifiers:jp.rcompareIdentifiers}});var Xo=h((MO,Ho)=>{"use strict";var yC=Vp(),_C=Rs(),Or=wt(),Gp=de(),Hp=H(),Xp="2.7.15",vC=function(){return!1},bC=function(e){if(!yC.gte(e.VERSION,Xp))throw new Error("AWS SDK version "+Xp+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var s=e[t];s.prototype.customizeRequests(Qp)}return e},SC=function(e){return e.customizeRequests(Qp),e};function Qp(r){var e=Or.resolveSegment(Or.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return Or.isAutomaticMode()?Hp.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):Hp.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var s=this.throttledError||vC,n=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+a+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(o!=null)for(let[m,f]of Object.entries(o))d+=";"+m+"="+f;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new _C(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new zp(d)),(d.statusCode===429||l.error&&s(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:n};d&&d.statusCode?(Gp.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(d&&d.statusCode){var f=Gp.getCauseTypeFromHttpStatus(d.statusCode);f&&(i[f]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(Or.isAutomaticMode()){var d=Or.getNamespace();d.run(function(){Or.setSegment(i),r.__send(l)})}else r.__send(l)})}function zp(r){this.init(r)}zp.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};Ho.exports.captureAWSClient=SC;Ho.exports.captureAWS=bC});var em=h((PO,Jp)=>{var ui=Object.defineProperty,EC=Object.getOwnPropertyDescriptor,wC=Object.getOwnPropertyNames,TC=Object.prototype.hasOwnProperty,kr=(r,e)=>ui(r,"name",{value:e,configurable:!0}),CC=(r,e)=>{for(var t in e)ui(r,t,{get:e[t],enumerable:!0})},AC=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of wC(e))!TC.call(r,n)&&n!==t&&ui(r,n,{get:()=>e[n],enumerable:!(s=EC(e,n))||s.enumerable});return r},RC=r=>AC(ui({},"__esModule",{value:!0}),r),Kp={};CC(Kp,{isClockSkewCorrectedError:()=>Yp,isClockSkewError:()=>MC,isRetryableByTrait:()=>NC,isServerError:()=>qC,isThrottlingError:()=>PC,isTransientError:()=>Zp});Jp.exports=RC(Kp);var xC=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],IC=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],LC=["TimeoutError","RequestTimeout","RequestTimeoutException"],OC=[500,502,503,504],kC=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],NC=kr(r=>r.$retryable!==void 0,"isRetryableByTrait"),MC=kr(r=>xC.includes(r.name),"isClockSkewError"),Yp=kr(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),PC=kr(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||IC.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Zp=kr(r=>{var e;return Yp(r)||LC.includes(r.name)||kC.includes(r?.code||"")||OC.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),qC=kr(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Zp(r)}return!1},"isServerError")});var am=h(Nr=>{"use strict";var nm=Nr&&Nr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Nr,"__esModule",{value:!0});Nr.captureAWSClient=void 0;var DC=em(),$C=nm(Rs()),BC=require("querystring"),FC=nm(Es()),Qo=wt(),tm=H(),{safeParseInt:ci}=de(),UC=de(),im="XRaySDKInstrumentation",rm=async(r,e,t,s,n,i)=>{var a,o,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:m}=((a=n?.output)===null||a===void 0?void 0:a.$metadata)||i?.$metadata,f=new $C.default({extendedRequestId:c,requestId:l,retryCount:m,data:n?.output,request:{operation:e,params:s,httpRequest:{region:t,statusCode:d}}},r),I={};return d&&(I.response={},I.response.status=d),!((o=n?.response)===null||o===void 0)&&o.headers&&((u=n?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(I.response||(I.response={}),I.response.content_length=ci(n.response.headers["content-length"])),[f,I]};function sm(r,e,t){var s,n,i;(t&&(0,DC.isThrottlingError)(t)||ci((s=r.response)===null||s===void 0?void 0:s.status)===429||ci((n=t?.$metadata)===null||n===void 0?void 0:n.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,UC.getCauseTypeFromHttpStatus)(ci((i=r.response)===null||i===void 0?void 0:i.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var jC=(r,e)=>(t,s)=>async n=>{var i;let a=Qo.isAutomaticMode()?Qo.resolveSegment():e,{clientName:o,commandName:u}=s,c=(i=n?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),m=o.slice(0,-6);if(!a){let ee=m+"."+d;return Qo.isAutomaticMode()?tm.getLogger().info("Call "+ee+" is missing the sub/segment context for automatic mode. Ignoring."):tm.getLogger().info("Call "+ee+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(n)}let f;a.notTraced?f=a.addNewSubsegmentWithoutSampling(m):f=a.addNewSubsegment(m),f.addAttribute("namespace","aws");let I=a instanceof FC.default?a.segment:a,C=I.segment?I.segment.additionalTraceData:I.additionalTraceData,re=(0,BC.stringify)({Root:I.trace_id,Parent:f.id,Sampled:f.notTraced?"0":"1"},";");if(C!=null)for(let[ee,le]of Object.entries(C))re+=";"+ee+"="+le;a.noOp||(n.request.headers["X-Amzn-Trace-Id"]=re);let Ae;try{if(Ae=await t(n),!Ae)throw new Error("Failed to get response from instrumented AWS Client.");let[ee,le]=await rm(m,d,await r.region(),c,Ae,null);return f.addAttribute("aws",ee),f.addAttribute("http",le),sm(le,f),f.close(),Ae}catch(ee){if(ee.$metadata){let[X,Re]=await rm(m,d,await r.region(),c,null,ee);f.addAttribute("aws",X),f.addAttribute("http",Re),sm(Re,f,ee)}let le={message:ee.message,name:ee.name,stack:ee.stack||new Error().stack};throw f.close(le,!0),ee}},WC={name:im,step:"build"},VC=(r,e)=>({applyToStack:t=>{t.add(jC(r,e),WC)}});function GC(r,e){return r.middlewareStack.remove(im),r.middlewareStack.use(VC(r.config,e)),r}Nr.captureAWSClient=GC});var Ko=h((DO,zo)=>{"use strict";var om=require("url"),Mr=wt(),li=de(),um=H(),HC=require("events"),XC=function(e,t,s){e.__request||cm(e,t,s)},QC=function(e,t,s){if(e.__request)return e;var n={};return Object.keys(e).forEach(function(i){n[i]=e[i]}),cm(n,t,s),n};function cm(r,e,t){function s(a,...o){let u,c,l,d,m=o[0];if(typeof o[1]=="object"?(l=!0,d=typeof m=="string"?new om.URL(m):m,u=o[1],c=o[2]):(l=!1,u=m,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new om.URL(u)),l||(d=u);let f=Mr.resolveSegment(Mr.resolveManualSegmentParams(u)),I=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!f){let X="[ host: "+I;return X=u.method?X+", method: "+u.method:X,X+=", path: "+(d.pathname||li.stripQueryStringFromPath(u.path))+" ]",Mr.isAutomaticMode()?um.getLogger().info("Options for request "+X+" is missing the sub/segment context for automatic mode. Ignoring."):um.getLogger().info("Options for request "+X+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let C;f.notTraced?C=f.addNewSubsegmentWithoutSampling(I):C=f.addNewSubsegment(I);let re=f.segment?f.segment:f;C.namespace="remote",u.headers||(u.headers={}),f.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+re.trace_id+";Parent="+C.id+";Sampled="+(C.notTraced?"0":"1"));let Ae=function(Re){if(t&&t(C,this,null,Re),C.http&&C.http.response)li.getCauseTypeFromHttpStatus(C.http.response.status)==="error"&&C.addErrorFlag(),C.close(Re,!0);else{let dg=Re.code!=="ECONNREFUSED";C.addRemoteRequestData(this,null,dg&&e),C.close(Re)}},ee=li.objectWithoutProperties(u,["Segment"],!0),le=a(...l?[m,ee]:[u],function(X){X.on("end",function(){t&&t(C,this.req,X),X.statusCode===429&&C.addThrottleFlag();let Re=li.getCauseTypeFromHttpStatus(X.statusCode);Re&&(C[Re]=!0),C.addRemoteRequestData(X.req,X,!!e),C.close()}),typeof c=="function"?Mr.isAutomaticMode()?Mr.getNamespace().run(function(){Mr.setSegment(C),c(X)}):c(X):X.req&&X.req.listenerCount("response")===0&&X.resume()});return le.on(HC.errorMonitor||"error",Ae),le}r.__request=r.request;function n(...a){return s(r.__request,...a)}r.__get=r.get;function i(...a){return s(r.__get,...a)}Object.defineProperties(r,{request:{value:n,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}zo.exports.captureHTTPsGlobal=XC;zo.exports.captureHTTPs=QC});var hm=h(($O,Yo)=>{"use strict";var qs=wt(),di=Symbol("original then"),fi=Symbol("original catch");function dm(r){let e=r.prototype.then;e[di]||(r.prototype.then=function(s,n){if(qs.isAutomaticMode()&&lm()){let i=qs.getNamespace();s=s&&i.bind(s),n=n&&i.bind(n)}return e.call(this,s,n)},r.prototype.then[di]=e);let t=r.prototype.catch;t&&!t[fi]&&(r.prototype.catch=function(s){if(qs.isAutomaticMode()&&lm()){let n=qs.getNamespace();s=s&&n.bind(s)}return t.call(this,s)},r.prototype.catch[fi]=t)}function zC(r){let e=r.prototype.then;e[di]&&(r.prototype.then=e[di]);let t=r.prototype.catch;t&&t[fi]&&(r.prototype.catch=t[fi])}function lm(){try{return qs.getSegment()}catch{return}}function fm(){dm(Promise)}function KC(){zC(Promise)}fm.patchThirdPartyPromise=dm;Yo.exports.capturePromise=fm;Yo.exports.uncapturePromise=KC});var gm=h((BO,mm)=>{"use strict";function pm(r,e,t,s,n){this.init(r,e,t,s,n)}pm.prototype.init=function(e,t,s,n,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=n,this.user=s};mm.exports=pm});var vm=h((FO,_m)=>{"use strict";var ct=wt(),Zo=H(),Pr=bt(),YC=de(),ZC=kf(),$s={};try{$s=Nf()}catch(r){Zo.getLogger().debug("Failed to load SDK data:",r)}var Ds="unknown",ym={plugins:{EC2Plugin:Uf(),ECSPlugin:Wf(),ElasticBeanstalkPlugin:Gf()},config:function(r){var e={};r.forEach(function(t){t.getData(function(s){if(s)for(var n in s)e[n]=s[n]}),Pr.setOrigin(t.originName),Pr.setPluginData(e)})},setAWSWhitelist:Rs().setAWSWhitelist,appendAWSWhitelist:Rs().appendAWSWhitelist,setStreamingThreshold:Pr.setStreamingThreshold,setLogger:Zo.setLogger,getLogger:Zo.getLogger,setDaemonAddress:Ln().setDaemonAddress,captureFunc:zn().captureFunc,captureAsyncFunc:zn().captureAsyncFunc,captureCallbackFunc:zn().captureCallbackFunc,captureAWS:Xo().captureAWS,captureAWSClient:Xo().captureAWSClient,captureAWSv3Client:am().captureAWSClient,captureHTTPs:Ko().captureHTTPs,captureHTTPsGlobal:Ko().captureHTTPsGlobal,capturePromise:hm().capturePromise,utils:YC,database:{SqlData:gm()},middleware:yo(),getNamespace:ct.getNamespace,resolveSegment:ct.resolveSegment,resolveManualSegmentParams:ct.resolveManualSegmentParams,getSegment:ct.getSegment,setSegment:ct.setSegment,isAutomaticMode:ct.isAutomaticMode,enableAutomaticMode:ct.enableAutomaticMode,enableManualMode:ct.enableManualMode,setContextMissingStrategy:ct.setContextMissingStrategy,Segment:ws(),Subsegment:Es(),SegmentUtils:Pr};ym.middleware.IncomingRequestData=io(),function(){var r={runtime:process.release&&process.release.name?process.release.name:Ds,runtime_version:process.version,version:process.env.npm_package_version||Ds,name:process.env.npm_package_name||Ds},e={sdk:"X-Ray for Node.js",sdk_version:$s.version?$s.version:Ds,package:$s.name?$s.name:Ds};Pr.setSDKData(e),Pr.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&ZC.init()}();_m.exports=ym});var Jo=h((UO,bm)=>{"use strict";bm.exports=vm()});var DR={};uu(DR,{handler:()=>qR});module.exports=_g(DR);var lu="ColdStart",du="default_namespace";var se={Seconds:"Seconds",Microseconds:"Microseconds",Milliseconds:"Milliseconds",Bytes:"Bytes",Kilobytes:"Kilobytes",Megabytes:"Megabytes",Gigabytes:"Gigabytes",Terabytes:"Terabytes",Bits:"Bits",Kilobits:"Kilobits",Megabits:"Megabits",Gigabits:"Gigabits",Terabits:"Terabits",Percent:"Percent",Count:"Count",BytesPerSecond:"Bytes/Second",KilobytesPerSecond:"Kilobytes/Second",MegabytesPerSecond:"Megabytes/Second",GigabytesPerSecond:"Gigabytes/Second",TerabytesPerSecond:"Terabytes/Second",BitsPerSecond:"Bits/Second",KilobitsPerSecond:"Kilobits/Second",MegabitsPerSecond:"Megabits/Second",GigabitsPerSecond:"Gigabits/Second",TerabitsPerSecond:"Terabits/Second",CountPerSecond:"Count/Second",NoUnit:"None"},nr={Standard:60,High:1};var Ru=require("console");var mt="2.28.1";var Ci=process.env.AWS_EXECUTION_ENV||"NA",vg={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},fu=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",bg=r=>e=>async t=>{let s=t.request.headers["user-agent"]||"";if(s.includes("PT/NO-OP")){let n=s.replace("PT/NO-OP",`PT/${r}/${mt} PTEnv/${Ci}`);return t.request.headers["user-agent"]=n,await e(t)}return s.includes("PT/")?await e(t):(t.request.headers["user-agent"]=s===""?`PT/${r}/${mt} PTEnv/${Ci}`:`${s} PT/${r}/${mt} PTEnv/${Ci}`,await e(t))},Sg=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},Ai=(r,e)=>{try{if(fu(r)){if(Sg(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(bg(e),vg)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var Gs="powertools-for-aws",hu=`${Gs}.tracer`,pu=`${Gs}.metrics`,mu=`${Gs}.logger`,gu=`${Gs}.idempotency`;var ir=r=>typeof r=="string",Hs=r=>typeof r=="number",Xs=r=>Hs(r)&&Number.isInteger(r);var yu=r=>Object.is(r,null),Qs=r=>yu(r)||Object.is(r,void 0),ar=r=>!!(Qs(r)||!ir(r)||r.trim().length===0);var or,Je=class{constructor(){k(this,or);A(this,"coldStart",!0);A(this,"defaultServiceName","service_undefined");te(this,or,this.getInitializationType()),p(this,or)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return p(this,or)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};or=new WeakMap;var _u=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${mt}/PTEnv/${_u}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${mt}/PTEnv/${_u}`;var vu="POWERTOOLS_DEV",bu="POWERTOOLS_SERVICE_NAME",Su="_X_AMZN_TRACE_ID";var Q=({key:r,defaultValue:e,errorMessage:t})=>{let s=process.env[r];if(s===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return s.trim()},Eu=({key:r,defaultValue:e,errorMessage:t})=>{let s=Q({key:r,defaultValue:String(e),errorMessage:t}),n=Number(s);if(Number.isNaN(n))throw new TypeError(`Environment variable ${r} must be a number`);return n},Eg=new Set(["1","y","yes","t","true","on"]),wg=new Set(["0","n","no","f","false","off"]),Hr=({key:r,defaultValue:e,errorMessage:t,extendedParsing:s})=>{let i=Q({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(s){if(Eg.has(i))return!0;if(wg.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},Lt=()=>{try{return Hr({key:vu,extendedParsing:!0})}catch{return!1}},zs=()=>Q({key:bu,defaultValue:""}),wu=()=>{let r=Q({key:Su,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[s,n]=t.split("=");e[s]=n}return e},Tu=()=>wu()?.Sampled==="1",et=()=>wu()?.Root;var xe,be,Qr,Ue,xu,Iu,Lu,Ri,xi=class xi extends Je{constructor(t={}){super();k(this,Ue);A(this,"console");A(this,"customConfigService");A(this,"defaultDimensions",{});A(this,"dimensions",{});A(this,"dimensionSets",[]);A(this,"functionName");k(this,xe);A(this,"isSingleMetric",!1);A(this,"metadata",{});A(this,"namespace");A(this,"shouldThrowOnEmptyMetrics",!1);A(this,"storedMetrics",{});A(this,"disabled",!1);k(this,be,{namespace:"",functionName:"",serviceName:"",disabled:!1,devMode:!1});k(this,Qr);this.dimensions={},this.setEnvConfig(),this.setConsole(),te(this,xe,t.logger||this.console),this.setOptions(t)}addDimension(t,s){if(ar(t)||ar(s)){p(this,xe).warn(`The dimension ${t} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);return}if(29<=this.getCurrentDimensionsCount())throw new RangeError(`The number of metric dimensions must be lower than ${29}`);(Object.hasOwn(this.dimensions,t)||Object.hasOwn(this.defaultDimensions,t))&&p(this,xe).warn(`Dimension "${t}" has already been added. The previous value will be overwritten.`),this.dimensions[t]=s}addDimensions(t){let s=q(this,Ue,Ri).call(this,t),n=this.getCurrentDimensionsCount(),i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.dimensionSets.push(s)}addMetadata(t,s){this.metadata[t]=s}addMetric(t,s,n,i=nr.Standard){this.storeMetric(t,s,n,i),this.isSingleMetric&&this.publishStoredMetrics()}captureColdStartMetric(t){if(!this.getColdStart())return;let s=this.singleMetric(),n=this.functionName?.trim()??t?.trim();n&&n.length>0&&s.addDimension("function_name",n),s.addMetric(lu,se.Count,1)}clearDefaultDimensions(){this.defaultDimensions={}}clearDimensions(){this.dimensions={},this.dimensionSets=[]}clearMetadata(){this.metadata={}}clearMetrics(){this.storedMetrics={}}hasStoredMetrics(){return Object.keys(this.storedMetrics).length>0}isDisabled(){return this.disabled}logMetrics(t={}){let{throwOnEmptyMetrics:s,defaultDimensions:n,captureColdStartMetric:i}=t;return s&&this.setThrowOnEmptyMetrics(s),n!==void 0&&this.setDefaultDimensions(n),(a,o,u)=>{let c=u.value,l=this;return u.value=async function(...d){i&&l.captureColdStartMetric(d[1].functionName);let m;try{m=await c.apply(this,d)}finally{l.publishStoredMetrics()}return m},u}}publishStoredMetrics(){let t=this.hasStoredMetrics();if(!this.shouldThrowOnEmptyMetrics&&!t&&p(this,xe).warn("No application metrics to publish. The cold-start metric may be published if enabled. If application metrics should never be empty, consider using `throwOnEmptyMetrics`"),!this.disabled){let s=this.serializeMetrics();t&&this.console.log(JSON.stringify(s))}this.clearMetrics(),this.clearDimensions(),this.clearMetadata()}setTimestamp(t){q(this,Ue,Iu).call(this,t)||p(this,xe).warn("This metric doesn't meet the requirements and will be skipped by Amazon CloudWatch. Ensure the timestamp is within 14 days in the past or up to 2 hours in the future and is also a valid number or Date object."),te(this,Qr,q(this,Ue,Lu).call(this,t))}serializeMetrics(){let t=Object.values(this.storedMetrics).map(a=>({Name:a.name,Unit:a.unit,...a.resolution===nr.High?{StorageResolution:a.resolution}:{}}));if(t.length===0&&this.shouldThrowOnEmptyMetrics)throw new RangeError("The number of metrics recorded must be higher than zero");this.namespace||p(this,xe).warn("Namespace should be defined, default used");let s=Object.values(this.storedMetrics).reduce((a,{name:o,value:u})=>(a[o]=u,a),{}),n=[],i=new Set([...Object.keys(this.defaultDimensions),...Object.keys(this.dimensions)]);Object.keys(this.dimensions).length>0&&n.push([...i]);for(let a of this.dimensionSets){let o=new Set([...Object.keys(this.defaultDimensions),...Object.keys(a)]);n.push([...o])}return n.length===0&&Object.keys(this.defaultDimensions).length>0&&n.push([...Object.keys(this.defaultDimensions)]),{_aws:{Timestamp:p(this,Qr)??Date.now(),CloudWatchMetrics:[{Namespace:this.namespace||du,Dimensions:n,Metrics:t}]},...this.defaultDimensions,...this.dimensions,...this.dimensionSets.reduce((a,o)=>{for(let[u,c]of Object.entries(o))a[u]=c;return a},{}),...s,...this.metadata}}setDefaultDimensions(t){let s=q(this,Ue,Ri).call(this,t),n=Object.keys(this.defaultDimensions).length,i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.defaultDimensions={...this.defaultDimensions,...s}}setFunctionName(t){this.functionName=t}setThrowOnEmptyMetrics(t){this.shouldThrowOnEmptyMetrics=t}singleMetric(){return new xi({namespace:this.namespace,defaultDimensions:this.defaultDimensions,singleMetric:!0,logger:p(this,xe)})}throwOnEmptyMetrics(){this.shouldThrowOnEmptyMetrics=!0}getCurrentDimensionsCount(){let t=this.dimensionSets.reduce((s,n)=>s+Object.keys(n).length,0);return Object.keys(this.dimensions).length+Object.keys(this.defaultDimensions).length+t}getCustomConfigService(){return this.customConfigService}isNewMetric(t,s){if(this.storedMetrics[t]){if(this.storedMetrics[t].unit!==s){let n=this.storedMetrics[t].unit;throw new Error(`Metric "${t}" has already been added with unit "${n}", but we received unit "${s}". Did you mean to use metric unit "${n}"?`)}return!1}return!0}setConsole(){p(this,be).devMode?this.console=console:this.console=new Ru.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(t){this.customConfigService=t||void 0}setEnvConfig(){p(this,be).namespace=Q({key:"POWERTOOLS_METRICS_NAMESPACE",defaultValue:""}),p(this,be).functionName=Q({key:"POWERTOOLS_METRICS_FUNCTION_NAME",defaultValue:""}),p(this,be).serviceName=zs(),p(this,be).disabled=Hr({key:"POWERTOOLS_METRICS_DISABLED",defaultValue:!1,extendedParsing:!0}),p(this,be).devMode=Lt()}setFunctionNameForColdStartMetric(t){let s=t?.trim()??p(this,be).functionName;s&&s.length>0&&(this.functionName=s)}setNamespace(t){this.namespace=t||this.getCustomConfigService()?.getNamespace()||p(this,be).namespace}setDisabled(){if("POWERTOOLS_METRICS_DISABLED"in process.env&&process.env.POWERTOOLS_METRICS_DISABLED!==void 0){this.disabled=p(this,be).disabled;return}this.disabled=p(this,be).devMode}setOptions(t){let{customConfigService:s,namespace:n,serviceName:i,singleMetric:a,defaultDimensions:o,functionName:u}=t;this.setCustomConfigService(s),this.setDisabled(),this.setNamespace(n);let c=q(this,Ue,xu).call(this,i);return this.setDefaultDimensions(o?{service:c,...o}:{service:c}),this.setFunctionNameForColdStartMetric(u),this.isSingleMetric=a||!1,this}storeMetric(t,s,n,i){if(!ir(t))throw new Error(`${t} is not a valid string`);if(t.length<1||t.length>255)throw new RangeError(`The metric name should be between ${1} and ${255} characters`);if(!Hs(n))throw new RangeError(`${n} is not a valid number`);if(!Object.values(se).includes(s))throw new RangeError(`Invalid metric unit '${s}', expected either option: ${Object.values(se).join(",")}`);if(!Object.values(nr).includes(i))throw new RangeError(`Invalid metric resolution '${i}', expected either option: ${Object.values(nr).join(",")}`);if(Object.keys(this.storedMetrics).length>=100&&this.publishStoredMetrics(),this.isNewMetric(t,s))this.storedMetrics[t]={unit:s,value:n,name:t,resolution:i};else{let a=this.storedMetrics[t];Array.isArray(a.value)||(a.value=[a.value]),a.value.push(n),a.value.length===100&&this.publishStoredMetrics()}}};xe=new WeakMap,be=new WeakMap,Qr=new WeakMap,Ue=new WeakSet,xu=function(t){return t||this.getCustomConfigService()?.getServiceName()||p(this,be).serviceName||this.defaultServiceName},Iu=function(t){let s=t instanceof Date;if(!s&&!Xs(t))return!1;let n=s?t.getTime():t,i=Date.now(),a=i-12096e5,o=i+72e5;return n>=a&&n<=o},Lu=function(t){return Xs(t)?t:t instanceof Date?t.getTime():0},Ri=function(t){let s={};for(let[n,i]of Object.entries(t)){if(ar(n)||ar(i)){p(this,xe).warn(`The dimension ${n} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);continue}(Object.hasOwn(this.dimensions,n)||Object.hasOwn(this.defaultDimensions,n)||Object.hasOwn(s,n))&&p(this,xe).warn(`Dimension "${n}" has already been added. The previous value will be overwritten.`),s[n]=i}return s};var Xr=xi;var Ii={PRETTY:4,COMPACT:0};var D={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},Ou=["level","message","sampling_rate","service","timestamp"],ku="Uncaught error detected, flushing log buffer before exit";var Ks,Ys,Nu,zr=class{constructor(){k(this,Ys);k(this,Ks,e=>{let t="2-digit",s=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:s})})}formatError(e){let{name:t,message:s,stack:n,cause:i,...a}=e,o={name:t,location:this.getCodeLocation(e.stack),message:s,stack:Lt()&&typeof n=="string"?n?.split(`
`):n,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(o[u]=a[u]);return o}formatTimestamp(e){let t="UTC",s=Q({key:"TZ",defaultValue:""});return s&&!s.includes(t)?q(this,Ys,Nu).call(this,e,s):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),s=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let n of t){let i=s.exec(n);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};Ks=new WeakMap,Ys=new WeakSet,Nu=function(e,t){let{year:s,month:n,day:i,hour:a,minute:o,second:u}=p(this,Ks).call(this,t).formatToParts(e).reduce((re,Ae)=>(re[Ae.type]=Ae.value,re),{}),c=`${s}-${n}-${i}T${a}:${o}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",m=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),f=Math.abs(l%60).toString().padStart(2,"0"),I=e.getMilliseconds().toString().padStart(3,"0"),C=`${d}${m}:${f}`;return`${c}.${I}${C}`};var uc=Fe(Fi(),1);var fr=class{constructor(e){A(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,uc.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let s in e)e[s]!==void 0&&e[s]!==""&&e[s]!==null&&(t[s]=e[s]);return t}setAttributes(e){this.attributes=e}};var lc=require("console"),dc=require("crypto");var ts=Fe(Fi(),1);var hr,on=class extends zr{constructor(t){super();k(this,hr);te(this,hr,t?.logRecordOrder)}formatAttributes(t,s){let n={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(p(this,hr)===void 0)return new fr({attributes:n}).addAttributes(s);let i={};for(let o of p(this,hr))o in n&&!(o in i)?i[o]=n[o]:o in s&&!(o in i)&&(i[o]=s[o]);for(let o in n)o in i||(i[o]=n[o]);for(let o in s)o in i||(i[o]=s[o]);return new fr({attributes:i})}};hr=new WeakMap;var Ui=class{constructor(e,t){A(this,"value");A(this,"logLevel");A(this,"byteSize");if(!ir(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},ji=class extends Set{constructor(){super(...arguments);A(this,"currentBytesSize",0);A(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let s=super.delete(t);return s&&(this.currentBytesSize-=t.byteSize),s}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},Mt,pr,cn,cc,un=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:s}){super();k(this,cn);k(this,Mt);k(this,pr);te(this,Mt,t),te(this,pr,s)}setItem(t,s,n){let i=new Ui(s,n);if(i.byteSize>p(this,Mt))throw new Error("Item too big");let a=this.get(t)||new ji;return a.currentBytesSize+i.byteSize>=p(this,Mt)&&(q(this,cn,cc).call(this,a,i),p(this,pr)&&p(this,pr).call(this)),a.add(i),super.set(t,a),this}};Mt=new WeakMap,pr=new WeakMap,cn=new WeakSet,cc=function(t,s){for(;t.currentBytesSize+s.byteSize>=p(this,Mt);)t.shift(),t.hasEvictedLog=!0};var je,mr,is,We,gt,Pt,ie,Qe,qt,st,as,$,rs,Wi,fc,hc,pc,mc,Vi,ss,gc,Gi=class Gi extends Je{constructor(t={}){super();k(this,$);A(this,"console");A(this,"customConfigService");A(this,"logEvent",!1);A(this,"logFormatter");A(this,"logIndentation",Ii.COMPACT);A(this,"logLevel",D.INFO);k(this,je);A(this,"persistentLogAttributes",{});A(this,"powertoolsLogData",{sampleRateValue:0});A(this,"temporaryLogAttributes",{});k(this,mr,[]);k(this,is,!1);k(this,We,new Map);k(this,gt,D.INFO);k(this,Pt);k(this,ie,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:D.DEBUG});k(this,Qe);k(this,qt);k(this,st,{sampleRateValue:0,refreshedTimes:0});k(this,as,new Map);let{customConfigService:s,...n}=t;this.customConfigService=s||void 0,this.setOptions(n),te(this,is,!0);for(let[i,a]of p(this,mr))this.printLog(i,this.createAndPopulateLogItem(...a));te(this,mr,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){q(this,$,Wi).call(this,t,"temp")}appendPersistentKeys(t){q(this,$,Wi).call(this,t,"persistent")}createChild(t={}){let s=this.createLogger((0,ts.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:p(this,st).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:p(this,Pt),correlationIdSearchFn:p(this,qt),...p(this,ie).enabled&&{logBufferOptions:{maxBytes:p(this,ie).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(p(this,ie).bufferAtVerbosity),flushOnErrorLog:p(this,ie).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&s.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&s.appendKeys(this.temporaryLogAttributes),s}critical(t,...s){this.processLogItem(D.CRITICAL,t,s)}debug(t,...s){this.processLogItem(D.DEBUG,t,s)}error(t,...s){p(this,ie).enabled&&p(this,ie).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(D.ERROR,t,s)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...s){this.processLogItem(D.INFO,t,s)}injectLambdaContext(t){return(s,n,i)=>{let a=i.value,o=this;i.value=async function(...u){o.refreshSampleRateCalculation(),o.addContext(u[1]),o.logEventIfEnabled(u[0],t?.logEvent),t?.correlationIdPath&&o.setCorrelationId(u[0],t?.correlationIdPath);try{return await a.apply(this,u)}catch(c){throw t?.flushBufferOnUncaughtError&&(o.flushBuffer(),o.error({message:ku,error:c})),c}finally{(t?.clearState||t?.resetKeys)&&o.resetKeys(),o.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,s,n){n&&(n.clearState||n?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,s,n,i){t.addContext(n),t.logEventIfEnabled(s,i?.logEvent)}logEventIfEnabled(t,s){this.shouldLogEvent(s)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(p(this,st).refreshedTimes===0){p(this,st).refreshedTimes++;return}q(this,$,Vi).call(this)&&this.logLevel>D.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(p(this,gt)))}removeKeys(t){for(let s of t)this.temporaryLogAttributes[s]=void 0,this.persistentLogAttributes[s]?p(this,We).set(s,"persistent"):p(this,We).delete(s)}removePersistentKeys(t){for(let s of t)this.persistentLogAttributes[s]=void 0,this.temporaryLogAttributes[s]?p(this,We).set(s,"temp"):p(this,We).delete(s)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?p(this,We).set(t,"persistent"):p(this,We).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=D[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...s){this.processLogItem(D.TRACE,t,s)}warn(t,...s){this.processLogItem(D.WARN,t,s)}createLogger(t){return new Gi(t)}getJsonReplacer(){let t=new WeakSet;return(s,n)=>{var a;let i=n;if(p(this,Pt)&&(i=(a=p(this,Pt))==null?void 0:a.call(this,s,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,ts.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return p(this,je)!==void 0?(this.logLevel=D[p(this,je)],this.isValidLogLevel(t)&&this.logLevel>D[t]&&q(this,$,rs).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${p(this,je)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,s,n){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:et(),...this.getPowertoolsLogData(),message:""},a=q(this,$,fc).call(this);return q(this,$,hc).call(this,s,i,a),q(this,$,pc).call(this,n,a),this.getLogFormatter().formatAttributes(i,a)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let s;for(let[n,i]of Object.entries(D))if(i===t){s=n;break}return s}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in D}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,s){s.prepareForPrint();let n=t===D.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[n](JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,s,n){let i=et();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,s,n),t)}catch(a){this.printLog(D.WARN,this.createAndPopulateLogItem(D.WARN,`Unable to buffer log: ${a.message}`,[a])),this.printLog(t,this.createAndPopulateLogItem(t,s,n))}return}t>=this.logLevel&&(p(this,is)?this.printLog(t,this.createAndPopulateLogItem(t,s,n)):p(this,mr).push([t,[t,s,n]]))}setConsole(){Lt()?this.console=console:this.console=new lc.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...s)=>{this.console.log(t,...s)}}setInitialLogLevel(t){let s=t?.toUpperCase();if(this.awsLogLevelShortCircuit(s)){te(this,gt,this.logLevel);return}if(this.isValidLogLevel(s)){this.logLevel=D[s],te(this,gt,this.logLevel);return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=D[n],te(this,gt,this.logLevel);return}let i=Q({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),a=Q({key:"LOG_LEVEL",defaultValue:""}),o=i!==""?i:a;this.isValidLogLevel(o)&&(this.logLevel=D[o],te(this,gt,this.logLevel))}setInitialSampleRate(t){let s=t,n=this.getCustomConfigService()?.getSampleRateValue(),i=Eu({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let a of[s,n,i])if(this.isValidSampleRate(a)){p(this,st).sampleRateValue=a,this.powertoolsLogData.sampleRateValue=a,q(this,$,Vi).call(this)&&this.logLevel>D.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=Hr({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,s){this.logFormatter=t??new on({logRecordOrder:s})}setLogIndentation(){Lt()&&(this.logIndentation=Ii.PRETTY)}setOptions(t){let{logLevel:s,serviceName:n,sampleRateValue:i,logFormatter:a,persistentKeys:o,persistentLogAttributes:u,environment:c,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:m,correlationIdSearchFn:f}=t;u&&Object.keys(u).length>0&&o&&Object.keys(o).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(n,c,o||u);let I=Q({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),C=I==="FATAL"?"CRITICAL":I;return this.isValidLogLevel(C)&&te(this,je,C),this.setLogEvent(),this.setInitialLogLevel(s),this.setInitialSampleRate(i),this.setLogFormatter(a,d),this.setConsole(),this.setLogIndentation(),te(this,Pt,l),q(this,$,gc).call(this,m),te(this,qt,f),this}setPowertoolsLogData(t,s,n){this.addToPowertoolsLogData({awsRegion:Q({key:"AWS_REGION",defaultValue:""}),environment:s||this.getCustomConfigService()?.getCurrentEnvironment()||Q({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||Q({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),n&&this.appendPersistentKeys(n)}bufferLogItem(t,s,n){s.prepareForPrint(),p(this,Qe)?.has(t)===!1&&p(this,Qe)?.clear(),p(this,Qe)?.setItem(t,JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation),n)}flushBuffer(){let t=et();if(t===void 0)return;let s=p(this,Qe)?.get(t);if(s!==void 0){for(let n of s){let i=this.getLogLevelNameFromNumber(n.logLevel).toLowerCase();this.console[i](n.value)}s.hasEvictedLog&&this.printLog(D.WARN,this.createAndPopulateLogItem(D.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),p(this,je)!==void 0&&D[p(this,je)]>p(this,ie).bufferAtVerbosity&&q(this,$,rs).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),p(this,Qe)?.delete(t)}}clearBuffer(){let t=et();t!==void 0&&p(this,Qe)?.delete(t)}shouldBufferLog(t,s){return p(this,ie).enabled&&t!==void 0&&s<=p(this,ie).bufferAtVerbosity}setCorrelationId(t,s){if(typeof s=="string"){if(!p(this,qt)){q(this,$,rs).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let n=p(this,qt).call(this,s,t);n&&this.appendKeys({correlation_id:n});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};je=new WeakMap,mr=new WeakMap,is=new WeakMap,We=new WeakMap,gt=new WeakMap,Pt=new WeakMap,ie=new WeakMap,Qe=new WeakMap,qt=new WeakMap,st=new WeakMap,as=new WeakMap,$=new WeakSet,rs=function(t){p(this,as).has(t)||(p(this,as).set(t,!0),this.warn(t))},Wi=function(t,s){for(let n of Object.keys(t))q(this,$,ss).call(this,n)===!1&&p(this,We).set(n,s);s==="temp"?(0,ts.default)(this.temporaryLogAttributes,t):(0,ts.default)(this.persistentLogAttributes,t)},fc=function(){let t={};for(let[s,n]of p(this,We))q(this,$,ss).call(this,s)||(t[s]=n==="persistent"?this.persistentLogAttributes[s]:this.temporaryLogAttributes[s]);return t},hc=function(t,s,n){if(typeof t=="string"){s.message=t;return}let{message:i,...a}=t;s.message=i;for(let[o,u]of Object.entries(a))q(this,$,ss).call(this,o)||(n[o]=u)},pc=function(t,s){for(let n of t)Qs(n)||(n instanceof Error?s.error=n:typeof n=="string"?s.extra=n:q(this,$,mc).call(this,n,s))},mc=function(t,s){for(let[n,i]of Object.entries(t))q(this,$,ss).call(this,n)||(s[n]=i)},Vi=function(){return p(this,st).sampleRateValue&&(0,dc.randomInt)(0,100)/100<=p(this,st).sampleRateValue},ss=function(t){return Ou.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},gc=function(t){if(t===void 0||(p(this,ie).enabled=t?.enabled!==!1,p(this,ie).enabled===!1))return;t?.maxBytes!==void 0&&(p(this,ie).maxBytes=t.maxBytes),te(this,Qe,new un({maxBytesSize:p(this,ie).maxBytes})),t?.flushOnErrorLog===!1&&(p(this,ie).flushOnErrorLog=!1);let s=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(s)&&(p(this,ie).bufferAtVerbosity=D[s]),p(this,je)!==void 0&&D[p(this,je)]>p(this,ie).bufferAtVerbosity&&q(this,$,rs).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var ns=Gi;var ue=[];for(let r=0;r<256;++r)ue.push((r+256).toString(16).slice(1));function yc(r,e=0){return(ue[r[e+0]]+ue[r[e+1]]+ue[r[e+2]]+ue[r[e+3]]+"-"+ue[r[e+4]]+ue[r[e+5]]+"-"+ue[r[e+6]]+ue[r[e+7]]+"-"+ue[r[e+8]]+ue[r[e+9]]+"-"+ue[r[e+10]]+ue[r[e+11]]+ue[r[e+12]]+ue[r[e+13]]+ue[r[e+14]]+ue[r[e+15]]).toLowerCase()}var _c=Fe(require("crypto")),dn=new Uint8Array(256),ln=dn.length;function Hi(){return ln>dn.length-16&&(_c.default.randomFillSync(dn),ln=0),dn.slice(ln,ln+=16)}var vc=Fe(require("crypto")),Xi={randomUUID:vc.default.randomUUID};function b_(r,e,t){if(Xi.randomUUID&&!e&&!r)return Xi.randomUUID();r=r||{};let s=r.random||(r.rng||Hi)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=s[n];return e}return yc(s)}var gr=b_;var Ve=class r{constructor(e,t){this.logger=new ns({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||gr(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,s){let n=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...n,...s})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,s){this.info(`Custom metric: ${e}`,{metric:e,value:t,...s})}logApiRequest(e,t,s){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...s})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};var sI=new Ve;var Oe=Fe(Xa(),1),QI=Oe.default.Client,od=Oe.default.Pool,zI=Oe.default.Connection,KI=Oe.default.types,YI=Oe.default.Query,ZI=Oe.default.DatabaseError,JI=Oe.default.escapeIdentifier,eL=Oe.default.escapeLiteral,tL=Oe.default.Result,rL=Oe.default.TypeOverrides,sL=Oe.default.defaults;var Pm=require("aws-sdk");var Im=Fe(Jo(),1);var Am=Fe(Jo(),1),hi=require("diagnostics_channel"),Rm=Fe(require("http"),1),xm=Fe(require("https"),1);var eu=require("url"),Sm=new TextDecoder,Em=(r,e)=>{let t=-1;for(let s=0;s<r.length;s+=2)if(Sm.decode(r[s]).toLowerCase()===e){t=s;break}return t===-1?null:Sm.decode(r[t+1])},tu=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",wm=r=>{if(typeof r.origin=="string")return new eu.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof eu.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:JC,captureAWSClient:eA,captureAWSv3Client:tA,captureAsyncFunc:rA,captureFunc:sA,captureHTTPsGlobal:Tm,getNamespace:nA,getSegment:iA,setSegment:aA,Segment:Cm,setContextMissingStrategy:oA,setDaemonAddress:uA,setLogger:cA}=Am.default,pi=class{captureAWS(e){return JC(e)}captureAWSClient(e){return eA(e)}captureAWSv3Client(e){return Ai(e,"tracer"),tA(e)}captureAsyncFunc(e,t,s){return rA(e,t)}captureFunc(e,t,s){return sA(e,t)}captureHTTPsGlobal(){Tm(Rm.default),Tm(xm.default)}getNamespace(){return nA()}getSegment(){return iA()}instrumentFetch(){let e=n=>{let{request:i}=n,a=i.method;if(a==="CONNECT")return;let o=this.getSegment(),u=wm(i);if(o&&u){let c=o.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${et()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:a}},this.setSegment(c)}},t=n=>{let{response:i}=n,a=this.getSegment();if(tu(a)){let o=i.statusCode,u=Em(i.headers,"content-length");a.http={...a.http,response:{status:o,...u&&{content_length:Number.parseInt(u,10)}}},o===429&&a.addThrottleFlag(),o>=400&&o<500?a.addErrorFlag():o>=500&&o<600&&a.addFaultFlag(),a.close(),this.setSegment(a.parent)}},s=n=>{let{error:i}=n,a=this.getSegment();tu(a)&&(a.addErrorFlag(),i instanceof Error&&a.addError(i,!0),a.close(),this.setSegment(a.parent))};(0,hi.subscribe)("undici:request:create",e),(0,hi.subscribe)("undici:request:headers",t),(0,hi.subscribe)("undici:request:error",s)}putAnnotation(e,t){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(s instanceof Cm){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}s.addAnnotation(e,t)}putMetadata(e,t,s){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(n instanceof Cm){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}n.addMetadata(e,t,s)}setContextMissingStrategy(e){oA(e)}setDaemonAddress(e){uA(e)}setLogger(e){cA(e)}setSegment(e){aA(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:lA}=Im.default,ne,mi,Lm,Bs=class extends Je{constructor(t={}){super();k(this,mi);A(this,"provider");A(this,"captureError",!0);A(this,"captureHTTPsRequests",!0);A(this,"captureResponse",!0);A(this,"customConfigService");k(this,ne,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});A(this,"serviceName");A(this,"tracingEnabled",!0);q(this,mi,Lm).call(this),this.setOptions(t),this.provider=new pi,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,s){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(t,s||!1)}}addResponseAsMetadata(t,s){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${s} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(s){try{return this.provider.captureAWSClient(t.service),t}catch{throw s}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){return o.isTracingEnabled()?o.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async c=>{o.annotateColdStart(),o.addServiceNameAnnotation();let l;try{l=await a.apply(this,u),(t?.captureResponse??!0)&&o.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw o.addErrorAsMetadata(d),d}finally{try{c?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",c?.name,d)}}return l}):a.apply(this,u)},i}}captureMethod(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){if(!o.isTracingEnabled())return a.apply(this,[...u]);let c=String(n),l=t?.subSegmentName?t.subSegmentName:`### ${c}`;return o.provider.captureAsyncFunc(l,async d=>{let m;try{m=await a.apply(this,[...u]),(t?.captureResponse??!0)&&o.addResponseAsMetadata(m,c)}catch(f){throw o.addErrorAsMetadata(f),f}finally{try{d?.close()}catch(f){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,f)}}return m})},i}}getRootXrayTraceId(){return et()}getSegment(){if(!this.isTracingEnabled())return new lA("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?Tu():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,s){this.isTracingEnabled()&&this.provider.putAnnotation(t,s)}putMetadata(t,s,n){this.isTracingEnabled()&&this.provider.putMetadata(t,s,n||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return p(this,ne).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return p(this,ne).awsExecutionEnv!==""}isLambdaSamCli(){return p(this,ne).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(p(this,ne).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let s=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(s!==void 0&&s.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}p(this,ne).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(p(this,ne).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:s,serviceName:n,captureHTTPsRequests:i,customConfigService:a}=t;return this.setCustomConfigService(a),this.setTracingEnabled(s),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let s=this.getCustomConfigService()?.getServiceName();if(s!==void 0&&this.isValidServiceName(s)){this.serviceName=s;return}if(p(this,ne).serviceName!==void 0&&this.isValidServiceName(p(this,ne).serviceName)){this.serviceName=p(this,ne).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let s=this.getCustomConfigService()?.getTracingEnabled();if(s!==void 0&&s.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(p(this,ne).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};ne=new WeakMap,mi=new WeakSet,Lm=function(){p(this,ne).awsExecutionEnv=Q({key:"AWS_EXECUTION_ENV",defaultValue:""}),p(this,ne).samLocal=Q({key:"AWS_SAM_LOCAL",defaultValue:""}),p(this,ne).captureError=Q({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),p(this,ne).captureHTTPsRequests=Q({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),p(this,ne).captureResponse=Q({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),p(this,ne).tracingEnabled=Q({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),p(this,ne).serviceName=zs()};var km=new Bs({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service"});function Nm(){return km}function ru(){try{return km.getSegment()}catch(r){console.warn("Failed to get X-Ray segment:",r);return}}function dA(r,e,t){try{let s=ru();if(!s)return;let n=s.addNewSubsegment(r);if(e)for(let[i,a]of Object.entries(e))a!==void 0&&n.addAnnotation(i,a);if(t)for(let[i,a]of Object.entries(t))n.addMetadata(i,a);return n}catch(s){console.warn("Failed to create X-Ray subsegment:",s);return}}function Om(r,e="success",t){if(r)try{r.addAnnotation("status",e),t&&(r.addError(t),r.addMetadata("error",{name:t.name,message:t.message,stack:t.stack})),r.close()}catch(s){console.warn("Failed to close X-Ray subsegment:",s)}}async function Ut(r,e,t,s){let n=dA(r,t,s);try{let i=await e();return Om(n,"success"),i}catch(i){throw Om(n,"error",i),i}}function we(r){try{let e=ru();if(!e)return;for(let[t,s]of Object.entries(r))s!==void 0&&e.addAnnotation(t,s)}catch(e){console.warn("Failed to add X-Ray annotations:",e)}}function qr(r,e){try{let t=ru();if(!t)return;if(e)t.addMetadata(e,r);else for(let[s,n]of Object.entries(r))t.addMetadata(s,n)}catch(t){console.warn("Failed to add X-Ray metadata:",t)}}async function Tt(r,e,t){return Ut(`DB:${r}`,e,{operation:"database"},{queryParams:t})}async function Mm(r,e,t,s){return Ut(`API:${r}:${e}`,t,{operation:"external_api",service:r},{callParams:s})}var qe=new Ve("database"),fA=new Pm.SecretsManager,su=class{constructor(e){this.pool=null;this.credentials=null;this.secretArn=e||process.env.DB_SECRET_ARN||""}async getCredentials(){if(this.credentials)return this.credentials;try{qe.info("Fetching database credentials from Secrets Manager",{secretArn:this.secretArn});let e=await fA.getSecretValue({SecretId:this.secretArn}).promise();if(!e.SecretString)throw new Error("Secret string is empty");let t=JSON.parse(e.SecretString);return this.credentials={username:t.username,password:t.password,host:t.host,port:t.port||5432,dbname:t.dbname||"fibonacci"},qe.info("Database credentials fetched successfully"),this.credentials}catch(e){throw qe.error("Failed to fetch database credentials",e),e}}async initializePool(){if(this.pool)return this.pool;let e=await this.getCredentials();return qe.info("Initializing database connection pool",{host:e.host,port:e.port,database:e.dbname}),this.pool=new od({user:e.username,password:e.password,host:e.host,port:e.port,database:e.dbname,max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4,ssl:{rejectUnauthorized:!1}}),this.pool.on("error",t=>{qe.error("Unexpected error on idle database client",t)}),qe.info("Database connection pool initialized"),this.pool}async getPool(){return await this.initializePool()}async close(){this.pool&&(qe.info("Closing database connection pool"),await this.pool.end(),this.pool=null,this.credentials=null)}},qm=new su;async function gi(r,e,t=3){let s=r.trim().split(" ")[0].toUpperCase();return Tt(s,async()=>{let n=await qm.getPool(),i=null;for(let a=1;a<=t;a++)try{qe.debug("Executing database query",{attempt:a,query:r.substring(0,100),paramCount:e?.length||0}),qr({query:r.substring(0,200),paramCount:e?.length||0,attempt:a},"database");let o=Date.now(),u=await n.query(r,e),c=Date.now()-o;return we({dbOperation:s,dbRowCount:u.rowCount||0,dbDuration:c}),qe.debug("Query executed successfully",{rowCount:u.rowCount,duration:c}),u}catch(o){if(i=o,qe.warn(`Query failed on attempt ${a}`,{attempt:a,maxRetries:t,error:i.message}),!hA(i)||a===t)throw we({dbOperation:s,dbError:i.name}),qe.error("Query failed permanently",i,{query:r.substring(0,100),attempts:a}),i;let c=Math.pow(2,a)*100;qe.debug(`Retrying query after ${c}ms`),await pA(c)}throw i||new Error("Query failed after retries")},{operation:s,paramCount:e?.length||0})}async function Dm(){return await(await qm.getPool()).connect()}function hA(r){let e=["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND","57P03","53300","08006","08003"],t=r.message.toLowerCase(),s=r.code;return e.includes(s)||t.includes("connection")||t.includes("timeout")||t.includes("econnrefused")}function pA(r){return new Promise(e=>setTimeout(e,r))}var W={};uu(W,{BRAND:()=>FA,DIRTY:()=>jt,EMPTY_PATH:()=>_A,INVALID:()=>E,NEVER:()=>TR,OK:()=>me,ParseStatus:()=>ce,Schema:()=>L,ZodAny:()=>Rt,ZodArray:()=>ht,ZodBigInt:()=>Vt,ZodBoolean:()=>Gt,ZodBranded:()=>Us,ZodCatch:()=>rr,ZodDate:()=>Ht,ZodDefault:()=>tr,ZodDiscriminatedUnion:()=>vi,ZodEffects:()=>Be,ZodEnum:()=>Jt,ZodError:()=>Te,ZodFirstPartyTypeKind:()=>w,ZodFunction:()=>Si,ZodIntersection:()=>Kt,ZodIssueCode:()=>g,ZodLazy:()=>Yt,ZodLiteral:()=>Zt,ZodMap:()=>jr,ZodNaN:()=>Vr,ZodNativeEnum:()=>er,ZodNever:()=>Xe,ZodNull:()=>Qt,ZodNullable:()=>Ze,ZodNumber:()=>Wt,ZodObject:()=>Ce,ZodOptional:()=>De,ZodParsedType:()=>_,ZodPipeline:()=>js,ZodPromise:()=>xt,ZodReadonly:()=>sr,ZodRecord:()=>bi,ZodSchema:()=>L,ZodSet:()=>Wr,ZodString:()=>At,ZodSymbol:()=>Fr,ZodTransformer:()=>Be,ZodTuple:()=>Ye,ZodType:()=>L,ZodUndefined:()=>Xt,ZodUnion:()=>zt,ZodUnknown:()=>ft,ZodVoid:()=>Ur,addIssueToContext:()=>y,any:()=>zA,array:()=>JA,bigint:()=>VA,boolean:()=>Qm,coerce:()=>wR,custom:()=>Gm,date:()=>GA,datetimeRegex:()=>Wm,defaultErrorMap:()=>lt,discriminatedUnion:()=>sR,effect:()=>mR,enum:()=>fR,function:()=>cR,getErrorMap:()=>Dr,getParsedType:()=>Ke,instanceof:()=>jA,intersection:()=>nR,isAborted:()=>yi,isAsync:()=>$r,isDirty:()=>_i,isValid:()=>Ct,late:()=>UA,lazy:()=>lR,literal:()=>dR,makeIssue:()=>Fs,map:()=>oR,nan:()=>WA,nativeEnum:()=>hR,never:()=>YA,null:()=>QA,nullable:()=>yR,number:()=>Xm,object:()=>eR,objectUtil:()=>nu,oboolean:()=>ER,onumber:()=>SR,optional:()=>gR,ostring:()=>bR,pipeline:()=>vR,preprocess:()=>_R,promise:()=>pR,quotelessJson:()=>mA,record:()=>aR,set:()=>uR,setErrorMap:()=>yA,strictObject:()=>tR,string:()=>Hm,symbol:()=>HA,transformer:()=>mR,tuple:()=>iR,undefined:()=>XA,union:()=>rR,unknown:()=>KA,util:()=>O,void:()=>ZA});var O;(function(r){r.assertEqual=n=>{};function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{let i={};for(let a of n)i[a]=a;return i},r.getValidEnumValues=n=>{let i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(let o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(let a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(O||(O={}));var nu;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(nu||(nu={}));var _=O.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ke=r=>{switch(typeof r){case"undefined":return _.undefined;case"string":return _.string;case"number":return Number.isNaN(r)?_.nan:_.number;case"boolean":return _.boolean;case"function":return _.function;case"bigint":return _.bigint;case"symbol":return _.symbol;case"object":return Array.isArray(r)?_.array:r===null?_.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?_.promise:typeof Map<"u"&&r instanceof Map?_.map:typeof Set<"u"&&r instanceof Set?_.set:typeof Date<"u"&&r instanceof Date?_.date:_.object;default:return _.unknown}};var g=O.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),mA=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),Te=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return n(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,O.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];t[i]=t[i]||[],t[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};Te.create=r=>new Te(r);var gA=(r,e)=>{let t;switch(r.code){case g.invalid_type:r.received===_.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case g.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,O.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:t=`Unrecognized key(s) in object: ${O.joinValues(r.keys,", ")}`;break;case g.invalid_union:t="Invalid input";break;case g.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${O.joinValues(r.options)}`;break;case g.invalid_enum_value:t=`Invalid enum value. Expected ${O.joinValues(r.options)}, received '${r.received}'`;break;case g.invalid_arguments:t="Invalid function arguments";break;case g.invalid_return_type:t="Invalid function return type";break;case g.invalid_date:t="Invalid date";break;case g.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:O.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case g.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case g.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case g.custom:t="Invalid input";break;case g.invalid_intersection_types:t="Intersection results could not be merged";break;case g.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case g.not_finite:t="Number must be finite";break;default:t=e.defaultError,O.assertNever(r)}return{message:t}},lt=gA;var $m=lt;function yA(r){$m=r}function Dr(){return $m}var Fs=r=>{let{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="",u=s.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},_A=[];function y(r,e){let t=Dr(),s=Fs({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===lt?void 0:lt].filter(n=>!!n)});r.common.issues.push(s)}var ce=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let n of t){if(n.status==="aborted")return E;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let n of t){let i=await n.key,a=await n.value;s.push({key:i,value:a})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let n of t){let{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return E;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}},E=Object.freeze({status:"aborted"}),jt=r=>({status:"dirty",value:r}),me=r=>({status:"valid",value:r}),yi=r=>r.status==="aborted",_i=r=>r.status==="dirty",Ct=r=>r.status==="valid",$r=r=>typeof Promise<"u"&&r instanceof Promise;var S;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(S||(S={}));var $e=class{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Bm=(r,e)=>{if(Ct(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new Te(r.common.issues);return this._error=t,this._error}}};function x(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??s??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:n}}var L=class{get description(){return this._def.description}_getType(e){return Ke(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Ke(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ce,ctx:{common:e.parent.common,data:e.data,parsedType:Ke(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if($r(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)},n=this._parseSync({data:e,path:s.path,parent:s});return Bm(s,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return Ct(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>Ct(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Ke(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await($r(n)?n:Promise.resolve(n));return Bm(s,i)}refine(e,t){let s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{let a=e(n),o=()=>i.addIssue({code:g.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new Be({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return De.create(this,this._def)}nullable(){return Ze.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ht.create(this)}promise(){return xt.create(this,this._def)}or(e){return zt.create([this,e],this._def)}and(e){return Kt.create(this,e,this._def)}transform(e){return new Be({...x(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new tr({...x(this._def),innerType:this,defaultValue:t,typeName:w.ZodDefault})}brand(){return new Us({typeName:w.ZodBranded,type:this,...x(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new rr({...x(this._def),innerType:this,catchValue:t,typeName:w.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return js.create(this,e)}readonly(){return sr.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},vA=/^c[^\s-]{8,}$/i,bA=/^[0-9a-z]+$/,SA=/^[0-9A-HJKMNP-TV-Z]{26}$/i,EA=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,wA=/^[a-z0-9_-]{21}$/i,TA=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,CA=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,AA=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,RA="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",iu,xA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,IA=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,LA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,OA=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,kA=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,NA=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Um="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",MA=new RegExp(`^${Um}$`);function jm(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function PA(r){return new RegExp(`^${jm(r)}$`)}function Wm(r){let e=`${Um}T${jm(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function qA(r,e){return!!((e==="v4"||!e)&&xA.test(r)||(e==="v6"||!e)&&LA.test(r))}function DA(r,e){if(!TA.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function $A(r,e){return!!((e==="v4"||!e)&&IA.test(r)||(e==="v6"||!e)&&OA.test(r))}var At=class r extends L{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==_.string){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.string,received:i.parsedType}),E}let s=new ce,n;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?y(n,{code:g.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&y(n,{code:g.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")AA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"email",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")iu||(iu=new RegExp(RA,"u")),iu.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"emoji",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")EA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"uuid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")wA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"nanoid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")vA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cuid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")bA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cuid2",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")SA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"ulid",code:g.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),y(n,{validation:"url",code:g.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"regex",code:g.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Wm(i).test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?MA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?PA(i).test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:g.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?CA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"duration",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?qA(e.data,i.version)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"ip",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?DA(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"jwt",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?$A(e.data,i.version)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"cidr",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?kA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"base64",code:g.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?NA.test(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{validation:"base64url",code:g.invalid_string,message:i.message}),s.dirty()):O.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:g.invalid_string,...S.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...S.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...S.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...S.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...S.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...S.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};At.create=r=>new At({checks:[],typeName:w.ZodString,coerce:r?.coerce??!1,...x(r)});function BA(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=Number.parseInt(r.toFixed(n).replace(".","")),a=Number.parseInt(e.toFixed(n).replace(".",""));return i%a/10**n}var Wt=class r extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==_.number){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.number,received:i.parsedType}),E}let s,n=new ce;for(let i of this._def.checks)i.kind==="int"?O.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:g.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?BA(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_finite,message:i.message}),n.dirty()):O.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&O.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Wt.create=r=>new Wt({checks:[],typeName:w.ZodNumber,coerce:r?.coerce||!1,...x(r)});var Vt=class r extends L{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==_.bigint)return this._getInvalidInput(e);let s,n=new ce;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),y(s,{code:g.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):O.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return y(t,{code:g.invalid_type,expected:_.bigint,received:t.parsedType}),E}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Vt.create=r=>new Vt({checks:[],typeName:w.ZodBigInt,coerce:r?.coerce??!1,...x(r)});var Gt=class extends L{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==_.boolean){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.boolean,received:s.parsedType}),E}return me(e.data)}};Gt.create=r=>new Gt({typeName:w.ZodBoolean,coerce:r?.coerce||!1,...x(r)});var Ht=class r extends L{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==_.date){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_type,expected:_.date,received:i.parsedType}),E}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return y(i,{code:g.invalid_date}),E}let s=new ce,n;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),y(n,{code:g.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):O.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Ht.create=r=>new Ht({checks:[],coerce:r?.coerce||!1,typeName:w.ZodDate,...x(r)});var Fr=class extends L{_parse(e){if(this._getType(e)!==_.symbol){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.symbol,received:s.parsedType}),E}return me(e.data)}};Fr.create=r=>new Fr({typeName:w.ZodSymbol,...x(r)});var Xt=class extends L{_parse(e){if(this._getType(e)!==_.undefined){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.undefined,received:s.parsedType}),E}return me(e.data)}};Xt.create=r=>new Xt({typeName:w.ZodUndefined,...x(r)});var Qt=class extends L{_parse(e){if(this._getType(e)!==_.null){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.null,received:s.parsedType}),E}return me(e.data)}};Qt.create=r=>new Qt({typeName:w.ZodNull,...x(r)});var Rt=class extends L{constructor(){super(...arguments),this._any=!0}_parse(e){return me(e.data)}};Rt.create=r=>new Rt({typeName:w.ZodAny,...x(r)});var ft=class extends L{constructor(){super(...arguments),this._unknown=!0}_parse(e){return me(e.data)}};ft.create=r=>new ft({typeName:w.ZodUnknown,...x(r)});var Xe=class extends L{_parse(e){let t=this._getOrReturnCtx(e);return y(t,{code:g.invalid_type,expected:_.never,received:t.parsedType}),E}};Xe.create=r=>new Xe({typeName:w.ZodNever,...x(r)});var Ur=class extends L{_parse(e){if(this._getType(e)!==_.undefined){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.void,received:s.parsedType}),E}return me(e.data)}};Ur.create=r=>new Ur({typeName:w.ZodVoid,...x(r)});var ht=class r extends L{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==_.array)return y(t,{code:g.invalid_type,expected:_.array,received:t.parsedType}),E;if(n.exactLength!==null){let a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(y(t,{code:a?g.too_big:g.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(y(t,{code:g.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(y(t,{code:g.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new $e(t,a,t.path,o)))).then(a=>ce.mergeArray(s,a));let i=[...t.data].map((a,o)=>n.type._parseSync(new $e(t,a,t.path,o)));return ce.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}};ht.create=(r,e)=>new ht({type:r,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...x(e)});function Br(r){if(r instanceof Ce){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=De.create(Br(s))}return new Ce({...r._def,shape:()=>e})}else return r instanceof ht?new ht({...r._def,type:Br(r.element)}):r instanceof De?De.create(Br(r.unwrap())):r instanceof Ze?Ze.create(Br(r.unwrap())):r instanceof Ye?Ye.create(r.items.map(e=>Br(e))):r}var Ce=class r extends L{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=O.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==_.object){let c=this._getOrReturnCtx(e);return y(c,{code:g.invalid_type,expected:_.object,received:c.parsedType}),E}let{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Xe&&this._def.unknownKeys==="strip"))for(let c in n.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=n.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new $e(n,d,n.path,c)),alwaysSet:c in n.data})}if(this._def.catchall instanceof Xe){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(c==="strict")o.length>0&&(y(n,{code:g.unrecognized_keys,keys:o}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=n.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new $e(n,d,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key,m=await l.value;c.push({key:d,value:m,alwaysSet:l.alwaysSet})}return c}).then(c=>ce.mergeObjectSync(s,c)):ce.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let n=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:S.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:w.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of O.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of O.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return Br(this)}partial(e){let t={};for(let s of O.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of O.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof De;)i=i._def.innerType;t[s]=i}return new r({...this._def,shape:()=>t})}keyof(){return Vm(O.objectKeys(this.shape))}};Ce.create=(r,e)=>new Ce({shape:()=>r,unknownKeys:"strip",catchall:Xe.create(),typeName:w.ZodObject,...x(e)});Ce.strictCreate=(r,e)=>new Ce({shape:()=>r,unknownKeys:"strict",catchall:Xe.create(),typeName:w.ZodObject,...x(e)});Ce.lazycreate=(r,e)=>new Ce({shape:r,unknownKeys:"strip",catchall:Xe.create(),typeName:w.ZodObject,...x(e)});var zt=class extends L{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new Te(o.ctx.common.issues));return y(t,{code:g.invalid_union,unionErrors:a}),E}if(t.common.async)return Promise.all(s.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i,a=[];for(let u of s){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new Te(u));return y(t,{code:g.invalid_union,unionErrors:o}),E}}get options(){return this._def.options}};zt.create=(r,e)=>new zt({options:r,typeName:w.ZodUnion,...x(e)});var dt=r=>r instanceof Yt?dt(r.schema):r instanceof Be?dt(r.innerType()):r instanceof Zt?[r.value]:r instanceof Jt?r.options:r instanceof er?O.objectValues(r.enum):r instanceof tr?dt(r._def.innerType):r instanceof Xt?[void 0]:r instanceof Qt?[null]:r instanceof De?[void 0,...dt(r.unwrap())]:r instanceof Ze?[null,...dt(r.unwrap())]:r instanceof Us||r instanceof sr?dt(r.unwrap()):r instanceof rr?dt(r._def.innerType):[],vi=class r extends L{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.object)return y(t,{code:g.invalid_type,expected:_.object,received:t.parsedType}),E;let s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(y(t,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),E)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let n=new Map;for(let i of t){let a=dt(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new r({typeName:w.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...x(s)})}};function au(r,e){let t=Ke(r),s=Ke(e);if(r===e)return{valid:!0,data:r};if(t===_.object&&s===_.object){let n=O.objectKeys(e),i=O.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=au(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===_.array&&s===_.array){if(r.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=au(a,o);if(!u.valid)return{valid:!1};n.push(u.data)}return{valid:!0,data:n}}else return t===_.date&&s===_.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var Kt=class extends L{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(yi(i)||yi(a))return E;let o=au(i.value,a.value);return o.valid?((_i(i)||_i(a))&&t.dirty(),{status:t.value,value:o.data}):(y(s,{code:g.invalid_intersection_types}),E)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};Kt.create=(r,e,t)=>new Kt({left:r,right:e,typeName:w.ZodIntersection,...x(t)});var Ye=class r extends L{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.array)return y(s,{code:g.invalid_type,expected:_.array,received:s.parsedType}),E;if(s.data.length<this._def.items.length)return y(s,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),E;!this._def.rest&&s.data.length>this._def.items.length&&(y(s,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new $e(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>ce.mergeArray(t,a)):ce.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Ye.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ye({items:r,typeName:w.ZodTuple,rest:null,...x(e)})};var bi=class r extends L{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.object)return y(s,{code:g.invalid_type,expected:_.object,received:s.parsedType}),E;let n=[],i=this._def.keyType,a=this._def.valueType;for(let o in s.data)n.push({key:i._parse(new $e(s,o,s.path,o)),value:a._parse(new $e(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?ce.mergeObjectAsync(t,n):ce.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof L?new r({keyType:e,valueType:t,typeName:w.ZodRecord,...x(s)}):new r({keyType:At.create(),valueType:e,typeName:w.ZodRecord,...x(t)})}},jr=class extends L{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.map)return y(s,{code:g.invalid_type,expected:_.map,received:s.parsedType}),E;let n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,u],c)=>({key:n._parse(new $e(s,o,s.path,[c,"key"])),value:i._parse(new $e(s,u,s.path,[c,"value"]))}));if(s.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return E;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return E;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};jr.create=(r,e,t)=>new jr({valueType:e,keyType:r,typeName:w.ZodMap,...x(t)});var Wr=class r extends L{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==_.set)return y(s,{code:g.invalid_type,expected:_.set,received:s.parsedType}),E;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(y(s,{code:g.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(y(s,{code:g.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return E;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...s.data.values()].map((u,c)=>i._parse(new $e(s,u,s.path,c)));return s.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Wr.create=(r,e)=>new Wr({valueType:r,minSize:null,maxSize:null,typeName:w.ZodSet,...x(e)});var Si=class r extends L{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.function)return y(t,{code:g.invalid_type,expected:_.function,received:t.parsedType}),E;function s(o,u){return Fs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Dr(),lt].filter(c=>!!c),issueData:{code:g.invalid_arguments,argumentsError:u}})}function n(o,u){return Fs({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Dr(),lt].filter(c=>!!c),issueData:{code:g.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof xt){let o=this;return me(async function(...u){let c=new Te([]),l=await o._def.args.parseAsync(u,i).catch(f=>{throw c.addIssue(s(u,f)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(n(d,f)),c})})}else{let o=this;return me(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new Te([s(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new Te([n(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Ye.create(e).rest(ft.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||Ye.create([]).rest(ft.create()),returns:t||ft.create(),typeName:w.ZodFunction,...x(s)})}},Yt=class extends L{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Yt.create=(r,e)=>new Yt({getter:r,typeName:w.ZodLazy,...x(e)});var Zt=class extends L{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return y(t,{received:t.data,code:g.invalid_literal,expected:this._def.value}),E}return{status:"valid",value:e.data}}get value(){return this._def.value}};Zt.create=(r,e)=>new Zt({value:r,typeName:w.ZodLiteral,...x(e)});function Vm(r,e){return new Jt({values:r,typeName:w.ZodEnum,...x(e)})}var Jt=class r extends L{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return y(t,{expected:O.joinValues(s),received:t.parsedType,code:g.invalid_type}),E}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return y(t,{received:t.data,code:g.invalid_enum_value,options:s}),E}return me(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};Jt.create=Vm;var er=class extends L{_parse(e){let t=O.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==_.string&&s.parsedType!==_.number){let n=O.objectValues(t);return y(s,{expected:O.joinValues(n),received:s.parsedType,code:g.invalid_type}),E}if(this._cache||(this._cache=new Set(O.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=O.objectValues(t);return y(s,{received:s.data,code:g.invalid_enum_value,options:n}),E}return me(e.data)}get enum(){return this._def.values}};er.create=(r,e)=>new er({values:r,typeName:w.ZodNativeEnum,...x(e)});var xt=class extends L{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==_.promise&&t.common.async===!1)return y(t,{code:g.invalid_type,expected:_.promise,received:t.parsedType}),E;let s=t.parsedType===_.promise?t.data:Promise.resolve(t.data);return me(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};xt.create=(r,e)=>new xt({type:r,typeName:w.ZodPromise,...x(e)});var Be=class extends L{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{y(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return E;let u=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return u.status==="aborted"?E:u.status==="dirty"?jt(u.value):t.value==="dirty"?jt(u.value):u});{if(t.value==="aborted")return E;let o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?E:o.status==="dirty"?jt(o.value):t.value==="dirty"?jt(o.value):o}}if(n.type==="refinement"){let a=o=>{let u=n.refinement(o,i);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?E:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?E:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ct(a))return E;let o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>Ct(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):E);O.assertNever(n)}};Be.create=(r,e,t)=>new Be({schema:r,typeName:w.ZodEffects,effect:e,...x(t)});Be.createWithPreprocess=(r,e,t)=>new Be({schema:e,effect:{type:"preprocess",transform:r},typeName:w.ZodEffects,...x(t)});var De=class extends L{_parse(e){return this._getType(e)===_.undefined?me(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};De.create=(r,e)=>new De({innerType:r,typeName:w.ZodOptional,...x(e)});var Ze=class extends L{_parse(e){return this._getType(e)===_.null?me(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Ze.create=(r,e)=>new Ze({innerType:r,typeName:w.ZodNullable,...x(e)});var tr=class extends L{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===_.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};tr.create=(r,e)=>new tr({innerType:r,typeName:w.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...x(e)});var rr=class extends L{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return $r(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Te(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new Te(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};rr.create=(r,e)=>new rr({innerType:r,typeName:w.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...x(e)});var Vr=class extends L{_parse(e){if(this._getType(e)!==_.nan){let s=this._getOrReturnCtx(e);return y(s,{code:g.invalid_type,expected:_.nan,received:s.parsedType}),E}return{status:"valid",value:e.data}}};Vr.create=r=>new Vr({typeName:w.ZodNaN,...x(r)});var FA=Symbol("zod_brand"),Us=class extends L{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},js=class r extends L{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?E:i.status==="dirty"?(t.dirty(),jt(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?E:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:w.ZodPipeline})}},sr=class extends L{_parse(e){let t=this._def.innerType._parse(e),s=n=>(Ct(n)&&(n.value=Object.freeze(n.value)),n);return $r(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}};sr.create=(r,e)=>new sr({innerType:r,typeName:w.ZodReadonly,...x(e)});function Fm(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Gm(r,e={},t){return r?Rt.create().superRefine((s,n)=>{let i=r(s);if(i instanceof Promise)return i.then(a=>{if(!a){let o=Fm(e,s),u=o.fatal??t??!0;n.addIssue({code:"custom",...o,fatal:u})}});if(!i){let a=Fm(e,s),o=a.fatal??t??!0;n.addIssue({code:"custom",...a,fatal:o})}}):Rt.create()}var UA={object:Ce.lazycreate},w;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(w||(w={}));var jA=(r,e={message:`Input not instance of ${r.name}`})=>Gm(t=>t instanceof r,e),Hm=At.create,Xm=Wt.create,WA=Vr.create,VA=Vt.create,Qm=Gt.create,GA=Ht.create,HA=Fr.create,XA=Xt.create,QA=Qt.create,zA=Rt.create,KA=ft.create,YA=Xe.create,ZA=Ur.create,JA=ht.create,eR=Ce.create,tR=Ce.strictCreate,rR=zt.create,sR=vi.create,nR=Kt.create,iR=Ye.create,aR=bi.create,oR=jr.create,uR=Wr.create,cR=Si.create,lR=Yt.create,dR=Zt.create,fR=Jt.create,hR=er.create,pR=xt.create,mR=Be.create,gR=De.create,yR=Ze.create,_R=Be.createWithPreprocess,vR=js.create,bR=()=>Hm().optional(),SR=()=>Xm().optional(),ER=()=>Qm().optional(),wR={string:r=>At.create({...r,coerce:!0}),number:r=>Wt.create({...r,coerce:!0}),boolean:r=>Gt.create({...r,coerce:!0}),bigint:r=>Vt.create({...r,coerce:!0}),date:r=>Ht.create({...r,coerce:!0})};var TR=E;var CR=/^\+[1-9]\d{1,14}$/,AR=W.string().regex(CR,"Phone must be in E.164 format (e.g., +5511999999999)").min(8,"Phone must be at least 8 characters").max(16,"Phone must be at most 16 characters"),RR=W.string().email("Invalid email format").min(5,"Email must be at least 5 characters").max(255,"Email must be at most 255 characters").toLowerCase().trim();function It(r){return r.replace(/<[^>]*>/g,"").replace(/[<>'"]/g,"").trim()}var zm=W.object({name:W.string().min(2,"Name must be at least 2 characters").max(100,"Name must be at most 100 characters").transform(It),email:RR,phone:AR.optional(),company:W.string().min(2,"Company must be at least 2 characters").max(100,"Company must be at most 100 characters").transform(It).optional(),message:W.string().max(1e3,"Message must be at most 1000 characters").transform(It).optional(),utmSource:W.string().max(100,"UTM source must be at most 100 characters").transform(It).optional(),utmMedium:W.string().max(100,"UTM medium must be at most 100 characters").transform(It).optional(),utmCampaign:W.string().max(100,"UTM campaign must be at most 100 characters").transform(It).optional()}).refine(r=>r.email||r.phone,{message:"Either email or phone must be provided",path:["email"]}),q1=W.object({page:W.string().optional().default("1").transform(r=>parseInt(r,10)).refine(r=>r>0,"Page must be greater than 0").refine(r=>r<=1e3,"Page must be at most 1000"),limit:W.string().optional().default("20").transform(r=>parseInt(r,10)).refine(r=>r>0,"Limit must be greater than 0").refine(r=>r<=100,"Limit must be at most 100"),status:W.enum(["novo","enriquecido","contatado","respondeu","interessado","agendado","convertido","descartado","descadastrado"]).optional(),source:W.string().max(100,"Source must be at most 100 characters").transform(It).optional(),startDate:W.string().datetime({message:"Start date must be in ISO 8601 format"}).optional(),endDate:W.string().datetime({message:"End date must be in ISO 8601 format"}).optional(),search:W.string().max(255,"Search query must be at most 255 characters").transform(It).optional(),sortBy:W.enum(["created_at","updated_at","name","company","priority_score"]).optional().default("created_at"),sortOrder:W.enum(["asc","desc"]).optional().default("desc")}).refine(r=>r.startDate&&r.endDate?new Date(r.startDate)<=new Date(r.endDate):!0,{message:"Start date must be before or equal to end date",path:["startDate"]}),D1=W.object({id:W.string().uuid("Lead ID must be a valid UUID")});function Km(r,e){let t=r.safeParse(e);return t.success?{success:!0,data:t.data}:{success:!1,errors:t.error}}function xR(r){return r.errors.map(e=>`${e.path.join(".")}: ${e.message}`)}function Ym(r){return{statusCode:400,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"},body:JSON.stringify({error:"Validation Error",message:"Invalid input data",details:xR(r)})}}var IR=/^(\d{1,3}\.){3}\d{1,3}$/,LR=/^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/,$1=W.string().refine(r=>IR.test(r)||LR.test(r),"Invalid IP address format");function Zm(r){let e=r.headers?.["x-forwarded-for"]||r.headers?.["X-Forwarded-For"];return e?e.split(",")[0].trim():r.requestContext?.identity?.sourceIp||r.requestContext?.http?.sourceIp||"0.0.0.0"}function Jm(r){return r.headers?.["user-agent"]||r.headers?.["User-Agent"]||"Unknown"}function eg(r){return r.headers?.referer||r.headers?.Referer}var Ei=new Ve("rate-limiter"),tg=10,rg=1,Ws=class extends Error{constructor(t,s){super(t);this.result=s;this.name="RateLimitError"}};async function OR(r){try{Ei.info("Checking rate limit",{ipAddress:r});let e=await gi("SELECT * FROM check_rate_limit($1::INET)",[r]);if(e.rows.length===0)return{allowed:!0,currentCount:0,limitCount:tg,windowResetAt:new Date(Date.now()+rg*60*60*1e3)};let t=e.rows[0],s=t.is_allowed===!0,n=parseInt(t.current_count,10),i=parseInt(t.limit_count,10),a=new Date(t.window_reset_at);return Ei.info("Rate limit check result",{ipAddress:r,allowed:s,currentCount:n,limitCount:i,windowResetAt:a}),{allowed:s,currentCount:n,limitCount:i,windowResetAt:a,message:s?void 0:`Rate limit exceeded. Maximum ${i} submissions per hour. Try again after ${a.toISOString()}`}}catch(e){return Ei.error("Error checking rate limit",e,{ipAddress:r}),{allowed:!0,currentCount:0,limitCount:tg,windowResetAt:new Date(Date.now()+rg*60*60*1e3),message:"Rate limit check failed, allowing submission"}}}async function sg(r){let e=await OR(r);if(!e.allowed)throw Ei.warn("Rate limit exceeded",{ipAddress:r,currentCount:e.currentCount,limitCount:e.limitCount}),new Ws(e.message||"Rate limit exceeded",e)}function ng(r){return{statusCode:429,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Retry-After":Math.ceil((r.result.windowResetAt.getTime()-Date.now())/1e3).toString(),"X-RateLimit-Limit":r.result.limitCount.toString(),"X-RateLimit-Remaining":Math.max(0,r.result.limitCount-r.result.currentCount).toString(),"X-RateLimit-Reset":r.result.windowResetAt.toISOString()},body:JSON.stringify({error:"Rate Limit Exceeded",message:r.message,details:{currentCount:r.result.currentCount,limitCount:r.result.limitCount,windowResetAt:r.result.windowResetAt.toISOString(),retryAfterSeconds:Math.ceil((r.result.windowResetAt.getTime()-Date.now())/1e3)}})}}var ag=Fe(require("https")),og=Fe(require("http")),ug=require("url");var pt=new Ve("webhook-sender"),kR=5e3,Vs=3,NR=[1e3,2e3,4e3];async function MR(r,e,t){return new Promise((s,n)=>{let i=new ug.URL(r),a=i.protocol==="https:",o=a?ag.default:og.default,u=JSON.stringify(e),c={hostname:i.hostname,port:i.port||(a?443:80),path:i.pathname+i.search,method:"POST",headers:{"Content-Type":"application/json","Content-Length":Buffer.byteLength(u),"User-Agent":"Nigredo-Webhook-Sender/1.0"},timeout:t},l=o.request(c,d=>{let m="";d.on("data",f=>{m+=f}),d.on("end",()=>{s({statusCode:d.statusCode||0,body:m})})});l.on("error",d=>{n(d)}),l.on("timeout",()=>{l.destroy(),n(new Error("Request timeout"))}),l.write(u),l.end()})}async function ig(r,e,t,s){try{await gi(`INSERT INTO nigredo_leads.webhook_logs 
       (lead_id, webhook_url, payload, status_code, response_body, 
        attempt_number, success, error_message)
       VALUES ($1, $2, $3, $4, $5, $6, $7, $8)`,[r,e,JSON.stringify(t),s.statusCode||null,s.responseBody||null,s.attemptNumber,s.success,s.error||null]),pt.info("Webhook attempt logged",{leadId:r,attemptNumber:s.attemptNumber,success:s.success})}catch(n){pt.error("Error logging webhook attempt",n,{leadId:r})}}async function cg(r,e,t){pt.info("Sending webhook",{webhookUrl:r,leadId:t,eventType:e.event_type});let s,n,i;for(let o=1;o<=Vs;o++){try{pt.info("Webhook attempt",{leadId:t,attempt:o,maxRetries:Vs});let c=await MR(r,e,kR);if(n=c.statusCode,i=c.body,c.statusCode>=200&&c.statusCode<300){pt.info("Webhook sent successfully",{leadId:t,attempt:o,statusCode:c.statusCode});let l={success:!0,statusCode:c.statusCode,responseBody:c.body,attemptNumber:o};return await ig(t,r,e,l),l}s=`HTTP ${c.statusCode}: ${c.body}`,pt.warn("Webhook attempt failed with non-2xx status",{leadId:t,attempt:o,statusCode:c.statusCode,responseBody:c.body})}catch(c){s=c.message||"Unknown error",pt.warn("Webhook attempt failed with exception",{leadId:t,attempt:o,error:s})}if(await ig(t,r,e,{success:!1,statusCode:n,responseBody:i,error:s,attemptNumber:o}),o<Vs){let c=NR[o-1]||1e3;pt.info("Waiting before retry",{leadId:t,delayMs:c}),await new Promise(l=>setTimeout(l,c))}}let a=new Error(s||"All retry attempts failed");return pt.error("Webhook failed after all retries",a,{leadId:t,maxRetries:Vs}),{success:!1,statusCode:n,responseBody:i,error:s||"All retry attempts failed",attemptNumber:Vs}}function lg(r){return{event_type:"lead.created",timestamp:new Date().toISOString(),lead:{id:r.id,name:r.name,email:r.email,phone:r.phone,company:r.company,message:r.message,utmSource:r.utm_source,utmMedium:r.utm_medium,utmCampaign:r.utm_campaign,ipAddress:r.ip_address,userAgent:r.user_agent,createdAt:r.created_at.toISOString()}}}var ek=Nm(),Z=new Xr({namespace:"Nigredo/Prospecting",serviceName:"nigredo-create-lead"}),J=new Ve("nigredo-create-lead"),wi=process.env.FIBONACCI_WEBHOOK_URL||"",PR=process.env.DEFAULT_TENANT_ID||"00000000-0000-0000-0000-000000000000",qR=async(r,e)=>{let t=gr();J.updateContext({traceId:t,requestId:e.awsRequestId,functionName:e.functionName}),we({correlationId:t,service:"nigredo-prospecting",operation:"create-lead"});let s=Date.now();try{J.info("Processing lead creation request",{correlationId:t,requestId:e.awsRequestId,functionName:e.functionName});let n=await Ut("ExtractRequestMetadata",()=>{let f=Zm(r),I=Jm(r),C=eg(r);return J.info("Request metadata extracted",{correlationId:t,ipAddress:f,userAgent:I,referer:C}),qr({ipAddress:f,userAgent:I,referer:C},"request"),{ip:f,ua:I,ref:C}},{operation:"extract_metadata"}),i=n.ua,a=n.ref,o=n.ip;we({ipAddress:o,hasReferer:!!a});try{await Ut("CheckRateLimit",async()=>{await sg(o),J.info("Rate limit check passed",{correlationId:t,ipAddress:o})},{operation:"rate_limit_check",ipAddress:o}),Z.addMetric("RateLimitCheckPassed",se.Count,1)}catch(f){if(f instanceof Ws)return J.warn("Rate limit exceeded",{correlationId:t,ipAddress:o,currentCount:f.result.currentCount,limitCount:f.result.limitCount}),we({rateLimitExceeded:!0,status:"error"}),Z.addMetric("RateLimitExceeded",se.Count,1),Z.publishStoredMetrics(),ng(f);throw f}if(!r.body)return J.warn("Missing request body",{correlationId:t}),we({validationFailed:!0,status:"error"}),Z.addMetric("ValidationError",se.Count,1),Z.publishStoredMetrics(),{statusCode:400,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","X-Correlation-Id":t},body:JSON.stringify({error:"Bad Request",message:"Request body is required"})};let u;try{u=JSON.parse(r.body)}catch(f){return J.warn("Invalid JSON in request body",{correlationId:t,error:f}),we({validationFailed:!0,status:"error"}),Z.addMetric("ValidationError",se.Count,1),Z.publishStoredMetrics(),{statusCode:400,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","X-Correlation-Id":t},body:JSON.stringify({error:"Bad Request",message:"Invalid JSON in request body"})}}let c=await Ut("ValidateInput",()=>{let f=Km(zm,u);return f.success?J.info("Input validated successfully",{correlationId:t}):(J.warn("Input validation failed",{correlationId:t,errors:f.errors.errors}),we({validationFailed:!0}),qr({validationErrors:f.errors.errors},"validation")),f},{operation:"input_validation"});if(!c.success)return Z.addMetric("ValidationError",se.Count,1),Z.publishStoredMetrics(),Ym(c.errors);let l=c.data,d=gr(),m=new Date;J.updateContext({leadId:d}),we({leadId:d,hasUtmSource:!!l.utmSource});try{let f=await Ut("DatabaseTransaction",async()=>{let C=await Dm();try{await Tt("BeginTransaction",()=>C.query("BEGIN"));let re=`
              INSERT INTO nigredo_leads.leads (
                id, tenant_id, name, email, phone, company, message,
                utm_source, utm_medium, utm_campaign,
                ip_address, user_agent, status, created_at, updated_at
              ) VALUES (
                $1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15
              )
              RETURNING *
            `,ee=(await Tt("InsertLead",()=>C.query(re,[d,PR,l.name,l.email,l.phone||null,l.company||null,l.message||null,l.utmSource||null,l.utmMedium||null,l.utmCampaign||null,o,i,"novo",m,m]),{leadId:d,email:l.email})).rows[0];J.info("Lead inserted into database",{correlationId:t,leadId:d,email:l.email});let le=`
              INSERT INTO nigredo_leads.form_submissions (
                lead_id, ip_address, user_agent, referer, source, form_type, submitted_at
              ) VALUES (
                $1, $2::INET, $3, $4, $5, $6, $7
              )
            `;return await Tt("InsertFormSubmission",()=>C.query(le,[d,o,i,a||null,"landing_page","contact",m]),{leadId:d}),J.info("Form submission recorded",{correlationId:t,leadId:d}),await Tt("IncrementRateLimit",()=>C.query("SELECT increment_rate_limit($1::INET)",[o]),{ipAddress:o}),J.info("Rate limit incremented",{correlationId:t,ipAddress:o}),await Tt("CommitTransaction",()=>C.query("COMMIT")),J.info("Database transaction committed",{correlationId:t,leadId:d}),ee}catch(re){throw await C.query("ROLLBACK"),re}finally{C.release()}},{operation:"database",leadId:d},{leadData:{email:l.email,hasPhone:!!l.phone,hasCompany:!!l.company}});if(Z.addMetric("LeadCreated",se.Count,1),l.utmSource&&(Z.addDimension("source",l.utmSource),Z.addMetric("LeadCreatedBySource",se.Count,1)),wi){let C=lg({id:f.id,name:f.name,email:f.email,phone:f.phone,company:f.company,message:f.message,utm_source:f.utm_source,utm_medium:f.utm_medium,utm_campaign:f.utm_campaign,ip_address:f.ip_address,user_agent:f.user_agent,created_at:f.created_at});J.info("Sending webhook to Fibonacci",{correlationId:t,leadId:d,webhookUrl:wi}),Mm("Fibonacci","sendLeadWebhook",()=>cg(wi,C,d),{leadId:d,webhookUrl:wi}).then(re=>{re.success?(J.info("Webhook sent successfully",{correlationId:t,leadId:d,attemptNumber:re.attemptNumber}),Z.addMetric("WebhookSuccess",se.Count,1)):(J.warn("Webhook failed after retries",{correlationId:t,leadId:d,error:re.error,attemptNumber:re.attemptNumber}),Z.addMetric("WebhookFailure",se.Count,1))}).catch(re=>{J.error("Webhook error",re,{correlationId:t,leadId:d}),Z.addMetric("WebhookError",se.Count,1)})}else J.warn("Webhook URL not configured, skipping webhook",{correlationId:t,leadId:d}),Z.addMetric("WebhookSkipped",se.Count,1);qr({lead:{id:d,email:l.email,source:l.utmSource,hasPhone:!!l.phone,hasCompany:!!l.company}},"result"),we({status:"success"});let I=Date.now()-s;return Z.addMetric("LeadCreationDuration",se.Milliseconds,I),J.info("Lead created successfully",{correlationId:t,leadId:d,email:l.email,durationMs:I}),Z.publishStoredMetrics(),{statusCode:201,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({success:!0,message:"Lead created successfully",data:{id:d,createdAt:m.toISOString()}})}}catch(f){return J.error("Error creating lead",f,{correlationId:t,leadId:d}),we({error:!0,status:"error"}),Z.addMetric("LeadCreationError",se.Count,1),Z.publishStoredMetrics(),{statusCode:500,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Internal Server Error",message:"Failed to create lead. Please try again later.",requestId:t})}}}catch(n){return J.error("Unexpected error in handler",n,{correlationId:t}),we({unexpectedError:!0,status:"error"}),Z.addMetric("UnexpectedError",se.Count,1),Z.publishStoredMetrics(),{statusCode:500,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Internal Server Error",message:"An unexpected error occurred",requestId:t})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
