"use strict";var cg=Object.create;var jt=Object.defineProperty;var lg=Object.getOwnPropertyDescriptor;var dg=Object.getOwnPropertyNames;var fg=Object.getPrototypeOf,hg=Object.prototype.hasOwnProperty;var ua=r=>{throw TypeError(r)};var pg=(r,e,t)=>e in r?jt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var j=(r,e)=>()=>(r&&(e=r(r=0)),e);var f=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ca=(r,e)=>{for(var t in e)jt(r,t,{get:e[t],enumerable:!0})},la=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of dg(e))!hg.call(r,s)&&s!==t&&jt(r,s,{get:()=>e[s],enumerable:!(n=lg(e,s))||n.enumerable});return r};var _e=(r,e,t)=>(t=r!=null?cg(fg(r)):{},la(e||!r||!r.__esModule?jt(t,"default",{value:r,enumerable:!0}):t,r)),Br=r=>la(jt({},"__esModule",{value:!0}),r);var b=(r,e,t)=>pg(r,typeof e!="symbol"?e+"":e,t),fs=(r,e,t)=>e.has(r)||ua("Cannot "+t);var g=(r,e,t)=>(fs(r,e,"read from private field"),t?t.call(r):e.get(r)),I=(r,e,t)=>e.has(r)?ua("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),X=(r,e,t,n)=>(fs(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),N=(r,e,t)=>(fs(r,e,"access private method"),t);var da,fa=j(()=>{da="ffffffff-ffff-ffff-ffff-ffffffffffff"});var ha,pa=j(()=>{ha="00000000-0000-0000-0000-000000000000"});var ga,ma=j(()=>{ga=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function gg(r){return typeof r=="string"&&ga.test(r)}var Ue,Ht=j(()=>{ma();Ue=gg});function mg(r){if(!Ue(r))throw TypeError("Invalid UUID");let e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var We,Gt=j(()=>{Ht();We=mg});function se(r,e=0){return(J[r[e+0]]+J[r[e+1]]+J[r[e+2]]+J[r[e+3]]+"-"+J[r[e+4]]+J[r[e+5]]+"-"+J[r[e+6]]+J[r[e+7]]+"-"+J[r[e+8]]+J[r[e+9]]+"-"+J[r[e+10]]+J[r[e+11]]+J[r[e+12]]+J[r[e+13]]+J[r[e+14]]+J[r[e+15]]).toLowerCase()}function yg(r,e=0){let t=se(r,e);if(!Ue(t))throw TypeError("Stringified UUID is invalid");return t}var J,ya,xe=j(()=>{Ht();J=[];for(let r=0;r<256;++r)J.push((r+256).toString(16).slice(1));ya=yg});function Ze(){return Ur>Wr.length-16&&(va.default.randomFillSync(Wr),Ur=0),Wr.slice(Ur,Ur+=16)}var va,Wr,Ur,jr=j(()=>{va=_e(require("crypto")),Wr=new Uint8Array(256),Ur=Wr.length});function vg(r,e,t){let n=e&&t||0,s=e||new Array(16);r=r||{};let i=r.node,o=r.clockseq;if(r._v6||(i||(i=hs),o==null&&(o=Hr)),i==null||o==null){let p=r.random||(r.rng||Ze)();i==null&&(i=[p[0],p[1],p[2],p[3],p[4],p[5]],!hs&&!r._v6&&(i[0]|=1,hs=i)),o==null&&(o=(p[6]<<8|p[7])&16383,Hr===void 0&&!r._v6&&(Hr=o))}let a=r.msecs!==void 0?r.msecs:Date.now(),u=r.nsecs!==void 0?r.nsecs:gs+1,c=a-ps+(u-gs)/1e4;if(c<0&&r.clockseq===void 0&&(o=o+1&16383),(c<0||a>ps)&&r.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");ps=a,gs=u,Hr=o,a+=122192928e5;let l=((a&268435455)*1e4+u)%4294967296;s[n++]=l>>>24&255,s[n++]=l>>>16&255,s[n++]=l>>>8&255,s[n++]=l&255;let d=a/4294967296*1e4&268435455;s[n++]=d>>>8&255,s[n++]=d&255,s[n++]=d>>>24&15|16,s[n++]=d>>>16&255,s[n++]=o>>>8|128,s[n++]=o&255;for(let p=0;p<6;++p)s[n+p]=i[p];return e||se(s)}var hs,Hr,ps,gs,Gr,ms=j(()=>{jr();xe();ps=0,gs=0;Gr=vg});function Vt(r){let e=typeof r=="string"?We(r):r,t=Sg(e);return typeof r=="string"?se(t):t}function Sg(r,e=!1){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}var ys=j(()=>{Gt();xe()});function Eg(r){r=unescape(encodeURIComponent(r));let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}function Qt(r,e,t){function n(s,i,o,a){var u;if(typeof s=="string"&&(s=Eg(s)),typeof i=="string"&&(i=We(i)),((u=i)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+s.length);if(c.set(i),c.set(s,i.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(let l=0;l<16;++l)o[a+l]=c[l];return o}return se(c)}try{n.name=r}catch{}return n.DNS=_g,n.URL=bg,n}var _g,bg,vs=j(()=>{xe();Gt();_g="6ba7b810-9dad-11d1-80b4-00c04fd430c8",bg="6ba7b811-9dad-11d1-80b4-00c04fd430c8"});function wg(r){return Array.isArray(r)?r=Buffer.from(r):typeof r=="string"&&(r=Buffer.from(r,"utf8")),Sa.default.createHash("md5").update(r).digest()}var Sa,Ea,_a=j(()=>{Sa=_e(require("crypto"));Ea=wg});var Tg,ba,wa=j(()=>{vs();_a();Tg=Qt("v3",48,Ea),ba=Tg});var Ta,Ss,Aa=j(()=>{Ta=_e(require("crypto")),Ss={randomUUID:Ta.default.randomUUID}});function Ag(r,e,t){if(Ss.randomUUID&&!e&&!r)return Ss.randomUUID();r=r||{};let n=r.random||(r.rng||Ze)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return se(n)}var je,Ca=j(()=>{Aa();jr();xe();je=Ag});function Cg(r){return Array.isArray(r)?r=Buffer.from(r):typeof r=="string"&&(r=Buffer.from(r,"utf8")),Ra.default.createHash("sha1").update(r).digest()}var Ra,Ia,xa=j(()=>{Ra=_e(require("crypto"));Ia=Cg});var Rg,La,Pa=j(()=>{vs();xa();Rg=Qt("v5",80,Ia),La=Rg});function Es(r={},e,t=0){let n=Gr({...r,_v6:!0},new Uint8Array(16));if(n=Vt(n),e){for(let s=0;s<16;s++)e[t+s]=n[s];return e}return se(n)}var Oa=j(()=>{xe();ms();ys()});function _s(r){let e=typeof r=="string"?We(r):r,t=Ig(e);return typeof r=="string"?se(t):t}function Ig(r){return Uint8Array.of((r[3]&15)<<4|r[4]>>4&15,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|r[6]&15,r[7],(r[1]&15)<<4|(r[2]&240)>>4,(r[2]&15)<<4|(r[3]&240)>>4,16|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}var Na=j(()=>{Gt();xe()});function xg(r,e,t){r=r||{};let n=e&&t||0,s=e||new Uint8Array(16),i=r.random||(r.rng||Ze)(),o=r.msecs!==void 0?r.msecs:Date.now(),a=r.seq!==void 0?r.seq:null,u=Ma,c=qa;return o>be&&r.msecs===void 0&&(be=o,a!==null&&(u=null,c=null)),a!==null&&(a>2147483647&&(a=2147483647),u=a>>>19&4095,c=a&524287),(u===null||c===null)&&(u=i[6]&127,u=u<<8|i[7],c=i[8]&63,c=c<<8|i[9],c=c<<5|i[10]>>>3),o+1e4>be&&a===null?++c>524287&&(c=0,++u>4095&&(u=0,be++)):be=o,Ma=u,qa=c,s[n++]=be/1099511627776&255,s[n++]=be/4294967296&255,s[n++]=be/16777216&255,s[n++]=be/65536&255,s[n++]=be/256&255,s[n++]=be&255,s[n++]=u>>>4&15|112,s[n++]=u&255,s[n++]=c>>>13&63|128,s[n++]=c>>>5&255,s[n++]=c<<3&255|i[10]&7,s[n++]=i[11],s[n++]=i[12],s[n++]=i[13],s[n++]=i[14],s[n++]=i[15],e||se(s)}var qa,Ma,be,Da,ka=j(()=>{jr();xe();qa=null,Ma=null,be=0;Da=xg});function Lg(r){if(!Ue(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}var $a,Fa=j(()=>{Ht();$a=Lg});var Vr={};ca(Vr,{MAX:()=>da,NIL:()=>ha,parse:()=>We,stringify:()=>ya,v1:()=>Gr,v1ToV6:()=>Vt,v3:()=>ba,v4:()=>je,v5:()=>La,v6:()=>Es,v6ToV1:()=>_s,v7:()=>Da,validate:()=>Ue,version:()=>$a});var ft=j(()=>{fa();pa();Gt();xe();ms();ys();wa();Ca();Pa();Oa();Na();ka();Ht();Fa()});var qs=f((zt,ht)=>{var Ng=200,iu="__lodash_hash_undefined__",qg=800,Mg=16,ou=9007199254740991,au="[object Arguments]",Dg="[object Array]",kg="[object AsyncFunction]",$g="[object Boolean]",Fg="[object Date]",Bg="[object Error]",uu="[object Function]",Ug="[object GeneratorFunction]",Wg="[object Map]",jg="[object Number]",Hg="[object Null]",cu="[object Object]",Gg="[object Proxy]",Vg="[object RegExp]",Qg="[object Set]",Xg="[object String]",Kg="[object Undefined]",zg="[object WeakMap]",Yg="[object ArrayBuffer]",Jg="[object DataView]",Zg="[object Float32Array]",em="[object Float64Array]",tm="[object Int8Array]",rm="[object Int16Array]",nm="[object Int32Array]",sm="[object Uint8Array]",im="[object Uint8ClampedArray]",om="[object Uint16Array]",am="[object Uint32Array]",um=/[\\^$.*+?()[\]{}|]/g,cm=/^\[object .+?Constructor\]$/,lm=/^(?:0|[1-9]\d*)$/,L={};L[Zg]=L[em]=L[tm]=L[rm]=L[nm]=L[sm]=L[im]=L[om]=L[am]=!0;L[au]=L[Dg]=L[Yg]=L[$g]=L[Jg]=L[Fg]=L[Bg]=L[uu]=L[Wg]=L[jg]=L[cu]=L[Vg]=L[Qg]=L[Xg]=L[zg]=!1;var lu=typeof global=="object"&&global&&global.Object===Object&&global,dm=typeof self=="object"&&self&&self.Object===Object&&self,Zt=lu||dm||Function("return this")(),du=typeof zt=="object"&&zt&&!zt.nodeType&&zt,Yt=du&&typeof ht=="object"&&ht&&!ht.nodeType&&ht,fu=Yt&&Yt.exports===du,Ts=fu&&lu.process,za=function(){try{var r=Yt&&Yt.require&&Yt.require("util").types;return r||Ts&&Ts.binding&&Ts.binding("util")}catch{}}(),Ya=za&&za.isTypedArray;function fm(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function hm(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}function pm(r){return function(e){return r(e)}}function gm(r,e){return r?.[e]}function mm(r,e){return function(t){return r(e(t))}}var ym=Array.prototype,vm=Function.prototype,Yr=Object.prototype,As=Zt["__core-js_shared__"],Jr=vm.toString,Pe=Yr.hasOwnProperty,Ja=function(){var r=/[^.]+$/.exec(As&&As.keys&&As.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),hu=Yr.toString,Sm=Jr.call(Object),Em=RegExp("^"+Jr.call(Pe).replace(um,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Kr=fu?Zt.Buffer:void 0,Za=Zt.Symbol,eu=Zt.Uint8Array,tu=Kr?Kr.allocUnsafe:void 0,pu=mm(Object.getPrototypeOf,Object),ru=Object.create,_m=Yr.propertyIsEnumerable,bm=ym.splice,et=Za?Za.toStringTag:void 0,zr=function(){try{var r=Ps(Object,"defineProperty");return r({},"",{}),r}catch{}}(),wm=Kr?Kr.isBuffer:void 0,nu=Math.max,Tm=Date.now,gu=Ps(Zt,"Map"),Jt=Ps(Object,"create"),Am=function(){function r(){}return function(e){if(!rt(e))return{};if(ru)return ru(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function tt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Cm(){this.__data__=Jt?Jt(null):{},this.size=0}function Rm(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function Im(r){var e=this.__data__;if(Jt){var t=e[r];return t===iu?void 0:t}return Pe.call(e,r)?e[r]:void 0}function xm(r){var e=this.__data__;return Jt?e[r]!==void 0:Pe.call(e,r)}function Lm(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Jt&&e===void 0?iu:e,this}tt.prototype.clear=Cm;tt.prototype.delete=Rm;tt.prototype.get=Im;tt.prototype.has=xm;tt.prototype.set=Lm;function Oe(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Pm(){this.__data__=[],this.size=0}function Om(r){var e=this.__data__,t=Zr(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():bm.call(e,t,1),--this.size,!0}function Nm(r){var e=this.__data__,t=Zr(e,r);return t<0?void 0:e[t][1]}function qm(r){return Zr(this.__data__,r)>-1}function Mm(r,e){var t=this.__data__,n=Zr(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}Oe.prototype.clear=Pm;Oe.prototype.delete=Om;Oe.prototype.get=Nm;Oe.prototype.has=qm;Oe.prototype.set=Mm;function pt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Dm(){this.size=0,this.__data__={hash:new tt,map:new(gu||Oe),string:new tt}}function km(r){var e=tn(this,r).delete(r);return this.size-=e?1:0,e}function $m(r){return tn(this,r).get(r)}function Fm(r){return tn(this,r).has(r)}function Bm(r,e){var t=tn(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}pt.prototype.clear=Dm;pt.prototype.delete=km;pt.prototype.get=$m;pt.prototype.has=Fm;pt.prototype.set=Bm;function gt(r){var e=this.__data__=new Oe(r);this.size=e.size}function Um(){this.__data__=new Oe,this.size=0}function Wm(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function jm(r){return this.__data__.get(r)}function Hm(r){return this.__data__.has(r)}function Gm(r,e){var t=this.__data__;if(t instanceof Oe){var n=t.__data__;if(!gu||n.length<Ng-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new pt(n)}return t.set(r,e),this.size=t.size,this}gt.prototype.clear=Um;gt.prototype.delete=Wm;gt.prototype.get=jm;gt.prototype.has=Hm;gt.prototype.set=Gm;function Vm(r,e){var t=xs(r),n=!t&&Is(r),s=!t&&!n&&Su(r),i=!t&&!n&&!s&&_u(r),o=t||n||s||i,a=o?hm(r.length,String):[],u=a.length;for(var c in r)(e||Pe.call(r,c))&&!(o&&(c=="length"||s&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||yu(c,u)))&&a.push(c);return a}function Cs(r,e,t){(t!==void 0&&!rn(r[e],t)||t===void 0&&!(e in r))&&Ls(r,e,t)}function Qm(r,e,t){var n=r[e];(!(Pe.call(r,e)&&rn(n,t))||t===void 0&&!(e in r))&&Ls(r,e,t)}function Zr(r,e){for(var t=r.length;t--;)if(rn(r[t][0],e))return t;return-1}function Ls(r,e,t){e=="__proto__"&&zr?zr(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Xm=ay();function en(r){return r==null?r===void 0?Kg:Hg:et&&et in Object(r)?uy(r):py(r)}function su(r){return er(r)&&en(r)==au}function Km(r){if(!rt(r)||fy(r))return!1;var e=Ns(r)?Em:cm;return e.test(vy(r))}function zm(r){return er(r)&&Eu(r.length)&&!!L[en(r)]}function Ym(r){if(!rt(r))return hy(r);var e=vu(r),t=[];for(var n in r)n=="constructor"&&(e||!Pe.call(r,n))||t.push(n);return t}function mu(r,e,t,n,s){r!==e&&Xm(e,function(i,o){if(s||(s=new gt),rt(i))Jm(r,e,o,t,mu,n,s);else{var a=n?n(Rs(r,o),i,o+"",r,e,s):void 0;a===void 0&&(a=i),Cs(r,o,a)}},bu)}function Jm(r,e,t,n,s,i,o){var a=Rs(r,t),u=Rs(e,t),c=o.get(u);if(c){Cs(r,t,c);return}var l=i?i(a,u,t+"",r,e,o):void 0,d=l===void 0;if(d){var p=xs(u),h=!p&&Su(u),E=!p&&!h&&_u(u);l=u,p||h||E?xs(a)?l=a:Sy(a)?l=sy(a):h?(d=!1,l=ty(u,!0)):E?(d=!1,l=ny(u,!0)):l=[]:Ey(u)||Is(u)?(l=a,Is(a)?l=_y(a):(!rt(a)||Ns(a))&&(l=cy(u))):d=!1}d&&(o.set(u,l),s(l,u,n,i,o),o.delete(u)),Cs(r,t,l)}function Zm(r,e){return my(gy(r,e,wu),r+"")}var ey=zr?function(r,e){return zr(r,"toString",{configurable:!0,enumerable:!1,value:wy(e),writable:!0})}:wu;function ty(r,e){if(e)return r.slice();var t=r.length,n=tu?tu(t):new r.constructor(t);return r.copy(n),n}function ry(r){var e=new r.constructor(r.byteLength);return new eu(e).set(new eu(r)),e}function ny(r,e){var t=e?ry(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function sy(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}function iy(r,e,t,n){var s=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],u=n?n(t[a],r[a],a,t,r):void 0;u===void 0&&(u=r[a]),s?Ls(t,a,u):Qm(t,a,u)}return t}function oy(r){return Zm(function(e,t){var n=-1,s=t.length,i=s>1?t[s-1]:void 0,o=s>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(s--,i):void 0,o&&ly(t[0],t[1],o)&&(i=s<3?void 0:i,s=1),e=Object(e);++n<s;){var a=t[n];a&&r(e,a,n,i)}return e})}function ay(r){return function(e,t,n){for(var s=-1,i=Object(e),o=n(e),a=o.length;a--;){var u=o[r?a:++s];if(t(i[u],u,i)===!1)break}return e}}function tn(r,e){var t=r.__data__;return dy(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Ps(r,e){var t=gm(r,e);return Km(t)?t:void 0}function uy(r){var e=Pe.call(r,et),t=r[et];try{r[et]=void 0;var n=!0}catch{}var s=hu.call(r);return n&&(e?r[et]=t:delete r[et]),s}function cy(r){return typeof r.constructor=="function"&&!vu(r)?Am(pu(r)):{}}function yu(r,e){var t=typeof r;return e=e??ou,!!e&&(t=="number"||t!="symbol"&&lm.test(r))&&r>-1&&r%1==0&&r<e}function ly(r,e,t){if(!rt(t))return!1;var n=typeof e;return(n=="number"?Os(t)&&yu(e,t.length):n=="string"&&e in t)?rn(t[e],r):!1}function dy(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function fy(r){return!!Ja&&Ja in r}function vu(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Yr;return r===t}function hy(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function py(r){return hu.call(r)}function gy(r,e,t){return e=nu(e===void 0?r.length-1:e,0),function(){for(var n=arguments,s=-1,i=nu(n.length-e,0),o=Array(i);++s<i;)o[s]=n[e+s];s=-1;for(var a=Array(e+1);++s<e;)a[s]=n[s];return a[e]=t(o),fm(r,this,a)}}function Rs(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var my=yy(ey);function yy(r){var e=0,t=0;return function(){var n=Tm(),s=Mg-(n-t);if(t=n,s>0){if(++e>=qg)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function vy(r){if(r!=null){try{return Jr.call(r)}catch{}try{return r+""}catch{}}return""}function rn(r,e){return r===e||r!==r&&e!==e}var Is=su(function(){return arguments}())?su:function(r){return er(r)&&Pe.call(r,"callee")&&!_m.call(r,"callee")},xs=Array.isArray;function Os(r){return r!=null&&Eu(r.length)&&!Ns(r)}function Sy(r){return er(r)&&Os(r)}var Su=wm||Ty;function Ns(r){if(!rt(r))return!1;var e=en(r);return e==uu||e==Ug||e==kg||e==Gg}function Eu(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=ou}function rt(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function er(r){return r!=null&&typeof r=="object"}function Ey(r){if(!er(r)||en(r)!=cu)return!1;var e=pu(r);if(e===null)return!0;var t=Pe.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Jr.call(t)==Sm}var _u=Ya?pm(Ya):zm;function _y(r){return iy(r,bu(r))}function bu(r){return Os(r)?Vm(r,!0):Ym(r)}var by=oy(function(r,e,t){mu(r,e,t)});function wy(r){return function(){return r}}function wu(r){return r}function Ty(){return!1}ht.exports=by});var Gs=f(Uu=>{"use strict";Uu.parse=function(r,e){return new Hs(r,e).parse()};var Hs=class r{constructor(e,t){this.source=e,this.transform=t||Iy,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,n,s;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!s)this.dimension++,this.dimension>1&&(n=new r(this.source.substr(this.position-1),this.transform),this.entries.push(n.parse(!0)),this.position+=n.position-2);else if(t.value==="}"&&!s){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(s&&this.newEntry(!0),s=!s):t.value===","&&!s?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Iy(r){return r}});var Vs=f((eI,Wu)=>{var xy=Gs();Wu.exports={create:function(r,e){return{parse:function(){return xy.parse(r,e)}}}}});var Gu=f((tI,Hu)=>{"use strict";var Ly=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,Py=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Oy=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Ny=/^-?infinity$/;Hu.exports=function(e){if(Ny.test(e))return Number(e.replace("i","I"));var t=Ly.exec(e);if(!t)return qy(e)||null;var n=!!t[8],s=parseInt(t[1],10);n&&(s=ju(s));var i=parseInt(t[2],10)-1,o=t[3],a=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),l=t[7];l=l?1e3*parseFloat(l):0;var d,p=My(e);return p!=null?(d=new Date(Date.UTC(s,i,o,a,u,c,l)),Qs(s)&&d.setUTCFullYear(s),p!==0&&d.setTime(d.getTime()-p)):(d=new Date(s,i,o,a,u,c,l),Qs(s)&&d.setFullYear(s)),d};function qy(r){var e=Py.exec(r);if(e){var t=parseInt(e[1],10),n=!!e[4];n&&(t=ju(t));var s=parseInt(e[2],10)-1,i=e[3],o=new Date(t,s,i);return Qs(t)&&o.setFullYear(t),o}}function My(r){if(r.endsWith("+00"))return 0;var e=Oy.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var n=t==="-"?-1:1,s=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return s*n*1e3}}function ju(r){return-(r-1)}function Qs(r){return r>=0&&r<100}});var Qu=f((rI,Vu)=>{Vu.exports=ky;var Dy=Object.prototype.hasOwnProperty;function ky(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Dy.call(t,n)&&(r[n]=t[n])}return r}});var zu=f((nI,Ku)=>{"use strict";var $y=Qu();Ku.exports=bt;function bt(r){if(!(this instanceof bt))return new bt(r);$y(this,zy(r))}var Fy=["seconds","minutes","hours","days","months","years"];bt.prototype.toPostgres=function(){var r=Fy.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var By={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Uy=["years","months","days"],Wy=["hours","minutes","seconds"];bt.prototype.toISOString=bt.prototype.toISO=function(){var r=Uy.map(t,this).join(""),e=Wy.map(t,this).join("");return"P"+r+"T"+e;function t(n){var s=this[n]||0;return n==="seconds"&&this.milliseconds&&(s=(s+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),s+By[n]}};var Xs="([+-]?\\d+)",jy=Xs+"\\s+years?",Hy=Xs+"\\s+mons?",Gy=Xs+"\\s+days?",Vy="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Qy=new RegExp([jy,Hy,Gy,Vy].map(function(r){return"("+r+")?"}).join("\\s*")),Xu={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},Xy=["hours","minutes","seconds","milliseconds"];function Ky(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function zy(r){if(!r)return{};var e=Qy.exec(r),t=e[8]==="-";return Object.keys(Xu).reduce(function(n,s){var i=Xu[s],o=e[i];return!o||(o=s==="milliseconds"?Ky(o):parseInt(o,10),!o)||(t&&~Xy.indexOf(s)&&(o*=-1),n[s]=o),n},{})}});var Ju=f((sI,Yu)=>{"use strict";Yu.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",n=0;n<e.length;)if(e[n]!=="\\")t+=e[n],++n;else if(/[0-7]{3}/.test(e.substr(n+1,3)))t+=String.fromCharCode(parseInt(e.substr(n+1,3),8)),n+=4;else{for(var s=1;n+s<e.length&&e[n+s]==="\\";)s++;for(var i=0;i<Math.floor(s/2);++i)t+="\\";n+=Math.floor(s/2)*2}return new Buffer(t,"binary")}});var ic=f((iI,sc)=>{var ar=Gs(),ur=Vs(),un=Gu(),ec=zu(),tc=Ju();function cn(r){return function(t){return t===null?t:r(t)}}function rc(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function Yy(r){return r?ar.parse(r,rc):null}function Jy(r){return parseInt(r,10)}function Ks(r){return r?ar.parse(r,cn(Jy)):null}function Zy(r){return r?ar.parse(r,cn(function(e){return nc(e).trim()})):null}var ev=function(r){if(!r)return null;var e=ur.create(r,function(t){return t!==null&&(t=Zs(t)),t});return e.parse()},zs=function(r){if(!r)return null;var e=ur.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},fe=function(r){if(!r)return null;var e=ur.create(r);return e.parse()},Ys=function(r){if(!r)return null;var e=ur.create(r,function(t){return t!==null&&(t=un(t)),t});return e.parse()},tv=function(r){if(!r)return null;var e=ur.create(r,function(t){return t!==null&&(t=ec(t)),t});return e.parse()},rv=function(r){return r?ar.parse(r,cn(tc)):null},Js=function(r){return parseInt(r,10)},nc=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},Zu=function(r){return r?ar.parse(r,cn(JSON.parse)):null},Zs=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},nv=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",n=!1,s=2;s<r.length-1;s++){if(n||(e+=r[s]),r[s]===")"){n=!0;continue}else if(!n)continue;r[s]!==","&&(t+=r[s])}var i=Zs(e);return i.radius=parseFloat(t),i},sv=function(r){r(20,nc),r(21,Js),r(23,Js),r(26,Js),r(700,parseFloat),r(701,parseFloat),r(16,rc),r(1082,un),r(1114,un),r(1184,un),r(600,Zs),r(651,fe),r(718,nv),r(1e3,Yy),r(1001,rv),r(1005,Ks),r(1007,Ks),r(1028,Ks),r(1016,Zy),r(1017,ev),r(1021,zs),r(1022,zs),r(1231,zs),r(1014,fe),r(1015,fe),r(1008,fe),r(1009,fe),r(1040,fe),r(1041,fe),r(1115,Ys),r(1182,Ys),r(1185,Ys),r(1186,ec),r(1187,tv),r(17,tc),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,Zu),r(3807,Zu),r(3907,fe),r(2951,fe),r(791,fe),r(1183,fe),r(1270,fe)};sc.exports={init:sv}});var ac=f((oI,oc)=>{"use strict";var ce=1e6;function iv(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),n="";e<0&&(e=~e+(t===0),t=~t+1>>>0,n="-");var s="",i,o,a,u,c,l;{if(i=e%ce,e=e/ce>>>0,o=4294967296*i+t,t=o/ce>>>0,a=""+(o-ce*t),t===0&&e===0)return n+a+s;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";s=u+a+s}{if(i=e%ce,e=e/ce>>>0,o=4294967296*i+t,t=o/ce>>>0,a=""+(o-ce*t),t===0&&e===0)return n+a+s;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";s=u+a+s}{if(i=e%ce,e=e/ce>>>0,o=4294967296*i+t,t=o/ce>>>0,a=""+(o-ce*t),t===0&&e===0)return n+a+s;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";s=u+a+s}return i=e%ce,o=4294967296*i+t,a=""+o%ce,n+a+s}oc.exports=iv});var fc=f((aI,dc)=>{var ov=ac(),F=function(r,e,t,n,s){t=t||0,n=n||!1,s=s||function(h,E,_){return h*Math.pow(2,_)+E};var i=t>>3,o=function(h){return n?~h&255:h},a=255,u=8-t%8;e<u&&(a=255<<8-e&255,u=e),t&&(a=a>>t%8);var c=0;t%8+e>=8&&(c=s(0,o(r[i])&a,u));for(var l=e+t>>3,d=i+1;d<l;d++)c=s(c,o(r[d]),8);var p=(e+t)%8;return p>0&&(c=s(c,o(r[l])>>8-p,p)),c},lc=function(r,e,t){var n=Math.pow(2,t-1)-1,s=F(r,1),i=F(r,t,1);if(i===0)return 0;var o=1,a=function(c,l,d){c===0&&(c=1);for(var p=1;p<=d;p++)o/=2,(l&1<<d-p)>0&&(c+=o);return c},u=F(r,e,t+1,!1,a);return i==Math.pow(2,t+1)-1?u===0?s===0?1/0:-1/0:NaN:(s===0?1:-1)*Math.pow(2,i-n)*u},av=function(r){return F(r,1)==1?-1*(F(r,15,1,!0)+1):F(r,15,1)},uc=function(r){return F(r,1)==1?-1*(F(r,31,1,!0)+1):F(r,31,1)},uv=function(r){return lc(r,23,8)},cv=function(r){return lc(r,52,11)},lv=function(r){var e=F(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,F(r,16,16)),n=0,s=[],i=F(r,16),o=0;o<i;o++)n+=F(r,16,64+16*o)*t,t/=1e4;var a=Math.pow(10,F(r,16,48));return(e===0?1:-1)*Math.round(n*a)/a},cc=function(r,e){var t=F(e,1),n=F(e,63,1),s=new Date((t===0?1:-1)*n/1e3+9466848e5);return r||s.setTime(s.getTime()+s.getTimezoneOffset()*6e4),s.usec=n%1e3,s.getMicroSeconds=function(){return this.usec},s.setMicroSeconds=function(i){this.usec=i},s.getUTCMicroSeconds=function(){return this.usec},s},cr=function(r){for(var e=F(r,32),t=F(r,32,32),n=F(r,32,64),s=96,i=[],o=0;o<e;o++)i[o]=F(r,32,s),s+=32,s+=32;var a=function(c){var l=F(r,32,s);if(s+=32,l==4294967295)return null;var d;if(c==23||c==20)return d=F(r,l*8,s),s+=l*8,d;if(c==25)return d=r.toString(this.encoding,s>>3,(s+=l<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var d=[],p;if(c.length>1){var h=c.shift();for(p=0;p<h;p++)d[p]=u(c,l);c.unshift(h)}else for(p=0;p<c[0];p++)d[p]=a(l);return d};return u(i,n)},dv=function(r){return r.toString("utf8")},fv=function(r){return r===null?null:F(r,8)>0},hv=function(r){r(20,ov),r(21,av),r(23,uc),r(26,uc),r(1700,lv),r(700,uv),r(701,cv),r(16,fv),r(1114,cc.bind(null,!1)),r(1184,cc.bind(null,!0)),r(1e3,cr),r(1007,cr),r(1016,cr),r(1008,cr),r(1009,cr),r(25,dv)};dc.exports={init:hv}});var pc=f((uI,hc)=>{hc.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var fr=f(dr=>{var pv=ic(),gv=fc(),mv=Vs(),yv=pc();dr.getTypeParser=vv;dr.setTypeParser=Sv;dr.arrayParser=mv;dr.builtins=yv;var lr={text:{},binary:{}};function gc(r){return String(r)}function vv(r,e){return e=e||"text",lr[e]&&lr[e][r]||gc}function Sv(r,e,t){typeof e=="function"&&(t=e,e="text"),lr[e][r]=t}pv.init(function(r,e){lr.text[r]=e});gv.init(function(r,e){lr.binary[r]=e})});var hr=f((lI,ei)=>{"use strict";ei.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var wt=fr(),Ev=wt.getTypeParser(20,"text"),_v=wt.getTypeParser(1016,"text");ei.exports.__defineSetter__("parseInt8",function(r){wt.setTypeParser(20,"text",r?wt.getTypeParser(23,"text"):Ev),wt.setTypeParser(1016,"text",r?wt.getTypeParser(1007,"text"):_v)})});var Tt=f((dI,vc)=>{"use strict";var bv=hr(),mc=require("util"),{isDate:wv}=mc.types||mc;function Tv(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function yc(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+yc(r[t]);else if(ArrayBuffer.isView(r[t])){let n=r[t];if(!(n instanceof Buffer)){let s=Buffer.from(n.buffer,n.byteOffset,n.byteLength);s.length===n.byteLength?n=s:n=s.slice(n.byteOffset,n.byteOffset+n.byteLength)}e+="\\\\x"+n.toString("hex")}else e+=Tv(ln(r[t]));return e=e+"}",e}var ln=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return wv(r)?bv.parseInputDatesAsUTC?Rv(r):Cv(r):Array.isArray(r)?yc(r):Av(r,e)}return r.toString()};function Av(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),ln(r.toPostgres(ln),e)}return JSON.stringify(r)}function Cv(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),n=t<1;n&&(t=Math.abs(t)+1);let s=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(s+="-",e*=-1):s+="+",s+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),n&&(s+=" BC"),s}function Rv(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let n=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return n+="+00:00",t&&(n+=" BC"),n}function Iv(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var xv=function(r){return'"'+r.replace(/"/g,'""')+'"'},Lv=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let n=0;n<r.length;n++){let s=r[n];s==="'"?t+=s+s:s==="\\"?(t+=s+s,e=!0):t+=s}return t+="'",e===!0&&(t=" E"+t),t};vc.exports={prepareValue:function(e){return ln(e)},normalizeQueryConfig:Iv,escapeIdentifier:xv,escapeLiteral:Lv}});var Ec=f((fI,Sc)=>{"use strict";var At=require("crypto");function ti(r){return At.createHash("md5").update(r,"utf-8").digest("hex")}function Pv(r,e,t){let n=ti(e+r);return"md5"+ti(Buffer.concat([Buffer.from(n),t]))}function Ov(r){return At.createHash("sha256").update(r).digest()}function Nv(r,e){return r=r.replace(/(\D)-/,"$1"),At.createHash(r).update(e).digest()}function qv(r,e){return At.createHmac("sha256",r).update(e).digest()}async function Mv(r,e,t){return At.pbkdf2Sync(r,e,t,32,"sha256")}Sc.exports={postgresMd5PasswordHash:Pv,randomBytes:At.randomBytes,deriveKey:Mv,sha256:Ov,hashByName:Nv,hmacSha256:qv,md5:ti}});var Tc=f((hI,wc)=>{var _c=require("crypto");wc.exports={postgresMd5PasswordHash:kv,randomBytes:Dv,deriveKey:Uv,sha256:$v,hashByName:Fv,hmacSha256:Bv,md5:ri};var bc=_c.webcrypto||globalThis.crypto,at=bc.subtle,ni=new TextEncoder;function Dv(r){return bc.getRandomValues(Buffer.alloc(r))}async function ri(r){try{return _c.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?ni.encode(r):r,n=await at.digest("MD5",t);return Array.from(new Uint8Array(n)).map(s=>s.toString(16).padStart(2,"0")).join("")}}async function kv(r,e,t){let n=await ri(e+r);return"md5"+await ri(Buffer.concat([Buffer.from(n),t]))}async function $v(r){return await at.digest("SHA-256",r)}async function Fv(r,e){return await at.digest(r,e)}async function Bv(r,e){let t=await at.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await at.sign("HMAC",t,ni.encode(e))}async function Uv(r,e,t){let n=await at.importKey("raw",ni.encode(r),"PBKDF2",!1,["deriveBits"]),s={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await at.deriveBits(s,n,32*8,["deriveBits"])}});var ii=f((pI,si)=>{"use strict";var Wv=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Wv?si.exports=Ec():si.exports=Tc()});var Rc=f((gI,Cc)=>{function ut(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function oi(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let n=t&127;if(n>4)throw ut("bad length",r);t=0;for(let s=0;s<n;s++)t=t<<8|r[e++];return{length:t,index:e}}function Ac(r,e){if(r[e++]!==6)throw ut("non-OID data",r);let{length:t,index:n}=oi(r,e);e=n;let s=e+t,i=r[e++],o=(i/40>>0)+"."+i%40;for(;e<s;){let a=0;for(;e<s;){let u=r[e++];if(a=a<<7|u&127,u<128)break}o+="."+a}return{oid:o,index:e}}function pr(r,e){if(r[e++]!==48)throw ut("non-sequence data",r);return oi(r,e)}function jv(r,e){e===void 0&&(e=0),e=pr(r,e).index;let{length:t,index:n}=pr(r,e);e=n+t,e=pr(r,e).index;let{oid:s,index:i}=Ac(r,e);switch(s){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=i,e=pr(r,e).index,r[e++]!==160)throw ut("non-tag data",r);e=oi(r,e).index,e=pr(r,e).index;let{oid:o}=Ac(r,e);switch(o){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw ut("unknown hash OID "+o,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw ut("Ed448 certificate channel binding is not currently supported by Postgres")}throw ut("unknown OID "+s,r)}Cc.exports={signatureAlgorithmHashFromCertificate:jv}});var Pc=f((mI,Lc)=>{"use strict";var Ve=ii(),{signatureAlgorithmHashFromCertificate:Hv}=Rc();function Gv(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let n=t.find(o=>r.includes(o));if(!n)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(n==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let s=Ve.randomBytes(18).toString("base64");return{mechanism:n,clientNonce:s,response:(n==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+s,message:"SASLInitialResponse"}}async function Vv(r,e,t,n){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let s=Kv(t);if(s.nonce.startsWith(r.clientNonce)){if(s.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let i="n=*,r="+r.clientNonce,o="r="+s.nonce+",s="+s.salt+",i="+s.iteration,a=n?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let k=n.getPeerCertificate().raw,Q=Hv(k);(Q==="MD5"||Q==="SHA-1")&&(Q="SHA-256");let $=await Ve.hashByName(Q,k);a=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from($)]).toString("base64")}let u="c="+a+",r="+s.nonce,c=i+","+o+","+u,l=Buffer.from(s.salt,"base64"),d=await Ve.deriveKey(e,l,s.iteration),p=await Ve.hmacSha256(d,"Client Key"),h=await Ve.sha256(p),E=await Ve.hmacSha256(h,c),_=Yv(Buffer.from(p),Buffer.from(E)).toString("base64"),Ee=await Ve.hmacSha256(d,"Server Key"),Y=await Ve.hmacSha256(Ee,c);r.message="SASLResponse",r.serverSignature=Buffer.from(Y).toString("base64"),r.response=u+",p="+_}function Qv(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=zv(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function Xv(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function Ic(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function xc(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],n=e.substring(2);return[t,n]}))}function Kv(r){let e=xc(r),t=e.get("r");if(t){if(!Xv(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let n=e.get("s");if(n){if(!Ic(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let s=e.get("i");if(s){if(!/^[1-9][0-9]*$/.test(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let i=parseInt(s,10);return{nonce:t,salt:n,iteration:i}}function zv(r){let t=xc(r).get("v");if(t){if(!Ic(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function Yv(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,n)=>r[n]^e[n]))}Lc.exports={startSession:Gv,continueSession:Vv,finalizeSession:Qv}});var fn=f((yI,Oc)=>{"use strict";var Jv=fr();function dn(r){this._types=r||Jv,this.text={},this.binary={}}dn.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};dn.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};dn.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};Oc.exports=dn});var Mc=f((vI,qc)=>{"use strict";function Ct(r,e={}){if(r.charAt(0)==="/"){let u=r.split(" ");return{host:u[0],database:u[1]}}let t={},n,s=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{n=new URL(r,"postgres://base")}catch{n=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),s=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of n.searchParams.entries())t[u[0]]=u[1];if(t.user=t.user||decodeURIComponent(n.username),t.password=t.password||decodeURIComponent(n.password),n.protocol=="socket:")return t.host=decodeURI(n.pathname),t.database=n.searchParams.get("db"),t.client_encoding=n.searchParams.get("encoding"),t;let i=s?"":n.hostname;t.host?i&&/^%2f/i.test(i)&&(n.pathname=i+n.pathname):t.host=decodeURIComponent(i),t.port||(t.port=n.port);let o=n.pathname.slice(1)||null;t.database=o?decodeURI(o):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let a=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=a.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=a.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=a.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function Zv(r){return Object.entries(r).reduce((t,[n,s])=>(s!=null&&(t[n]=s),t),{})}function Nc(r){return Object.entries(r).reduce((t,[n,s])=>{if(n==="ssl"){let i=s;typeof i=="boolean"&&(t[n]=i),typeof i=="object"&&(t[n]=Zv(i))}else if(s!=null)if(n==="port"){if(s!==""){let i=parseInt(s,10);if(isNaN(i))throw new Error(`Invalid ${n}: ${s}`);t[n]=i}}else t[n]=s;return t},{})}function eS(r){return Nc(Ct(r))}qc.exports=Ct;Ct.parse=Ct;Ct.toClientConfig=Nc;Ct.parseIntoClientConfig=eS});var ui=f((SI,$c)=>{"use strict";var tS=require("dns"),kc=hr(),Dc=Mc().parse,ie=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||kc[r]},rS=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return kc.ssl},Rt=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},he=function(r,e,t){let n=e[t];n!=null&&r.push(t+"="+Rt(n))},ai=class{constructor(e){e=typeof e=="string"?Dc(e):e||{},e.connectionString&&(e=Object.assign({},e,Dc(e.connectionString))),this.user=ie("user",e),this.database=ie("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(ie("port",e),10),this.host=ie("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:ie("password",e)}),this.binary=ie("binary",e),this.options=ie("options",e),this.ssl=typeof e.ssl>"u"?rS():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=ie("client_encoding",e),this.replication=ie("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=ie("application_name",e,"PGAPPNAME"),this.fallback_application_name=ie("fallback_application_name",e,!1),this.statement_timeout=ie("statement_timeout",e,!1),this.lock_timeout=ie("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=ie("idle_in_transaction_session_timeout",e,!1),this.query_timeout=ie("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];he(t,this,"user"),he(t,this,"password"),he(t,this,"port"),he(t,this,"application_name"),he(t,this,"fallback_application_name"),he(t,this,"connect_timeout"),he(t,this,"options");let n=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(he(t,n,"sslmode"),he(t,n,"sslca"),he(t,n,"sslkey"),he(t,n,"sslcert"),he(t,n,"sslrootcert"),this.database&&t.push("dbname="+Rt(this.database)),this.replication&&t.push("replication="+Rt(this.replication)),this.host&&t.push("host="+Rt(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+Rt(this.client_encoding)),tS.lookup(this.host,function(s,i){return s?e(s,null):(t.push("hostaddr="+Rt(i)),e(null,t.join(" ")))})}};$c.exports=ai});var li=f((EI,Bc)=>{"use strict";var nS=fr(),Fc=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,ci=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=Fc.exec(e.text):t=Fc.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let n=0,s=e.length;n<s;n++){let i=e[n];i!==null?t[n]=this._parsers[n](i):t[n]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let n=0,s=e.length;n<s;n++){let i=e[n],o=this.fields[n].name;if(i!==null){let a=this.fields[n].format==="binary"?Buffer.from(i):i;t[o]=this._parsers[n](a)}else t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let n=0;n<e.length;n++){let s=e[n];t[s.name]=null,this._types?this._parsers[n]=this._types.getTypeParser(s.dataTypeID,s.format||"text"):this._parsers[n]=nS.getTypeParser(s.dataTypeID,s.format||"text")}this._prebuiltEmptyResultObject={...t}}};Bc.exports=ci});var Hc=f((_I,jc)=>{"use strict";var{EventEmitter:sS}=require("events"),Uc=li(),Wc=Tt(),di=class extends sS{constructor(e,t,n){super(),e=Wc.normalizeQueryConfig(e,t,n),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new Uc(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new Uc(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(n){this._canceledDueToError=n;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:Wc.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};jc.exports=di});var Ci=f(v=>{"use strict";Object.defineProperty(v,"__esModule",{value:!0});v.NoticeMessage=v.DataRowMessage=v.CommandCompleteMessage=v.ReadyForQueryMessage=v.NotificationResponseMessage=v.BackendKeyDataMessage=v.AuthenticationMD5Password=v.ParameterStatusMessage=v.ParameterDescriptionMessage=v.RowDescriptionMessage=v.Field=v.CopyResponse=v.CopyDataMessage=v.DatabaseError=v.copyDone=v.emptyQuery=v.replicationStart=v.portalSuspended=v.noData=v.closeComplete=v.bindComplete=v.parseComplete=void 0;v.parseComplete={name:"parseComplete",length:5};v.bindComplete={name:"bindComplete",length:5};v.closeComplete={name:"closeComplete",length:5};v.noData={name:"noData",length:5};v.portalSuspended={name:"portalSuspended",length:5};v.replicationStart={name:"replicationStart",length:4};v.emptyQuery={name:"emptyQuery",length:4};v.copyDone={name:"copyDone",length:4};var fi=class extends Error{constructor(e,t,n){super(e),this.length=t,this.name=n}};v.DatabaseError=fi;var hi=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};v.CopyDataMessage=hi;var pi=class{constructor(e,t,n,s){this.length=e,this.name=t,this.binary=n,this.columnTypes=new Array(s)}};v.CopyResponse=pi;var gi=class{constructor(e,t,n,s,i,o,a){this.name=e,this.tableID=t,this.columnID=n,this.dataTypeID=s,this.dataTypeSize=i,this.dataTypeModifier=o,this.format=a}};v.Field=gi;var mi=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};v.RowDescriptionMessage=mi;var yi=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};v.ParameterDescriptionMessage=yi;var vi=class{constructor(e,t,n){this.length=e,this.parameterName=t,this.parameterValue=n,this.name="parameterStatus"}};v.ParameterStatusMessage=vi;var Si=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};v.AuthenticationMD5Password=Si;var Ei=class{constructor(e,t,n){this.length=e,this.processID=t,this.secretKey=n,this.name="backendKeyData"}};v.BackendKeyDataMessage=Ei;var _i=class{constructor(e,t,n,s){this.length=e,this.processId=t,this.channel=n,this.payload=s,this.name="notification"}};v.NotificationResponseMessage=_i;var bi=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};v.ReadyForQueryMessage=bi;var wi=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};v.CommandCompleteMessage=wi;var Ti=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};v.DataRowMessage=Ti;var Ai=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};v.NoticeMessage=Ai});var Gc=f(hn=>{"use strict";Object.defineProperty(hn,"__esModule",{value:!0});hn.Writer=void 0;var Ri=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let n=this.buffer,s=n.length+(n.length>>1)+e;this.buffer=Buffer.allocUnsafe(s),n.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};hn.Writer=Ri});var Qc=f(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.serialize=void 0;var Ii=Gc(),q=new Ii.Writer,iS=r=>{q.addInt16(3).addInt16(0);for(let n of Object.keys(r))q.addCString(n).addCString(r[n]);q.addCString("client_encoding").addCString("UTF8");let e=q.addCString("").flush(),t=e.length+4;return new Ii.Writer().addInt32(t).add(e).flush()},oS=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},aS=r=>q.addCString(r).flush(112),uS=function(r,e){return q.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),q.flush(112)},cS=function(r){return q.addString(r).flush(112)},lS=r=>q.addCString(r).flush(81),Vc=[],dS=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||Vc,n=t.length,s=q.addCString(e).addCString(r.text).addInt16(n);for(let i=0;i<n;i++)s.addInt32(t[i]);return q.flush(80)},It=new Ii.Writer,fS=function(r,e){for(let t=0;t<r.length;t++){let n=e?e(r[t],t):r[t];n==null?(q.addInt16(0),It.addInt32(-1)):n instanceof Buffer?(q.addInt16(1),It.addInt32(n.length),It.add(n)):(q.addInt16(0),It.addInt32(Buffer.byteLength(n)),It.addString(n))}},hS=(r={})=>{let e=r.portal||"",t=r.statement||"",n=r.binary||!1,s=r.values||Vc,i=s.length;return q.addCString(e).addCString(t),q.addInt16(i),fS(s,r.valueMapper),q.addInt16(i),q.add(It.flush()),q.addInt16(1),q.addInt16(n?1:0),q.flush(66)},pS=Buffer.from([69,0,0,0,9,0,0,0,0,0]),gS=r=>{if(!r||!r.portal&&!r.rows)return pS;let e=r.portal||"",t=r.rows||0,n=Buffer.byteLength(e),s=4+n+1+4,i=Buffer.allocUnsafe(1+s);return i[0]=69,i.writeInt32BE(s,1),i.write(e,5,"utf-8"),i[n+5]=0,i.writeUInt32BE(t,i.length-4),i},mS=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},xi=(r,e)=>{let n=4+Buffer.byteLength(e)+1,s=Buffer.allocUnsafe(1+n);return s[0]=r,s.writeInt32BE(n,1),s.write(e,5,"utf-8"),s[n]=0,s},yS=q.addCString("P").flush(68),vS=q.addCString("S").flush(68),SS=r=>r.name?xi(68,`${r.type}${r.name||""}`):r.type==="P"?yS:vS,ES=r=>{let e=`${r.type}${r.name||""}`;return xi(67,e)},_S=r=>q.add(r).flush(100),bS=r=>xi(102,r),pn=r=>Buffer.from([r,0,0,0,4]),wS=pn(72),TS=pn(83),AS=pn(88),CS=pn(99),RS={startup:iS,password:aS,requestSsl:oS,sendSASLInitialResponseMessage:uS,sendSCRAMClientFinalMessage:cS,query:lS,parse:dS,bind:hS,execute:gS,describe:SS,close:ES,flush:()=>wS,sync:()=>TS,end:()=>AS,copyData:_S,copyDone:()=>CS,copyFail:bS,cancel:mS};gn.serialize=RS});var Xc=f(mn=>{"use strict";Object.defineProperty(mn,"__esModule",{value:!0});mn.BufferReader=void 0;var IS=Buffer.allocUnsafe(0),Li=class{constructor(e=0){this.offset=e,this.buffer=IS,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};mn.BufferReader=Li});var Yc=f(yn=>{"use strict";Object.defineProperty(yn,"__esModule",{value:!0});yn.Parser=void 0;var B=Ci(),xS=Xc(),Pi=1,LS=4,Kc=Pi+LS,zc=Buffer.allocUnsafe(0),Oi=class{constructor(e){if(this.buffer=zc,this.bufferLength=0,this.bufferOffset=0,this.reader=new xS.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let n=this.bufferOffset+this.bufferLength,s=this.bufferOffset;for(;s+Kc<=n;){let i=this.buffer[s],o=this.buffer.readUInt32BE(s+Pi),a=Pi+o;if(a+s<=n){let u=this.handlePacket(s+Kc,i,o,this.buffer);t(u),s+=a}else break}s===n?(this.buffer=zc,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=n-s,this.bufferOffset=s)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let s;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)s=this.buffer;else{let i=this.buffer.byteLength*2;for(;t>=i;)i*=2;s=Buffer.allocUnsafe(i)}this.buffer.copy(s,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=s,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,n,s){switch(t){case 50:return B.bindComplete;case 49:return B.parseComplete;case 51:return B.closeComplete;case 110:return B.noData;case 115:return B.portalSuspended;case 99:return B.copyDone;case 87:return B.replicationStart;case 73:return B.emptyQuery;case 68:return this.parseDataRowMessage(e,n,s);case 67:return this.parseCommandCompleteMessage(e,n,s);case 90:return this.parseReadyForQueryMessage(e,n,s);case 65:return this.parseNotificationMessage(e,n,s);case 82:return this.parseAuthenticationResponse(e,n,s);case 83:return this.parseParameterStatusMessage(e,n,s);case 75:return this.parseBackendKeyData(e,n,s);case 69:return this.parseErrorMessage(e,n,s,"error");case 78:return this.parseErrorMessage(e,n,s,"notice");case 84:return this.parseRowDescriptionMessage(e,n,s);case 116:return this.parseParameterDescriptionMessage(e,n,s);case 71:return this.parseCopyInMessage(e,n,s);case 72:return this.parseCopyOutMessage(e,n,s);case 100:return this.parseCopyData(e,n,s);default:return new B.DatabaseError("received invalid response: "+t.toString(16),n,"error")}}parseReadyForQueryMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.string(1);return new B.ReadyForQueryMessage(t,s)}parseCommandCompleteMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.cstring();return new B.CommandCompleteMessage(t,s)}parseCopyData(e,t,n){let s=n.slice(e,e+(t-4));return new B.CopyDataMessage(t,s)}parseCopyInMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyInResponse")}parseCopyOutMessage(e,t,n){return this.parseCopyMessage(e,t,n,"copyOutResponse")}parseCopyMessage(e,t,n,s){this.reader.setBuffer(e,n);let i=this.reader.byte()!==0,o=this.reader.int16(),a=new B.CopyResponse(t,s,i,o);for(let u=0;u<o;u++)a.columnTypes[u]=this.reader.int16();return a}parseNotificationMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),i=this.reader.cstring(),o=this.reader.cstring();return new B.NotificationResponseMessage(t,s,i,o)}parseRowDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),i=new B.RowDescriptionMessage(t,s);for(let o=0;o<s;o++)i.fields[o]=this.parseField();return i}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),n=this.reader.int16(),s=this.reader.uint32(),i=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new B.Field(e,t,n,s,i,o,a)}parseParameterDescriptionMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),i=new B.ParameterDescriptionMessage(t,s);for(let o=0;o<s;o++)i.dataTypeIDs[o]=this.reader.int32();return i}parseDataRowMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int16(),i=new Array(s);for(let o=0;o<s;o++){let a=this.reader.int32();i[o]=a===-1?null:this.reader.string(a)}return new B.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.cstring(),i=this.reader.cstring();return new B.ParameterStatusMessage(t,s,i)}parseBackendKeyData(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),i=this.reader.int32();return new B.BackendKeyDataMessage(t,s,i)}parseAuthenticationResponse(e,t,n){this.reader.setBuffer(e,n);let s=this.reader.int32(),i={name:"authenticationOk",length:t};switch(s){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";let o=this.reader.bytes(4);return new B.AuthenticationMD5Password(t,o)}break;case 10:{i.name="authenticationSASL",i.mechanisms=[];let o;do o=this.reader.cstring(),o&&i.mechanisms.push(o);while(o)}break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(t-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+s)}return i}parseErrorMessage(e,t,n,s){this.reader.setBuffer(e,n);let i={},o=this.reader.string(1);for(;o!=="\0";)i[o]=this.reader.cstring(),o=this.reader.string(1);let a=i.M,u=s==="notice"?new B.NoticeMessage(t,a):new B.DatabaseError(a,t,s);return u.severity=i.S,u.code=i.C,u.detail=i.D,u.hint=i.H,u.position=i.P,u.internalPosition=i.p,u.internalQuery=i.q,u.where=i.W,u.schema=i.s,u.table=i.t,u.column=i.c,u.dataType=i.d,u.constraint=i.n,u.file=i.F,u.line=i.L,u.routine=i.R,u}};yn.Parser=Oi});var Ni=f(Qe=>{"use strict";Object.defineProperty(Qe,"__esModule",{value:!0});Qe.DatabaseError=Qe.serialize=Qe.parse=void 0;var PS=Ci();Object.defineProperty(Qe,"DatabaseError",{enumerable:!0,get:function(){return PS.DatabaseError}});var OS=Qc();Object.defineProperty(Qe,"serialize",{enumerable:!0,get:function(){return OS.serialize}});var NS=Yc();function qS(r,e){let t=new NS.Parser;return r.on("data",n=>t.parse(n,e)),new Promise(n=>r.on("end",()=>n()))}Qe.parse=qS});var Jc=f(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});qi.default={}});var el=f((xI,Zc)=>{var{getStream:MS,getSecureStream:DS}=BS();Zc.exports={getStream:MS,getSecureStream:DS};function kS(){function r(t){let n=require("net");return new n.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function $S(){function r(t){let{CloudflareSocket:n}=Jc();return new n(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function FS(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function BS(){return FS()?$S():kS()}});var Di=f((LI,tl)=>{"use strict";var US=require("events").EventEmitter,{parse:WS,serialize:K}=Ni(),{getStream:jS,getSecureStream:HS}=el(),GS=K.flush(),VS=K.sync(),QS=K.end(),Mi=class extends US{constructor(e){super(),e=e||{},this.stream=e.stream||jS(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(n){n==="message"&&(t._emitMessage=!0)})}connect(e,t){let n=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){n._keepAlive&&n.stream.setKeepAlive(!0,n._keepAliveInitialDelayMillis),n.emit("connect")});let s=function(i){n._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||n.emit("error",i)};if(this.stream.on("error",s),this.stream.on("close",function(){n.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){switch(i.toString("utf8")){case"S":break;case"N":return n.stream.end(),n.emit("error",new Error("The server does not support SSL connections"));default:return n.stream.end(),n.emit("error",new Error("There was an error establishing an SSL connection"))}let a={socket:n.stream};n.ssl!==!0&&(Object.assign(a,n.ssl),"key"in n.ssl&&(a.key=n.ssl.key));let u=require("net");u.isIP&&u.isIP(t)===0&&(a.servername=t);try{n.stream=HS(a)}catch(c){return n.emit("error",c)}n.attachListeners(n.stream),n.stream.on("error",s),n.emit("sslconnect")})}attachListeners(e){WS(e,t=>{let n=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(n,t)})}requestSsl(){this.stream.write(K.requestSsl())}startup(e){this.stream.write(K.startup(e))}cancel(e,t){this._send(K.cancel(e,t))}password(e){this._send(K.password(e))}sendSASLInitialResponseMessage(e,t){this._send(K.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(K.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(K.query(e))}parse(e){this._send(K.parse(e))}bind(e){this._send(K.bind(e))}execute(e){this._send(K.execute(e))}flush(){this.stream.writable&&this.stream.write(GS)}sync(){this._ending=!0,this._send(VS)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(QS,()=>{this.stream.end()})}close(e){this._send(K.close(e))}describe(e){this._send(K.describe(e))}sendCopyFromChunk(e){this._send(K.copyData(e))}endCopyFrom(){this._send(K.copyDone())}sendCopyFail(e){this._send(K.copyFail(e))}};tl.exports=Mi});var il=f((PI,sl)=>{"use strict";var{Transform:XS}=require("stream"),{StringDecoder:KS}=require("string_decoder"),Xe=Symbol("last"),vn=Symbol("decoder");function zS(r,e,t){let n;if(this.overflow){if(n=this[vn].write(r).split(this.matcher),n.length===1)return t();n.shift(),this.overflow=!1}else this[Xe]+=this[vn].write(r),n=this[Xe].split(this.matcher);this[Xe]=n.pop();for(let s=0;s<n.length;s++)try{nl(this,this.mapper(n[s]))}catch(i){return t(i)}if(this.overflow=this[Xe].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function YS(r){if(this[Xe]+=this[vn].end(),this[Xe])try{nl(this,this.mapper(this[Xe]))}catch(e){return r(e)}r()}function nl(r,e){e!==void 0&&r.push(e)}function rl(r){return r}function JS(r,e,t){switch(r=r||/\r?\n/,e=e||rl,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=rl)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=zS,t.flush=YS,t.readableObjectMode=!0;let n=new XS(t);return n[Xe]="",n[vn]=new KS("utf8"),n.matcher=r,n.mapper=e,n.maxLength=t.maxLength,n.skipOverflow=t.skipOverflow||!1,n.overflow=!1,n._destroy=function(s,i){this._writableState.errorEmitted=!1,i(s)},n}sl.exports=JS});var ul=f((OI,qe)=>{"use strict";var ol=require("path"),ZS=require("stream").Stream,eE=il(),al=require("util"),tE=5432,Sn=process.platform==="win32",gr=process.stderr,rE=56,nE=7,sE=61440,iE=32768;function oE(r){return(r&sE)==iE}var xt=["host","port","database","user","password"],ki=xt.length,aE=xt[ki-1];function $i(){var r=gr instanceof ZS&&gr.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);gr.write(al.format.apply(al,e))}}Object.defineProperty(qe.exports,"isWin",{get:function(){return Sn},set:function(r){Sn=r}});qe.exports.warnTo=function(r){var e=gr;return gr=r,e};qe.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(Sn?ol.join(e.APPDATA||"./","postgresql","pgpass.conf"):ol.join(e.HOME||"./",".pgpass"));return t};qe.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:Sn?!0:(e=e||"<unkn>",oE(r.mode)?r.mode&(rE|nE)?($i('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:($i('WARNING: password file "%s" is not a plain file',e),!1))};var uE=qe.exports.match=function(r,e){return xt.slice(0,-1).reduce(function(t,n,s){return s==1&&Number(r[n]||tE)===Number(e[n])?t&&!0:t&&(e[n]==="*"||e[n]===r[n])},!0)};qe.exports.getPassword=function(r,e,t){var n,s=e.pipe(eE());function i(u){var c=cE(u);c&&lE(c)&&uE(r,c)&&(n=c[aE],s.end())}var o=function(){e.destroy(),t(n)},a=function(u){e.destroy(),$i("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",a),s.on("data",i).on("end",o).on("error",a)};var cE=qe.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",n=0,s=0,i=0,o={},a=!1,u=function(l,d,p){var h=r.substring(d,p);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(h=h.replace(/\\([:\\])/g,"$1")),o[xt[l]]=h},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),a=n==ki-1,a){u(n,s);break}c>=0&&e==":"&&t!=="\\"&&(u(n,s,c+1),s=c+2,n+=1)}return o=Object.keys(o).length===ki?o:null,o},lE=qe.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<xt.length;t+=1){var n=e[t],s=r[xt[t]]||"",i=n(s);if(!i)return!1}return!0}});var ll=f((qI,Fi)=>{"use strict";var NI=require("path"),cl=require("fs"),En=ul();Fi.exports=function(r,e){var t=En.getFileName();cl.stat(t,function(n,s){if(n||!En.usePgPass(s,t))return e(void 0);var i=cl.createReadStream(t);En.getPassword(r,i,e)})};Fi.exports.warnTo=En.warnTo});var pl=f((MI,hl)=>{"use strict";var dE=require("events").EventEmitter,dl=Tt(),Bi=Pc(),fE=fn(),hE=ui(),fl=Hc(),pE=hr(),gE=Di(),mE=ii(),_n=class extends dE{constructor(e){super(),this.connectionParameters=new hE(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new fE(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new gE({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||pE.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=n=>{process.nextTick(()=>{n.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,n=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let s=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(s)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{n._ending=!0,n.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){t.ssl?n.requestSsl():n.startup(t.getStartupConf())}),n.on("sslconnect",function(){n.startup(t.getStartupConf())}),this._attachListeners(n),n.once("end",()=>{let s=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(s),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(s):this._handleErrorEvent(s):this._connectionError||this._handleErrorEvent(s)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,n)=>{this._connect(s=>{s?n(s):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(n=>{if(n!==void 0){if(typeof n!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=n}else this.connectionParameters.password=this.password=null;e()}).catch(n=>{t.emit("error",n)});else if(this.password!==null)e();else try{ll()(this.connectionParameters,s=>{s!==void 0&&(this.connectionParameters.password=this.password=s),e()})}catch(n){this.emit("error",n)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await mE.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Bi.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await Bi.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{Bi.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},n=e.application_name||e.fallback_application_name;return n&&(t.application_name=n),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let n=this.connection;this.host&&this.host.indexOf("/")===0?n.connect(this.host+"/.s.PGSQL."+this.port):n.connect(this.port,this.host),n.on("connect",function(){n.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,n){return this._types.setTypeParser(e,t,n)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return dl.escapeIdentifier(e)}escapeLiteral(e){return dl.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,n){let s,i,o,a,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,i=s=e,typeof t=="function"&&(s.callback=s.callback||t)):(o=e.query_timeout||this.connectionParameters.query_timeout,s=new fl(e,t,n),s.callback||(i=new this._Promise((c,l)=>{s.callback=(d,p)=>d?l(d):c(p)}).catch(c=>{throw Error.captureStackTrace(c),c}))),o&&(u=s.callback,a=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{s.handleError(c,this.connection)}),u(c),s.callback=()=>{};let l=this.queryQueue.indexOf(s);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},o),s.callback=(c,l)=>{clearTimeout(a),u(c,l)}),this.binary&&!s.binary&&(s.binary=!0),s._result&&!s._result._types&&(s._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(s),this._pulseQueryQueue(),i):(process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};_n.Query=fl;hl.exports=_n});var vl=f((DI,yl)=>{"use strict";var yE=require("events").EventEmitter,gl=function(){},ml=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},Ui=class{constructor(e,t,n){this.client=e,this.idleListener=t,this.timeoutId=n}},Lt=class{constructor(e){this.callback=e}};function vE(){throw new Error("Release called on client which has already been released to the pool.")}function bn(r,e){if(e)return{callback:e,result:void 0};let t,n,s=function(o,a){o?t(o):n(a)},i=new r(function(o,a){n=o,t=a}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:s,result:i}}function SE(r,e){return function t(n){n.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",n)}),r._remove(e),r.emit("error",n,e)}}var Wi=class extends yE{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||ji().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let n=t.client;n.ref&&n.ref();let s=t.idleListener;return this._acquireClient(n,e,s,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let n=ml(this._idle,i=>i.client===e);n!==void 0&&clearTimeout(n.timeoutId),this._clients=this._clients.filter(i=>i!==e);let s=this;e.end(()=>{s.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let s=new Error("Cannot use a pool after calling end on the pool");return e?e(s):this.Promise.reject(s)}let t=bn(this.Promise,e),n=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new Lt(t.callback)),n;let s=(a,u,c)=>{clearTimeout(o),t.callback(a,u,c)},i=new Lt(s),o=setTimeout(()=>{ml(this._pendingQueue,a=>a.callback===s),i.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return o.unref&&o.unref(),this._pendingQueue.push(i),n}return this.newClient(new Lt(t.callback)),n}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let n=SE(this,t);this.log("checking client timeout");let s,i=!1;this.options.connectionTimeoutMillis&&(s=setTimeout(()=>{this.log("ending client due to timeout"),i=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(s&&clearTimeout(s),t.on("error",n),o)this.log("client failed to connect",o),this._clients=this._clients.filter(a=>a!==t),i&&(o=new Error("Connection terminated due to connection timeout",{cause:o})),this._pulseQueue(),e.timedOut||e.callback(o,void 0,gl);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new Lt((c,l,d)=>d()),n,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),t.once("end",()=>clearTimeout(a))}return this._acquireClient(t,e,n,!0)}})}_acquireClient(e,t,n,s){s&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,n),e.removeListener("error",n),t.timedOut?s&&this.options.verify?this.options.verify(e,e.release):e.release():s&&this.options.verify?this.options.verify(e,i=>{if(i)return e.release(i),t.callback(i,void 0,gl);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let n=!1;return s=>{n&&vE(),n=!0,this._release(e,t,s)}}_release(e,t,n){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",n,e),n||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let i;this.options.idleTimeoutMillis&&this._isAboveMin()&&(i=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&i.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new Ui(e,t,i)),this._pulseQueue()}query(e,t,n){if(typeof e=="function"){let i=bn(this.Promise,e);return setImmediate(function(){return i.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),i.result}typeof t=="function"&&(n=t,t=void 0);let s=bn(this.Promise,n);return n=s.callback,this.connect((i,o)=>{if(i)return n(i);let a=!1,u=c=>{a||(a=!0,o.release(c),n(c))};o.once("error",u),this.log("dispatching query");try{o.query(e,t,(c,l)=>{if(this.log("query dispatched"),o.removeListener("error",u),!a)return a=!0,o.release(c),c?n(c):n(void 0,l)})}catch(c){return o.release(c),n(c)}}),s.result}end(e){if(this.log("ending"),this.ending){let n=new Error("Called end on pool more than once");return e?e(n):this.Promise.reject(n)}this.ending=!0;let t=bn(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};yl.exports=Wi});var _l=f((kI,El)=>{"use strict";var Sl=require("events").EventEmitter,EE=require("util"),Hi=Tt(),Pt=El.exports=function(r,e,t){Sl.call(this),r=Hi.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(n){n==="row"&&(this._emitRowEvents=!0)}.bind(this))};EE.inherits(Pt,Sl);var _E={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Pt.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let n=_E[t]||t;r[n]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};Pt.prototype.then=function(r,e){return this._getPromise().then(r,e)};Pt.prototype.catch=function(r){return this._getPromise().catch(r)};Pt.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};Pt.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(n,s,i){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),n)return e.handleError(n);e._emitRowEvents&&(i.length>1?s.forEach((o,a)=>{o.forEach(u=>{e.emit("row",u,i[a])})}):s.forEach(function(o){e.emit("row",o,i)})),e.state="end",e.emit("end",i),e.callback&&e.callback(null,i)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let n=(this.values||[]).map(Hi.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let s=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(s)}return r.native.execute(this.name,n,t)}return r.native.prepare(this.name,this.text,n.length,function(s){return s?t(s):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,n,t))})}else if(this.values){if(!Array.isArray(this.values)){let s=new Error("Query values must be an array");return t(s)}let n=this.values.map(Hi.prepareValue);r.native.query(this.text,n,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var Cl=f(($I,Al)=>{"use strict";var bl;try{bl=require("pg-native")}catch(r){throw r}var bE=fn(),wl=require("events").EventEmitter,wE=require("util"),TE=ui(),Tl=_l(),le=Al.exports=function(r){wl.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new bE(r.types),this.native=new bl({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new TE(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};le.Query=Tl;wE.inherits(le,wl);le.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};le.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,n){if(e.connectionParameters.nativeConnectionString&&(n=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(n,function(s){if(s)return e.native.end(),r(s);e._connected=!0,e.native.on("error",function(i){e._queryable=!1,e._errorAllQueries(i),e.emit("error",i)}),e.native.on("notification",function(i){e.emit("notification",{channel:i.relname,payload:i.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};le.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(n=>{n?t(n):e()})})};le.prototype.query=function(r,e,t){let n,s,i,o,a;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")i=r.query_timeout||this.connectionParameters.query_timeout,s=n=r,typeof e=="function"&&(r.callback=e);else if(i=r.query_timeout||this.connectionParameters.query_timeout,n=new Tl(r,e,t),!n.callback){let u,c;s=new this._Promise((l,d)=>{u=l,c=d}).catch(l=>{throw Error.captureStackTrace(l),l}),n.callback=(l,d)=>l?c(l):u(d)}return i&&(a=n.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{n.handleError(u,this.connection)}),a(u),n.callback=()=>{};let c=this._queryQueue.indexOf(n);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},i),n.callback=(u,c)=>{clearTimeout(o),a(u,c)}),this._queryable?this._ending?(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"))}),s):(this._queryQueue.push(n),this._pulseQueryQueue(),s):(n.native=this.native,process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"))}),s)};le.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(n,s){r=i=>i?s(i):n()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};le.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};le.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};le.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};le.prototype.ref=function(){};le.prototype.unref=function(){};le.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};le.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var Gi=f((FI,Rl)=>{"use strict";Rl.exports=Cl()});var ji=f((UI,mr)=>{"use strict";var AE=pl(),CE=hr(),RE=Di(),IE=li(),xE=Tt(),LE=vl(),PE=fn(),{DatabaseError:OE}=Ni(),{escapeIdentifier:NE,escapeLiteral:qE}=Tt(),ME=r=>class extends LE{constructor(t){super(t,r)}},Vi=function(r){this.defaults=CE,this.Client=r,this.Query=this.Client.Query,this.Pool=ME(this.Client),this._pools=[],this.Connection=RE,this.types=fr(),this.DatabaseError=OE,this.TypeOverrides=PE,this.escapeIdentifier=NE,this.escapeLiteral=qE,this.Result=IE,this.utils=xE};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?mr.exports=new Vi(Gi()):(mr.exports=new Vi(AE),Object.defineProperty(mr.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new Vi(Gi())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(mr.exports,"native",{value:r}),r}}))});var Ol=f((ZI,Pl)=>{"use strict";function Qi(r){return typeof r=="function"}var oe=console.error.bind(console);function yr(r,e,t){var n=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:n,writable:!0,value:t})}function vr(r){r&&r.logger&&(Qi(r.logger)?oe=r.logger:oe("new logger isn't a function, not replacing"))}function xl(r,e,t){if(!r||!r[e]){oe("no original function "+e+" to wrap");return}if(!t){oe("no wrapper function"),oe(new Error().stack);return}if(!Qi(r[e])||!Qi(t)){oe("original object and wrapper must be functions");return}var n=r[e],s=t(n,e);return yr(s,"__original",n),yr(s,"__unwrap",function(){r[e]===s&&yr(r,e,n)}),yr(s,"__wrapped",!0),yr(r,e,s),s}function DE(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{oe("must provide one or more modules to patch"),oe(new Error().stack);return}if(!(e&&Array.isArray(e))){oe("must provide one or more functions to wrap on modules");return}r.forEach(function(n){e.forEach(function(s){xl(n,s,t)})})}function Ll(r,e){if(!r||!r[e]){oe("no function to unwrap."),oe(new Error().stack);return}if(!r[e].__unwrap)oe("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function kE(r,e){if(r)Array.isArray(r)||(r=[r]);else{oe("must provide one or more modules to patch"),oe(new Error().stack);return}if(!(e&&Array.isArray(e))){oe("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(n){Ll(t,n)})})}vr.wrap=xl;vr.massWrap=DE;vr.unwrap=Ll;vr.massUnwrap=kE;Pl.exports=vr});var kl=f((ex,Dl)=>{"use strict";var ql=Ol(),Ot=ql.wrap,wn=ql.unwrap,Me="wrap@before";function Tn(r,e,t){var n=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:n,writable:!0,value:t})}function $E(r,e){for(var t=e.length,n=0;n<t;n++){var s=e[n],i=r[Me];if(typeof i=="function")i(s);else if(Array.isArray(i))for(var o=i.length,a=0;a<o;a++)i[a](s)}}function Ml(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function FE(r,e,t){var n=Ml(r,e),s=n.filter(function(i){return t.indexOf(i)===-1});s.length>0&&$E(r,s)}function Nl(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var n=0;n<r.length;n++)t[n]=e(r[n])}return t}}Dl.exports=function(e,t,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function s(o){return function(u,c){var l=Ml(this,u).slice();try{var d=o.call(this,u,c);return FE(this,u,l),d}finally{this.on.__wrapped||Ot(this,"on",s),this.addListener.__wrapped||Ot(this,"addListener",s)}}}function i(o){return function(u){if(!this._events||!this._events[u])return o.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Nl(c,n)}}}Ot(this,"removeListener",l);try{return this._events[u]=Nl(c,n),o.apply(this,arguments)}finally{wn(this,"removeListener"),this._events[u]=c}}}e[Me]?typeof e[Me]=="function"?Tn(e,Me,[e[Me],t]):Array.isArray(e[Me])&&e[Me].push(t):Tn(e,Me,t),e.__wrapped||(Ot(e,"addListener",s),Ot(e,"on",s),Ot(e,"emit",i),Tn(e,"__unwrap",function(){wn(e,"addListener"),wn(e,"on"),wn(e,"emit"),delete e[Me],delete e.__wrapped}),Tn(e,"__wrapped",!0))}});var Ul=f((tx,Bl)=>{"use strict";var T=require("util"),De=require("assert"),BE=kl(),P=require("async_hooks"),Sr="cls@contexts",Er="error@context",U=process.env.DEBUG_CLS_HOOKED,w=-1;Bl.exports={getNamespace:$l,createNamespace:UE,destroyNamespace:Fl,reset:WE,ERROR_SYMBOL:Er};function ge(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}ge.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,U){let n=" ".repeat(this._indent<0?0:this._indent);M(n+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+w+" active:"+T.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};ge.prototype.get=function(e){if(!this.active){if(U){let t=P.currentId(),n=P.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);M(`${s}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${w} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length}`)}return}if(U){let t=P.executionAsyncId(),n=P.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);M(s+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+w+" active:"+T.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),M(`${s}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${w} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length} active:${T.inspect(this.active)}`)}return this.active[e]};ge.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=w,U){let t=P.executionAsyncId(),n=P.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);M(`${s}CONTEXT-CREATED Context: (${this.name}) currentUid:${w} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length} context:${T.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};ge.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(U){let n=P.triggerAsyncId(),s=P.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);M(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${w} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} context:${T.inspect(t)}`)}return e(t),t}catch(n){throw n&&(n[Er]=t),n}finally{if(U){let n=P.triggerAsyncId(),s=P.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);M(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${w} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${T.inspect(t)}`)}this.exit(t)}};ge.prototype.runAndReturn=function(e){let t;return this.run(function(n){t=e(n)}),t};ge.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let n=e(t);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return U&&M("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+w+" len:"+this._set.length+" "+T.inspect(t)),n.then(s=>(U&&M("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+w+" len:"+this._set.length+" "+T.inspect(t)),this.exit(t),s)).catch(s=>{throw s[Er]=t,U&&M("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+w+" len:"+this._set.length+" "+T.inspect(t)),this.exit(t),s})};ge.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let n=this;return function(){n.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[Er]=t),i}finally{n.exit(t)}}};ge.prototype.enter=function(e){if(De.ok(e,"context must be provided for entering"),U){let t=P.executionAsyncId(),n=P.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);M(`${s}CONTEXT-ENTER: (${this.name}) currentUid:${w} triggerId:${n} asyncHooksCurrentId:${t} len:${this._set.length} ${T.inspect(e)}`)}this._set.push(this.active),this.active=e};ge.prototype.exit=function(e){if(De.ok(e,"context must be provided for exiting"),U){let n=P.executionAsyncId(),s=P.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);M(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${w} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${T.inspect(e)}`)}if(this.active===e){De.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(U&&M("??ERROR?? context exiting but not entered - ignoring: "+T.inspect(e)),De.ok(t>=0,`context not currently entered; can't exit. 
`+T.inspect(this)+`
`+T.inspect(e))):(De.ok(t,"can't remove top context"),this._set.splice(t,1))};ge.prototype.bindEmitter=function(e){De.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,n="context@"+this.name;function s(o){o&&(o[Sr]||(o[Sr]=Object.create(null)),o[Sr][n]={namespace:t,context:t.active})}function i(o){if(!(o&&o[Sr]))return o;let a=o,u=o[Sr];return Object.keys(u).forEach(function(c){let l=u[c];a=l.namespace.bind(a,l.context)}),a}BE(e,s,i)};ge.prototype.fromException=function(e){return e[Er]};function $l(r){return process.namespaces[r]}function UE(r){De.ok(r,"namespace must be given a name."),U&&M(`NS-CREATING NAMESPACE (${r})`);let e=new ge(r);return e.id=w,P.createHook({init(n,s,i,o){if(w=P.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),U){let a=" ".repeat(e._indent<0?0:e._indent);M(`${a}INIT [${s}] (${r}) asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(w===0){let a=P.triggerAsyncId(),u=e._contexts.get(a);if(u){if(e._contexts.set(n,u),U){let c=" ".repeat(e._indent<0?0:e._indent);M(`${c}INIT USING CONTEXT FROM TRIGGERID [${s}] (${r}) asyncId:${n} currentUid:${w} triggerId:${a} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(U){let c=" ".repeat(e._indent<0?0:e._indent);M(`${c}INIT MISSING CONTEXT [${s}] (${r}) asyncId:${n} currentUid:${w} triggerId:${a} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}if(U&&s==="PROMISE"){M(T.inspect(o,{showHidden:!0}));let a=o.parentId,u=" ".repeat(e._indent<0?0:e._indent);M(`${u}INIT RESOURCE-PROMISE [${s}] (${r}) parentId:${a} asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}},before(n){w=P.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(w),s){if(U){let i=P.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);M(`${o}BEFORE (${r}) asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${T.inspect(s)}`),e._indent+=2}e.enter(s)}else if(U){let i=P.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);M(`${o}BEFORE MISSING CONTEXT (${r}) asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${T.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){w=P.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(w),s){if(U){let i=P.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);M(`${o}AFTER (${r}) asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${T.inspect(s)}`)}e.exit(s)}else if(U){let i=P.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);M(`${o}AFTER MISSING CONTEXT (${r}) asyncId:${n} currentUid:${w} triggerId:${i} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${T.inspect(s)}`)}},destroy(n){if(w=P.executionAsyncId(),U){let s=P.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);M(`${i}DESTROY (${r}) currentUid:${w} asyncId:${n} triggerId:${s} active:${T.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${T.inspect(e._contexts.get(w))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[r]=e,e}function Fl(r){let e=$l(r);De.ok(e,`can't delete nonexistent namespace! "`+r+'"'),De.ok(e.id,"don't assign to process.namespaces directly! "+T.inspect(e)),process.namespaces[r]=null}function WE(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){Fl(r)}),process.namespaces=Object.create(null)}process.namespaces={};function M(...r){U&&process._rawDebug(`${T.format(...r)}`)}});var D=f((rx,Hl)=>{"use strict";var Xi=["debug","info","warn","error","silent"],Wl=Xi.indexOf("error"),jE=HE(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),jl={error:An("error"),info:An("info"),warn:An("warn"),debug:An("debug")};function An(r){var e=Xi.indexOf(r),t=console[r]||console.log||(()=>{});return e>=jE?(n,s)=>{(n||s)&&t(QE(r,n,s))}:()=>{}}function HE(r){if(r){var e=r.toLowerCase(),t=Xi.indexOf(e);return t>=0?t:Wl}return Wl}function GE(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",n=function(s){var i=Math.floor(Math.abs(s));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+n(e/60)+":"+n(e%60)}function VE(){return process.env.LAMBDA_TASK_ROOT!==void 0}function QE(r,e,t){var n=[];VE()||(n.push(GE(new Date)),n.push(`[${r.toUpperCase()}]`)),e&&n.push(e);var s=n.join(" "),i=XE(t);return[s,i].filter(o=>o.length>0).join(`
  `)}function XE(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var KE={setLogger:function(e){jl=e},getLogger:function(){return jl}};Hl.exports=KE});var Ki=f((nx,Vl)=>{"use strict";var zE=require("crypto");function Gl(r,e){this.init(r,e)}Gl.prototype.init=function(e,t){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!t,this.id=zE.randomBytes(8).toString("hex"),n.stack){var s=n.stack.split(`
`);s.shift(),s.forEach(i=>{var o=i.trim().replace(/\(|\)/g,"");o=o.substring(o.indexOf(" ")+1);var a=o.lastIndexOf(" ")>=0?o.slice(0,o.lastIndexOf(" ")):null,u=Array.isArray(a)&&!a.length?o:o.slice(o.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:a||"anonymous"};this.stack.push(c)},this)}};Vl.exports=Gl});var Xl=f((sx,Ql)=>{Ql.exports=YE;function YE(r){var e=!1,t=null,n=null,s=null;return o;function i(a){s&&e_(s,a),e=!1,s=n;var u=t;if(t=null,n=null,!u||!u.length){if(!s||!s.length){s=null;return}u||(u=[])}e=!0,r(u,i)}function o(a,u){e?(t||(t=[],n=[]),JE(t,a),u&&n.push(u)):(u&&(s=[u]),e=!0,r(Array.isArray(a)?a:[a],i))}}function JE(r,e){Array.isArray(e)?ZE(r,e):r.push(e)}function ZE(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function e_(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Cn=f((ix,Yl)=>{"use strict";var Kl=D(),Ae={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?Kl.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(zl(e),Kl.getLogger().info("Configured daemon address to "+e+"."))}},zl=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");Ae.udp_ip=n[0],Ae.tcp_ip=n[0],Ae.udp_port=n[1],Ae.tcp_port=n[1]}else if(t.length===2){var s=t[0].split(":"),i=t[1].split(":"),o={};if(o[s[0]]=s,o[i[0]]=i,Ae.udp_ip=o.udp[1],Ae.udp_port=parseInt(o.udp[2]),Ae.tcp_ip=o.tcp[1],Ae.tcp_port=parseInt(o.tcp[2]),!Ae.udp_port||!Ae.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&zl(process.env.AWS_XRAY_DAEMON_ADDRESS);Yl.exports=Ae});var In=f((ox,nd)=>{"use strict";var ed=require("dgram"),t_=Xl(),Rn=D(),Jl='{"format":"json","version":1}',Zl=`
`;function r_(r,e){var t=ed.createSocket("udp4");td(t,r,0,function(){try{t.close()}finally{e()}})}function td(r,e,t,n){if(t>=e.length){n();return}n_(r,e[t],function(){td(r,e,t+1,n)})}function n_(r,e,t){var n=e.msg,s=e.offset,i=e.length,o=e.port,a=e.address,u=e.callback;r.send(n,s,i,o,a,function(c){try{u(c)}finally{t()}})}function rd(){this.batchSend=t_(r_)}rd.prototype.send=function(r,e,t,n,s,i){var o={msg:r,offset:e,length:t,port:n,address:s,callback:i};this.batchSend(o)};var s_={daemonConfig:Cn(),format:function(e){return Jl+Zl+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new rd:this.socket=ed.createSocket("udp4").unref());var t=this.socket,n=e.format(),s=Jl+Zl+n,i=Buffer.from(s),o='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',a=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?Rn.getLogger().error(a+" too large to send: "+o+" ("+i.length+" bytes)."):Rn.getLogger().error("Error occured sending segment: ",u):(Rn.getLogger().debug(a+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),Rn.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};nd.exports=s_});var Ln=f((ax,sd)=>{"use strict";var i_=require("crypto"),xn=D(),zi=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||i_.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var n=new r,s,i;if(!e||typeof e!="string")return xn.getLogger().error("Empty or non-string trace ID provided"),n;let o=e.trim().split(t);return o.length!==3?(xn.getLogger().error("Unrecognized trace ID format"),n):(s=parseInt(o[0]),isNaN(s)||s<1?(xn.getLogger().error("Trace ID version must be positive integer"),n):(i=parseInt(o[1],16).toString(16),i==="NaN"?(xn.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(i=i.padStart(8,"0"),n.version=s,n.timestamp=i,n.id=o[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};sd.exports=zi});var Z=f((ux,id)=>{"use strict";var o_=require("crypto"),_r=D(),a_=Ln(),Yi={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,s=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===n-1){var o=function(){for(var p=0,h=0;h<n;h++){var E=e.charAt(h);if(E==="*")return!0;if(E==="?"){if(p===s)return!1;p++}else{if(p>=s||E!=t.charAt(p))return!1;p++}}return p===s};return o()}var a=[];a[0]=!0;for(var u=0;u<n;u++){var c,l=e.charAt(u);if(l!="*")for(c=s-1;c>=0;c--)a[c+1]=!!a[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=s&&!a[c];)c++;for(c;c<=s;c++)a[c]=!0}a[0]=a[0]&&l==="*"}return a[s]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=Yi.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){_r.getLogger().debug("Lambda trace data found: "+e);let t=Yi.processTraceData(e);var n=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,n=!0):!t.root||!t.parent||!t.sampled?_r.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(t={},_r.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=a_.FromString(t.root).toString(),r.id=t.parent||o_.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(_r.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),_r.getLogger().debug("Segment started: "+JSON.stringify(t)),n}},processTraceData:function(e){var t={},n={},s=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(o){if(o){var a=o.split("=");if(a[0]&&a[1]){let u=a[0].trim(),c=a[1].trim(),l=u.toLowerCase(),d=s.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(n[u]=c,i-=u.length+c.length)}}}),t.data=n),t},objectWithoutProperties:function(e,t,n){t=Array.isArray(t)?t:[],n=typeof n=="boolean"?n:!1;var s=n?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};id.exports=Yi});var Ke=f((cx,ud)=>{"use strict";var{safeParseInt:od}=Z(),ad=D(),u_=100,Ji={streamingThreshold:u_,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(Ji.streamingThreshold=e,ad.getLogger().debug("Subsegment streaming threshold set to: "+e)):ad.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return Ji.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=od(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=od(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};ud.exports=Ji});var dd=f((lx,ld)=>{"use strict";var{getHttpResponseData:c_}=Ke(),{stripQueryStringFromPath:l_}=Z();function cd(r,e,t){this.init(r,e,t)}cd.prototype.init=function(e,t,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+l_(e.path):"",method:e.method||""},n&&(this.request.traced=!0),t&&(this.response=c_(t))};ld.exports=cd});var br=f((dx,fd)=>{"use strict";var d_=require("crypto"),f_=Ki(),h_=dd(),p_=In(),Pn=Ke(),g_=Z(),ke=D();function A(r){this.init(r)}A.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=d_.randomBytes(8).toString("hex"),this.name=e,this.start_time=Pn.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};A.prototype.addNewSubsegment=function(e){let t=new A(e);return this.addSubsegment(t),t};A.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};A.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new A(e);return this.addSubsegment(t),t.notTraced=!0,t};A.prototype.addSubsegment=function(r){if(!(r instanceof A))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};A.prototype.removeSubsegment=function(e){if(!(e instanceof A))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};A.prototype.addAttribute=function(e,t){this[e]=t};A.prototype.addPrecursorId=function(r){typeof r!="string"&&ke.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};A.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){ke.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){ke.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};A.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ke.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ke.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=t||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][r]=e??"")};A.prototype.addSqlData=function(e){this.sql=e};A.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ke.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new f_(e,t))};A.prototype.addRemoteRequestData=function(e,t,n){this.http=new h_(e,t,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};A.prototype.addFaultFlag=function(){this.fault=!0};A.prototype.addErrorFlag=function(){this.error=!0};A.prototype.addThrottleFlag=function(){this.throttle=!0};A.prototype.close=function(e,t){var n=this.segment;this.end_time=Pn.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),n&&n.counter>Pn.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};A.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};A.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};A.prototype.isClosed=function(){return!this.in_progress};A.prototype.flush=function(){if(!this.parent||!this.segment){ke.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?p_.send(this):ke.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):ke.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};A.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};A.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};A.prototype.toString=function(){return this.serialize()};A.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=g_.objectWithoutProperties(this,e,!1);return t};A.prototype.serialize=function(e){return JSON.stringify(e??this,Pn.getJsonStringifyReplacer())};fd.exports=A});var wr=f((fx,gd)=>{"use strict";var m_=require("crypto"),y_=Ki(),v_=In(),me=Ke(),On=br(),hd=Ln(),pd=Z(),ze=D();function x(r,e,t){this.init(r,e,t)}x.prototype.init=function(e,t,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var s;t&&typeof t=="string"?s=hd.FromString(t):s=new hd;var i=m_.randomBytes(8).toString("hex"),o=me.getCurrentTime();this.trace_id=s.toString(),this.id=i,this.start_time=o,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),me.serviceData&&this.setServiceData(me.serviceData),me.pluginData&&this.addPluginData(me.pluginData),me.origin&&(this.origin=me.origin),me.sdkData&&this.setSDKData(me.sdkData)};x.prototype.addIncomingRequestData=function(e){this.http=e};x.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){ze.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){ze.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};x.prototype.setUser=function(r){typeof r!="string"&&ze.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};x.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ze.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ze.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=t||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][r]=e??"")};x.prototype.setSDKData=function(e){if(!e){ze.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};x.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};x.prototype.setServiceData=function(e){if(!e){ze.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};x.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};x.prototype.addNewSubsegment=function(e){var t=new On(e);return this.addSubsegment(t),t};x.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};x.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new On(e);return this.addSubsegment(t),t.notTraced=!0,t};x.prototype.addSubsegment=function(e){if(!(e instanceof On))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};x.prototype.removeSubsegment=function(e){if(!(e instanceof On))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};x.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ze.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new y_(e,t))};x.prototype.addFaultFlag=function(){this.fault=!0};x.prototype.addErrorFlag=function(){this.error=!0};x.prototype.addThrottleFlag=function(){this.throttle=!0};x.prototype.isClosed=function(){return!this.in_progress};x.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>me.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(n){n.streamSubsegments()||t.push(n)}),this.subsegments=t}};x.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};x.prototype.close=function(r,e){this.end_time||(this.end_time=me.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};x.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=pd.objectWithoutProperties(this,["counter","notTraced"],!0);v_.send(e)}};x.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=pd.objectWithoutProperties(this,e,!1);return this.serialize(t)};x.prototype.toString=function(){return this.serialize()};x.prototype.serialize=function(e){return JSON.stringify(e??this,me.getJsonStringifyReplacer())};gd.exports=x});var Je=f((hx,Sd)=>{"use strict";var Tr=Ul(),Ce=D(),Zi=wr(),md=br(),$e=!0,Ye="AWSXRay",yd="segment",vd=!1,ee={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);Ce.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!ee.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,n=e.Segment,s=null;return t&&(t instanceof Zi||t instanceof md)?(s=t,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof Zi||n instanceof md)&&(s=n,delete e.Segment),s}},getNamespace:function(){return Tr.getNamespace(Ye)||Tr.createNamespace(Ye)},resolveSegment:function(e){if($e)return this.getSegment();if(e&&!$e)return e;!e&&!$e&&ee.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if($e){var e=ee.getNamespace(Ye).get(yd);return e?e instanceof Zi&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():ee.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else ee.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){$e?ee.getNamespace(Ye).set(yd,e)||Ce.getLogger().warn("Failed to set the current sub/segment on the context."):ee.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return $e},enableAutomaticMode:function(){$e=!0,ee.getNamespace(Ye),Ce.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){$e=!1,Tr.getNamespace(Ye)&&Tr.destroyNamespace(Ye),Ce.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(vd)Ce.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=ee.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)ee.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Ce.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Ce.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(ee.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")ee.contextMissingStrategy.contextMissing=e,Ce.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?($e=!1,Ce.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(Tr.createNamespace(Ye),Ce.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(ee.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),vd=!0):(ee.contextMissingStrategy.contextMissing=ee.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Ce.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Sd.exports=ee});var to=f((px,Ed)=>{"use strict";var{getHttpResponseData:S_}=Ke();function eo(r){this.init(r)}eo.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:E_(e)||"",url:n||""},t&&(this.request.x_forwarded_for=t)};var E_=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};eo.prototype.close=function(e){this.response=S_(e)};Ed.exports=eo});var bd=f((gx,_d)=>{"use strict";function ro(r,e){this.init(r,e)}ro.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};ro.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};_d.exports=ro});var wd=f((mx,__)=>{__.exports={default:{fixed_target:1,rate:.05},version:2}});var so=f((yx,Id)=>{"use strict";var b_=require("fs"),Td=bd(),no=Z(),w_=wd(),Nn=D(),Cd={shouldSample:function(e){var t=e.host,n=e.httpMethod,s=e.urlPath,i="{ http_method: "+n+", host: "+t+", url_path: "+s+" }",o;return this.rules.some(function(a){if(a.default||t==null||no.wildcardMatch(a.host,t)&&(n==null||no.wildcardMatch(a.http_method,n))&&(s==null||no.wildcardMatch(a.url_path,s)))return o=a.reservoir,Nn.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(a.default?"default":"{ http_method: "+a.http_method+", host: "+a.host+", url_path: "+a.url_path+" }")+". Using fixed_target: "+o.fixedTarget+" and rate: "+o.fallbackRate+"."),!0}),o?o.isSampled():(Nn.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Nn.getLogger().info("Using custom sampling rules file: "+e),this.rules=Ad(JSON.parse(b_.readFileSync(e,"utf8")))):(Nn.getLogger().info("Using custom sampling rules source."),this.rules=Ad(e)):this.rules=Rd(w_)}},Ad=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Rd(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Rd=function(e){var t,n=[];if(e.default){var s=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&s.push("fixed_target"),typeof e.default.rate>"u"&&s.push("rate"),s.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+s+".");t={default:!0,reservoir:new Td(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(o){var a={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in o){var l=o[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(a[c]=l),e.version===1&&c==="service_name"?a.host=l:a[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" is missing required attributes: "+Object.keys(u)+".");var d=a;d.reservoir=new Td(o.fixed_target,o.rate),n.push(d)}),n.push(t),n};Cd.setLocalRules();Id.exports=Cd});var Ld=f((vx,xd)=>{"use strict";function Nt(){this.init()}Nt.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Nt.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Nt.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Nt.prototype.loadNewQuota=function(e,t,n){e&&(this.quota=e),t&&(this.TTL=t),n&&(this.reportInterval=n/10)};Nt.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};xd.exports=Nt});var Od=f((Sx,Pd)=>{"use strict";var Ar=Z(),T_=Ld();function z(r,e,t,n,s,i,o,a,u){this.init(r,e,t,n,s,i,o,a,u)}z.prototype.init=function(e,t,n,s,i,o,a,u,c){this.name=e,this.priority=t,this.rate=n,this.host=i,this.httpMethod=o,this.urlPath=a,this.serviceName=u,this.serviceType=c,this.reservoir=new T_,this.borrow=!!s,this.resetStatistics()};z.prototype.match=function(e){var t=e.host,n=e.httpMethod,s=e.serviceName,i=e.urlPath,o=e.serviceType;return this.isDefault()||(!t||Ar.wildcardMatch(this.host,t))&&(!n||Ar.wildcardMatch(this.httpMethod,n))&&(!s||Ar.wildcardMatch(this.serviceName,s))&&(!i||Ar.wildcardMatch(this.urlPath,i))&&(!o||Ar.wildcardMatch(this.serviceType,o))};z.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};z.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};z.prototype.isDefault=function(){return this.name==="Default"};z.prototype.incrementRequestCount=function(){this.requestCount++};z.prototype.incrementBorrowCount=function(){this.borrowCount++};z.prototype.incrementSampledCount=function(){this.sampledCount++};z.prototype.setRate=function(e){this.rate=e};z.prototype.getRate=function(){return this.rate};z.prototype.getName=function(){return this.name};z.prototype.getPriority=function(){return this.priority};z.prototype.getReservoir=function(){return this.reservoir};z.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};z.prototype.canBorrow=function(){return this.borrow};z.prototype.everMatched=function(){return this.requestCount>0};z.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Pd.exports=z});var io=f((Ex,Dd)=>{"use strict";var A_=require("crypto"),C_=D(),R_=Od(),qn=Cn(),I_=require("util"),x_=require("http"),qd={clientId:A_.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:C_,httpClient:x_,fetchSamplingRules:function(e){let t="{}",n=Nd(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var a="";o.on("data",u=>{a+=u}),o.on("error",u=>{e(u)}),o.on("end",()=>{var u;try{u=JSON.parse(a)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=P_(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let n=JSON.stringify(L_(e)),s=Nd(this.samplingTargetsPath,n.length),o=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var u="";a.on("data",c=>{u+=c}),a.on("error",c=>{t(c)}),a.on("end",()=>{var c;try{c=JSON.parse(u)}catch(p){t(p);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=O_(c),d=Md(c.LastRuleModification);t(null,l,d)})});o.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling targets.`))}),o.write(n),o.end()}},L_=function(e){var t=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(s){var i=s.snapshotStatistics(),o={RuleName:s.getName(),ClientID:qd.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:n};t.push(o)}),{SamplingStatisticsDocuments:t}},P_=function(e){var t=[],n=e.SamplingRuleRecords||[];return n.forEach(function(s){if(s=s.SamplingRule,N_(s)){var i=new R_(s.RuleName,s.Priority,s.FixedRate,s.ReservoirSize,s.Host,s.HTTPMethod,s.URLPath,s.ServiceName,s.ServiceType);t.push(i)}}),t},O_=function(e){var t=e.SamplingTargetDocuments||[],n={};return t.forEach(function(s){var i={rate:s.FixedRate,quota:s.ReservoirQuota,TTL:Md(s.ReservoirQuotaTTL),interval:s.Interval};n[s.RuleName]=i}),n},N_=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Md=function(e){return new Date(e).getTime()/1e3},Nd=function(e,t){return{hostname:qn.tcp_ip,port:qn.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:I_.format("%s:%d",qn.tcp_ip,qn.tcp_port)}}};Dd.exports=qd});var Mn=f((_x,kd)=>{"use strict";var q_=3600,oo={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(M_(t))return null;var n;return this.rules.forEach(function(s){!n&&s.match(e)&&(n=s),s.isDefault()&&!n&&(n=s)}),n},loadRules:function(e){var t={};this.rules.forEach(function(n){t[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var s=t[n.getName()];s&&n.merge(s)}),this.rules.sort(function(n,s){var i=n.getPriority()-s.getPriority();return i!==0?i:n.getName()>s.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var n=e[t.getName()];n&&(t.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),t.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},M_=function(e){return oo.getLastUpdated()?e>oo.getLastUpdated()+q_:!0};kd.exports=oo});var uo=f((bx,Ud)=>{"use strict";var ao=D(),D_=io(),$d=Mn(),k_=5*60*1e3,$_={start:function(){this.poller&&clearInterval(this.poller),Fd(!1),this.poller=setInterval(Fd,k_),this.poller.unref()}},Fd=function(e){if(e=typeof e>"u"?!0:e,e){var t=B_();setTimeout(Bd,t)}else Bd()},Bd=function(){try{F_()}catch(e){ao.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},F_=function(){var e=Math.floor(new Date().getTime()/1e3);D_.fetchSamplingRules(function(t,n){t?ao.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):n.length!==0&&($d.loadRules(n),$d.timestamp(e),ao.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},B_=function(){return Math.random()*5};Ud.exports=$_});var Gd=f((wx,Hd)=>{"use strict";var U_=uo(),W_=io(),co=Mn(),Dn=D(),Wd=10*1e3,jd={interval:Wd,start:function(){this.poller=setInterval(j_,Wd+V_()),this.poller.unref()}},j_=function(){try{H_()}catch(e){Dn.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},H_=function(){var e=G_();e&&e.length>0&&W_.fetchTargets(e,function(t,n,s){if(t){Dn.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}co.loadTargets(n),s>co.getLastUpdated()&&(Dn.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),U_.start()),Dn.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},G_=function(){var e=co.getRules(),t=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&t.push(n)}),t},V_=function(){return Math.random()/jd.interval};Hd.exports=jd});var Qd=f((Tx,Vd)=>{"use strict";var lo=D(),Q_=require("util"),X_=Ke(),K_={localSampler:so(),rulePoller:uo(),targetPoller:Gd(),ruleCache:Mn(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=X_.origin);var t=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,t);return n?(lo.getLogger().debug(Q_.format("Rule %s is matched.",n.getName())),z_(n,t)):(lo.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(s){lo.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+s)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},z_=function(e,t){e.incrementRequestCount();var n=e.getReservoir(),s=!0,i=n.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():s=!1,s?e.getName():!1};Vd.exports=K_});var ho=f((Ax,Xd)=>{"use strict";var Y_=wr(),J_=to(),Z_=D(),e0=Z(),t0=Z().wildcardMatch,r0=Z().processTraceData,fo="x-amzn-trace-id",n0=!!process.env.AWS_XRAY_TRACING_NAME,s0={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:Qd(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[fo]&&(t=r0(e.headers[fo])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?t0(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,n){var s;if(e.sampled==="1")s=!0;else if(e.sampled==="0")s=!1;else{var i={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:t.name};s=this.sampler.shouldSample(i),(s instanceof String||typeof s=="string")&&(t.setMatchedSamplingRule(s),s=!0)}e.sampled==="?"&&n.header&&n.header(fo,"Root="+e.root+";Sampled="+(s?"1":"0")),s||(t.notTraced=!0)},setDefaultName:function(e){n0||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=so()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,n){Z_.getLogger().debug(e+": { url: "+t+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,t){var n=this.processHeaders(e),s=this.resolveName(e.headers.host),i=new Y_(s,n.root,n.parent);t.req||(t.req=e),this.resolveSampling(n,i,t),i.addIncomingRequestData(new J_(e)),this.middlewareLog("Starting middleware segment",e.url,i);var o=this.middlewareLog,a=!1,u=function(){if(a)return;a=!0,t.statusCode===429&&i.addThrottleFlag();let c=e0.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),o("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};Xd.exports=s0});var Kd=f($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.InvokeStore=void 0;var i0=require("async_hooks"),po=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";po||(globalThis.awslambda=globalThis.awslambda||{});var o0={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},Cr=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let n=this.storage.getStore();n&&(n[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};b(Cr,"storage",new i0.AsyncLocalStorage),b(Cr,"PROTECTED_KEYS",o0);var kn;!po&&globalThis.awslambda?.InvokeStore?kn=globalThis.awslambda.InvokeStore:(kn=Cr,!po&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=kn));$n.InvokeStore=kn});var Jd=f((Ix,Yd)=>{"use strict";var Fn=Je(),a0=ho(),go=Z().LambdaUtils,u0=wr(),c0=In(),l0=Ke(),yo=D(),zd=Ln(),{InvokeStore:d0}=Kd(),mo=null;Yd.exports.init=function(){Fn.enableManualMode=function(){yo.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},c0.disableReusableSocket(),l0.setStreamingThreshold(0),yo.getLogger().info("Disabling centralized sampling in Lambda environment."),a0.disableCentralizedSampling();var e=Fn.getNamespace();e.enter(e.createContext()),Fn.setSegment(f0())};var f0=function(){var e=new u0("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],s=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(n.indexOf(i)===-1?e[i]=function(){var o=i;return function(){yo.getLogger().warn('Function "'+o+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=zd.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=zd.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let a=d0.getXRayTraceId(),u=process.env._X_AMZN_TRACE_ID;var c=a??u;c?c!=mo&&(this.reset(),go.populateTraceData(e,c)&&(mo=c)):(this.reset(),Fn.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},go.validTraceData(s)&&go.populateTraceData(e,s)&&(mo=s),e}});var Zd=f((xx,h0)=>{h0.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var rf=f((Lx,tf)=>{"use strict";var vo=require("http"),ef={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var s=5,i=function(){var o=vo.__request?vo.__request:vo.request,a=o(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else s>0&&Math.floor(this.statusCode/100)===5?(s--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});a.on("error",function(u){e(u)}),a.on("timeout",function(){a.abort()}),a.setTimeout(ef.METADATA_TIMEOUT),a.end()};i()}};tf.exports=ef});var uf=f((Px,af)=>{"use strict";var sf=rf(),nf=D(),So=require("http"),p0={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(n){let s=of(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});sf.getPluginMetadata(s,function(i,o){if(i||!o){nf.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let a={ec2:{instance_id:o.instanceId,availability_zone:o.availabilityZone,instance_size:o.instanceType,ami_id:o.imageId}};r(a)})}g0(function(n){n===null&&nf.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(n)})},originName:"AWS::EC2::Instance"};function g0(r){let e=So.__request?So.__request:So.request,s=of("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(s,function(o){let a="";o.on("data",function(u){a+=u}),o.on("end",function(){this.statusCode===200||this.statusCode===300?r(a):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(sf.METADATA_TIMEOUT),i.end()}function of(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}af.exports=p0});var lf=f((Ox,cf)=>{"use strict";var m0=require("os"),y0={getData:function(r){r({ecs:{container:m0.hostname()}})},originName:"AWS::ECS::Container"};cf.exports=y0});var ff=f((Nx,df)=>{"use strict";var v0=require("fs"),S0=D(),E0="/var/elasticbeanstalk/xray/environment.conf",_0={getData:function(r){v0.readFile(E0,"utf8",function(e,t){if(e)S0.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var n=JSON.parse(t),s={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};r(s)}})},originName:"AWS::ElasticBeanstalk::Environment"};df.exports=_0});var hf=f((qx,b0)=>{b0.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Sf=f((Mx,vf)=>{"use strict";var mf=require("fs"),qt=D(),w0=hf(),Bn={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Wn(r){this.init(r)}Wn.prototype.init=function(e){e?typeof e=="string"?(qt.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Un(JSON.parse(mf.readFileSync(e,"utf8")))):(qt.getLogger().info("Using custom AWS whitelist source."),this.services=Un(e)):this.services=w0.services};Wn.prototype.append=function(e){var t={};typeof e=="string"?(qt.getLogger().info("Appending AWS whitelist with custom file: "+e),t=Un(JSON.parse(mf.readFileSync(e,"utf8")))):(qt.getLogger().info("Appending AWS whitelist with a custom source."),t=Un(e));for(var n in t)this.services[n]=t[n]};Wn.prototype.capture=function(e,t){var n=t.request.operation,s=this.services[e]!==void 0?this.services[e].operations[n]:null;if(s===null){qt.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var o in s){var a=s[o];o===Bn.REQ_PARAMS?pf(a,t.request.params,i):o===Bn.REQ_DESC?gf(a,t.request.params,i):o===Bn.RES_PARAMS?t.data&&pf(a,t.data,i):o===Bn.RES_DESC?t.data&&gf(a,t.data,i):qt.getLogger().error('Unknown parameter type "'+o+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function pf(r,e,t){r.forEach(function(n){if(typeof e[n]<"u"){var s=yf(n);this[s]=e[n]}},t)}function gf(r,e,t){for(var n in r){var s=r[n];if(typeof e[n]<"u"){var i;if(s.list&&s.get_count?i=e[n]?e[n].length:0:i=s.get_keys===!0?Object.keys(e[n]):e[n],typeof s.rename_to=="string")t[s.rename_to]=i;else{var o=yf(n);t[o]=i}}}}function yf(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function Un(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}vf.exports=Wn});var Rr=f((Dx,jn)=>{"use strict";var Ef=Sf(),Eo=new Ef;function _o(r,e){this.init(r,e)}_o.prototype.init=function(e,t){this.operation=C0(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(Eo.capture(t.toLowerCase(),e))};_o.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var T0=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Eo=new Ef(e)},A0=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Eo.append(e)};function C0(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}jn.exports=_o;jn.exports.appendAWSWhitelist=A0;jn.exports.setAWSWhitelist=T0});var Gn=f((kx,Hn)=>{"use strict";var ct=Je(),Ir=D(),_f=function(e,t,n){bo(e,t);var s,i,o=ct.resolveSegment(n);if(!o)return Ir.getLogger().warn("Failed to capture function."),t();s=o.addNewSubsegment(e),i=bf(t,s);try{let a=i(s);return s.close(),a}catch(a){throw s.close(a),a}},R0=function(e,t,n){bo(e,t);var s,i,o=ct.resolveSegment(n);if(!o)return Ir.getLogger().warn("Failed to capture async function."),t();s=o.addNewSubsegment(e),i=bf(t,s);try{return i(s)}catch(a){throw s.close(a),a}},I0=function(e,t,n){bo(e,t);var s=ct.resolveSegment(n);return s?(s.incrementCounter(),function(){var i=ct.resolveSegment(n),o=Array.prototype.slice.call(arguments);_f(e,t.bind.apply(t,[null].concat(o)),i),s.decrementCounter()}.bind(this)):(Ir.getLogger().warn("Failed to capture callback function."),t)};function bf(r,e){var t;if(ct.isAutomaticMode()){var n=ct.getNamespace(),s=function(){var i;return n.run(function(){ct.setSegment(e),i=r(e)}),i};t=s}else t=r;return t}function bo(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',Ir.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',Ir.getLogger().error(t),new Error(t)}Hn.exports.captureFunc=_f;Hn.exports.captureAsyncFunc=R0;Hn.exports.captureCallbackFunc=I0});var xr=f(($x,wf)=>{"use strict";var x0="2.0.0",L0=Number.MAX_SAFE_INTEGER||9007199254740991,P0=16,O0=250,N0=["major","premajor","minor","preminor","patch","prepatch","prerelease"];wf.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:P0,MAX_SAFE_BUILD_LENGTH:O0,MAX_SAFE_INTEGER:L0,RELEASE_TYPES:N0,SEMVER_SPEC_VERSION:x0,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Lr=f((Fx,Tf)=>{"use strict";var q0=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Tf.exports=q0});var Mt=f((Ie,Af)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:wo,MAX_SAFE_BUILD_LENGTH:M0,MAX_LENGTH:D0}=xr(),k0=Lr();Ie=Af.exports={};var $0=Ie.re=[],F0=Ie.safeRe=[],m=Ie.src=[],B0=Ie.safeSrc=[],y=Ie.t={},U0=0,To="[a-zA-Z0-9-]",W0=[["\\s",1],["\\d",D0],[To,M0]],j0=r=>{for(let[e,t]of W0)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},S=(r,e,t)=>{let n=j0(e),s=U0++;k0(r,s,e),y[r]=s,m[s]=e,B0[s]=n,$0[s]=new RegExp(e,t?"g":void 0),F0[s]=new RegExp(n,t?"g":void 0)};S("NUMERICIDENTIFIER","0|[1-9]\\d*");S("NUMERICIDENTIFIERLOOSE","\\d+");S("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${To}*`);S("MAINVERSION",`(${m[y.NUMERICIDENTIFIER]})\\.(${m[y.NUMERICIDENTIFIER]})\\.(${m[y.NUMERICIDENTIFIER]})`);S("MAINVERSIONLOOSE",`(${m[y.NUMERICIDENTIFIERLOOSE]})\\.(${m[y.NUMERICIDENTIFIERLOOSE]})\\.(${m[y.NUMERICIDENTIFIERLOOSE]})`);S("PRERELEASEIDENTIFIER",`(?:${m[y.NONNUMERICIDENTIFIER]}|${m[y.NUMERICIDENTIFIER]})`);S("PRERELEASEIDENTIFIERLOOSE",`(?:${m[y.NONNUMERICIDENTIFIER]}|${m[y.NUMERICIDENTIFIERLOOSE]})`);S("PRERELEASE",`(?:-(${m[y.PRERELEASEIDENTIFIER]}(?:\\.${m[y.PRERELEASEIDENTIFIER]})*))`);S("PRERELEASELOOSE",`(?:-?(${m[y.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${m[y.PRERELEASEIDENTIFIERLOOSE]})*))`);S("BUILDIDENTIFIER",`${To}+`);S("BUILD",`(?:\\+(${m[y.BUILDIDENTIFIER]}(?:\\.${m[y.BUILDIDENTIFIER]})*))`);S("FULLPLAIN",`v?${m[y.MAINVERSION]}${m[y.PRERELEASE]}?${m[y.BUILD]}?`);S("FULL",`^${m[y.FULLPLAIN]}$`);S("LOOSEPLAIN",`[v=\\s]*${m[y.MAINVERSIONLOOSE]}${m[y.PRERELEASELOOSE]}?${m[y.BUILD]}?`);S("LOOSE",`^${m[y.LOOSEPLAIN]}$`);S("GTLT","((?:<|>)?=?)");S("XRANGEIDENTIFIERLOOSE",`${m[y.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);S("XRANGEIDENTIFIER",`${m[y.NUMERICIDENTIFIER]}|x|X|\\*`);S("XRANGEPLAIN",`[v=\\s]*(${m[y.XRANGEIDENTIFIER]})(?:\\.(${m[y.XRANGEIDENTIFIER]})(?:\\.(${m[y.XRANGEIDENTIFIER]})(?:${m[y.PRERELEASE]})?${m[y.BUILD]}?)?)?`);S("XRANGEPLAINLOOSE",`[v=\\s]*(${m[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${m[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${m[y.XRANGEIDENTIFIERLOOSE]})(?:${m[y.PRERELEASELOOSE]})?${m[y.BUILD]}?)?)?`);S("XRANGE",`^${m[y.GTLT]}\\s*${m[y.XRANGEPLAIN]}$`);S("XRANGELOOSE",`^${m[y.GTLT]}\\s*${m[y.XRANGEPLAINLOOSE]}$`);S("COERCEPLAIN",`(^|[^\\d])(\\d{1,${wo}})(?:\\.(\\d{1,${wo}}))?(?:\\.(\\d{1,${wo}}))?`);S("COERCE",`${m[y.COERCEPLAIN]}(?:$|[^\\d])`);S("COERCEFULL",m[y.COERCEPLAIN]+`(?:${m[y.PRERELEASE]})?(?:${m[y.BUILD]})?(?:$|[^\\d])`);S("COERCERTL",m[y.COERCE],!0);S("COERCERTLFULL",m[y.COERCEFULL],!0);S("LONETILDE","(?:~>?)");S("TILDETRIM",`(\\s*)${m[y.LONETILDE]}\\s+`,!0);Ie.tildeTrimReplace="$1~";S("TILDE",`^${m[y.LONETILDE]}${m[y.XRANGEPLAIN]}$`);S("TILDELOOSE",`^${m[y.LONETILDE]}${m[y.XRANGEPLAINLOOSE]}$`);S("LONECARET","(?:\\^)");S("CARETTRIM",`(\\s*)${m[y.LONECARET]}\\s+`,!0);Ie.caretTrimReplace="$1^";S("CARET",`^${m[y.LONECARET]}${m[y.XRANGEPLAIN]}$`);S("CARETLOOSE",`^${m[y.LONECARET]}${m[y.XRANGEPLAINLOOSE]}$`);S("COMPARATORLOOSE",`^${m[y.GTLT]}\\s*(${m[y.LOOSEPLAIN]})$|^$`);S("COMPARATOR",`^${m[y.GTLT]}\\s*(${m[y.FULLPLAIN]})$|^$`);S("COMPARATORTRIM",`(\\s*)${m[y.GTLT]}\\s*(${m[y.LOOSEPLAIN]}|${m[y.XRANGEPLAIN]})`,!0);Ie.comparatorTrimReplace="$1$2$3";S("HYPHENRANGE",`^\\s*(${m[y.XRANGEPLAIN]})\\s+-\\s+(${m[y.XRANGEPLAIN]})\\s*$`);S("HYPHENRANGELOOSE",`^\\s*(${m[y.XRANGEPLAINLOOSE]})\\s+-\\s+(${m[y.XRANGEPLAINLOOSE]})\\s*$`);S("STAR","(<|>)?=?\\s*\\*");S("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");S("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Vn=f((Bx,Cf)=>{"use strict";var H0=Object.freeze({loose:!0}),G0=Object.freeze({}),V0=r=>r?typeof r!="object"?H0:r:G0;Cf.exports=V0});var Ao=f((Ux,xf)=>{"use strict";var Rf=/^[0-9]+$/,If=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Rf.test(r),n=Rf.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},Q0=(r,e)=>If(e,r);xf.exports={compareIdentifiers:If,rcompareIdentifiers:Q0}});var te=f((Wx,Pf)=>{"use strict";var Qn=Lr(),{MAX_LENGTH:Lf,MAX_SAFE_INTEGER:Xn}=xr(),{safeRe:Kn,t:zn}=Mt(),X0=Vn(),{compareIdentifiers:Co}=Ao(),Ro=class r{constructor(e,t){if(t=X0(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Lf)throw new TypeError(`version is longer than ${Lf} characters`);Qn("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Kn[zn.LOOSE]:Kn[zn.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Xn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Xn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Xn||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Xn)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Qn("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(Qn("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Co(n,s)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(Qn("build compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Co(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?Kn[zn.PRERELEASELOOSE]:Kn[zn.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];n===!1&&(i=[t]),Co(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Pf.exports=Ro});var lt=f((jx,Nf)=>{"use strict";var Of=te(),K0=(r,e,t=!1)=>{if(r instanceof Of)return r;try{return new Of(r,e)}catch(n){if(!t)return null;throw n}};Nf.exports=K0});var Mf=f((Hx,qf)=>{"use strict";var z0=lt(),Y0=(r,e)=>{let t=z0(r,e);return t?t.version:null};qf.exports=Y0});var kf=f((Gx,Df)=>{"use strict";var J0=lt(),Z0=(r,e)=>{let t=J0(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Df.exports=Z0});var Bf=f((Vx,Ff)=>{"use strict";var $f=te(),eb=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new $f(r instanceof $f?r.version:r,t).inc(e,n,s).version}catch{return null}};Ff.exports=eb});var jf=f((Qx,Wf)=>{"use strict";var Uf=lt(),tb=(r,e)=>{let t=Uf(r,null,!0),n=Uf(e,null,!0),s=t.compare(n);if(s===0)return null;let i=s>0,o=i?t:n,a=i?n:t,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==n.major?l+"major":t.minor!==n.minor?l+"minor":t.patch!==n.patch?l+"patch":"prerelease"};Wf.exports=tb});var Gf=f((Xx,Hf)=>{"use strict";var rb=te(),nb=(r,e)=>new rb(r,e).major;Hf.exports=nb});var Qf=f((Kx,Vf)=>{"use strict";var sb=te(),ib=(r,e)=>new sb(r,e).minor;Vf.exports=ib});var Kf=f((zx,Xf)=>{"use strict";var ob=te(),ab=(r,e)=>new ob(r,e).patch;Xf.exports=ab});var Yf=f((Yx,zf)=>{"use strict";var ub=lt(),cb=(r,e)=>{let t=ub(r,e);return t&&t.prerelease.length?t.prerelease:null};zf.exports=cb});var ye=f((Jx,Zf)=>{"use strict";var Jf=te(),lb=(r,e,t)=>new Jf(r,t).compare(new Jf(e,t));Zf.exports=lb});var th=f((Zx,eh)=>{"use strict";var db=ye(),fb=(r,e,t)=>db(e,r,t);eh.exports=fb});var nh=f((eL,rh)=>{"use strict";var hb=ye(),pb=(r,e)=>hb(r,e,!0);rh.exports=pb});var Yn=f((tL,ih)=>{"use strict";var sh=te(),gb=(r,e,t)=>{let n=new sh(r,t),s=new sh(e,t);return n.compare(s)||n.compareBuild(s)};ih.exports=gb});var ah=f((rL,oh)=>{"use strict";var mb=Yn(),yb=(r,e)=>r.sort((t,n)=>mb(t,n,e));oh.exports=yb});var ch=f((nL,uh)=>{"use strict";var vb=Yn(),Sb=(r,e)=>r.sort((t,n)=>vb(n,t,e));uh.exports=Sb});var Pr=f((sL,lh)=>{"use strict";var Eb=ye(),_b=(r,e,t)=>Eb(r,e,t)>0;lh.exports=_b});var Jn=f((iL,dh)=>{"use strict";var bb=ye(),wb=(r,e,t)=>bb(r,e,t)<0;dh.exports=wb});var Io=f((oL,fh)=>{"use strict";var Tb=ye(),Ab=(r,e,t)=>Tb(r,e,t)===0;fh.exports=Ab});var xo=f((aL,hh)=>{"use strict";var Cb=ye(),Rb=(r,e,t)=>Cb(r,e,t)!==0;hh.exports=Rb});var Zn=f((uL,ph)=>{"use strict";var Ib=ye(),xb=(r,e,t)=>Ib(r,e,t)>=0;ph.exports=xb});var es=f((cL,gh)=>{"use strict";var Lb=ye(),Pb=(r,e,t)=>Lb(r,e,t)<=0;gh.exports=Pb});var Lo=f((lL,mh)=>{"use strict";var Ob=Io(),Nb=xo(),qb=Pr(),Mb=Zn(),Db=Jn(),kb=es(),$b=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Ob(r,t,n);case"!=":return Nb(r,t,n);case">":return qb(r,t,n);case">=":return Mb(r,t,n);case"<":return Db(r,t,n);case"<=":return kb(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};mh.exports=$b});var vh=f((dL,yh)=>{"use strict";var Fb=te(),Bb=lt(),{safeRe:ts,t:rs}=Mt(),Ub=(r,e)=>{if(r instanceof Fb)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?ts[rs.COERCEFULL]:ts[rs.COERCE]);else{let u=e.includePrerelease?ts[rs.COERCERTLFULL]:ts[rs.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let n=t[2],s=t[3]||"0",i=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return Bb(`${n}.${s}.${i}${o}${a}`,e)};yh.exports=Ub});var Eh=f((fL,Sh)=>{"use strict";var Po=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};Sh.exports=Po});var ve=f((hL,Th)=>{"use strict";var Wb=/\s+/g,Oo=class r{constructor(e,t){if(t=Hb(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof No)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Wb," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!bh(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&Yb(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&Kb)|(this.options.loose&&zb))+":"+e,s=_h.get(n);if(s)return s;let i=this.options.loose,o=i?ae[re.HYPHENRANGELOOSE]:ae[re.HYPHENRANGE];e=e.replace(o,aw(this.options.includePrerelease)),O("hyphen replace",e),e=e.replace(ae[re.COMPARATORTRIM],Vb),O("comparator trim",e),e=e.replace(ae[re.TILDETRIM],Qb),O("tilde trim",e),e=e.replace(ae[re.CARETTRIM],Xb),O("caret trim",e);let a=e.split(" ").map(d=>Jb(d,this.options)).join(" ").split(/\s+/).map(d=>ow(d,this.options));i&&(a=a.filter(d=>(O("loose invalid filter",d,this.options),!!d.match(ae[re.COMPARATORLOOSE])))),O("range list",a);let u=new Map,c=a.map(d=>new No(d,this.options));for(let d of c){if(bh(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return _h.set(n,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>wh(n,t)&&e.set.some(s=>wh(s,t)&&n.every(i=>s.every(o=>i.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Gb(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(uw(this.set[t],e,this.options))return!0;return!1}};Th.exports=Oo;var jb=Eh(),_h=new jb,Hb=Vn(),No=Or(),O=Lr(),Gb=te(),{safeRe:ae,t:re,comparatorTrimReplace:Vb,tildeTrimReplace:Qb,caretTrimReplace:Xb}=Mt(),{FLAG_INCLUDE_PRERELEASE:Kb,FLAG_LOOSE:zb}=xr(),bh=r=>r.value==="<0.0.0-0",Yb=r=>r.value==="",wh=(r,e)=>{let t=!0,n=r.slice(),s=n.pop();for(;t&&n.length;)t=n.every(i=>s.intersects(i,e)),s=n.pop();return t},Jb=(r,e)=>(r=r.replace(ae[re.BUILD],""),O("comp",r,e),r=tw(r,e),O("caret",r),r=Zb(r,e),O("tildes",r),r=nw(r,e),O("xrange",r),r=iw(r,e),O("stars",r),r),ue=r=>!r||r.toLowerCase()==="x"||r==="*",Zb=(r,e)=>r.trim().split(/\s+/).map(t=>ew(t,e)).join(" "),ew=(r,e)=>{let t=e.loose?ae[re.TILDELOOSE]:ae[re.TILDE];return r.replace(t,(n,s,i,o,a)=>{O("tilde",r,n,s,i,o,a);let u;return ue(s)?u="":ue(i)?u=`>=${s}.0.0 <${+s+1}.0.0-0`:ue(o)?u=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:a?(O("replaceTilde pr",a),u=`>=${s}.${i}.${o}-${a} <${s}.${+i+1}.0-0`):u=`>=${s}.${i}.${o} <${s}.${+i+1}.0-0`,O("tilde return",u),u})},tw=(r,e)=>r.trim().split(/\s+/).map(t=>rw(t,e)).join(" "),rw=(r,e)=>{O("caret",r,e);let t=e.loose?ae[re.CARETLOOSE]:ae[re.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(s,i,o,a,u)=>{O("caret",r,s,i,o,a,u);let c;return ue(i)?c="":ue(o)?c=`>=${i}.0.0${n} <${+i+1}.0.0-0`:ue(a)?i==="0"?c=`>=${i}.${o}.0${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${n} <${+i+1}.0.0-0`:u?(O("replaceCaret pr",u),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${u} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${u} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${u} <${+i+1}.0.0-0`):(O("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${n} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${n} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),O("caret return",c),c})},nw=(r,e)=>(O("replaceXRanges",r,e),r.split(/\s+/).map(t=>sw(t,e)).join(" ")),sw=(r,e)=>{r=r.trim();let t=e.loose?ae[re.XRANGELOOSE]:ae[re.XRANGE];return r.replace(t,(n,s,i,o,a,u)=>{O("xRange",r,n,s,i,o,a,u);let c=ue(i),l=c||ue(o),d=l||ue(a),p=d;return s==="="&&p&&(s=""),u=e.includePrerelease?"-0":"",c?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&p?(l&&(o=0),a=0,s===">"?(s=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):s==="<="&&(s="<",l?i=+i+1:o=+o+1),s==="<"&&(u="-0"),n=`${s+i}.${o}.${a}${u}`):l?n=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),O("xRange return",n),n})},iw=(r,e)=>(O("replaceStars",r,e),r.trim().replace(ae[re.STAR],"")),ow=(r,e)=>(O("replaceGTE0",r,e),r.trim().replace(ae[e.includePrerelease?re.GTE0PRE:re.GTE0],"")),aw=r=>(e,t,n,s,i,o,a,u,c,l,d,p)=>(ue(n)?t="":ue(s)?t=`>=${n}.0.0${r?"-0":""}`:ue(i)?t=`>=${n}.${s}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,ue(c)?u="":ue(l)?u=`<${+c+1}.0.0-0`:ue(d)?u=`<${c}.${+l+1}.0-0`:p?u=`<=${c}.${l}.${d}-${p}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),uw=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(O(r[n].semver),r[n].semver!==No.ANY&&r[n].semver.prerelease.length>0){let s=r[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var Or=f((pL,Lh)=>{"use strict";var Nr=Symbol("SemVer ANY"),Do=class r{static get ANY(){return Nr}constructor(e,t){if(t=Ah(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Mo("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Nr?this.value="":this.value=this.operator+this.semver.version,Mo("comp",this)}parse(e){let t=this.options.loose?Ch[Rh.COMPARATORLOOSE]:Ch[Rh.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ih(n[2],this.options.loose):this.semver=Nr}toString(){return this.value}test(e){if(Mo("Comparator.test",e,this.options.loose),this.semver===Nr||e===Nr)return!0;if(typeof e=="string")try{e=new Ih(e,this.options)}catch{return!1}return qo(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new xh(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new xh(this.value,t).test(e.semver):(t=Ah(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||qo(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||qo(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Lh.exports=Do;var Ah=Vn(),{safeRe:Ch,t:Rh}=Mt(),qo=Lo(),Mo=Lr(),Ih=te(),xh=ve()});var qr=f((gL,Ph)=>{"use strict";var cw=ve(),lw=(r,e,t)=>{try{e=new cw(e,t)}catch{return!1}return e.test(r)};Ph.exports=lw});var Nh=f((mL,Oh)=>{"use strict";var dw=ve(),fw=(r,e)=>new dw(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));Oh.exports=fw});var Mh=f((yL,qh)=>{"use strict";var hw=te(),pw=ve(),gw=(r,e,t)=>{let n=null,s=null,i=null;try{i=new pw(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!n||s.compare(o)===-1)&&(n=o,s=new hw(n,t))}),n};qh.exports=gw});var kh=f((vL,Dh)=>{"use strict";var mw=te(),yw=ve(),vw=(r,e,t)=>{let n=null,s=null,i=null;try{i=new yw(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!n||s.compare(o)===1)&&(n=o,s=new mw(n,t))}),n};Dh.exports=vw});var Bh=f((SL,Fh)=>{"use strict";var ko=te(),Sw=ve(),$h=Pr(),Ew=(r,e)=>{r=new Sw(r,e);let t=new ko("0.0.0");if(r.test(t)||(t=new ko("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let s=r.set[n],i=null;s.forEach(o=>{let a=new ko(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||$h(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!t||$h(t,i))&&(t=i)}return t&&r.test(t)?t:null};Fh.exports=Ew});var Wh=f((EL,Uh)=>{"use strict";var _w=ve(),bw=(r,e)=>{try{return new _w(r,e).range||"*"}catch{return null}};Uh.exports=bw});var ns=f((_L,Vh)=>{"use strict";var ww=te(),Gh=Or(),{ANY:Tw}=Gh,Aw=ve(),Cw=qr(),jh=Pr(),Hh=Jn(),Rw=es(),Iw=Zn(),xw=(r,e,t,n)=>{r=new ww(r,n),e=new Aw(e,n);let s,i,o,a,u;switch(t){case">":s=jh,i=Rw,o=Hh,a=">",u=">=";break;case"<":s=Hh,i=Iw,o=jh,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Cw(r,e,n))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,p=null;if(l.forEach(h=>{h.semver===Tw&&(h=new Gh(">=0.0.0")),d=d||h,p=p||h,s(h.semver,d.semver,n)?d=h:o(h.semver,p.semver,n)&&(p=h)}),d.operator===a||d.operator===u||(!p.operator||p.operator===a)&&i(r,p.semver))return!1;if(p.operator===u&&o(r,p.semver))return!1}return!0};Vh.exports=xw});var Xh=f((bL,Qh)=>{"use strict";var Lw=ns(),Pw=(r,e,t)=>Lw(r,e,">",t);Qh.exports=Pw});var zh=f((wL,Kh)=>{"use strict";var Ow=ns(),Nw=(r,e,t)=>Ow(r,e,"<",t);Kh.exports=Nw});var Zh=f((TL,Jh)=>{"use strict";var Yh=ve(),qw=(r,e,t)=>(r=new Yh(r,t),e=new Yh(e,t),r.intersects(e,t));Jh.exports=qw});var tp=f((AL,ep)=>{"use strict";var Mw=qr(),Dw=ye();ep.exports=(r,e,t)=>{let n=[],s=null,i=null,o=r.sort((l,d)=>Dw(l,d,t));for(let l of o)Mw(l,e,t)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let a=[];for(let[l,d]of n)l===d?a.push(l):!d&&l===o[0]?a.push("*"):d?l===o[0]?a.push(`<=${d}`):a.push(`${l} - ${d}`):a.push(`>=${l}`);let u=a.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var ap=f((CL,op)=>{"use strict";var rp=ve(),Fo=Or(),{ANY:$o}=Fo,Mr=qr(),Bo=ye(),kw=(r,e,t={})=>{if(r===e)return!0;r=new rp(r,t),e=new rp(e,t);let n=!1;e:for(let s of r.set){for(let i of e.set){let o=Fw(s,i,t);if(n=n||o!==null,o)continue e}if(n)return!1}return!0},$w=[new Fo(">=0.0.0-0")],np=[new Fo(">=0.0.0")],Fw=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===$o){if(e.length===1&&e[0].semver===$o)return!0;t.includePrerelease?r=$w:r=np}if(e.length===1&&e[0].semver===$o){if(t.includePrerelease)return!0;e=np}let n=new Set,s,i;for(let h of r)h.operator===">"||h.operator===">="?s=sp(s,h,t):h.operator==="<"||h.operator==="<="?i=ip(i,h,t):n.add(h.semver);if(n.size>1)return null;let o;if(s&&i){if(o=Bo(s.semver,i.semver,t),o>0)return null;if(o===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let h of n){if(s&&!Mr(h,String(s),t)||i&&!Mr(h,String(i),t))return null;for(let E of e)if(!Mr(h,String(E),t))return!1;return!0}let a,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,p=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",s){if(p&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===p.major&&h.semver.minor===p.minor&&h.semver.patch===p.patch&&(p=!1),h.operator===">"||h.operator===">="){if(a=sp(s,h,t),a===h&&a!==s)return!1}else if(s.operator===">="&&!Mr(s.semver,String(h),t))return!1}if(i){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(u=ip(i,h,t),u===h&&u!==i)return!1}else if(i.operator==="<="&&!Mr(i.semver,String(h),t))return!1}if(!h.operator&&(i||s)&&o!==0)return!1}return!(s&&c&&!i&&o!==0||i&&l&&!s&&o!==0||p||d)},sp=(r,e,t)=>{if(!r)return e;let n=Bo(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},ip=(r,e,t)=>{if(!r)return e;let n=Bo(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};op.exports=kw});var dp=f((RL,lp)=>{"use strict";var Uo=Mt(),up=xr(),Bw=te(),cp=Ao(),Uw=lt(),Ww=Mf(),jw=kf(),Hw=Bf(),Gw=jf(),Vw=Gf(),Qw=Qf(),Xw=Kf(),Kw=Yf(),zw=ye(),Yw=th(),Jw=nh(),Zw=Yn(),eT=ah(),tT=ch(),rT=Pr(),nT=Jn(),sT=Io(),iT=xo(),oT=Zn(),aT=es(),uT=Lo(),cT=vh(),lT=Or(),dT=ve(),fT=qr(),hT=Nh(),pT=Mh(),gT=kh(),mT=Bh(),yT=Wh(),vT=ns(),ST=Xh(),ET=zh(),_T=Zh(),bT=tp(),wT=ap();lp.exports={parse:Uw,valid:Ww,clean:jw,inc:Hw,diff:Gw,major:Vw,minor:Qw,patch:Xw,prerelease:Kw,compare:zw,rcompare:Yw,compareLoose:Jw,compareBuild:Zw,sort:eT,rsort:tT,gt:rT,lt:nT,eq:sT,neq:iT,gte:oT,lte:aT,cmp:uT,coerce:cT,Comparator:lT,Range:dT,satisfies:fT,toComparators:hT,maxSatisfying:pT,minSatisfying:gT,minVersion:mT,validRange:yT,outside:vT,gtr:ST,ltr:ET,intersects:_T,simplifyRange:bT,subset:wT,SemVer:Bw,re:Uo.re,src:Uo.src,tokens:Uo.t,SEMVER_SPEC_VERSION:up.SEMVER_SPEC_VERSION,RELEASE_TYPES:up.RELEASE_TYPES,compareIdentifiers:cp.compareIdentifiers,rcompareIdentifiers:cp.rcompareIdentifiers}});var jo=f((IL,Wo)=>{"use strict";var TT=dp(),AT=Rr(),Dt=Je(),fp=Z(),hp=D(),pp="2.7.15",CT=function(){return!1},RT=function(e){if(!TT.gte(e.VERSION,pp))throw new Error("AWS SDK version "+pp+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var n=e[t];n.prototype.customizeRequests(gp)}return e},IT=function(e){return e.customizeRequests(gp),e};function gp(r){var e=Dt.resolveSegment(Dt.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return Dt.isAutomaticMode()?hp.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):hp.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var n=this.throttledError||CT,s=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var o=e.segment?e.segment.trace_id:e.trace_id;let a=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+o+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(a!=null)for(let[p,h]of Object.entries(a))d+=";"+p+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new AT(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new mp(d)),(d.statusCode===429||l.error&&n(l.error))&&i.addThrottleFlag()),l.error){var p={message:l.error.message,name:l.error.code,stack:s};d&&d.statusCode?(fp.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(p,!0)):i.close(p)}else{if(d&&d.statusCode){var h=fp.getCauseTypeFromHttpStatus(d.statusCode);h&&(i[h]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(Dt.isAutomaticMode()){var d=Dt.getNamespace();d.run(function(){Dt.setSegment(i),r.__send(l)})}else r.__send(l)})}function mp(r){this.init(r)}mp.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};Wo.exports.captureAWSClient=IT;Wo.exports.captureAWS=RT});var _p=f((xL,Ep)=>{var ss=Object.defineProperty,xT=Object.getOwnPropertyDescriptor,LT=Object.getOwnPropertyNames,PT=Object.prototype.hasOwnProperty,kt=(r,e)=>ss(r,"name",{value:e,configurable:!0}),OT=(r,e)=>{for(var t in e)ss(r,t,{get:e[t],enumerable:!0})},NT=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of LT(e))!PT.call(r,s)&&s!==t&&ss(r,s,{get:()=>e[s],enumerable:!(n=xT(e,s))||n.enumerable});return r},qT=r=>NT(ss({},"__esModule",{value:!0}),r),yp={};OT(yp,{isClockSkewCorrectedError:()=>vp,isClockSkewError:()=>UT,isRetryableByTrait:()=>BT,isServerError:()=>jT,isThrottlingError:()=>WT,isTransientError:()=>Sp});Ep.exports=qT(yp);var MT=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],DT=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],kT=["TimeoutError","RequestTimeout","RequestTimeoutException"],$T=[500,502,503,504],FT=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],BT=kt(r=>r.$retryable!==void 0,"isRetryableByTrait"),UT=kt(r=>MT.includes(r.name),"isClockSkewError"),vp=kt(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),WT=kt(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||DT.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Sp=kt(r=>{var e;return vp(r)||kT.includes(r.name)||FT.includes(r?.code||"")||$T.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),jT=kt(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Sp(r)}return!1},"isServerError")});var Rp=f($t=>{"use strict";var Ap=$t&&$t.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($t,"__esModule",{value:!0});$t.captureAWSClient=void 0;var HT=_p(),GT=Ap(Rr()),VT=require("querystring"),QT=Ap(br()),Ho=Je(),bp=D(),{safeParseInt:is}=Z(),XT=Z(),Cp="XRaySDKInstrumentation",wp=async(r,e,t,n,s,i)=>{var o,a,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:p}=((o=s?.output)===null||o===void 0?void 0:o.$metadata)||i?.$metadata,h=new GT.default({extendedRequestId:c,requestId:l,retryCount:p,data:s?.output,request:{operation:e,params:n,httpRequest:{region:t,statusCode:d}}},r),E={};return d&&(E.response={},E.response.status=d),!((a=s?.response)===null||a===void 0)&&a.headers&&((u=s?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(E.response||(E.response={}),E.response.content_length=is(s.response.headers["content-length"])),[h,E]};function Tp(r,e,t){var n,s,i;(t&&(0,HT.isThrottlingError)(t)||is((n=r.response)===null||n===void 0?void 0:n.status)===429||is((s=t?.$metadata)===null||s===void 0?void 0:s.httpStatusCode)===429)&&e.addThrottleFlag();let o=(0,XT.getCauseTypeFromHttpStatus)(is((i=r.response)===null||i===void 0?void 0:i.status));o==="fault"?e.addFaultFlag():o==="error"&&e.addErrorFlag()}var KT=(r,e)=>(t,n)=>async s=>{var i;let o=Ho.isAutomaticMode()?Ho.resolveSegment():e,{clientName:a,commandName:u}=n,c=(i=s?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),p=a.slice(0,-6);if(!o){let k=p+"."+d;return Ho.isAutomaticMode()?bp.getLogger().info("Call "+k+" is missing the sub/segment context for automatic mode. Ignoring."):bp.getLogger().info("Call "+k+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(s)}let h;o.notTraced?h=o.addNewSubsegmentWithoutSampling(p):h=o.addNewSubsegment(p),h.addAttribute("namespace","aws");let E=o instanceof QT.default?o.segment:o,_=E.segment?E.segment.additionalTraceData:E.additionalTraceData,Ee=(0,VT.stringify)({Root:E.trace_id,Parent:h.id,Sampled:h.notTraced?"0":"1"},";");if(_!=null)for(let[k,Q]of Object.entries(_))Ee+=";"+k+"="+Q;o.noOp||(s.request.headers["X-Amzn-Trace-Id"]=Ee);let Y;try{if(Y=await t(s),!Y)throw new Error("Failed to get response from instrumented AWS Client.");let[k,Q]=await wp(p,d,await r.region(),c,Y,null);return h.addAttribute("aws",k),h.addAttribute("http",Q),Tp(Q,h),h.close(),Y}catch(k){if(k.$metadata){let[$,de]=await wp(p,d,await r.region(),c,null,k);h.addAttribute("aws",$),h.addAttribute("http",de),Tp(de,h,k)}let Q={message:k.message,name:k.name,stack:k.stack||new Error().stack};throw h.close(Q,!0),k}},zT={name:Cp,step:"build"},YT=(r,e)=>({applyToStack:t=>{t.add(KT(r,e),zT)}});function JT(r,e){return r.middlewareStack.remove(Cp),r.middlewareStack.use(YT(r.config,e)),r}$t.captureAWSClient=JT});var Vo=f((PL,Go)=>{"use strict";var Ip=require("url"),Ft=Je(),os=Z(),xp=D(),ZT=require("events"),eA=function(e,t,n){e.__request||Lp(e,t,n)},tA=function(e,t,n){if(e.__request)return e;var s={};return Object.keys(e).forEach(function(i){s[i]=e[i]}),Lp(s,t,n),s};function Lp(r,e,t){function n(o,...a){let u,c,l,d,p=a[0];if(typeof a[1]=="object"?(l=!0,d=typeof p=="string"?new Ip.URL(p):p,u=a[1],c=a[2]):(l=!1,u=p,c=a[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return o(...a);typeof u=="string"&&(u=new Ip.URL(u)),l||(d=u);let h=Ft.resolveSegment(Ft.resolveManualSegmentParams(u)),E=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!h){let $="[ host: "+E;return $=u.method?$+", method: "+u.method:$,$+=", path: "+(d.pathname||os.stripQueryStringFromPath(u.path))+" ]",Ft.isAutomaticMode()?xp.getLogger().info("Options for request "+$+" is missing the sub/segment context for automatic mode. Ignoring."):xp.getLogger().info("Options for request "+$+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),o(...a)}let _;h.notTraced?_=h.addNewSubsegmentWithoutSampling(E):_=h.addNewSubsegment(E);let Ee=h.segment?h.segment:h;_.namespace="remote",u.headers||(u.headers={}),h.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+Ee.trace_id+";Parent="+_.id+";Sampled="+(_.notTraced?"0":"1"));let Y=function(de){if(t&&t(_,this,null,de),_.http&&_.http.response)os.getCauseTypeFromHttpStatus(_.http.response.status)==="error"&&_.addErrorFlag(),_.close(de,!0);else{let ug=de.code!=="ECONNREFUSED";_.addRemoteRequestData(this,null,ug&&e),_.close(de)}},k=os.objectWithoutProperties(u,["Segment"],!0),Q=o(...l?[p,k]:[u],function($){$.on("end",function(){t&&t(_,this.req,$),$.statusCode===429&&_.addThrottleFlag();let de=os.getCauseTypeFromHttpStatus($.statusCode);de&&(_[de]=!0),_.addRemoteRequestData($.req,$,!!e),_.close()}),typeof c=="function"?Ft.isAutomaticMode()?Ft.getNamespace().run(function(){Ft.setSegment(_),c($)}):c($):$.req&&$.req.listenerCount("response")===0&&$.resume()});return Q.on(ZT.errorMonitor||"error",Y),Q}r.__request=r.request;function s(...o){return n(r.__request,...o)}r.__get=r.get;function i(...o){return n(r.__get,...o)}Object.defineProperties(r,{request:{value:s,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}Go.exports.captureHTTPsGlobal=eA;Go.exports.captureHTTPs=tA});var qp=f((OL,Qo)=>{"use strict";var Dr=Je(),as=Symbol("original then"),us=Symbol("original catch");function Op(r){let e=r.prototype.then;e[as]||(r.prototype.then=function(n,s){if(Dr.isAutomaticMode()&&Pp()){let i=Dr.getNamespace();n=n&&i.bind(n),s=s&&i.bind(s)}return e.call(this,n,s)},r.prototype.then[as]=e);let t=r.prototype.catch;t&&!t[us]&&(r.prototype.catch=function(n){if(Dr.isAutomaticMode()&&Pp()){let s=Dr.getNamespace();n=n&&s.bind(n)}return t.call(this,n)},r.prototype.catch[us]=t)}function rA(r){let e=r.prototype.then;e[as]&&(r.prototype.then=e[as]);let t=r.prototype.catch;t&&t[us]&&(r.prototype.catch=t[us])}function Pp(){try{return Dr.getSegment()}catch{return}}function Np(){Op(Promise)}function nA(){rA(Promise)}Np.patchThirdPartyPromise=Op;Qo.exports.capturePromise=Np;Qo.exports.uncapturePromise=nA});var kp=f((NL,Dp)=>{"use strict";function Mp(r,e,t,n,s){this.init(r,e,t,n,s)}Mp.prototype.init=function(e,t,n,s,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=s,this.user=n};Dp.exports=Mp});var Bp=f((qL,Fp)=>{"use strict";var Fe=Je(),Xo=D(),Bt=Ke(),sA=Z(),iA=Jd(),$r={};try{$r=Zd()}catch(r){Xo.getLogger().debug("Failed to load SDK data:",r)}var kr="unknown",$p={plugins:{EC2Plugin:uf(),ECSPlugin:lf(),ElasticBeanstalkPlugin:ff()},config:function(r){var e={};r.forEach(function(t){t.getData(function(n){if(n)for(var s in n)e[s]=n[s]}),Bt.setOrigin(t.originName),Bt.setPluginData(e)})},setAWSWhitelist:Rr().setAWSWhitelist,appendAWSWhitelist:Rr().appendAWSWhitelist,setStreamingThreshold:Bt.setStreamingThreshold,setLogger:Xo.setLogger,getLogger:Xo.getLogger,setDaemonAddress:Cn().setDaemonAddress,captureFunc:Gn().captureFunc,captureAsyncFunc:Gn().captureAsyncFunc,captureCallbackFunc:Gn().captureCallbackFunc,captureAWS:jo().captureAWS,captureAWSClient:jo().captureAWSClient,captureAWSv3Client:Rp().captureAWSClient,captureHTTPs:Vo().captureHTTPs,captureHTTPsGlobal:Vo().captureHTTPsGlobal,capturePromise:qp().capturePromise,utils:sA,database:{SqlData:kp()},middleware:ho(),getNamespace:Fe.getNamespace,resolveSegment:Fe.resolveSegment,resolveManualSegmentParams:Fe.resolveManualSegmentParams,getSegment:Fe.getSegment,setSegment:Fe.setSegment,isAutomaticMode:Fe.isAutomaticMode,enableAutomaticMode:Fe.enableAutomaticMode,enableManualMode:Fe.enableManualMode,setContextMissingStrategy:Fe.setContextMissingStrategy,Segment:wr(),Subsegment:br(),SegmentUtils:Bt};$p.middleware.IncomingRequestData=to(),function(){var r={runtime:process.release&&process.release.name?process.release.name:kr,runtime_version:process.version,version:process.env.npm_package_version||kr,name:process.env.npm_package_name||kr},e={sdk:"X-Ray for Node.js",sdk_version:$r.version?$r.version:kr,package:$r.name?$r.name:kr};Bt.setSDKData(e),Bt.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&iA.init()}();Fp.exports=$p});var Ko=f((ML,Up)=>{"use strict";Up.exports=Bp()});var WA={};ca(WA,{handler:()=>xA});module.exports=Br(WA);var ig=require("aws-sdk");ft();var bs={PRETTY:4,COMPACT:0};var C={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},Ba=["level","message","sampling_rate","service","timestamp"],Ua="Uncaught error detected, flushing log buffer before exit";var Wa="POWERTOOLS_DEV",ja="POWERTOOLS_SERVICE_NAME",Ha="_X_AMZN_TRACE_ID";var H=({key:r,defaultValue:e,errorMessage:t})=>{let n=process.env[r];if(n===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return n.trim()},Ga=({key:r,defaultValue:e,errorMessage:t})=>{let n=H({key:r,defaultValue:String(e),errorMessage:t}),s=Number(n);if(Number.isNaN(s))throw new TypeError(`Environment variable ${r} must be a number`);return s},Pg=new Set(["1","y","yes","t","true","on"]),Og=new Set(["0","n","no","f","false","off"]),ws=({key:r,defaultValue:e,errorMessage:t,extendedParsing:n})=>{let i=H({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(n){if(Pg.has(i))return!0;if(Og.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},Xt=()=>{try{return ws({key:Wa,extendedParsing:!0})}catch{return!1}},Va=()=>H({key:ja,defaultValue:""}),Qa=()=>{let r=H({key:Ha,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[n,s]=t.split("=");e[n]=s}return e},Xa=()=>Qa()?.Sampled==="1",Le=()=>Qa()?.Root;var Qr,Xr,Ka,Kt=class{constructor(){I(this,Xr);I(this,Qr,e=>{let t="2-digit",n=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:n})})}formatError(e){let{name:t,message:n,stack:s,cause:i,...o}=e,a={name:t,location:this.getCodeLocation(e.stack),message:n,stack:Xt()&&typeof s=="string"?s?.split(`
`):s,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(a[u]=o[u]);return a}formatTimestamp(e){let t="UTC",n=H({key:"TZ",defaultValue:""});return n&&!n.includes(t)?N(this,Xr,Ka).call(this,e,n):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),n=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let s of t){let i=n.exec(s);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};Qr=new WeakMap,Xr=new WeakSet,Ka=function(e,t){let{year:n,month:s,day:i,hour:o,minute:a,second:u}=g(this,Qr).call(this,t).formatToParts(e).reduce((Ee,Y)=>(Ee[Y.type]=Y.value,Ee),{}),c=`${n}-${s}-${i}T${o}:${a}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",p=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),h=Math.abs(l%60).toString().padStart(2,"0"),E=e.getMilliseconds().toString().padStart(3,"0"),_=`${d}${p}:${h}`;return`${c}.${E}${_}`};var Tu=_e(qs(),1);var mt=class{constructor(e){b(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,Tu.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let n in e)e[n]!==void 0&&e[n]!==""&&e[n]!==null&&(t[n]=e[n]);return t}setAttributes(e){this.attributes=e}};var Nu=require("console"),qu=require("crypto");var He="2.28.1";var Ms=process.env.AWS_EXECUTION_ENV||"NA",Ay={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Au=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",Cy=r=>e=>async t=>{let n=t.request.headers["user-agent"]||"";if(n.includes("PT/NO-OP")){let s=n.replace("PT/NO-OP",`PT/${r}/${He} PTEnv/${Ms}`);return t.request.headers["user-agent"]=s,await e(t)}return n.includes("PT/")?await e(t):(t.request.headers["user-agent"]=n===""?`PT/${r}/${He} PTEnv/${Ms}`:`${n} PT/${r}/${He} PTEnv/${Ms}`,await e(t))},Ry=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},Ds=(r,e)=>{try{if(Au(r)){if(Ry(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(Cy(e),Ay)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var nn="powertools-for-aws",Cu=`${nn}.tracer`,Ru=`${nn}.metrics`,Iu=`${nn}.logger`,xu=`${nn}.idempotency`;var ks=r=>typeof r=="string";var Lu=r=>Object.is(r,null),$s=r=>Lu(r)||Object.is(r,void 0);var yt,nt=class{constructor(){I(this,yt);b(this,"coldStart",!0);b(this,"defaultServiceName","service_undefined");X(this,yt,this.getInitializationType()),g(this,yt)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return g(this,yt)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};yt=new WeakMap;var Pu=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${He}/PTEnv/${Pu}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${He}/PTEnv/${Pu}`;var tr=_e(qs(),1);var vt,sn=class extends Kt{constructor(t){super();I(this,vt);X(this,vt,t?.logRecordOrder)}formatAttributes(t,n){let s={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(g(this,vt)===void 0)return new mt({attributes:s}).addAttributes(n);let i={};for(let a of g(this,vt))a in s&&!(a in i)?i[a]=s[a]:a in n&&!(a in i)&&(i[a]=n[a]);for(let a in s)a in i||(i[a]=s[a]);for(let a in n)a in i||(i[a]=n[a]);return new mt({attributes:i})}};vt=new WeakMap;var Fs=class{constructor(e,t){b(this,"value");b(this,"logLevel");b(this,"byteSize");if(!ks(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},Bs=class extends Set{constructor(){super(...arguments);b(this,"currentBytesSize",0);b(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let n=super.delete(t);return n&&(this.currentBytesSize-=t.byteSize),n}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},st,St,an,Ou,on=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:n}){super();I(this,an);I(this,st);I(this,St);X(this,st,t),X(this,St,n)}setItem(t,n,s){let i=new Fs(n,s);if(i.byteSize>g(this,st))throw new Error("Item too big");let o=this.get(t)||new Bs;return o.currentBytesSize+i.byteSize>=g(this,st)&&(N(this,an,Ou).call(this,o,i),g(this,St)&&g(this,St).call(this)),o.add(i),super.set(t,o),this}};st=new WeakMap,St=new WeakMap,an=new WeakSet,Ou=function(t,n){for(;t.currentBytesSize+n.byteSize>=g(this,st);)t.shift(),t.hasEvictedLog=!0};var we,Et,ir,Te,Ge,it,V,Re,ot,Ne,or,R,rr,Us,Mu,Du,ku,$u,Ws,nr,Fu,js=class js extends nt{constructor(t={}){super();I(this,R);b(this,"console");b(this,"customConfigService");b(this,"logEvent",!1);b(this,"logFormatter");b(this,"logIndentation",bs.COMPACT);b(this,"logLevel",C.INFO);I(this,we);b(this,"persistentLogAttributes",{});b(this,"powertoolsLogData",{sampleRateValue:0});b(this,"temporaryLogAttributes",{});I(this,Et,[]);I(this,ir,!1);I(this,Te,new Map);I(this,Ge,C.INFO);I(this,it);I(this,V,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:C.DEBUG});I(this,Re);I(this,ot);I(this,Ne,{sampleRateValue:0,refreshedTimes:0});I(this,or,new Map);let{customConfigService:n,...s}=t;this.customConfigService=n||void 0,this.setOptions(s),X(this,ir,!0);for(let[i,o]of g(this,Et))this.printLog(i,this.createAndPopulateLogItem(...o));X(this,Et,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){N(this,R,Us).call(this,t,"temp")}appendPersistentKeys(t){N(this,R,Us).call(this,t,"persistent")}createChild(t={}){let n=this.createLogger((0,tr.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:g(this,Ne).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:g(this,it),correlationIdSearchFn:g(this,ot),...g(this,V).enabled&&{logBufferOptions:{maxBytes:g(this,V).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(g(this,V).bufferAtVerbosity),flushOnErrorLog:g(this,V).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&n.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&n.appendKeys(this.temporaryLogAttributes),n}critical(t,...n){this.processLogItem(C.CRITICAL,t,n)}debug(t,...n){this.processLogItem(C.DEBUG,t,n)}error(t,...n){g(this,V).enabled&&g(this,V).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(C.ERROR,t,n)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...n){this.processLogItem(C.INFO,t,n)}injectLambdaContext(t){return(n,s,i)=>{let o=i.value,a=this;i.value=async function(...u){a.refreshSampleRateCalculation(),a.addContext(u[1]),a.logEventIfEnabled(u[0],t?.logEvent),t?.correlationIdPath&&a.setCorrelationId(u[0],t?.correlationIdPath);try{return await o.apply(this,u)}catch(c){throw t?.flushBufferOnUncaughtError&&(a.flushBuffer(),a.error({message:Ua,error:c})),c}finally{(t?.clearState||t?.resetKeys)&&a.resetKeys(),a.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,n,s){s&&(s.clearState||s?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,n,s,i){t.addContext(s),t.logEventIfEnabled(n,i?.logEvent)}logEventIfEnabled(t,n){this.shouldLogEvent(n)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(g(this,Ne).refreshedTimes===0){g(this,Ne).refreshedTimes++;return}N(this,R,Ws).call(this)&&this.logLevel>C.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(g(this,Ge)))}removeKeys(t){for(let n of t)this.temporaryLogAttributes[n]=void 0,this.persistentLogAttributes[n]?g(this,Te).set(n,"persistent"):g(this,Te).delete(n)}removePersistentKeys(t){for(let n of t)this.persistentLogAttributes[n]=void 0,this.temporaryLogAttributes[n]?g(this,Te).set(n,"temp"):g(this,Te).delete(n)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?g(this,Te).set(t,"persistent"):g(this,Te).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=C[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...n){this.processLogItem(C.TRACE,t,n)}warn(t,...n){this.processLogItem(C.WARN,t,n)}createLogger(t){return new js(t)}getJsonReplacer(){let t=new WeakSet;return(n,s)=>{var o;let i=s;if(g(this,it)&&(i=(o=g(this,it))==null?void 0:o.call(this,n,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,tr.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return g(this,we)!==void 0?(this.logLevel=C[g(this,we)],this.isValidLogLevel(t)&&this.logLevel>C[t]&&N(this,R,rr).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${g(this,we)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,n,s){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:Le(),...this.getPowertoolsLogData(),message:""},o=N(this,R,Mu).call(this);return N(this,R,Du).call(this,n,i,o),N(this,R,ku).call(this,s,o),this.getLogFormatter().formatAttributes(i,o)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let n;for(let[s,i]of Object.entries(C))if(i===t){n=s;break}return n}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in C}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,n){n.prepareForPrint();let s=t===C.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[s](JSON.stringify(n.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,n,s){let i=Le();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,n,s),t)}catch(o){this.printLog(C.WARN,this.createAndPopulateLogItem(C.WARN,`Unable to buffer log: ${o.message}`,[o])),this.printLog(t,this.createAndPopulateLogItem(t,n,s))}return}t>=this.logLevel&&(g(this,ir)?this.printLog(t,this.createAndPopulateLogItem(t,n,s)):g(this,Et).push([t,[t,n,s]]))}setConsole(){Xt()?this.console=console:this.console=new Nu.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...n)=>{this.console.log(t,...n)}}setInitialLogLevel(t){let n=t?.toUpperCase();if(this.awsLogLevelShortCircuit(n)){X(this,Ge,this.logLevel);return}if(this.isValidLogLevel(n)){this.logLevel=C[n],X(this,Ge,this.logLevel);return}let s=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(s)){this.logLevel=C[s],X(this,Ge,this.logLevel);return}let i=H({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),o=H({key:"LOG_LEVEL",defaultValue:""}),a=i!==""?i:o;this.isValidLogLevel(a)&&(this.logLevel=C[a],X(this,Ge,this.logLevel))}setInitialSampleRate(t){let n=t,s=this.getCustomConfigService()?.getSampleRateValue(),i=Ga({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let o of[n,s,i])if(this.isValidSampleRate(o)){g(this,Ne).sampleRateValue=o,this.powertoolsLogData.sampleRateValue=o,N(this,R,Ws).call(this)&&this.logLevel>C.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=ws({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,n){this.logFormatter=t??new sn({logRecordOrder:n})}setLogIndentation(){Xt()&&(this.logIndentation=bs.PRETTY)}setOptions(t){let{logLevel:n,serviceName:s,sampleRateValue:i,logFormatter:o,persistentKeys:a,persistentLogAttributes:u,environment:c,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:p,correlationIdSearchFn:h}=t;u&&Object.keys(u).length>0&&a&&Object.keys(a).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(s,c,a||u);let E=H({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),_=E==="FATAL"?"CRITICAL":E;return this.isValidLogLevel(_)&&X(this,we,_),this.setLogEvent(),this.setInitialLogLevel(n),this.setInitialSampleRate(i),this.setLogFormatter(o,d),this.setConsole(),this.setLogIndentation(),X(this,it,l),N(this,R,Fu).call(this,p),X(this,ot,h),this}setPowertoolsLogData(t,n,s){this.addToPowertoolsLogData({awsRegion:H({key:"AWS_REGION",defaultValue:""}),environment:n||this.getCustomConfigService()?.getCurrentEnvironment()||H({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||H({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),s&&this.appendPersistentKeys(s)}bufferLogItem(t,n,s){n.prepareForPrint(),g(this,Re)?.has(t)===!1&&g(this,Re)?.clear(),g(this,Re)?.setItem(t,JSON.stringify(n.getAttributes(),this.getJsonReplacer(),this.logIndentation),s)}flushBuffer(){let t=Le();if(t===void 0)return;let n=g(this,Re)?.get(t);if(n!==void 0){for(let s of n){let i=this.getLogLevelNameFromNumber(s.logLevel).toLowerCase();this.console[i](s.value)}n.hasEvictedLog&&this.printLog(C.WARN,this.createAndPopulateLogItem(C.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),g(this,we)!==void 0&&C[g(this,we)]>g(this,V).bufferAtVerbosity&&N(this,R,rr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),g(this,Re)?.delete(t)}}clearBuffer(){let t=Le();t!==void 0&&g(this,Re)?.delete(t)}shouldBufferLog(t,n){return g(this,V).enabled&&t!==void 0&&n<=g(this,V).bufferAtVerbosity}setCorrelationId(t,n){if(typeof n=="string"){if(!g(this,ot)){N(this,R,rr).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let s=g(this,ot).call(this,n,t);s&&this.appendKeys({correlation_id:s});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};we=new WeakMap,Et=new WeakMap,ir=new WeakMap,Te=new WeakMap,Ge=new WeakMap,it=new WeakMap,V=new WeakMap,Re=new WeakMap,ot=new WeakMap,Ne=new WeakMap,or=new WeakMap,R=new WeakSet,rr=function(t){g(this,or).has(t)||(g(this,or).set(t,!0),this.warn(t))},Us=function(t,n){for(let s of Object.keys(t))N(this,R,nr).call(this,s)===!1&&g(this,Te).set(s,n);n==="temp"?(0,tr.default)(this.temporaryLogAttributes,t):(0,tr.default)(this.persistentLogAttributes,t)},Mu=function(){let t={};for(let[n,s]of g(this,Te))N(this,R,nr).call(this,n)||(t[n]=s==="persistent"?this.persistentLogAttributes[n]:this.temporaryLogAttributes[n]);return t},Du=function(t,n,s){if(typeof t=="string"){n.message=t;return}let{message:i,...o}=t;n.message=i;for(let[a,u]of Object.entries(o))N(this,R,nr).call(this,a)||(s[a]=u)},ku=function(t,n){for(let s of t)$s(s)||(s instanceof Error?n.error=s:typeof s=="string"?n.extra=s:N(this,R,$u).call(this,s,n))},$u=function(t,n){for(let[s,i]of Object.entries(t))N(this,R,nr).call(this,s)||(n[s]=i)},Ws=function(){return g(this,Ne).sampleRateValue&&(0,qu.randomInt)(0,100)/100<=g(this,Ne).sampleRateValue},nr=function(t){return Ba.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},Fu=function(t){if(t===void 0||(g(this,V).enabled=t?.enabled!==!1,g(this,V).enabled===!1))return;t?.maxBytes!==void 0&&(g(this,V).maxBytes=t.maxBytes),X(this,Re,new on({maxBytesSize:g(this,V).maxBytes})),t?.flushOnErrorLog===!1&&(g(this,V).flushOnErrorLog=!1);let n=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(n)&&(g(this,V).bufferAtVerbosity=C[n]),g(this,we)!==void 0&&C[g(this,we)]>g(this,V).bufferAtVerbosity&&N(this,R,rr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var sr=js;ft();var _t=class r{constructor(e,t){this.logger=new sr({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||je(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,n){let s=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...s,...n})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,n){this.info(`Custom metric: ${e}`,{metric:e,value:t,...n})}logApiRequest(e,t,n){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...n})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};function Bu(r,e){return new _t(`fibonacci-${r}`,{agent:r,...e})}var YR=new _t;var pe=_e(ji(),1),WI=pe.default.Client,Il=pe.default.Pool,jI=pe.default.Connection,HI=pe.default.types,GI=pe.default.Query,VI=pe.default.DatabaseError,QI=pe.default.escapeIdentifier,XI=pe.default.escapeLiteral,KI=pe.default.Result,zI=pe.default.TypeOverrides,YI=pe.default.defaults;var tg=require("aws-sdk");var zp=_e(Ko(),1);var Qp=_e(Ko(),1),cs=require("diagnostics_channel"),Xp=_e(require("http"),1),Kp=_e(require("https"),1);var zo=require("url"),Wp=new TextDecoder,jp=(r,e)=>{let t=-1;for(let n=0;n<r.length;n+=2)if(Wp.decode(r[n]).toLowerCase()===e){t=n;break}return t===-1?null:Wp.decode(r[t+1])},Yo=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",Hp=r=>{if(typeof r.origin=="string")return new zo.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof zo.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:oA,captureAWSClient:aA,captureAWSv3Client:uA,captureAsyncFunc:cA,captureFunc:lA,captureHTTPsGlobal:Gp,getNamespace:dA,getSegment:fA,setSegment:hA,Segment:Vp,setContextMissingStrategy:pA,setDaemonAddress:gA,setLogger:mA}=Qp.default,ls=class{captureAWS(e){return oA(e)}captureAWSClient(e){return aA(e)}captureAWSv3Client(e){return Ds(e,"tracer"),uA(e)}captureAsyncFunc(e,t,n){return cA(e,t)}captureFunc(e,t,n){return lA(e,t)}captureHTTPsGlobal(){Gp(Xp.default),Gp(Kp.default)}getNamespace(){return dA()}getSegment(){return fA()}instrumentFetch(){let e=s=>{let{request:i}=s,o=i.method;if(o==="CONNECT")return;let a=this.getSegment(),u=Hp(i);if(a&&u){let c=a.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${Le()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:o}},this.setSegment(c)}},t=s=>{let{response:i}=s,o=this.getSegment();if(Yo(o)){let a=i.statusCode,u=jp(i.headers,"content-length");o.http={...o.http,response:{status:a,...u&&{content_length:Number.parseInt(u,10)}}},a===429&&o.addThrottleFlag(),a>=400&&a<500?o.addErrorFlag():a>=500&&a<600&&o.addFaultFlag(),o.close(),this.setSegment(o.parent)}},n=s=>{let{error:i}=s,o=this.getSegment();Yo(o)&&(o.addErrorFlag(),i instanceof Error&&o.addError(i,!0),o.close(),this.setSegment(o.parent))};(0,cs.subscribe)("undici:request:create",e),(0,cs.subscribe)("undici:request:headers",t),(0,cs.subscribe)("undici:request:error",n)}putAnnotation(e,t){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(n instanceof Vp){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}n.addAnnotation(e,t)}putMetadata(e,t,n){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(s instanceof Vp){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}s.addMetadata(e,t,n)}setContextMissingStrategy(e){pA(e)}setDaemonAddress(e){gA(e)}setLogger(e){mA(e)}setSegment(e){hA(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:yA}=zp.default,G,ds,Yp,Fr=class extends nt{constructor(t={}){super();I(this,ds);b(this,"provider");b(this,"captureError",!0);b(this,"captureHTTPsRequests",!0);b(this,"captureResponse",!0);b(this,"customConfigService");I(this,G,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});b(this,"serviceName");b(this,"tracingEnabled",!0);N(this,ds,Yp).call(this),this.setOptions(t),this.provider=new ls,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,n){if(!this.isTracingEnabled())return;let s=this.getSegment();if(s!==void 0){if(!this.captureError){s.addErrorFlag();return}s.addError(t,n||!1)}}addResponseAsMetadata(t,n){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${n} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(n){try{return this.provider.captureAWSClient(t.service),t}catch{throw n}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(n,s,i)=>{let o=i.value,a=this;return i.value=function(...u){return a.isTracingEnabled()?a.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async c=>{a.annotateColdStart(),a.addServiceNameAnnotation();let l;try{l=await o.apply(this,u),(t?.captureResponse??!0)&&a.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw a.addErrorAsMetadata(d),d}finally{try{c?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",c?.name,d)}}return l}):o.apply(this,u)},i}}captureMethod(t){return(n,s,i)=>{let o=i.value,a=this;return i.value=function(...u){if(!a.isTracingEnabled())return o.apply(this,[...u]);let c=String(s),l=t?.subSegmentName?t.subSegmentName:`### ${c}`;return a.provider.captureAsyncFunc(l,async d=>{let p;try{p=await o.apply(this,[...u]),(t?.captureResponse??!0)&&a.addResponseAsMetadata(p,c)}catch(h){throw a.addErrorAsMetadata(h),h}finally{try{d?.close()}catch(h){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,h)}}return p})},i}}getRootXrayTraceId(){return Le()}getSegment(){if(!this.isTracingEnabled())return new yA("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?Xa():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,n){this.isTracingEnabled()&&this.provider.putAnnotation(t,n)}putMetadata(t,n,s){this.isTracingEnabled()&&this.provider.putMetadata(t,n,s||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return g(this,G).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return g(this,G).awsExecutionEnv!==""}isLambdaSamCli(){return g(this,G).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(g(this,G).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let n=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(n!==void 0&&n.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}g(this,G).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(g(this,G).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:n,serviceName:s,captureHTTPsRequests:i,customConfigService:o}=t;return this.setCustomConfigService(o),this.setTracingEnabled(n),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(s),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let n=this.getCustomConfigService()?.getServiceName();if(n!==void 0&&this.isValidServiceName(n)){this.serviceName=n;return}if(g(this,G).serviceName!==void 0&&this.isValidServiceName(g(this,G).serviceName)){this.serviceName=g(this,G).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let n=this.getCustomConfigService()?.getTracingEnabled();if(n!==void 0&&n.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(g(this,G).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};G=new WeakMap,ds=new WeakSet,Yp=function(){g(this,G).awsExecutionEnv=H({key:"AWS_EXECUTION_ENV",defaultValue:""}),g(this,G).samLocal=H({key:"AWS_SAM_LOCAL",defaultValue:""}),g(this,G).captureError=H({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),g(this,G).captureHTTPsRequests=H({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),g(this,G).captureResponse=H({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),g(this,G).tracingEnabled=H({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),g(this,G).serviceName=Va()};var vA=new Fr({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service"});function Jo(){try{return vA.getSegment()}catch(r){console.warn("Failed to get X-Ray segment:",r);return}}function SA(r,e,t){try{let n=Jo();if(!n)return;let s=n.addNewSubsegment(r);if(e)for(let[i,o]of Object.entries(e))o!==void 0&&s.addAnnotation(i,o);if(t)for(let[i,o]of Object.entries(t))s.addMetadata(i,o);return s}catch(n){console.warn("Failed to create X-Ray subsegment:",n);return}}function Jp(r,e="success",t){if(r)try{r.addAnnotation("status",e),t&&(r.addError(t),r.addMetadata("error",{name:t.name,message:t.message,stack:t.stack})),r.close()}catch(n){console.warn("Failed to close X-Ray subsegment:",n)}}async function EA(r,e,t,n){let s=SA(r,t,n);try{let i=await e();return Jp(s,"success"),i}catch(i){throw Jp(s,"error",i),i}}function Zo(r){try{let e=Jo();if(!e)return;for(let[t,n]of Object.entries(r))n!==void 0&&e.addAnnotation(t,n)}catch(e){console.warn("Failed to add X-Ray annotations:",e)}}function Zp(r,e){try{let t=Jo();if(!t)return;if(e)t.addMetadata(e,r);else for(let[n,s]of Object.entries(r))t.addMetadata(n,s)}catch(t){console.warn("Failed to add X-Ray metadata:",t)}}async function eg(r,e,t){return EA(`DB:${r}`,e,{operation:"database"},{queryParams:t})}var Se=new _t("database"),_A=new tg.SecretsManager,ea=class{constructor(e){this.pool=null;this.credentials=null;this.secretArn=e||process.env.DB_SECRET_ARN||""}async getCredentials(){if(this.credentials)return this.credentials;try{Se.info("Fetching database credentials from Secrets Manager",{secretArn:this.secretArn});let e=await _A.getSecretValue({SecretId:this.secretArn}).promise();if(!e.SecretString)throw new Error("Secret string is empty");let t=JSON.parse(e.SecretString);return this.credentials={username:t.username,password:t.password,host:t.host,port:t.port||5432,dbname:t.dbname||"fibonacci"},Se.info("Database credentials fetched successfully"),this.credentials}catch(e){throw Se.error("Failed to fetch database credentials",e),e}}async initializePool(){if(this.pool)return this.pool;let e=await this.getCredentials();return Se.info("Initializing database connection pool",{host:e.host,port:e.port,database:e.dbname}),this.pool=new Il({user:e.username,password:e.password,host:e.host,port:e.port,database:e.dbname,max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4,ssl:{rejectUnauthorized:!1}}),this.pool.on("error",t=>{Se.error("Unexpected error on idle database client",t)}),Se.info("Database connection pool initialized"),this.pool}async getPool(){return await this.initializePool()}async close(){this.pool&&(Se.info("Closing database connection pool"),await this.pool.end(),this.pool=null,this.credentials=null)}},bA=new ea;async function dt(r,e,t=3){let n=r.trim().split(" ")[0].toUpperCase();return eg(n,async()=>{let s=await bA.getPool(),i=null;for(let o=1;o<=t;o++)try{Se.debug("Executing database query",{attempt:o,query:r.substring(0,100),paramCount:e?.length||0}),Zp({query:r.substring(0,200),paramCount:e?.length||0,attempt:o},"database");let a=Date.now(),u=await s.query(r,e),c=Date.now()-a;return Zo({dbOperation:n,dbRowCount:u.rowCount||0,dbDuration:c}),Se.debug("Query executed successfully",{rowCount:u.rowCount,duration:c}),u}catch(a){if(i=a,Se.warn(`Query failed on attempt ${o}`,{attempt:o,maxRetries:t,error:i.message}),!wA(i)||o===t)throw Zo({dbOperation:n,dbError:i.name}),Se.error("Query failed permanently",i,{query:r.substring(0,100),attempts:o}),i;let c=Math.pow(2,o)*100;Se.debug(`Retrying query after ${c}ms`),await TA(c)}throw i||new Error("Query failed after retries")},{operation:n,paramCount:e?.length||0})}function wA(r){let e=["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND","57P03","53300","08006","08003"],t=r.message.toLowerCase(),n=r.code;return e.includes(n)||t.includes("connection")||t.includes("timeout")||t.includes("econnrefused")}function TA(r){return new Promise(e=>setTimeout(e,r))}var{v4:rg}=(ft(),Br(Vr)),ne=class extends Error{constructor(t,n,s,i,o,a=!1){super(t);this.code=n;this.server=s;this.method=i;this.traceId=o;this.isRetryable=a;this.name="MCPError"}},ta=class extends ne{constructor(e,t,n,s){super(`MCP call timed out after ${s}ms`,"MCP_TIMEOUT",e,t,n,!0),this.name="MCPTimeoutError"}},ra=class extends ne{constructor(e,t,n,s){super(`Network error during MCP call: ${s.message}`,"MCP_NETWORK_ERROR",e,t,n,!0),this.name="MCPNetworkError"}};var na=class{info(e,t){console.log(JSON.stringify({level:"INFO",message:e,...t}))}warn(e,t){console.warn(JSON.stringify({level:"WARN",message:e,...t}))}error(e,t,n){console.error(JSON.stringify({level:"ERROR",message:e,error:{name:t.name,message:t.message,stack:t.stack},...n}))}debug(e,t){console.debug(JSON.stringify({level:"DEBUG",message:e,...t}))}},Ut=class{constructor(e={}){this.timeout=e.timeout??3e4,this.maxRetries=e.maxRetries??3,this.initialRetryDelay=e.initialRetryDelay??1e3,this.maxRetryDelay=e.maxRetryDelay??3e4,this.logger=e.logger??new na}async call(e,t,n={}){let s=rg(),i=Date.now();this.logger.info("MCP call initiated",{traceId:s,server:e,method:t,params:this.sanitizeParams(n)});let o=null;for(let a=1;a<=this.maxRetries;a++)try{let u=await this.executeCall(e,t,n,s,a),c=Date.now()-i;return this.logger.info("MCP call succeeded",{traceId:s,server:e,method:t,attempt:a,duration:c}),u}catch(u){let c=Date.now()-i;if(u instanceof ne){if(o=u,this.logger.warn("MCP call failed",{traceId:s,server:e,method:t,attempt:a,maxRetries:this.maxRetries,duration:c,error:u.message,code:u.code,isRetryable:u.isRetryable}),!u.isRetryable)throw this.logger.error("MCP call failed with non-retryable error",u,{traceId:s,server:e,method:t}),u;if(a===this.maxRetries)break;let l=this.calculateRetryDelay(a);this.logger.debug("Retrying MCP call after delay",{traceId:s,server:e,method:t,attempt:a,nextAttempt:a+1,delayMs:l}),await this.sleep(l)}else{let l=new ne(`Unexpected error during MCP call: ${u}`,"MCP_UNEXPECTED_ERROR",e,t,s,!1);throw this.logger.error("MCP call failed with unexpected error",l,{traceId:s,server:e,method:t,originalError:u}),l}}throw this.logger.error("MCP call failed after all retries",o,{traceId:s,server:e,method:t,attempts:this.maxRetries}),o}async listTools(e){let t=rg();this.logger.info("Listing MCP tools",{traceId:t,server:e});try{let n=await this.executeListTools(e,t);return this.logger.info("MCP tools listed successfully",{traceId:t,server:e,toolCount:n.length}),n}catch(n){throw this.logger.error("Failed to list MCP tools",n,{traceId:t,server:e}),n}}async executeCall(e,t,n,s,i){let o=new AbortController,a=global.setTimeout(()=>o.abort(),this.timeout);try{let u=await this.simulateMCPCall(e,t,n,o.signal);return global.clearTimeout(a),u}catch(u){throw global.clearTimeout(a),u instanceof Error&&u.name==="AbortError"?new ta(e,t,s,this.timeout):this.isNetworkError(u)?new ra(e,t,s,u):u}}async executeListTools(e,t){return[]}async simulateMCPCall(e,t,n,s){return new Promise((i,o)=>{if(s.aborted){o(new Error("AbortError"));return}s.addEventListener("abort",()=>{o(new Error("AbortError"))}),global.setTimeout(()=>{i({})},100)})}calculateRetryDelay(e){let t=this.initialRetryDelay*Math.pow(2,e-1),n=t*.25*(Math.random()*2-1),s=t+n;return Math.min(s,this.maxRetryDelay)}sleep(e){return new Promise(t=>global.setTimeout(t,e))}isNetworkError(e){return e instanceof Error?["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND","ENETUNREACH"].some(n=>e.message.includes(n)):!1}sanitizeParams(e){let t=["password","token","apiKey","secret","authorization"],n={...e};for(let s of Object.keys(n))t.some(i=>s.toLowerCase().includes(i))&&(n[s]="***REDACTED***");return n}};var{v4:Wt}=(ft(),Br(Vr)),AA=require("aws-sdk"),sa=class{constructor(e={}){this.credentials=null;this.credentialsExpiry=0;this.mcpClient=new Ut(e),this.secretName=e.secretName??"fibonacci/mcp/calendar",this.apiEndpoint=e.apiEndpoint??"https://www.googleapis.com/calendar/v3",this.logger=e.logger??this.mcpClient.logger,this.secretsManager=new AA.SecretsManager({region:process.env.AWS_REGION??"us-east-1"})}async getCredentials(){if(this.credentials&&Date.now()<this.credentialsExpiry)return this.credentials;try{let e=await this.secretsManager.getSecretValue({SecretId:this.secretName}).promise();if(!e.SecretString)throw new Error("Secret string is empty");let t=JSON.parse(e.SecretString);return this.credentials={clientId:t.clientId,clientSecret:t.clientSecret,refreshToken:t.refreshToken,accessToken:t.accessToken,expiryDate:t.expiryDate},this.credentialsExpiry=Date.now()+50*60*1e3,this.credentials}catch(e){throw this.logger.error("Failed to fetch calendar credentials",e),new ne("Failed to fetch calendar credentials","CREDENTIALS_ERROR","calendar","getCredentials",Wt(),!1)}}async getAvailability(e){let t=Wt();this.logger.info("Calendar getAvailability initiated",{traceId:t,calendarId:this.maskCalendarId(e.calendarId),startDate:e.startDate,endDate:e.endDate,duration:e.duration});try{let n=this.generateMockAvailableSlots(e.startDate,e.endDate,e.duration,e.workingHours,e.workingDays);return this.logger.info("Calendar getAvailability succeeded",{traceId:t,totalSlots:n.length}),{availableSlots:n,totalSlots:n.length}}catch(n){throw this.logger.error("Calendar getAvailability failed",n,{traceId:t}),n}}async createEvent(e){let t=Wt();this.logger.info("Calendar createEvent initiated",{traceId:t,calendarId:this.maskCalendarId(e.calendarId),summary:e.summary,start:e.start,duration:e.duration});try{let n=Wt(),s={eventId:n,htmlLink:`https://calendar.google.com/event?eid=${n}`,hangoutLink:e.conferenceData?`https://meet.google.com/${n.substring(0,12)}`:void 0,status:"confirmed",created:new Date().toISOString()};return this.logger.info("Calendar createEvent succeeded",{traceId:t,eventId:s.eventId}),s}catch(n){throw this.logger.error("Calendar createEvent failed",n,{traceId:t}),n}}async updateEvent(e){let t=Wt();this.logger.info("Calendar updateEvent initiated",{traceId:t,calendarId:this.maskCalendarId(e.calendarId),eventId:e.eventId});try{let n={eventId:e.eventId,htmlLink:`https://calendar.google.com/event?eid=${e.eventId}`,status:e.status||"confirmed",updated:new Date().toISOString()};return this.logger.info("Calendar updateEvent succeeded",{traceId:t,eventId:n.eventId}),n}catch(n){throw this.logger.error("Calendar updateEvent failed",n,{traceId:t}),n}}async deleteEvent(e){let t=Wt();this.logger.info("Calendar deleteEvent initiated",{traceId:t,calendarId:this.maskCalendarId(e.calendarId),eventId:e.eventId});try{let n={eventId:e.eventId,deleted:!0,timestamp:new Date().toISOString()};return this.logger.info("Calendar deleteEvent succeeded",{traceId:t,eventId:n.eventId}),n}catch(n){throw this.logger.error("Calendar deleteEvent failed",n,{traceId:t}),n}}generateMockAvailableSlots(e,t,n,s,i){let o=[],a=new Date(e),u=new Date(t),c=s||{start:"09:00",end:"18:00"},l=i||[1,2,3,4,5],d=new Date(a);for(;d<=u;){let p=d.getDay();if(l.includes(p)){let[h,E]=c.start.split(":").map(Number),[_,Ee]=c.end.split(":").map(Number),Y=new Date(d);Y.setHours(h,E,0,0);let k=new Date(d);for(k.setHours(_,Ee,0,0);Y<k;){let Q=new Date(Y.getTime()+n*6e4);Q<=k&&o.push({start:Y.toISOString(),end:Q.toISOString(),available:!0}),Y=Q}}d.setDate(d.getDate()+1),d.setHours(0,0,0,0)}return o.slice(0,3)}maskCalendarId(e){if(e.length<=8)return e;let t=e.substring(0,4),n=e.substring(e.length-4),s="*".repeat(e.length-8);return`${t}${s}${n}`}};function ng(r){return new sa(r)}var{v4:Be}=(ft(),Br(Vr)),CA=require("aws-sdk"),ia=class{constructor(e){this.secondWindow=[];this.minuteWindow=[];this.hourWindow=[];this.messagesPerSecond=e.messagesPerSecond,this.messagesPerMinute=e.messagesPerMinute,this.messagesPerHour=e.messagesPerHour}async checkAndRecord(){let e=Date.now();return this.cleanupWindows(e),this.secondWindow.length>=this.messagesPerSecond||this.minuteWindow.length>=this.messagesPerMinute||this.hourWindow.length>=this.messagesPerHour?!1:(this.secondWindow.push(e),this.minuteWindow.push(e),this.hourWindow.push(e),!0)}async waitForSlot(){for(;!await this.checkAndRecord();)await this.sleep(100)}cleanupWindows(e){let t=e-1e3,n=e-6e4,s=e-36e5;this.secondWindow=this.secondWindow.filter(i=>i>t),this.minuteWindow=this.minuteWindow.filter(i=>i>n),this.hourWindow=this.hourWindow.filter(i=>i>s)}sleep(e){return new Promise(t=>setTimeout(t,e))}},oa=class{constructor(e={}){this.apiKey=null;this.apiKeyExpiry=0;this.idempotencyCache=new Map;this.mcpClient=new Ut(e),this.secretName=e.secretName??"fibonacci/mcp/whatsapp",this.apiEndpoint=e.apiEndpoint??"https://graph.facebook.com/v18.0",this.logger=e.logger??this.mcpClient.logger,this.rateLimiter=new ia(e.rateLimit??{messagesPerSecond:80,messagesPerMinute:1e3,messagesPerHour:1e4}),this.secretsManager=new CA.SecretsManager({region:process.env.AWS_REGION??"us-east-1"})}async sendMessage(e){let t=Be(),n=Date.now();this.validateSendMessageParams(e);let s=e.idempotencyKey??this.generateIdempotencyKey(e);this.logger.info("WhatsApp sendMessage initiated",{traceId:t,to:this.maskPhoneNumber(e.to),idempotencyKey:s});let i=this.idempotencyCache.get(s);if(i)return this.logger.info("WhatsApp sendMessage returned from cache (idempotent)",{traceId:t,idempotencyKey:s,messageId:i.messageId}),i;try{await this.rateLimiter.waitForSlot();let o=await this.getApiKey(),a=await this.sendWhatsAppMessage(e,o,s,t);if(this.idempotencyCache.set(s,a),this.idempotencyCache.size>1e4){let c=this.idempotencyCache.keys().next().value;c&&this.idempotencyCache.delete(c)}let u=Date.now()-n;return this.logger.info("WhatsApp sendMessage succeeded",{traceId:t,messageId:a.messageId,status:a.status,duration:u}),a}catch(o){let a=Date.now()-n;throw this.logger.error("WhatsApp sendMessage failed",o,{traceId:t,to:this.maskPhoneNumber(e.to),duration:a}),o}}async getMessageStatus(e){let t=Be(),n=Date.now();this.logger.info("WhatsApp getMessageStatus initiated",{traceId:t,messageId:e});try{let s=await this.getApiKey(),i=await this.fetchMessageStatus(e,s,t),o=Date.now()-n;return this.logger.info("WhatsApp getMessageStatus succeeded",{traceId:t,messageId:e,status:i.status,duration:o}),i}catch(s){let i=Date.now()-n;throw this.logger.error("WhatsApp getMessageStatus failed",s,{traceId:t,messageId:e,duration:i}),s}}async getApiKey(){let e=Date.now();if(this.apiKey&&e<this.apiKeyExpiry)return this.apiKey;try{this.logger.debug("Fetching WhatsApp API key from Secrets Manager",{secretName:this.secretName});let t=await this.secretsManager.getSecretValue({SecretId:this.secretName}).promise();if(!t.SecretString)throw new Error("Secret value is empty");let n=JSON.parse(t.SecretString);if(this.apiKey=n.apiKey,!this.apiKey)throw new Error("apiKey not found in secret");return this.apiKeyExpiry=e+3e5,this.logger.debug("WhatsApp API key fetched successfully"),this.apiKey}catch(t){throw this.logger.error("Failed to fetch WhatsApp API key",t,{secretName:this.secretName}),new ne(`Failed to fetch API key from Secrets Manager: ${t}`,"WHATSAPP_AUTH_ERROR","whatsapp","getApiKey",Be(),!1)}}async sendWhatsAppMessage(e,t,n,s){let i={messaging_product:"whatsapp",recipient_type:"individual",to:e.to,type:"text",text:{body:e.message}};try{return{messageId:(await this.makeHttpRequest("POST",`${this.apiEndpoint}/messages`,i,{Authorization:`Bearer ${t}`,"Content-Type":"application/json","X-Idempotency-Key":n,"X-Trace-Id":s})).messages?.[0]?.id??Be(),status:"sent",timestamp:new Date().toISOString()}}catch(o){throw new ne(`WhatsApp API error: ${o}`,"WHATSAPP_API_ERROR","whatsapp","sendMessage",s,this.isRetryableError(o))}}async fetchMessageStatus(e,t,n){try{let s=await this.makeHttpRequest("GET",`${this.apiEndpoint}/messages/${e}`,null,{Authorization:`Bearer ${t}`,"X-Trace-Id":n});return{messageId:e,status:this.mapWhatsAppStatus(s.status),timestamp:s.timestamp??new Date().toISOString(),errorCode:s.error?.code,errorMessage:s.error?.message}}catch(s){throw new ne(`WhatsApp API error: ${s}`,"WHATSAPP_API_ERROR","whatsapp","getMessageStatus",n,this.isRetryableError(s))}}async makeHttpRequest(e,t,n,s){return this.logger.debug("Making HTTP request to WhatsApp API",{method:e,url:t.replace(/\/\d+\//g,"/****/")}),new Promise(i=>{setTimeout(()=>{i(e==="POST"?{messages:[{id:Be()}]}:{status:"delivered",timestamp:new Date().toISOString()})},100)})}validateSendMessageParams(e){if(!e.to)throw new ne("Missing required parameter: to","WHATSAPP_INVALID_PARAMS","whatsapp","sendMessage",Be(),!1);if(!e.message)throw new ne("Missing required parameter: message","WHATSAPP_INVALID_PARAMS","whatsapp","sendMessage",Be(),!1);if(!e.to.startsWith("+"))throw new ne("Phone number must be in international format (e.g., +5511987654321)","WHATSAPP_INVALID_PHONE","whatsapp","sendMessage",Be(),!1);if(e.message.length>4096)throw new ne("Message exceeds maximum length of 4096 characters","WHATSAPP_MESSAGE_TOO_LONG","whatsapp","sendMessage",Be(),!1)}generateIdempotencyKey(e){let t=`${e.to}:${e.message}`,n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);n=(n<<5)-n+i,n=n&n}return`whatsapp-${Math.abs(n)}-${Date.now()}`}mapWhatsAppStatus(e){return{queued:"queued",sent:"sent",delivered:"delivered",read:"read",failed:"failed"}[e.toLowerCase()]??"sent"}isRetryableError(e){return!!(e instanceof Error&&["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND"].some(n=>e.message.includes(n))||e.statusCode>=500&&e.statusCode<600||e.statusCode===429)}maskPhoneNumber(e){if(e.length<=7)return e;let t=e.substring(0,3),n=e.substring(e.length-4),s="*".repeat(e.length-7);return`${t}${s}${n}`}};function sg(r){return new oa(r)}var W=Bu("agendamento"),RA=new ig.EventBridge,og=ng(),aa=sg(),IA=process.env.EVENT_BUS_NAME||"fibonacci-bus";async function xA(r,e){W.info("Agente de Agendamento invoked",{recordCount:r.Records.length,requestId:e.awsRequestId});for(let t of r.Records){let n=je();W.setTraceId(n);try{await LA(t,n)}catch(s){throw W.error("Failed to process agendamento request",s,{traceId:n,messageId:t.messageId}),s}}}async function LA(r,e){let t=Date.now();W.info("Processing agendamento request",{traceId:e,messageId:r.messageId});let n=JSON.parse(r.body),s=n.detail||n;if(s.type==="schedule_request")await PA(s,e);else if(s.type==="schedule_confirmation")await OA(s,e);else{W.warn("Unknown agendamento message type",{traceId:e,type:s.type});return}let i=Date.now()-t;W.info("Agendamento request processed successfully",{traceId:e,duration:i})}async function PA(r,e){W.updateContext({leadId:r.leadId,tenantId:r.tenantId}),W.info("Handling schedule request");let t=await ag(r.leadId,e);if(!t)throw new Error(`Lead not found: ${r.leadId}`);let n=new Date;n.setDate(n.getDate()+1),n.setHours(0,0,0,0);let s=new Date(n);s.setDate(s.getDate()+7);let i={calendarId:r.calendarId,startDate:n.toISOString().split("T")[0],endDate:s.toISOString().split("T")[0],duration:r.duration||60,workingHours:{start:"09:00",end:"18:00"},workingDays:[1,2,3,4,5]};W.info("Fetching calendar availability",{traceId:e,leadId:t.id,calendarId:r.calendarId});let o=await og.getAvailability(i);if(o.availableSlots.length===0){W.warn("No available slots found",{traceId:e,leadId:t.id}),await qA(t,e);return}let a=o.availableSlots.slice(0,3);W.info("Proposing slots to lead",{traceId:e,leadId:t.id,slotCount:a.length}),await NA(t,a,r.tenantId,e),await MA(t.id,r.tenantId,a,r.calendarId,e),W.info("Schedule request handled successfully",{traceId:e,leadId:t.id,proposedSlots:a.length})}async function OA(r,e){W.info("Handling schedule confirmation",{traceId:e,leadId:r.leadId,selectedSlot:r.selectedSlot});let t=await ag(r.leadId,e);if(!t)throw new Error(`Lead not found: ${r.leadId}`);let n=await DA(r.leadId,e);if(!n)throw new Error(`No pending agendamento found for lead: ${r.leadId}`);let s=new Date(r.selectedSlot),i=n.duration||60,o={calendarId:n.calendar_id,summary:`Reuni\xE3o - ${t.empresa}`,description:await kA(t,e),start:s.toISOString(),duration:i,attendees:[{email:t.email,displayName:t.contato}],conferenceData:{createRequest:{requestId:je(),conferenceSolutionKey:{type:"hangoutsMeet"}}}};W.info("Creating calendar event",{traceId:e,leadId:t.id,start:s.toISOString()});let a=await og.createEvent(o);await $A(t.id,t.tenant_id,s,i,a.eventId,o.description,e),await FA(t,s,a.htmlLink,a.hangoutLink,e),await BA(t.id,"agendado",e),await UA(t,s,a.eventId,e),W.info("Schedule confirmation handled successfully",{traceId:e,leadId:t.id,eventId:a.eventId})}async function ag(r,e){let t=await dt("SELECT * FROM nigredo_leads.leads WHERE id = $1",[r]);return t.rows.length>0?t.rows[0]:null}async function NA(r,e,t,n){if(!r.telefone){W.warn("Lead has no phone number, cannot send WhatsApp",{traceId:n,leadId:r.id});return}let s=e.map((o,a)=>{let u=new Date(o.start),c=u.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),l=u.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});return`${a+1}. ${c} \xE0s ${l}`}).join(`
`),i=`Ol\xE1 ${r.contato}! \u{1F44B}

\xD3timo! Vamos agendar nossa reuni\xE3o. Tenho os seguintes hor\xE1rios dispon\xEDveis:

${s}

Por favor, responda com o n\xFAmero da op\xE7\xE3o que melhor se encaixa na sua agenda.`;await aa.sendMessage({to:r.telefone,message:i,idempotencyKey:`${r.id}-propose-slots-${n}`}),W.info("Proposed slots sent to lead",{traceId:n,leadId:r.id,slotCount:e.length})}async function qA(r,e){if(!r.telefone)return;let t=`Ol\xE1 ${r.contato}! \u{1F44B}

Infelizmente n\xE3o temos hor\xE1rios dispon\xEDveis nos pr\xF3ximos dias. Nossa equipe entrar\xE1 em contato em breve para encontrar um hor\xE1rio que funcione para ambos.

Obrigado pela compreens\xE3o!`;await aa.sendMessage({to:r.telefone,message:t,idempotencyKey:`${r.id}-no-slots-${e}`})}async function MA(r,e,t,n,s){await dt(`INSERT INTO nigredo_leads.agendamentos 
     (id, lead_id, tenant_id, status, calendar_event_id, briefing, created_at, metadata)
     VALUES ($1, $2, $3, $4, $5, $6, NOW(), $7)`,[je(),r,e,"proposto",null,null,JSON.stringify({proposed_slots:t,calendar_id:n,trace_id:s})]),W.info("Proposed slots saved to database",{traceId:s,leadId:r,slotCount:t.length})}async function DA(r,e){let t=await dt(`SELECT * FROM nigredo_leads.agendamentos 
     WHERE lead_id = $1 AND status = 'proposto' 
     ORDER BY created_at DESC LIMIT 1`,[r]);if(t.rows.length===0)return null;let n=t.rows[0];return{...n,proposed_slots:n.metadata?.proposed_slots||[],calendar_id:n.metadata?.calendar_id,duration:n.duracao||60}}async function kA(r,e){let t=await dt(`SELECT tipo, canal, mensagem, sentimento, intensidade, created_at
     FROM nigredo_leads.interacoes
     WHERE lead_id = $1
     ORDER BY created_at DESC
     LIMIT 10`,[r.id]),n=`# Briefing Comercial - ${r.empresa}

`;if(n+=`**Contato:** ${r.contato}
`,n+=`**Email:** ${r.email||"N/A"}
`,n+=`**Telefone:** ${r.telefone||"N/A"}
`,n+=`**Setor:** ${r.metadata?.setor||"N/A"}
`,n+=`**Porte:** ${r.metadata?.porte||"N/A"}

`,n+=`## Hist\xF3rico de Intera\xE7\xF5es

`,t.rows.length>0)for(let s of t.rows){let i=new Date(s.created_at).toLocaleDateString("pt-BR"),o=s.sentimento?` [${s.sentimento}${s.intensidade?` ${s.intensidade}%`:""}]`:"";n+=`- **${i}** (${s.canal})${o}: ${s.mensagem.substring(0,100)}...
`}else n+=`Nenhuma intera\xE7\xE3o registrada.
`;if(n+=`
## Classifica\xE7\xF5es e Insights

`,n+=`- **Status:** ${r.status}
`,n+=`- **Prioridade:** ${r.metadata?.priority||"N/A"}
`,n+=`- **Necessidade Aut\xEAntica:** ${r.metadata?.authentic_need?"Sim":"N\xE3o"}
`,r.metadata?.objections&&r.metadata.objections.length>0){n+=`
## Obje\xE7\xF5es Identificadas

`;for(let s of r.metadata.objections)n+=`- ${s}
`}return n+=`
---
`,n+=`*Briefing gerado automaticamente pelo Agente de Agendamento*
`,n+=`*Trace ID: ${e}*
`,n}async function $A(r,e,t,n,s,i,o){await dt(`UPDATE nigredo_leads.agendamentos
     SET status = 'confirmado',
         data_hora = $1,
         duracao = $2,
         calendar_event_id = $3,
         briefing = $4,
         metadata = jsonb_set(metadata, '{trace_id}', $5::jsonb)
     WHERE lead_id = $6 AND status = 'proposto'`,[t,n,s,i,JSON.stringify(o),r]),W.info("Confirmed agendamento saved to database",{traceId:o,leadId:r,calendarEventId:s})}async function FA(r,e,t,n,s){if(!r.telefone){W.warn("Lead has no phone number, cannot send confirmation",{traceId:s,leadId:r.id});return}let i=e.toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),o=e.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),a=`Ol\xE1 ${r.contato}! \u2705

Sua reuni\xE3o est\xE1 confirmada para:
\u{1F4C5} ${i}
\u{1F550} ${o}

`;n&&(a+=`\u{1F517} Link da reuni\xE3o: ${n}

`),a+=`Voc\xEA tamb\xE9m receber\xE1 um convite por email com todos os detalhes.

Estamos ansiosos para conversar com voc\xEA!`,await aa.sendMessage({to:r.telefone,message:a,idempotencyKey:`${r.id}-confirmation-${s}`}),W.info("Confirmation sent to lead",{traceId:s,leadId:r.id})}async function BA(r,e,t){await dt(`UPDATE nigredo_leads.leads
     SET status = $1, updated_at = NOW()
     WHERE id = $2`,[e,r]),W.info("Lead status updated",{traceId:t,leadId:r,status:e})}async function UA(r,e,t,n){let s={Source:"nigredo.agendamento",DetailType:"agendamento.confirmed",Detail:JSON.stringify({leadId:r.id,tenantId:r.tenant_id,empresa:r.empresa,contato:r.contato,dataHora:e.toISOString(),calendarEventId:t,traceId:n,timestamp:new Date().toISOString()}),EventBusName:IA};await RA.putEvents({Entries:[s]}).promise(),W.info("Published nigredo.agendamento.confirmed event",{traceId:n,leadId:r.id,eventId:t})}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
