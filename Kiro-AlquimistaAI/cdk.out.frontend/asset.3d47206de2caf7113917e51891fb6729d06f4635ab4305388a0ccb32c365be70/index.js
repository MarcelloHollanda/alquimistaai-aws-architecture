"use strict";var vp=Object.create;var Ut=Object.defineProperty;var Sp=Object.getOwnPropertyDescriptor;var Ep=Object.getOwnPropertyNames;var bp=Object.getPrototypeOf,wp=Object.prototype.hasOwnProperty;var Qo=r=>{throw TypeError(r)};var Tp=(r,e,t)=>e in r?Ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var f=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Ap=(r,e)=>{for(var t in e)Ut(r,t,{get:e[t],enumerable:!0})},Ho=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Ep(e))!wp.call(r,n)&&n!==t&&Ut(r,n,{get:()=>e[n],enumerable:!(s=Sp(e,n))||s.enumerable});return r};var Ce=(r,e,t)=>(t=r!=null?vp(bp(r)):{},Ho(e||!r||!r.__esModule?Ut(t,"default",{value:r,enumerable:!0}):t,r)),Cp=r=>Ho(Ut({},"__esModule",{value:!0}),r);var v=(r,e,t)=>Tp(r,typeof e!="symbol"?e+"":e,t),cn=(r,e,t)=>e.has(r)||Qo("Cannot "+t);var p=(r,e,t)=>(cn(r,e,"read from private field"),t?t.call(r):e.get(r)),b=(r,e,t)=>e.has(r)?Qo("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),j=(r,e,t,s)=>(cn(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),R=(r,e,t)=>(cn(r,e,"access private method"),t);var An=f((Qt,ht)=>{var Dp=200,Ra="__lodash_hash_undefined__",kp=800,$p=16,Ia=9007199254740991,La="[object Arguments]",Bp="[object Array]",Fp="[object AsyncFunction]",Up="[object Boolean]",jp="[object Date]",Gp="[object Error]",Oa="[object Function]",Wp="[object GeneratorFunction]",Vp="[object Map]",Qp="[object Number]",Hp="[object Null]",xa="[object Object]",Xp="[object Proxy]",Kp="[object RegExp]",zp="[object Set]",Yp="[object String]",Jp="[object Undefined]",Zp="[object WeakMap]",em="[object ArrayBuffer]",tm="[object DataView]",rm="[object Float32Array]",sm="[object Float64Array]",nm="[object Int8Array]",im="[object Int16Array]",om="[object Int32Array]",am="[object Uint8Array]",um="[object Uint8ClampedArray]",cm="[object Uint16Array]",lm="[object Uint32Array]",dm=/[\\^$.*+?()[\]{}|]/g,fm=/^\[object .+?Constructor\]$/,hm=/^(?:0|[1-9]\d*)$/,x={};x[rm]=x[sm]=x[nm]=x[im]=x[om]=x[am]=x[um]=x[cm]=x[lm]=!0;x[La]=x[Bp]=x[em]=x[Up]=x[tm]=x[jp]=x[Gp]=x[Oa]=x[Vp]=x[Qp]=x[xa]=x[Kp]=x[zp]=x[Yp]=x[Zp]=!1;var Na=typeof global=="object"&&global&&global.Object===Object&&global,pm=typeof self=="object"&&self&&self.Object===Object&&self,Kt=Na||pm||Function("return this")(),qa=typeof Qt=="object"&&Qt&&!Qt.nodeType&&Qt,Ht=qa&&typeof ht=="object"&&ht&&!ht.nodeType&&ht,Ma=Ht&&Ht.exports===qa,mn=Ma&&Na.process,_a=function(){try{var r=Ht&&Ht.require&&Ht.require("util").types;return r||mn&&mn.binding&&mn.binding("util")}catch{}}(),va=_a&&_a.isTypedArray;function mm(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function gm(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}function ym(r){return function(e){return r(e)}}function _m(r,e){return r?.[e]}function vm(r,e){return function(t){return r(e(t))}}var Sm=Array.prototype,Em=Function.prototype,Qr=Object.prototype,gn=Kt["__core-js_shared__"],Hr=Em.toString,Le=Qr.hasOwnProperty,Sa=function(){var r=/[^.]+$/.exec(gn&&gn.keys&&gn.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Pa=Qr.toString,bm=Hr.call(Object),wm=RegExp("^"+Hr.call(Le).replace(dm,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wr=Ma?Kt.Buffer:void 0,Ea=Kt.Symbol,ba=Kt.Uint8Array,wa=Wr?Wr.allocUnsafe:void 0,Da=vm(Object.getPrototypeOf,Object),Ta=Object.create,Tm=Qr.propertyIsEnumerable,Am=Sm.splice,Ke=Ea?Ea.toStringTag:void 0,Vr=function(){try{var r=bn(Object,"defineProperty");return r({},"",{}),r}catch{}}(),Cm=Wr?Wr.isBuffer:void 0,Aa=Math.max,Rm=Date.now,ka=bn(Kt,"Map"),Xt=bn(Object,"create"),Im=function(){function r(){}return function(e){if(!Ye(e))return{};if(Ta)return Ta(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function ze(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Lm(){this.__data__=Xt?Xt(null):{},this.size=0}function Om(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function xm(r){var e=this.__data__;if(Xt){var t=e[r];return t===Ra?void 0:t}return Le.call(e,r)?e[r]:void 0}function Nm(r){var e=this.__data__;return Xt?e[r]!==void 0:Le.call(e,r)}function qm(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Xt&&e===void 0?Ra:e,this}ze.prototype.clear=Lm;ze.prototype.delete=Om;ze.prototype.get=xm;ze.prototype.has=Nm;ze.prototype.set=qm;function Oe(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Mm(){this.__data__=[],this.size=0}function Pm(r){var e=this.__data__,t=Xr(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():Am.call(e,t,1),--this.size,!0}function Dm(r){var e=this.__data__,t=Xr(e,r);return t<0?void 0:e[t][1]}function km(r){return Xr(this.__data__,r)>-1}function $m(r,e){var t=this.__data__,s=Xr(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}Oe.prototype.clear=Mm;Oe.prototype.delete=Pm;Oe.prototype.get=Dm;Oe.prototype.has=km;Oe.prototype.set=$m;function pt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Bm(){this.size=0,this.__data__={hash:new ze,map:new(ka||Oe),string:new ze}}function Fm(r){var e=zr(this,r).delete(r);return this.size-=e?1:0,e}function Um(r){return zr(this,r).get(r)}function jm(r){return zr(this,r).has(r)}function Gm(r,e){var t=zr(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}pt.prototype.clear=Bm;pt.prototype.delete=Fm;pt.prototype.get=Um;pt.prototype.has=jm;pt.prototype.set=Gm;function mt(r){var e=this.__data__=new Oe(r);this.size=e.size}function Wm(){this.__data__=new Oe,this.size=0}function Vm(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function Qm(r){return this.__data__.get(r)}function Hm(r){return this.__data__.has(r)}function Xm(r,e){var t=this.__data__;if(t instanceof Oe){var s=t.__data__;if(!ka||s.length<Dp-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new pt(s)}return t.set(r,e),this.size=t.size,this}mt.prototype.clear=Wm;mt.prototype.delete=Vm;mt.prototype.get=Qm;mt.prototype.has=Hm;mt.prototype.set=Xm;function Km(r,e){var t=Sn(r),s=!t&&vn(r),n=!t&&!s&&Ua(r),i=!t&&!s&&!n&&Ga(r),o=t||s||n||i,a=o?gm(r.length,String):[],u=a.length;for(var c in r)(e||Le.call(r,c))&&!(o&&(c=="length"||n&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||Ba(c,u)))&&a.push(c);return a}function yn(r,e,t){(t!==void 0&&!Yr(r[e],t)||t===void 0&&!(e in r))&&En(r,e,t)}function zm(r,e,t){var s=r[e];(!(Le.call(r,e)&&Yr(s,t))||t===void 0&&!(e in r))&&En(r,e,t)}function Xr(r,e){for(var t=r.length;t--;)if(Yr(r[t][0],e))return t;return-1}function En(r,e,t){e=="__proto__"&&Vr?Vr(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Ym=lg();function Kr(r){return r==null?r===void 0?Jp:Hp:Ke&&Ke in Object(r)?dg(r):yg(r)}function Ca(r){return zt(r)&&Kr(r)==La}function Jm(r){if(!Ye(r)||mg(r))return!1;var e=Tn(r)?wm:fm;return e.test(Eg(r))}function Zm(r){return zt(r)&&ja(r.length)&&!!x[Kr(r)]}function eg(r){if(!Ye(r))return gg(r);var e=Fa(r),t=[];for(var s in r)s=="constructor"&&(e||!Le.call(r,s))||t.push(s);return t}function $a(r,e,t,s,n){r!==e&&Ym(e,function(i,o){if(n||(n=new mt),Ye(i))tg(r,e,o,t,$a,s,n);else{var a=s?s(_n(r,o),i,o+"",r,e,n):void 0;a===void 0&&(a=i),yn(r,o,a)}},Wa)}function tg(r,e,t,s,n,i,o){var a=_n(r,t),u=_n(e,t),c=o.get(u);if(c){yn(r,t,c);return}var l=i?i(a,u,t+"",r,e,o):void 0,d=l===void 0;if(d){var m=Sn(u),h=!m&&Ua(u),E=!m&&!h&&Ga(u);l=u,m||h||E?Sn(a)?l=a:bg(a)?l=ag(a):h?(d=!1,l=ng(u,!0)):E?(d=!1,l=og(u,!0)):l=[]:wg(u)||vn(u)?(l=a,vn(a)?l=Tg(a):(!Ye(a)||Tn(a))&&(l=fg(u))):d=!1}d&&(o.set(u,l),n(l,u,s,i,o),o.delete(u)),yn(r,t,l)}function rg(r,e){return vg(_g(r,e,Va),r+"")}var sg=Vr?function(r,e){return Vr(r,"toString",{configurable:!0,enumerable:!1,value:Cg(e),writable:!0})}:Va;function ng(r,e){if(e)return r.slice();var t=r.length,s=wa?wa(t):new r.constructor(t);return r.copy(s),s}function ig(r){var e=new r.constructor(r.byteLength);return new ba(e).set(new ba(r)),e}function og(r,e){var t=e?ig(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function ag(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}function ug(r,e,t,s){var n=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],u=s?s(t[a],r[a],a,t,r):void 0;u===void 0&&(u=r[a]),n?En(t,a,u):zm(t,a,u)}return t}function cg(r){return rg(function(e,t){var s=-1,n=t.length,i=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,o&&hg(t[0],t[1],o)&&(i=n<3?void 0:i,n=1),e=Object(e);++s<n;){var a=t[s];a&&r(e,a,s,i)}return e})}function lg(r){return function(e,t,s){for(var n=-1,i=Object(e),o=s(e),a=o.length;a--;){var u=o[r?a:++n];if(t(i[u],u,i)===!1)break}return e}}function zr(r,e){var t=r.__data__;return pg(e)?t[typeof e=="string"?"string":"hash"]:t.map}function bn(r,e){var t=_m(r,e);return Jm(t)?t:void 0}function dg(r){var e=Le.call(r,Ke),t=r[Ke];try{r[Ke]=void 0;var s=!0}catch{}var n=Pa.call(r);return s&&(e?r[Ke]=t:delete r[Ke]),n}function fg(r){return typeof r.constructor=="function"&&!Fa(r)?Im(Da(r)):{}}function Ba(r,e){var t=typeof r;return e=e??Ia,!!e&&(t=="number"||t!="symbol"&&hm.test(r))&&r>-1&&r%1==0&&r<e}function hg(r,e,t){if(!Ye(t))return!1;var s=typeof e;return(s=="number"?wn(t)&&Ba(e,t.length):s=="string"&&e in t)?Yr(t[e],r):!1}function pg(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function mg(r){return!!Sa&&Sa in r}function Fa(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||Qr;return r===t}function gg(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function yg(r){return Pa.call(r)}function _g(r,e,t){return e=Aa(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,i=Aa(s.length-e,0),o=Array(i);++n<i;)o[n]=s[e+n];n=-1;for(var a=Array(e+1);++n<e;)a[n]=s[n];return a[e]=t(o),mm(r,this,a)}}function _n(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var vg=Sg(sg);function Sg(r){var e=0,t=0;return function(){var s=Rm(),n=$p-(s-t);if(t=s,n>0){if(++e>=kp)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function Eg(r){if(r!=null){try{return Hr.call(r)}catch{}try{return r+""}catch{}}return""}function Yr(r,e){return r===e||r!==r&&e!==e}var vn=Ca(function(){return arguments}())?Ca:function(r){return zt(r)&&Le.call(r,"callee")&&!Tm.call(r,"callee")},Sn=Array.isArray;function wn(r){return r!=null&&ja(r.length)&&!Tn(r)}function bg(r){return zt(r)&&wn(r)}var Ua=Cm||Rg;function Tn(r){if(!Ye(r))return!1;var e=Kr(r);return e==Oa||e==Wp||e==Fp||e==Xp}function ja(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Ia}function Ye(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function zt(r){return r!=null&&typeof r=="object"}function wg(r){if(!zt(r)||Kr(r)!=xa)return!1;var e=Da(r);if(e===null)return!0;var t=Le.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Hr.call(t)==bm}var Ga=va?ym(va):Zm;function Tg(r){return ug(r,Wa(r))}function Wa(r){return wn(r)?Km(r,!0):eg(r)}var Ag=cg(function(r,e,t){$a(r,e,t)});function Cg(r){return function(){return r}}function Va(r){return r}function Rg(){return!1}ht.exports=Ag});var Pn=f(iu=>{"use strict";iu.parse=function(r,e){return new Mn(r,e).parse()};var Mn=class r{constructor(e,t){this.source=e,this.transform=t||Og,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var e=this.source[this.position++];return e==="\\"?{value:this.source[this.position++],escaped:!0}:{value:e,escaped:!1}}record(e){this.recorded.push(e)}newEntry(e){var t;(this.recorded.length>0||e)&&(t=this.recorded.join(""),t==="NULL"&&!e&&(t=null),t!==null&&(t=this.transform(t)),this.entries.push(t),this.recorded=[])}consumeDimensions(){if(this.source[0]==="[")for(;!this.isEof();){var e=this.nextCharacter();if(e.value==="=")break}}parse(e){var t,s,n;for(this.consumeDimensions();!this.isEof();)if(t=this.nextCharacter(),t.value==="{"&&!n)this.dimension++,this.dimension>1&&(s=new r(this.source.substr(this.position-1),this.transform),this.entries.push(s.parse(!0)),this.position+=s.position-2);else if(t.value==="}"&&!n){if(this.dimension--,!this.dimension&&(this.newEntry(),e))return this.entries}else t.value==='"'&&!t.escaped?(n&&this.newEntry(!0),n=!n):t.value===","&&!n?this.newEntry():this.record(t.value);if(this.dimension!==0)throw new Error("array dimension not balanced");return this.entries}};function Og(r){return r}});var Dn=f((ZA,ou)=>{var xg=Pn();ou.exports={create:function(r,e){return{parse:function(){return xg.parse(r,e)}}}}});var cu=f((eC,uu)=>{"use strict";var Ng=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,qg=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,Mg=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,Pg=/^-?infinity$/;uu.exports=function(e){if(Pg.test(e))return Number(e.replace("i","I"));var t=Ng.exec(e);if(!t)return Dg(e)||null;var s=!!t[8],n=parseInt(t[1],10);s&&(n=au(n));var i=parseInt(t[2],10)-1,o=t[3],a=parseInt(t[4],10),u=parseInt(t[5],10),c=parseInt(t[6],10),l=t[7];l=l?1e3*parseFloat(l):0;var d,m=kg(e);return m!=null?(d=new Date(Date.UTC(n,i,o,a,u,c,l)),kn(n)&&d.setUTCFullYear(n),m!==0&&d.setTime(d.getTime()-m)):(d=new Date(n,i,o,a,u,c,l),kn(n)&&d.setFullYear(n)),d};function Dg(r){var e=qg.exec(r);if(e){var t=parseInt(e[1],10),s=!!e[4];s&&(t=au(t));var n=parseInt(e[2],10)-1,i=e[3],o=new Date(t,n,i);return kn(t)&&o.setFullYear(t),o}}function kg(r){if(r.endsWith("+00"))return 0;var e=Mg.exec(r.split(" ")[1]);if(e){var t=e[1];if(t==="Z")return 0;var s=t==="-"?-1:1,n=parseInt(e[2],10)*3600+parseInt(e[3]||0,10)*60+parseInt(e[4]||0,10);return n*s*1e3}}function au(r){return-(r-1)}function kn(r){return r>=0&&r<100}});var du=f((tC,lu)=>{lu.exports=Bg;var $g=Object.prototype.hasOwnProperty;function Bg(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)$g.call(t,s)&&(r[s]=t[s])}return r}});var pu=f((rC,hu)=>{"use strict";var Fg=du();hu.exports=St;function St(r){if(!(this instanceof St))return new St(r);Fg(this,Jg(r))}var Ug=["seconds","minutes","hours","days","months","years"];St.prototype.toPostgres=function(){var r=Ug.filter(this.hasOwnProperty,this);return this.milliseconds&&r.indexOf("seconds")<0&&r.push("seconds"),r.length===0?"0":r.map(function(e){var t=this[e]||0;return e==="seconds"&&this.milliseconds&&(t=(t+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),t+" "+e},this).join(" ")};var jg={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},Gg=["years","months","days"],Wg=["hours","minutes","seconds"];St.prototype.toISOString=St.prototype.toISO=function(){var r=Gg.map(t,this).join(""),e=Wg.map(t,this).join("");return"P"+r+"T"+e;function t(s){var n=this[s]||0;return s==="seconds"&&this.milliseconds&&(n=(n+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),n+jg[s]}};var $n="([+-]?\\d+)",Vg=$n+"\\s+years?",Qg=$n+"\\s+mons?",Hg=$n+"\\s+days?",Xg="([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?",Kg=new RegExp([Vg,Qg,Hg,Xg].map(function(r){return"("+r+")?"}).join("\\s*")),fu={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},zg=["hours","minutes","seconds","milliseconds"];function Yg(r){var e=r+"000000".slice(r.length);return parseInt(e,10)/1e3}function Jg(r){if(!r)return{};var e=Kg.exec(r),t=e[8]==="-";return Object.keys(fu).reduce(function(s,n){var i=fu[n],o=e[i];return!o||(o=n==="milliseconds"?Yg(o):parseInt(o,10),!o)||(t&&~zg.indexOf(n)&&(o*=-1),s[n]=o),s},{})}});var gu=f((sC,mu)=>{"use strict";mu.exports=function(e){if(/^\\x/.test(e))return new Buffer(e.substr(2),"hex");for(var t="",s=0;s<e.length;)if(e[s]!=="\\")t+=e[s],++s;else if(/[0-7]{3}/.test(e.substr(s+1,3)))t+=String.fromCharCode(parseInt(e.substr(s+1,3),8)),s+=4;else{for(var n=1;s+n<e.length&&e[s+n]==="\\";)n++;for(var i=0;i<Math.floor(n/2);++i)t+="\\";s+=Math.floor(n/2)*2}return new Buffer(t,"binary")}});var wu=f((nC,bu)=>{var nr=Pn(),ir=Dn(),ss=cu(),_u=pu(),vu=gu();function ns(r){return function(t){return t===null?t:r(t)}}function Su(r){return r===null?r:r==="TRUE"||r==="t"||r==="true"||r==="y"||r==="yes"||r==="on"||r==="1"}function Zg(r){return r?nr.parse(r,Su):null}function ey(r){return parseInt(r,10)}function Bn(r){return r?nr.parse(r,ns(ey)):null}function ty(r){return r?nr.parse(r,ns(function(e){return Eu(e).trim()})):null}var ry=function(r){if(!r)return null;var e=ir.create(r,function(t){return t!==null&&(t=Gn(t)),t});return e.parse()},Fn=function(r){if(!r)return null;var e=ir.create(r,function(t){return t!==null&&(t=parseFloat(t)),t});return e.parse()},ce=function(r){if(!r)return null;var e=ir.create(r);return e.parse()},Un=function(r){if(!r)return null;var e=ir.create(r,function(t){return t!==null&&(t=ss(t)),t});return e.parse()},sy=function(r){if(!r)return null;var e=ir.create(r,function(t){return t!==null&&(t=_u(t)),t});return e.parse()},ny=function(r){return r?nr.parse(r,ns(vu)):null},jn=function(r){return parseInt(r,10)},Eu=function(r){var e=String(r);return/^\d+$/.test(e)?e:r},yu=function(r){return r?nr.parse(r,ns(JSON.parse)):null},Gn=function(r){return r[0]!=="("?null:(r=r.substring(1,r.length-1).split(","),{x:parseFloat(r[0]),y:parseFloat(r[1])})},iy=function(r){if(r[0]!=="<"&&r[1]!=="(")return null;for(var e="(",t="",s=!1,n=2;n<r.length-1;n++){if(s||(e+=r[n]),r[n]===")"){s=!0;continue}else if(!s)continue;r[n]!==","&&(t+=r[n])}var i=Gn(e);return i.radius=parseFloat(t),i},oy=function(r){r(20,Eu),r(21,jn),r(23,jn),r(26,jn),r(700,parseFloat),r(701,parseFloat),r(16,Su),r(1082,ss),r(1114,ss),r(1184,ss),r(600,Gn),r(651,ce),r(718,iy),r(1e3,Zg),r(1001,ny),r(1005,Bn),r(1007,Bn),r(1028,Bn),r(1016,ty),r(1017,ry),r(1021,Fn),r(1022,Fn),r(1231,Fn),r(1014,ce),r(1015,ce),r(1008,ce),r(1009,ce),r(1040,ce),r(1041,ce),r(1115,Un),r(1182,Un),r(1185,Un),r(1186,_u),r(1187,sy),r(17,vu),r(114,JSON.parse.bind(JSON)),r(3802,JSON.parse.bind(JSON)),r(199,yu),r(3807,yu),r(3907,ce),r(2951,ce),r(791,ce),r(1183,ce),r(1270,ce)};bu.exports={init:oy}});var Au=f((iC,Tu)=>{"use strict";var ie=1e6;function ay(r){var e=r.readInt32BE(0),t=r.readUInt32BE(4),s="";e<0&&(e=~e+(t===0),t=~t+1>>>0,s="-");var n="",i,o,a,u,c,l;{if(i=e%ie,e=e/ie>>>0,o=4294967296*i+t,t=o/ie>>>0,a=""+(o-ie*t),t===0&&e===0)return s+a+n;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";n=u+a+n}{if(i=e%ie,e=e/ie>>>0,o=4294967296*i+t,t=o/ie>>>0,a=""+(o-ie*t),t===0&&e===0)return s+a+n;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";n=u+a+n}{if(i=e%ie,e=e/ie>>>0,o=4294967296*i+t,t=o/ie>>>0,a=""+(o-ie*t),t===0&&e===0)return s+a+n;for(u="",c=6-a.length,l=0;l<c;l++)u+="0";n=u+a+n}return i=e%ie,o=4294967296*i+t,a=""+o%ie,s+a+n}Tu.exports=ay});var Ou=f((oC,Lu)=>{var uy=Au(),B=function(r,e,t,s,n){t=t||0,s=s||!1,n=n||function(h,E,w){return h*Math.pow(2,w)+E};var i=t>>3,o=function(h){return s?~h&255:h},a=255,u=8-t%8;e<u&&(a=255<<8-e&255,u=e),t&&(a=a>>t%8);var c=0;t%8+e>=8&&(c=n(0,o(r[i])&a,u));for(var l=e+t>>3,d=i+1;d<l;d++)c=n(c,o(r[d]),8);var m=(e+t)%8;return m>0&&(c=n(c,o(r[l])>>8-m,m)),c},Iu=function(r,e,t){var s=Math.pow(2,t-1)-1,n=B(r,1),i=B(r,t,1);if(i===0)return 0;var o=1,a=function(c,l,d){c===0&&(c=1);for(var m=1;m<=d;m++)o/=2,(l&1<<d-m)>0&&(c+=o);return c},u=B(r,e,t+1,!1,a);return i==Math.pow(2,t+1)-1?u===0?n===0?1/0:-1/0:NaN:(n===0?1:-1)*Math.pow(2,i-s)*u},cy=function(r){return B(r,1)==1?-1*(B(r,15,1,!0)+1):B(r,15,1)},Cu=function(r){return B(r,1)==1?-1*(B(r,31,1,!0)+1):B(r,31,1)},ly=function(r){return Iu(r,23,8)},dy=function(r){return Iu(r,52,11)},fy=function(r){var e=B(r,16,32);if(e==49152)return NaN;for(var t=Math.pow(1e4,B(r,16,16)),s=0,n=[],i=B(r,16),o=0;o<i;o++)s+=B(r,16,64+16*o)*t,t/=1e4;var a=Math.pow(10,B(r,16,48));return(e===0?1:-1)*Math.round(s*a)/a},Ru=function(r,e){var t=B(e,1),s=B(e,63,1),n=new Date((t===0?1:-1)*s/1e3+9466848e5);return r||n.setTime(n.getTime()+n.getTimezoneOffset()*6e4),n.usec=s%1e3,n.getMicroSeconds=function(){return this.usec},n.setMicroSeconds=function(i){this.usec=i},n.getUTCMicroSeconds=function(){return this.usec},n},or=function(r){for(var e=B(r,32),t=B(r,32,32),s=B(r,32,64),n=96,i=[],o=0;o<e;o++)i[o]=B(r,32,n),n+=32,n+=32;var a=function(c){var l=B(r,32,n);if(n+=32,l==4294967295)return null;var d;if(c==23||c==20)return d=B(r,l*8,n),n+=l*8,d;if(c==25)return d=r.toString(this.encoding,n>>3,(n+=l<<3)>>3),d;console.log("ERROR: ElementType not implemented: "+c)},u=function(c,l){var d=[],m;if(c.length>1){var h=c.shift();for(m=0;m<h;m++)d[m]=u(c,l);c.unshift(h)}else for(m=0;m<c[0];m++)d[m]=a(l);return d};return u(i,s)},hy=function(r){return r.toString("utf8")},py=function(r){return r===null?null:B(r,8)>0},my=function(r){r(20,uy),r(21,cy),r(23,Cu),r(26,Cu),r(1700,fy),r(700,ly),r(701,dy),r(16,py),r(1114,Ru.bind(null,!1)),r(1184,Ru.bind(null,!0)),r(1e3,or),r(1007,or),r(1016,or),r(1008,or),r(1009,or),r(25,hy)};Lu.exports={init:my}});var Nu=f((aC,xu)=>{xu.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}});var cr=f(ur=>{var gy=wu(),yy=Ou(),_y=Dn(),vy=Nu();ur.getTypeParser=Sy;ur.setTypeParser=Ey;ur.arrayParser=_y;ur.builtins=vy;var ar={text:{},binary:{}};function qu(r){return String(r)}function Sy(r,e){return e=e||"text",ar[e]&&ar[e][r]||qu}function Ey(r,e,t){typeof e=="function"&&(t=e,e="text"),ar[e][r]=t}gy.init(function(r,e){ar.text[r]=e});yy.init(function(r,e){ar.binary[r]=e})});var lr=f((cC,Wn)=>{"use strict";Wn.exports={host:"localhost",user:process.platform==="win32"?process.env.USERNAME:process.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var Et=cr(),by=Et.getTypeParser(20,"text"),wy=Et.getTypeParser(1016,"text");Wn.exports.__defineSetter__("parseInt8",function(r){Et.setTypeParser(20,"text",r?Et.getTypeParser(23,"text"):by),Et.setTypeParser(1016,"text",r?Et.getTypeParser(1007,"text"):wy)})});var bt=f((lC,Du)=>{"use strict";var Ty=lr(),Mu=require("util"),{isDate:Ay}=Mu.types||Mu;function Cy(r){return'"'+r.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function Pu(r){let e="{";for(let t=0;t<r.length;t++)if(t>0&&(e=e+","),r[t]===null||typeof r[t]>"u")e=e+"NULL";else if(Array.isArray(r[t]))e=e+Pu(r[t]);else if(ArrayBuffer.isView(r[t])){let s=r[t];if(!(s instanceof Buffer)){let n=Buffer.from(s.buffer,s.byteOffset,s.byteLength);n.length===s.byteLength?s=n:s=n.slice(s.byteOffset,s.byteOffset+s.byteLength)}e+="\\\\x"+s.toString("hex")}else e+=Cy(is(r[t]));return e=e+"}",e}var is=function(r,e){if(r==null)return null;if(typeof r=="object"){if(r instanceof Buffer)return r;if(ArrayBuffer.isView(r)){let t=Buffer.from(r.buffer,r.byteOffset,r.byteLength);return t.length===r.byteLength?t:t.slice(r.byteOffset,r.byteOffset+r.byteLength)}return Ay(r)?Ty.parseInputDatesAsUTC?Ly(r):Iy(r):Array.isArray(r)?Pu(r):Ry(r,e)}return r.toString()};function Ry(r,e){if(r&&typeof r.toPostgres=="function"){if(e=e||[],e.indexOf(r)!==-1)throw new Error('circular reference detected while preparing "'+r+'" for query');return e.push(r),is(r.toPostgres(is),e)}return JSON.stringify(r)}function Iy(r){let e=-r.getTimezoneOffset(),t=r.getFullYear(),s=t<1;s&&(t=Math.abs(t)+1);let n=String(t).padStart(4,"0")+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+String(r.getMilliseconds()).padStart(3,"0");return e<0?(n+="-",e*=-1):n+="+",n+=String(Math.floor(e/60)).padStart(2,"0")+":"+String(e%60).padStart(2,"0"),s&&(n+=" BC"),n}function Ly(r){let e=r.getUTCFullYear(),t=e<1;t&&(e=Math.abs(e)+1);let s=String(e).padStart(4,"0")+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")+"T"+String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")+":"+String(r.getUTCSeconds()).padStart(2,"0")+"."+String(r.getUTCMilliseconds()).padStart(3,"0");return s+="+00:00",t&&(s+=" BC"),s}function Oy(r,e,t){return r=typeof r=="string"?{text:r}:r,e&&(typeof e=="function"?r.callback=e:r.values=e),t&&(r.callback=t),r}var xy=function(r){return'"'+r.replace(/"/g,'""')+'"'},Ny=function(r){let e=!1,t="'";if(r==null||typeof r!="string")return"''";for(let s=0;s<r.length;s++){let n=r[s];n==="'"?t+=n+n:n==="\\"?(t+=n+n,e=!0):t+=n}return t+="'",e===!0&&(t=" E"+t),t};Du.exports={prepareValue:function(e){return is(e)},normalizeQueryConfig:Oy,escapeIdentifier:xy,escapeLiteral:Ny}});var $u=f((dC,ku)=>{"use strict";var wt=require("crypto");function Vn(r){return wt.createHash("md5").update(r,"utf-8").digest("hex")}function qy(r,e,t){let s=Vn(e+r);return"md5"+Vn(Buffer.concat([Buffer.from(s),t]))}function My(r){return wt.createHash("sha256").update(r).digest()}function Py(r,e){return r=r.replace(/(\D)-/,"$1"),wt.createHash(r).update(e).digest()}function Dy(r,e){return wt.createHmac("sha256",r).update(e).digest()}async function ky(r,e,t){return wt.pbkdf2Sync(r,e,t,32,"sha256")}ku.exports={postgresMd5PasswordHash:qy,randomBytes:wt.randomBytes,deriveKey:ky,sha256:My,hashByName:Py,hmacSha256:Dy,md5:Vn}});var ju=f((fC,Uu)=>{var Bu=require("crypto");Uu.exports={postgresMd5PasswordHash:By,randomBytes:$y,deriveKey:Gy,sha256:Fy,hashByName:Uy,hmacSha256:jy,md5:Qn};var Fu=Bu.webcrypto||globalThis.crypto,rt=Fu.subtle,Hn=new TextEncoder;function $y(r){return Fu.getRandomValues(Buffer.alloc(r))}async function Qn(r){try{return Bu.createHash("md5").update(r,"utf-8").digest("hex")}catch{let t=typeof r=="string"?Hn.encode(r):r,s=await rt.digest("MD5",t);return Array.from(new Uint8Array(s)).map(n=>n.toString(16).padStart(2,"0")).join("")}}async function By(r,e,t){let s=await Qn(e+r);return"md5"+await Qn(Buffer.concat([Buffer.from(s),t]))}async function Fy(r){return await rt.digest("SHA-256",r)}async function Uy(r,e){return await rt.digest(r,e)}async function jy(r,e){let t=await rt.importKey("raw",r,{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return await rt.sign("HMAC",t,Hn.encode(e))}async function Gy(r,e,t){let s=await rt.importKey("raw",Hn.encode(r),"PBKDF2",!1,["deriveBits"]),n={name:"PBKDF2",hash:"SHA-256",salt:e,iterations:t};return await rt.deriveBits(n,s,32*8,["deriveBits"])}});var Kn=f((hC,Xn)=>{"use strict";var Wy=parseInt(process.versions&&process.versions.node&&process.versions.node.split(".")[0])<15;Wy?Xn.exports=$u():Xn.exports=ju()});var Vu=f((pC,Wu)=>{function st(r,e){return new Error("SASL channel binding: "+r+" when parsing public certificate "+e.toString("base64"))}function zn(r,e){let t=r[e++];if(t<128)return{length:t,index:e};let s=t&127;if(s>4)throw st("bad length",r);t=0;for(let n=0;n<s;n++)t=t<<8|r[e++];return{length:t,index:e}}function Gu(r,e){if(r[e++]!==6)throw st("non-OID data",r);let{length:t,index:s}=zn(r,e);e=s;let n=e+t,i=r[e++],o=(i/40>>0)+"."+i%40;for(;e<n;){let a=0;for(;e<n;){let u=r[e++];if(a=a<<7|u&127,u<128)break}o+="."+a}return{oid:o,index:e}}function dr(r,e){if(r[e++]!==48)throw st("non-sequence data",r);return zn(r,e)}function Vy(r,e){e===void 0&&(e=0),e=dr(r,e).index;let{length:t,index:s}=dr(r,e);e=s+t,e=dr(r,e).index;let{oid:n,index:i}=Gu(r,e);switch(n){case"1.2.840.113549.1.1.4":return"MD5";case"1.2.840.113549.1.1.5":return"SHA-1";case"1.2.840.113549.1.1.11":return"SHA-256";case"1.2.840.113549.1.1.12":return"SHA-384";case"1.2.840.113549.1.1.13":return"SHA-512";case"1.2.840.113549.1.1.14":return"SHA-224";case"1.2.840.113549.1.1.15":return"SHA512-224";case"1.2.840.113549.1.1.16":return"SHA512-256";case"1.2.840.10045.4.1":return"SHA-1";case"1.2.840.10045.4.3.1":return"SHA-224";case"1.2.840.10045.4.3.2":return"SHA-256";case"1.2.840.10045.4.3.3":return"SHA-384";case"1.2.840.10045.4.3.4":return"SHA-512";case"1.2.840.113549.1.1.10":{if(e=i,e=dr(r,e).index,r[e++]!==160)throw st("non-tag data",r);e=zn(r,e).index,e=dr(r,e).index;let{oid:o}=Gu(r,e);switch(o){case"1.2.840.113549.2.5":return"MD5";case"1.3.14.3.2.26":return"SHA-1";case"2.16.840.1.101.3.4.2.1":return"SHA-256";case"2.16.840.1.101.3.4.2.2":return"SHA-384";case"2.16.840.1.101.3.4.2.3":return"SHA-512"}throw st("unknown hash OID "+o,r)}case"1.3.101.110":case"1.3.101.112":return"SHA-512";case"1.3.101.111":case"1.3.101.113":throw st("Ed448 certificate channel binding is not currently supported by Postgres")}throw st("unknown OID "+n,r)}Wu.exports={signatureAlgorithmHashFromCertificate:Vy}});var Ku=f((mC,Xu)=>{"use strict";var Ue=Kn(),{signatureAlgorithmHashFromCertificate:Qy}=Vu();function Hy(r,e){let t=["SCRAM-SHA-256"];e&&t.unshift("SCRAM-SHA-256-PLUS");let s=t.find(o=>r.includes(o));if(!s)throw new Error("SASL: Only mechanism(s) "+t.join(" and ")+" are supported");if(s==="SCRAM-SHA-256-PLUS"&&typeof e.getPeerCertificate!="function")throw new Error("SASL: Mechanism SCRAM-SHA-256-PLUS requires a certificate");let n=Ue.randomBytes(18).toString("base64");return{mechanism:s,clientNonce:n,response:(s==="SCRAM-SHA-256-PLUS"?"p=tls-server-end-point":e?"y":"n")+",,n=*,r="+n,message:"SASLInitialResponse"}}async function Xy(r,e,t,s){if(r.message!=="SASLInitialResponse")throw new Error("SASL: Last message was not SASLInitialResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if(e==="")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a non-empty string");if(typeof t!="string")throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let n=Yy(t);if(n.nonce.startsWith(r.clientNonce)){if(n.nonce.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");let i="n=*,r="+r.clientNonce,o="r="+n.nonce+",s="+n.salt+",i="+n.iteration,a=s?"eSws":"biws";if(r.mechanism==="SCRAM-SHA-256-PLUS"){let W=s.getPeerCertificate().raw,se=Qy(W);(se==="MD5"||se==="SHA-1")&&(se="SHA-256");let k=await Ue.hashByName(se,W);a=Buffer.concat([Buffer.from("p=tls-server-end-point,,"),Buffer.from(k)]).toString("base64")}let u="c="+a+",r="+n.nonce,c=i+","+o+","+u,l=Buffer.from(n.salt,"base64"),d=await Ue.deriveKey(e,l,n.iteration),m=await Ue.hmacSha256(d,"Client Key"),h=await Ue.sha256(m),E=await Ue.hmacSha256(h,c),w=Zy(Buffer.from(m),Buffer.from(E)).toString("base64"),Ae=await Ue.hmacSha256(d,"Server Key"),ge=await Ue.hmacSha256(Ae,c);r.message="SASLResponse",r.serverSignature=Buffer.from(ge).toString("base64"),r.response=u+",p="+w}function Ky(r,e){if(r.message!=="SASLResponse")throw new Error("SASL: Last message was not SASLResponse");if(typeof e!="string")throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:t}=Jy(e);if(t!==r.serverSignature)throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function zy(r){if(typeof r!="string")throw new TypeError("SASL: text must be a string");return r.split("").map((e,t)=>r.charCodeAt(t)).every(e=>e>=33&&e<=43||e>=45&&e<=126)}function Qu(r){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(r)}function Hu(r){if(typeof r!="string")throw new TypeError("SASL: attribute pairs text must be a string");return new Map(r.split(",").map(e=>{if(!/^.=/.test(e))throw new Error("SASL: Invalid attribute pair entry");let t=e[0],s=e.substring(2);return[t,s]}))}function Yy(r){let e=Hu(r),t=e.get("r");if(t){if(!zy(t))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let s=e.get("s");if(s){if(!Qu(s))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let n=e.get("i");if(n){if(!/^[1-9][0-9]*$/.test(n))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");let i=parseInt(n,10);return{nonce:t,salt:s,iteration:i}}function Jy(r){let t=Hu(r).get("v");if(t){if(!Qu(t))throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw new Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:t}}function Zy(r,e){if(!Buffer.isBuffer(r))throw new TypeError("first argument must be a Buffer");if(!Buffer.isBuffer(e))throw new TypeError("second argument must be a Buffer");if(r.length!==e.length)throw new Error("Buffer lengths must match");if(r.length===0)throw new Error("Buffers cannot be empty");return Buffer.from(r.map((t,s)=>r[s]^e[s]))}Xu.exports={startSession:Hy,continueSession:Xy,finalizeSession:Ky}});var as=f((gC,zu)=>{"use strict";var e_=cr();function os(r){this._types=r||e_,this.text={},this.binary={}}os.prototype.getOverrides=function(r){switch(r){case"text":return this.text;case"binary":return this.binary;default:return{}}};os.prototype.setTypeParser=function(r,e,t){typeof e=="function"&&(t=e,e="text"),this.getOverrides(e)[r]=t};os.prototype.getTypeParser=function(r,e){return e=e||"text",this.getOverrides(e)[r]||this._types.getTypeParser(r,e)};zu.exports=os});var Zu=f((yC,Ju)=>{"use strict";function Tt(r,e={}){if(r.charAt(0)==="/"){let u=r.split(" ");return{host:u[0],database:u[1]}}let t={},s,n=!1;/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(r)&&(r=encodeURI(r).replace(/%25(\d\d)/g,"%$1"));try{try{s=new URL(r,"postgres://base")}catch{s=new URL(r.replace("@/","@___DUMMY___/"),"postgres://base"),n=!0}}catch(u){u.input&&(u.input="*****REDACTED*****")}for(let u of s.searchParams.entries())t[u[0]]=u[1];if(t.user=t.user||decodeURIComponent(s.username),t.password=t.password||decodeURIComponent(s.password),s.protocol=="socket:")return t.host=decodeURI(s.pathname),t.database=s.searchParams.get("db"),t.client_encoding=s.searchParams.get("encoding"),t;let i=n?"":s.hostname;t.host?i&&/^%2f/i.test(i)&&(s.pathname=i+s.pathname):t.host=decodeURIComponent(i),t.port||(t.port=s.port);let o=s.pathname.slice(1)||null;t.database=o?decodeURI(o):null,(t.ssl==="true"||t.ssl==="1")&&(t.ssl=!0),t.ssl==="0"&&(t.ssl=!1),(t.sslcert||t.sslkey||t.sslrootcert||t.sslmode)&&(t.ssl={});let a=t.sslcert||t.sslkey||t.sslrootcert?require("fs"):null;if(t.sslcert&&(t.ssl.cert=a.readFileSync(t.sslcert).toString()),t.sslkey&&(t.ssl.key=a.readFileSync(t.sslkey).toString()),t.sslrootcert&&(t.ssl.ca=a.readFileSync(t.sslrootcert).toString()),e.useLibpqCompat&&t.uselibpqcompat)throw new Error("Both useLibpqCompat and uselibpqcompat are set. Please use only one of them.");if(t.uselibpqcompat==="true"||e.useLibpqCompat)switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":{t.ssl.rejectUnauthorized=!1;break}case"require":{t.sslrootcert?t.ssl.checkServerIdentity=function(){}:t.ssl.rejectUnauthorized=!1;break}case"verify-ca":{if(!t.ssl.ca)throw new Error("SECURITY WARNING: Using sslmode=verify-ca requires specifying a CA with sslrootcert. If a public CA is used, verify-ca allows connections to a server that somebody else may have registered with the CA, making you vulnerable to Man-in-the-Middle attacks. Either specify a custom CA certificate with sslrootcert parameter or use sslmode=verify-full for proper security.");t.ssl.checkServerIdentity=function(){};break}case"verify-full":break}else switch(t.sslmode){case"disable":{t.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{t.ssl.rejectUnauthorized=!1;break}}return t}function t_(r){return Object.entries(r).reduce((t,[s,n])=>(n!=null&&(t[s]=n),t),{})}function Yu(r){return Object.entries(r).reduce((t,[s,n])=>{if(s==="ssl"){let i=n;typeof i=="boolean"&&(t[s]=i),typeof i=="object"&&(t[s]=t_(i))}else if(n!=null)if(s==="port"){if(n!==""){let i=parseInt(n,10);if(isNaN(i))throw new Error(`Invalid ${s}: ${n}`);t[s]=i}}else t[s]=n;return t},{})}function r_(r){return Yu(Tt(r))}Ju.exports=Tt;Tt.parse=Tt;Tt.toClientConfig=Yu;Tt.parseIntoClientConfig=r_});var Jn=f((_C,rc)=>{"use strict";var s_=require("dns"),tc=lr(),ec=Zu().parse,Z=function(r,e,t){return t===void 0?t=process.env["PG"+r.toUpperCase()]:t===!1||(t=process.env[t]),e[r]||t||tc[r]},n_=function(){switch(process.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return tc.ssl},At=function(r){return"'"+(""+r).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},le=function(r,e,t){let s=e[t];s!=null&&r.push(t+"="+At(s))},Yn=class{constructor(e){e=typeof e=="string"?ec(e):e||{},e.connectionString&&(e=Object.assign({},e,ec(e.connectionString))),this.user=Z("user",e),this.database=Z("database",e),this.database===void 0&&(this.database=this.user),this.port=parseInt(Z("port",e),10),this.host=Z("host",e),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:Z("password",e)}),this.binary=Z("binary",e),this.options=Z("options",e),this.ssl=typeof e.ssl>"u"?n_():e.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=Z("client_encoding",e),this.replication=Z("replication",e),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=Z("application_name",e,"PGAPPNAME"),this.fallback_application_name=Z("fallback_application_name",e,!1),this.statement_timeout=Z("statement_timeout",e,!1),this.lock_timeout=Z("lock_timeout",e,!1),this.idle_in_transaction_session_timeout=Z("idle_in_transaction_session_timeout",e,!1),this.query_timeout=Z("query_timeout",e,!1),e.connectionTimeoutMillis===void 0?this.connect_timeout=process.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(e.connectionTimeoutMillis/1e3),e.keepAlive===!1?this.keepalives=0:e.keepAlive===!0&&(this.keepalives=1),typeof e.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(e.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(e){let t=[];le(t,this,"user"),le(t,this,"password"),le(t,this,"port"),le(t,this,"application_name"),le(t,this,"fallback_application_name"),le(t,this,"connect_timeout"),le(t,this,"options");let s=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(le(t,s,"sslmode"),le(t,s,"sslca"),le(t,s,"sslkey"),le(t,s,"sslcert"),le(t,s,"sslrootcert"),this.database&&t.push("dbname="+At(this.database)),this.replication&&t.push("replication="+At(this.replication)),this.host&&t.push("host="+At(this.host)),this.isDomainSocket)return e(null,t.join(" "));this.client_encoding&&t.push("client_encoding="+At(this.client_encoding)),s_.lookup(this.host,function(n,i){return n?e(n,null):(t.push("hostaddr="+At(i)),e(null,t.join(" ")))})}};rc.exports=Yn});var ei=f((vC,nc)=>{"use strict";var i_=cr(),sc=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,Zn=class{constructor(e,t){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=t,this.RowCtor=null,this.rowAsArray=e==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray),this._prebuiltEmptyResultObject=null}addCommandComplete(e){let t;e.text?t=sc.exec(e.text):t=sc.exec(e.command),t&&(this.command=t[1],t[3]?(this.oid=parseInt(t[2],10),this.rowCount=parseInt(t[3],10)):t[2]&&(this.rowCount=parseInt(t[2],10)))}_parseRowAsArray(e){let t=new Array(e.length);for(let s=0,n=e.length;s<n;s++){let i=e[s];i!==null?t[s]=this._parsers[s](i):t[s]=null}return t}parseRow(e){let t={...this._prebuiltEmptyResultObject};for(let s=0,n=e.length;s<n;s++){let i=e[s],o=this.fields[s].name;if(i!==null){let a=this.fields[s].format==="binary"?Buffer.from(i):i;t[o]=this._parsers[s](a)}else t[o]=null}return t}addRow(e){this.rows.push(e)}addFields(e){this.fields=e,this.fields.length&&(this._parsers=new Array(e.length));let t={};for(let s=0;s<e.length;s++){let n=e[s];t[n.name]=null,this._types?this._parsers[s]=this._types.getTypeParser(n.dataTypeID,n.format||"text"):this._parsers[s]=i_.getTypeParser(n.dataTypeID,n.format||"text")}this._prebuiltEmptyResultObject={...t}}};nc.exports=Zn});var uc=f((SC,ac)=>{"use strict";var{EventEmitter:o_}=require("events"),ic=ei(),oc=bt(),ti=class extends o_{constructor(e,t,s){super(),e=oc.normalizeQueryConfig(e,t,s),this.text=e.text,this.values=e.values,this.rows=e.rows,this.types=e.types,this.name=e.name,this.queryMode=e.queryMode,this.binary=e.binary,this.portal=e.portal||"",this.callback=e.callback,this._rowMode=e.rowMode,process.domain&&e.callback&&(this.callback=process.domain.bind(e.callback)),this._result=new ic(this._rowMode,this.types),this._results=this._result,this._canceledDueToError=!1}requiresPreparation(){return this.queryMode==="extended"||this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new ic(this._rowMode,this._result._types),this._results.push(this._result))}handleRowDescription(e){this._checkForMultirow(),this._result.addFields(e.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(e){let t;if(!this._canceledDueToError){try{t=this._result.parseRow(e.fields)}catch(s){this._canceledDueToError=s;return}this.emit("row",t,this._result),this._accumulateRows&&this._result.addRow(t)}}handleCommandComplete(e,t){this._checkForMultirow(),this._result.addCommandComplete(e),this.rows&&t.sync()}handleEmptyQuery(e){this.rows&&e.sync()}handleError(e,t){if(this._canceledDueToError&&(e=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(e);this.emit("error",e)}handleReadyForQuery(e){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,e);if(this.callback)try{this.callback(null,this._results)}catch(t){process.nextTick(()=>{throw t})}this.emit("end",this._results)}submit(e){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let t=e.parsedStatements[this.name];if(this.text&&t&&this.text!==t)return new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);if(this.values&&!Array.isArray(this.values))return new Error("Query values must be an array");if(this.requiresPreparation()){e.stream.cork&&e.stream.cork();try{this.prepare(e)}finally{e.stream.uncork&&e.stream.uncork()}}else e.query(this.text);return null}hasBeenParsed(e){return this.name&&e.parsedStatements[this.name]}handlePortalSuspended(e){this._getRows(e,this.rows)}_getRows(e,t){e.execute({portal:this.portal,rows:t}),t?e.flush():e.sync()}prepare(e){this.hasBeenParsed(e)||e.parse({text:this.text,name:this.name,types:this.types});try{e.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:oc.prepareValue})}catch(t){this.handleError(t,e);return}e.describe({type:"P",name:this.portal||""}),this._getRows(e,this.rows)}handleCopyInResponse(e){e.sendCopyFail("No source stream defined")}handleCopyData(e,t){}};ac.exports=ti});var gi=f(_=>{"use strict";Object.defineProperty(_,"__esModule",{value:!0});_.NoticeMessage=_.DataRowMessage=_.CommandCompleteMessage=_.ReadyForQueryMessage=_.NotificationResponseMessage=_.BackendKeyDataMessage=_.AuthenticationMD5Password=_.ParameterStatusMessage=_.ParameterDescriptionMessage=_.RowDescriptionMessage=_.Field=_.CopyResponse=_.CopyDataMessage=_.DatabaseError=_.copyDone=_.emptyQuery=_.replicationStart=_.portalSuspended=_.noData=_.closeComplete=_.bindComplete=_.parseComplete=void 0;_.parseComplete={name:"parseComplete",length:5};_.bindComplete={name:"bindComplete",length:5};_.closeComplete={name:"closeComplete",length:5};_.noData={name:"noData",length:5};_.portalSuspended={name:"portalSuspended",length:5};_.replicationStart={name:"replicationStart",length:4};_.emptyQuery={name:"emptyQuery",length:4};_.copyDone={name:"copyDone",length:4};var ri=class extends Error{constructor(e,t,s){super(e),this.length=t,this.name=s}};_.DatabaseError=ri;var si=class{constructor(e,t){this.length=e,this.chunk=t,this.name="copyData"}};_.CopyDataMessage=si;var ni=class{constructor(e,t,s,n){this.length=e,this.name=t,this.binary=s,this.columnTypes=new Array(n)}};_.CopyResponse=ni;var ii=class{constructor(e,t,s,n,i,o,a){this.name=e,this.tableID=t,this.columnID=s,this.dataTypeID=n,this.dataTypeSize=i,this.dataTypeModifier=o,this.format=a}};_.Field=ii;var oi=class{constructor(e,t){this.length=e,this.fieldCount=t,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};_.RowDescriptionMessage=oi;var ai=class{constructor(e,t){this.length=e,this.parameterCount=t,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};_.ParameterDescriptionMessage=ai;var ui=class{constructor(e,t,s){this.length=e,this.parameterName=t,this.parameterValue=s,this.name="parameterStatus"}};_.ParameterStatusMessage=ui;var ci=class{constructor(e,t){this.length=e,this.salt=t,this.name="authenticationMD5Password"}};_.AuthenticationMD5Password=ci;var li=class{constructor(e,t,s){this.length=e,this.processID=t,this.secretKey=s,this.name="backendKeyData"}};_.BackendKeyDataMessage=li;var di=class{constructor(e,t,s,n){this.length=e,this.processId=t,this.channel=s,this.payload=n,this.name="notification"}};_.NotificationResponseMessage=di;var fi=class{constructor(e,t){this.length=e,this.status=t,this.name="readyForQuery"}};_.ReadyForQueryMessage=fi;var hi=class{constructor(e,t){this.length=e,this.text=t,this.name="commandComplete"}};_.CommandCompleteMessage=hi;var pi=class{constructor(e,t){this.length=e,this.fields=t,this.name="dataRow",this.fieldCount=t.length}};_.DataRowMessage=pi;var mi=class{constructor(e,t){this.length=e,this.message=t,this.name="notice"}};_.NoticeMessage=mi});var cc=f(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.Writer=void 0;var yi=class{constructor(e=256){this.size=e,this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(e)}ensure(e){if(this.buffer.length-this.offset<e){let s=this.buffer,n=s.length+(s.length>>1)+e;this.buffer=Buffer.allocUnsafe(n),s.copy(this.buffer)}}addInt32(e){return this.ensure(4),this.buffer[this.offset++]=e>>>24&255,this.buffer[this.offset++]=e>>>16&255,this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addInt16(e){return this.ensure(2),this.buffer[this.offset++]=e>>>8&255,this.buffer[this.offset++]=e>>>0&255,this}addCString(e){if(!e)this.ensure(1);else{let t=Buffer.byteLength(e);this.ensure(t+1),this.buffer.write(e,this.offset,"utf-8"),this.offset+=t}return this.buffer[this.offset++]=0,this}addString(e=""){let t=Buffer.byteLength(e);return this.ensure(t),this.buffer.write(e,this.offset),this.offset+=t,this}add(e){return this.ensure(e.length),e.copy(this.buffer,this.offset),this.offset+=e.length,this}join(e){if(e){this.buffer[this.headerPosition]=e;let t=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(t,this.headerPosition+1)}return this.buffer.slice(e?0:5,this.offset)}flush(e){let t=this.join(e);return this.offset=5,this.headerPosition=0,this.buffer=Buffer.allocUnsafe(this.size),t}};us.Writer=yi});var dc=f(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.serialize=void 0;var _i=cc(),M=new _i.Writer,a_=r=>{M.addInt16(3).addInt16(0);for(let s of Object.keys(r))M.addCString(s).addCString(r[s]);M.addCString("client_encoding").addCString("UTF8");let e=M.addCString("").flush(),t=e.length+4;return new _i.Writer().addInt32(t).add(e).flush()},u_=()=>{let r=Buffer.allocUnsafe(8);return r.writeInt32BE(8,0),r.writeInt32BE(80877103,4),r},c_=r=>M.addCString(r).flush(112),l_=function(r,e){return M.addCString(r).addInt32(Buffer.byteLength(e)).addString(e),M.flush(112)},d_=function(r){return M.addString(r).flush(112)},f_=r=>M.addCString(r).flush(81),lc=[],h_=r=>{let e=r.name||"";e.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",e,e.length),console.error("This can cause conflicts and silent errors executing queries"));let t=r.types||lc,s=t.length,n=M.addCString(e).addCString(r.text).addInt16(s);for(let i=0;i<s;i++)n.addInt32(t[i]);return M.flush(80)},Ct=new _i.Writer,p_=function(r,e){for(let t=0;t<r.length;t++){let s=e?e(r[t],t):r[t];s==null?(M.addInt16(0),Ct.addInt32(-1)):s instanceof Buffer?(M.addInt16(1),Ct.addInt32(s.length),Ct.add(s)):(M.addInt16(0),Ct.addInt32(Buffer.byteLength(s)),Ct.addString(s))}},m_=(r={})=>{let e=r.portal||"",t=r.statement||"",s=r.binary||!1,n=r.values||lc,i=n.length;return M.addCString(e).addCString(t),M.addInt16(i),p_(n,r.valueMapper),M.addInt16(i),M.add(Ct.flush()),M.addInt16(1),M.addInt16(s?1:0),M.flush(66)},g_=Buffer.from([69,0,0,0,9,0,0,0,0,0]),y_=r=>{if(!r||!r.portal&&!r.rows)return g_;let e=r.portal||"",t=r.rows||0,s=Buffer.byteLength(e),n=4+s+1+4,i=Buffer.allocUnsafe(1+n);return i[0]=69,i.writeInt32BE(n,1),i.write(e,5,"utf-8"),i[s+5]=0,i.writeUInt32BE(t,i.length-4),i},__=(r,e)=>{let t=Buffer.allocUnsafe(16);return t.writeInt32BE(16,0),t.writeInt16BE(1234,4),t.writeInt16BE(5678,6),t.writeInt32BE(r,8),t.writeInt32BE(e,12),t},vi=(r,e)=>{let s=4+Buffer.byteLength(e)+1,n=Buffer.allocUnsafe(1+s);return n[0]=r,n.writeInt32BE(s,1),n.write(e,5,"utf-8"),n[s]=0,n},v_=M.addCString("P").flush(68),S_=M.addCString("S").flush(68),E_=r=>r.name?vi(68,`${r.type}${r.name||""}`):r.type==="P"?v_:S_,b_=r=>{let e=`${r.type}${r.name||""}`;return vi(67,e)},w_=r=>M.add(r).flush(100),T_=r=>vi(102,r),cs=r=>Buffer.from([r,0,0,0,4]),A_=cs(72),C_=cs(83),R_=cs(88),I_=cs(99),L_={startup:a_,password:c_,requestSsl:u_,sendSASLInitialResponseMessage:l_,sendSCRAMClientFinalMessage:d_,query:f_,parse:h_,bind:m_,execute:y_,describe:E_,close:b_,flush:()=>A_,sync:()=>C_,end:()=>R_,copyData:w_,copyDone:()=>I_,copyFail:T_,cancel:__};ls.serialize=L_});var fc=f(ds=>{"use strict";Object.defineProperty(ds,"__esModule",{value:!0});ds.BufferReader=void 0;var O_=Buffer.allocUnsafe(0),Si=class{constructor(e=0){this.offset=e,this.buffer=O_,this.encoding="utf-8"}setBuffer(e,t){this.offset=e,this.buffer=t}int16(){let e=this.buffer.readInt16BE(this.offset);return this.offset+=2,e}byte(){let e=this.buffer[this.offset];return this.offset++,e}int32(){let e=this.buffer.readInt32BE(this.offset);return this.offset+=4,e}uint32(){let e=this.buffer.readUInt32BE(this.offset);return this.offset+=4,e}string(e){let t=this.buffer.toString(this.encoding,this.offset,this.offset+e);return this.offset+=e,t}cstring(){let e=this.offset,t=e;for(;this.buffer[t++]!==0;);return this.offset=t,this.buffer.toString(this.encoding,e,t-1)}bytes(e){let t=this.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}};ds.BufferReader=Si});var mc=f(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.Parser=void 0;var F=gi(),x_=fc(),Ei=1,N_=4,hc=Ei+N_,pc=Buffer.allocUnsafe(0),bi=class{constructor(e){if(this.buffer=pc,this.bufferLength=0,this.bufferOffset=0,this.reader=new x_.BufferReader,e?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=e?.mode||"text"}parse(e,t){this.mergeBuffer(e);let s=this.bufferOffset+this.bufferLength,n=this.bufferOffset;for(;n+hc<=s;){let i=this.buffer[n],o=this.buffer.readUInt32BE(n+Ei),a=Ei+o;if(a+n<=s){let u=this.handlePacket(n+hc,i,o,this.buffer);t(u),n+=a}else break}n===s?(this.buffer=pc,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=s-n,this.bufferOffset=n)}mergeBuffer(e){if(this.bufferLength>0){let t=this.bufferLength+e.byteLength;if(t+this.bufferOffset>this.buffer.byteLength){let n;if(t<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)n=this.buffer;else{let i=this.buffer.byteLength*2;for(;t>=i;)i*=2;n=Buffer.allocUnsafe(i)}this.buffer.copy(n,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=n,this.bufferOffset=0}e.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=t}else this.buffer=e,this.bufferOffset=0,this.bufferLength=e.byteLength}handlePacket(e,t,s,n){switch(t){case 50:return F.bindComplete;case 49:return F.parseComplete;case 51:return F.closeComplete;case 110:return F.noData;case 115:return F.portalSuspended;case 99:return F.copyDone;case 87:return F.replicationStart;case 73:return F.emptyQuery;case 68:return this.parseDataRowMessage(e,s,n);case 67:return this.parseCommandCompleteMessage(e,s,n);case 90:return this.parseReadyForQueryMessage(e,s,n);case 65:return this.parseNotificationMessage(e,s,n);case 82:return this.parseAuthenticationResponse(e,s,n);case 83:return this.parseParameterStatusMessage(e,s,n);case 75:return this.parseBackendKeyData(e,s,n);case 69:return this.parseErrorMessage(e,s,n,"error");case 78:return this.parseErrorMessage(e,s,n,"notice");case 84:return this.parseRowDescriptionMessage(e,s,n);case 116:return this.parseParameterDescriptionMessage(e,s,n);case 71:return this.parseCopyInMessage(e,s,n);case 72:return this.parseCopyOutMessage(e,s,n);case 100:return this.parseCopyData(e,s,n);default:return new F.DatabaseError("received invalid response: "+t.toString(16),s,"error")}}parseReadyForQueryMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.string(1);return new F.ReadyForQueryMessage(t,n)}parseCommandCompleteMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring();return new F.CommandCompleteMessage(t,n)}parseCopyData(e,t,s){let n=s.slice(e,e+(t-4));return new F.CopyDataMessage(t,n)}parseCopyInMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyInResponse")}parseCopyOutMessage(e,t,s){return this.parseCopyMessage(e,t,s,"copyOutResponse")}parseCopyMessage(e,t,s,n){this.reader.setBuffer(e,s);let i=this.reader.byte()!==0,o=this.reader.int16(),a=new F.CopyResponse(t,n,i,o);for(let u=0;u<o;u++)a.columnTypes[u]=this.reader.int16();return a}parseNotificationMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.cstring(),o=this.reader.cstring();return new F.NotificationResponseMessage(t,n,i,o)}parseRowDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new F.RowDescriptionMessage(t,n);for(let o=0;o<n;o++)i.fields[o]=this.parseField();return i}parseField(){let e=this.reader.cstring(),t=this.reader.uint32(),s=this.reader.int16(),n=this.reader.uint32(),i=this.reader.int16(),o=this.reader.int32(),a=this.reader.int16()===0?"text":"binary";return new F.Field(e,t,s,n,i,o,a)}parseParameterDescriptionMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new F.ParameterDescriptionMessage(t,n);for(let o=0;o<n;o++)i.dataTypeIDs[o]=this.reader.int32();return i}parseDataRowMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int16(),i=new Array(n);for(let o=0;o<n;o++){let a=this.reader.int32();i[o]=a===-1?null:this.reader.string(a)}return new F.DataRowMessage(t,i)}parseParameterStatusMessage(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.cstring(),i=this.reader.cstring();return new F.ParameterStatusMessage(t,n,i)}parseBackendKeyData(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i=this.reader.int32();return new F.BackendKeyDataMessage(t,n,i)}parseAuthenticationResponse(e,t,s){this.reader.setBuffer(e,s);let n=this.reader.int32(),i={name:"authenticationOk",length:t};switch(n){case 0:break;case 3:i.length===8&&(i.name="authenticationCleartextPassword");break;case 5:if(i.length===12){i.name="authenticationMD5Password";let o=this.reader.bytes(4);return new F.AuthenticationMD5Password(t,o)}break;case 10:{i.name="authenticationSASL",i.mechanisms=[];let o;do o=this.reader.cstring(),o&&i.mechanisms.push(o);while(o)}break;case 11:i.name="authenticationSASLContinue",i.data=this.reader.string(t-8);break;case 12:i.name="authenticationSASLFinal",i.data=this.reader.string(t-8);break;default:throw new Error("Unknown authenticationOk message type "+n)}return i}parseErrorMessage(e,t,s,n){this.reader.setBuffer(e,s);let i={},o=this.reader.string(1);for(;o!=="\0";)i[o]=this.reader.cstring(),o=this.reader.string(1);let a=i.M,u=n==="notice"?new F.NoticeMessage(t,a):new F.DatabaseError(a,t,n);return u.severity=i.S,u.code=i.C,u.detail=i.D,u.hint=i.H,u.position=i.P,u.internalPosition=i.p,u.internalQuery=i.q,u.where=i.W,u.schema=i.s,u.table=i.t,u.column=i.c,u.dataType=i.d,u.constraint=i.n,u.file=i.F,u.line=i.L,u.routine=i.R,u}};fs.Parser=bi});var wi=f(je=>{"use strict";Object.defineProperty(je,"__esModule",{value:!0});je.DatabaseError=je.serialize=je.parse=void 0;var q_=gi();Object.defineProperty(je,"DatabaseError",{enumerable:!0,get:function(){return q_.DatabaseError}});var M_=dc();Object.defineProperty(je,"serialize",{enumerable:!0,get:function(){return M_.serialize}});var P_=mc();function D_(r,e){let t=new P_.Parser;return r.on("data",s=>t.parse(s,e)),new Promise(s=>r.on("end",()=>s()))}je.parse=D_});var gc=f(Ti=>{"use strict";Object.defineProperty(Ti,"__esModule",{value:!0});Ti.default={}});var _c=f((IC,yc)=>{var{getStream:k_,getSecureStream:$_}=j_();yc.exports={getStream:k_,getSecureStream:$_};function B_(){function r(t){let s=require("net");return new s.Socket}function e(t){return require("tls").connect(t)}return{getStream:r,getSecureStream:e}}function F_(){function r(t){let{CloudflareSocket:s}=gc();return new s(t)}function e(t){return t.socket.startTls(t),t.socket}return{getStream:r,getSecureStream:e}}function U_(){if(typeof navigator=="object"&&navigator!==null&&typeof navigator.userAgent=="string")return navigator.userAgent==="Cloudflare-Workers";if(typeof Response=="function"){let r=new Response(null,{cf:{thing:!0}});if(typeof r.cf=="object"&&r.cf!==null&&r.cf.thing)return!0}return!1}function j_(){return U_()?F_():B_()}});var Ci=f((LC,vc)=>{"use strict";var G_=require("events").EventEmitter,{parse:W_,serialize:Q}=wi(),{getStream:V_,getSecureStream:Q_}=_c(),H_=Q.flush(),X_=Q.sync(),K_=Q.end(),Ai=class extends G_{constructor(e){super(),e=e||{},this.stream=e.stream||V_(e.ssl),typeof this.stream=="function"&&(this.stream=this.stream(e)),this._keepAlive=e.keepAlive,this._keepAliveInitialDelayMillis=e.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=e.ssl||!1,this._ending=!1,this._emitMessage=!1;let t=this;this.on("newListener",function(s){s==="message"&&(t._emitMessage=!0)})}connect(e,t){let s=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(e,t),this.stream.once("connect",function(){s._keepAlive&&s.stream.setKeepAlive(!0,s._keepAliveInitialDelayMillis),s.emit("connect")});let n=function(i){s._ending&&(i.code==="ECONNRESET"||i.code==="EPIPE")||s.emit("error",i)};if(this.stream.on("error",n),this.stream.on("close",function(){s.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(i){switch(i.toString("utf8")){case"S":break;case"N":return s.stream.end(),s.emit("error",new Error("The server does not support SSL connections"));default:return s.stream.end(),s.emit("error",new Error("There was an error establishing an SSL connection"))}let a={socket:s.stream};s.ssl!==!0&&(Object.assign(a,s.ssl),"key"in s.ssl&&(a.key=s.ssl.key));let u=require("net");u.isIP&&u.isIP(t)===0&&(a.servername=t);try{s.stream=Q_(a)}catch(c){return s.emit("error",c)}s.attachListeners(s.stream),s.stream.on("error",n),s.emit("sslconnect")})}attachListeners(e){W_(e,t=>{let s=t.name==="error"?"errorMessage":t.name;this._emitMessage&&this.emit("message",t),this.emit(s,t)})}requestSsl(){this.stream.write(Q.requestSsl())}startup(e){this.stream.write(Q.startup(e))}cancel(e,t){this._send(Q.cancel(e,t))}password(e){this._send(Q.password(e))}sendSASLInitialResponseMessage(e,t){this._send(Q.sendSASLInitialResponseMessage(e,t))}sendSCRAMClientFinalMessage(e){this._send(Q.sendSCRAMClientFinalMessage(e))}_send(e){return this.stream.writable?this.stream.write(e):!1}query(e){this._send(Q.query(e))}parse(e){this._send(Q.parse(e))}bind(e){this._send(Q.bind(e))}execute(e){this._send(Q.execute(e))}flush(){this.stream.writable&&this.stream.write(H_)}sync(){this._ending=!0,this._send(X_)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(K_,()=>{this.stream.end()})}close(e){this._send(Q.close(e))}describe(e){this._send(Q.describe(e))}sendCopyFromChunk(e){this._send(Q.copyData(e))}endCopyFrom(){this._send(Q.copyDone())}sendCopyFail(e){this._send(Q.copyFail(e))}};vc.exports=Ai});var wc=f((OC,bc)=>{"use strict";var{Transform:z_}=require("stream"),{StringDecoder:Y_}=require("string_decoder"),Ge=Symbol("last"),hs=Symbol("decoder");function J_(r,e,t){let s;if(this.overflow){if(s=this[hs].write(r).split(this.matcher),s.length===1)return t();s.shift(),this.overflow=!1}else this[Ge]+=this[hs].write(r),s=this[Ge].split(this.matcher);this[Ge]=s.pop();for(let n=0;n<s.length;n++)try{Ec(this,this.mapper(s[n]))}catch(i){return t(i)}if(this.overflow=this[Ge].length>this.maxLength,this.overflow&&!this.skipOverflow){t(new Error("maximum buffer reached"));return}t()}function Z_(r){if(this[Ge]+=this[hs].end(),this[Ge])try{Ec(this,this.mapper(this[Ge]))}catch(e){return r(e)}r()}function Ec(r,e){e!==void 0&&r.push(e)}function Sc(r){return r}function ev(r,e,t){switch(r=r||/\r?\n/,e=e||Sc,t=t||{},arguments.length){case 1:typeof r=="function"?(e=r,r=/\r?\n/):typeof r=="object"&&!(r instanceof RegExp)&&!r[Symbol.split]&&(t=r,r=/\r?\n/);break;case 2:typeof r=="function"?(t=e,e=r,r=/\r?\n/):typeof e=="object"&&(t=e,e=Sc)}t=Object.assign({},t),t.autoDestroy=!0,t.transform=J_,t.flush=Z_,t.readableObjectMode=!0;let s=new z_(t);return s[Ge]="",s[hs]=new Y_("utf8"),s.matcher=r,s.mapper=e,s.maxLength=t.maxLength,s.skipOverflow=t.skipOverflow||!1,s.overflow=!1,s._destroy=function(n,i){this._writableState.errorEmitted=!1,i(n)},s}bc.exports=ev});var Cc=f((xC,Ne)=>{"use strict";var Tc=require("path"),tv=require("stream").Stream,rv=wc(),Ac=require("util"),sv=5432,ps=process.platform==="win32",fr=process.stderr,nv=56,iv=7,ov=61440,av=32768;function uv(r){return(r&ov)==av}var Rt=["host","port","database","user","password"],Ri=Rt.length,cv=Rt[Ri-1];function Ii(){var r=fr instanceof tv&&fr.writable===!0;if(r){var e=Array.prototype.slice.call(arguments).concat(`
`);fr.write(Ac.format.apply(Ac,e))}}Object.defineProperty(Ne.exports,"isWin",{get:function(){return ps},set:function(r){ps=r}});Ne.exports.warnTo=function(r){var e=fr;return fr=r,e};Ne.exports.getFileName=function(r){var e=r||process.env,t=e.PGPASSFILE||(ps?Tc.join(e.APPDATA||"./","postgresql","pgpass.conf"):Tc.join(e.HOME||"./",".pgpass"));return t};Ne.exports.usePgPass=function(r,e){return Object.prototype.hasOwnProperty.call(process.env,"PGPASSWORD")?!1:ps?!0:(e=e||"<unkn>",uv(r.mode)?r.mode&(nv|iv)?(Ii('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',e),!1):!0:(Ii('WARNING: password file "%s" is not a plain file',e),!1))};var lv=Ne.exports.match=function(r,e){return Rt.slice(0,-1).reduce(function(t,s,n){return n==1&&Number(r[s]||sv)===Number(e[s])?t&&!0:t&&(e[s]==="*"||e[s]===r[s])},!0)};Ne.exports.getPassword=function(r,e,t){var s,n=e.pipe(rv());function i(u){var c=dv(u);c&&fv(c)&&lv(r,c)&&(s=c[cv],n.end())}var o=function(){e.destroy(),t(s)},a=function(u){e.destroy(),Ii("WARNING: error on reading file: %s",u),t(void 0)};e.on("error",a),n.on("data",i).on("end",o).on("error",a)};var dv=Ne.exports.parseLine=function(r){if(r.length<11||r.match(/^\s+#/))return null;for(var e="",t="",s=0,n=0,i=0,o={},a=!1,u=function(l,d,m){var h=r.substring(d,m);Object.hasOwnProperty.call(process.env,"PGPASS_NO_DEESCAPE")||(h=h.replace(/\\([:\\])/g,"$1")),o[Rt[l]]=h},c=0;c<r.length-1;c+=1){if(e=r.charAt(c+1),t=r.charAt(c),a=s==Ri-1,a){u(s,n);break}c>=0&&e==":"&&t!=="\\"&&(u(s,n,c+1),n=c+2,s+=1)}return o=Object.keys(o).length===Ri?o:null,o},fv=Ne.exports.isValidEntry=function(r){for(var e={0:function(o){return o.length>0},1:function(o){return o==="*"?!0:(o=Number(o),isFinite(o)&&o>0&&o<9007199254740992&&Math.floor(o)===o)},2:function(o){return o.length>0},3:function(o){return o.length>0},4:function(o){return o.length>0}},t=0;t<Rt.length;t+=1){var s=e[t],n=r[Rt[t]]||"",i=s(n);if(!i)return!1}return!0}});var Ic=f((qC,Li)=>{"use strict";var NC=require("path"),Rc=require("fs"),ms=Cc();Li.exports=function(r,e){var t=ms.getFileName();Rc.stat(t,function(s,n){if(s||!ms.usePgPass(n,t))return e(void 0);var i=Rc.createReadStream(t);ms.getPassword(r,i,e)})};Li.exports.warnTo=ms.warnTo});var Nc=f((MC,xc)=>{"use strict";var hv=require("events").EventEmitter,Lc=bt(),Oi=Ku(),pv=as(),mv=Jn(),Oc=uc(),gv=lr(),yv=Ci(),_v=Kn(),gs=class extends hv{constructor(e){super(),this.connectionParameters=new mv(e),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;let t=e||{};this._Promise=t.Promise||global.Promise,this._types=new pv(t.types),this._ending=!1,this._ended=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.enableChannelBinding=!!t.enableChannelBinding,this.connection=t.connection||new yv({stream:t.stream,ssl:this.connectionParameters.ssl,keepAlive:t.keepAlive||!1,keepAliveInitialDelayMillis:t.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=t.binary||gv.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=t.connectionTimeoutMillis||0}_errorAllQueries(e){let t=s=>{process.nextTick(()=>{s.handleError(e,this.connection)})};this.activeQuery&&(t(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(t),this.queryQueue.length=0}_connect(e){let t=this,s=this.connection;if(this._connectionCallback=e,this._connecting||this._connected){let n=new Error("Client has already been connected. You cannot reuse a client.");process.nextTick(()=>{e(n)});return}this._connecting=!0,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{s._ending=!0,s.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis),this.connectionTimeoutHandle.unref&&this.connectionTimeoutHandle.unref()),this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){t.ssl?s.requestSsl():s.startup(t.getStartupConf())}),s.on("sslconnect",function(){s.startup(t.getStartupConf())}),this._attachListeners(s),s.once("end",()=>{let n=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(n),this._ended=!0,this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(n):this._handleErrorEvent(n):this._connectionError||this._handleErrorEvent(n)),process.nextTick(()=>{this.emit("end")})})}connect(e){if(e){this._connect(e);return}return new this._Promise((t,s)=>{this._connect(n=>{n?s(n):t()})})}_attachListeners(e){e.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),e.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),e.on("authenticationSASL",this._handleAuthSASL.bind(this)),e.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),e.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),e.on("backendKeyData",this._handleBackendKeyData.bind(this)),e.on("error",this._handleErrorEvent.bind(this)),e.on("errorMessage",this._handleErrorMessage.bind(this)),e.on("readyForQuery",this._handleReadyForQuery.bind(this)),e.on("notice",this._handleNotice.bind(this)),e.on("rowDescription",this._handleRowDescription.bind(this)),e.on("dataRow",this._handleDataRow.bind(this)),e.on("portalSuspended",this._handlePortalSuspended.bind(this)),e.on("emptyQuery",this._handleEmptyQuery.bind(this)),e.on("commandComplete",this._handleCommandComplete.bind(this)),e.on("parseComplete",this._handleParseComplete.bind(this)),e.on("copyInResponse",this._handleCopyInResponse.bind(this)),e.on("copyData",this._handleCopyData.bind(this)),e.on("notification",this._handleNotification.bind(this))}_checkPgPass(e){let t=this.connection;if(typeof this.password=="function")this._Promise.resolve().then(()=>this.password()).then(s=>{if(s!==void 0){if(typeof s!="string"){t.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=s}else this.connectionParameters.password=this.password=null;e()}).catch(s=>{t.emit("error",s)});else if(this.password!==null)e();else try{Ic()(this.connectionParameters,n=>{n!==void 0&&(this.connectionParameters.password=this.password=n),e()})}catch(s){this.emit("error",s)}}_handleAuthCleartextPassword(e){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(e){this._checkPgPass(async()=>{try{let t=await _v.postgresMd5PasswordHash(this.user,this.password,e.salt);this.connection.password(t)}catch(t){this.emit("error",t)}})}_handleAuthSASL(e){this._checkPgPass(()=>{try{this.saslSession=Oi.startSession(e.mechanisms,this.enableChannelBinding&&this.connection.stream),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)}catch(t){this.connection.emit("error",t)}})}async _handleAuthSASLContinue(e){try{await Oi.continueSession(this.saslSession,this.password,e.data,this.enableChannelBinding&&this.connection.stream),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}catch(t){this.connection.emit("error",t)}}_handleAuthSASLFinal(e){try{Oi.finalizeSession(this.saslSession,e.data),this.saslSession=null}catch(t){this.connection.emit("error",t)}}_handleBackendKeyData(e){this.processID=e.processID,this.secretKey=e.secretKey}_handleReadyForQuery(e){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:t}=this;this.activeQuery=null,this.readyForQuery=!0,t&&t.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(e){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(e);this.emit("error",e)}}_handleErrorEvent(e){if(this._connecting)return this._handleErrorWhileConnecting(e);this._queryable=!1,this._errorAllQueries(e),this.emit("error",e)}_handleErrorMessage(e){if(this._connecting)return this._handleErrorWhileConnecting(e);let t=this.activeQuery;if(!t){this._handleErrorEvent(e);return}this.activeQuery=null,t.handleError(e,this.connection)}_handleRowDescription(e){this.activeQuery.handleRowDescription(e)}_handleDataRow(e){this.activeQuery.handleDataRow(e)}_handlePortalSuspended(e){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(e){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(e){if(this.activeQuery==null){let t=new Error("Received unexpected commandComplete message from backend.");this._handleErrorEvent(t);return}this.activeQuery.handleCommandComplete(e,this.connection)}_handleParseComplete(){if(this.activeQuery==null){let e=new Error("Received unexpected parseComplete message from backend.");this._handleErrorEvent(e);return}this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(e){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(e){this.activeQuery.handleCopyData(e,this.connection)}_handleNotification(e){this.emit("notification",e)}_handleNotice(e){this.emit("notice",e)}getStartupConf(){let e=this.connectionParameters,t={user:e.user,database:e.database},s=e.application_name||e.fallback_application_name;return s&&(t.application_name=s),e.replication&&(t.replication=""+e.replication),e.statement_timeout&&(t.statement_timeout=String(parseInt(e.statement_timeout,10))),e.lock_timeout&&(t.lock_timeout=String(parseInt(e.lock_timeout,10))),e.idle_in_transaction_session_timeout&&(t.idle_in_transaction_session_timeout=String(parseInt(e.idle_in_transaction_session_timeout,10))),e.options&&(t.options=e.options),t}cancel(e,t){if(e.activeQuery===t){let s=this.connection;this.host&&this.host.indexOf("/")===0?s.connect(this.host+"/.s.PGSQL."+this.port):s.connect(this.port,this.host),s.on("connect",function(){s.cancel(e.processID,e.secretKey)})}else e.queryQueue.indexOf(t)!==-1&&e.queryQueue.splice(e.queryQueue.indexOf(t),1)}setTypeParser(e,t,s){return this._types.setTypeParser(e,t,s)}getTypeParser(e,t){return this._types.getTypeParser(e,t)}escapeIdentifier(e){return Lc.escapeIdentifier(e)}escapeLiteral(e){return Lc.escapeLiteral(e)}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let e=this.activeQuery.submit(this.connection);e&&process.nextTick(()=>{this.activeQuery.handleError(e,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(e,t,s){let n,i,o,a,u;if(e==null)throw new TypeError("Client was passed a null or undefined query");return typeof e.submit=="function"?(o=e.query_timeout||this.connectionParameters.query_timeout,i=n=e,typeof t=="function"&&(n.callback=n.callback||t)):(o=e.query_timeout||this.connectionParameters.query_timeout,n=new Oc(e,t,s),n.callback||(i=new this._Promise((c,l)=>{n.callback=(d,m)=>d?l(d):c(m)}).catch(c=>{throw Error.captureStackTrace(c),c}))),o&&(u=n.callback,a=setTimeout(()=>{let c=new Error("Query read timeout");process.nextTick(()=>{n.handleError(c,this.connection)}),u(c),n.callback=()=>{};let l=this.queryQueue.indexOf(n);l>-1&&this.queryQueue.splice(l,1),this._pulseQueryQueue()},o),n.callback=(c,l)=>{clearTimeout(a),u(c,l)}),this.binary&&!n.binary&&(n.binary=!0),n._result&&!n._result._types&&(n._result._types=this._types),this._queryable?this._ending?(process.nextTick(()=>{n.handleError(new Error("Client was closed and is not queryable"),this.connection)}),i):(this.queryQueue.push(n),this._pulseQueryQueue(),i):(process.nextTick(()=>{n.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),i)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(e){if(this._ending=!0,!this.connection._connecting||this._ended)if(e)e();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),e)this.connection.once("end",e);else return new this._Promise(t=>{this.connection.once("end",t)})}};gs.Query=Oc;xc.exports=gs});var Dc=f((PC,Pc)=>{"use strict";var vv=require("events").EventEmitter,qc=function(){},Mc=(r,e)=>{let t=r.findIndex(e);return t===-1?void 0:r.splice(t,1)[0]},xi=class{constructor(e,t,s){this.client=e,this.idleListener=t,this.timeoutId=s}},It=class{constructor(e){this.callback=e}};function Sv(){throw new Error("Release called on client which has already been released to the pool.")}function ys(r,e){if(e)return{callback:e,result:void 0};let t,s,n=function(o,a){o?t(o):s(a)},i=new r(function(o,a){s=o,t=a}).catch(o=>{throw Error.captureStackTrace(o),o});return{callback:n,result:i}}function Ev(r,e){return function t(s){s.client=e,e.removeListener("error",t),e.on("error",()=>{r.log("additional client error after disconnection due to error",s)}),r._remove(e),r.emit("error",s,e)}}var Ni=class extends vv{constructor(e,t){super(),this.options=Object.assign({},e),e!=null&&"password"in e&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),e!=null&&e.ssl&&e.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||t||qi().Client,this.Promise=this.options.Promise||global.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(t=>{this._remove(t.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let e=this._pendingQueue.shift();if(this._idle.length){let t=this._idle.pop();clearTimeout(t.timeoutId);let s=t.client;s.ref&&s.ref();let n=t.idleListener;return this._acquireClient(s,e,n,!1)}if(!this._isFull())return this.newClient(e);throw new Error("unexpected condition")}_remove(e,t){let s=Mc(this._idle,i=>i.client===e);s!==void 0&&clearTimeout(s.timeoutId),this._clients=this._clients.filter(i=>i!==e);let n=this;e.end(()=>{n.emit("remove",e),typeof t=="function"&&t()})}connect(e){if(this.ending){let n=new Error("Cannot use a pool after calling end on the pool");return e?e(n):this.Promise.reject(n)}let t=ys(this.Promise,e),s=t.result;if(this._isFull()||this._idle.length){if(this._idle.length&&process.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new It(t.callback)),s;let n=(a,u,c)=>{clearTimeout(o),t.callback(a,u,c)},i=new It(n),o=setTimeout(()=>{Mc(this._pendingQueue,a=>a.callback===n),i.timedOut=!0,t.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return o.unref&&o.unref(),this._pendingQueue.push(i),s}return this.newClient(new It(t.callback)),s}newClient(e){let t=new this.Client(this.options);this._clients.push(t);let s=Ev(this,t);this.log("checking client timeout");let n,i=!1;this.options.connectionTimeoutMillis&&(n=setTimeout(()=>{this.log("ending client due to timeout"),i=!0,t.connection?t.connection.stream.destroy():t.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),t.connect(o=>{if(n&&clearTimeout(n),t.on("error",s),o)this.log("client failed to connect",o),this._clients=this._clients.filter(a=>a!==t),i&&(o=new Error("Connection terminated due to connection timeout",{cause:o})),this._pulseQueue(),e.timedOut||e.callback(o,void 0,qc);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(t),this._idle.findIndex(c=>c.client===t)!==-1&&this._acquireClient(t,new It((c,l,d)=>d()),s,!1)},this.options.maxLifetimeSeconds*1e3);a.unref(),t.once("end",()=>clearTimeout(a))}return this._acquireClient(t,e,s,!0)}})}_acquireClient(e,t,s,n){n&&this.emit("connect",e),this.emit("acquire",e),e.release=this._releaseOnce(e,s),e.removeListener("error",s),t.timedOut?n&&this.options.verify?this.options.verify(e,e.release):e.release():n&&this.options.verify?this.options.verify(e,i=>{if(i)return e.release(i),t.callback(i,void 0,qc);t.callback(void 0,e,e.release)}):t.callback(void 0,e,e.release)}_releaseOnce(e,t){let s=!1;return n=>{s&&Sv(),s=!0,this._release(e,t,n)}}_release(e,t,s){if(e.on("error",t),e._poolUseCount=(e._poolUseCount||0)+1,this.emit("release",s,e),s||this.ending||!e._queryable||e._ending||e._poolUseCount>=this.options.maxUses)return e._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(e,this._pulseQueue.bind(this));if(this._expired.has(e))return this.log("remove expired client"),this._expired.delete(e),this._remove(e,this._pulseQueue.bind(this));let i;this.options.idleTimeoutMillis&&this._isAboveMin()&&(i=setTimeout(()=>{this.log("remove idle client"),this._remove(e,this._pulseQueue.bind(this))},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&i.unref()),this.options.allowExitOnIdle&&e.unref(),this._idle.push(new xi(e,t,i)),this._pulseQueue()}query(e,t,s){if(typeof e=="function"){let i=ys(this.Promise,e);return setImmediate(function(){return i.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),i.result}typeof t=="function"&&(s=t,t=void 0);let n=ys(this.Promise,s);return s=n.callback,this.connect((i,o)=>{if(i)return s(i);let a=!1,u=c=>{a||(a=!0,o.release(c),s(c))};o.once("error",u),this.log("dispatching query");try{o.query(e,t,(c,l)=>{if(this.log("query dispatched"),o.removeListener("error",u),!a)return a=!0,o.release(c),c?s(c):s(void 0,l)})}catch(c){return o.release(c),s(c)}}),n.result}end(e){if(this.log("ending"),this.ending){let s=new Error("Called end on pool more than once");return e?e(s):this.Promise.reject(s)}this.ending=!0;let t=ys(this.Promise,e);return this._endCallback=t.callback,this._pulseQueue(),t.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((e,t)=>e+(this._expired.has(t)?1:0),0)}get totalCount(){return this._clients.length}};Pc.exports=Ni});var Bc=f((DC,$c)=>{"use strict";var kc=require("events").EventEmitter,bv=require("util"),Mi=bt(),Lt=$c.exports=function(r,e,t){kc.call(this),r=Mi.normalizeQueryConfig(r,e,t),this.text=r.text,this.values=r.values,this.name=r.name,this.queryMode=r.queryMode,this.callback=r.callback,this.state="new",this._arrayMode=r.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(s){s==="row"&&(this._emitRowEvents=!0)}.bind(this))};bv.inherits(Lt,kc);var wv={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};Lt.prototype.handleError=function(r){let e=this.native.pq.resultErrorFields();if(e)for(let t in e){let s=wv[t]||t;r[s]=e[t]}this.callback?this.callback(r):this.emit("error",r),this.state="error"};Lt.prototype.then=function(r,e){return this._getPromise().then(r,e)};Lt.prototype.catch=function(r){return this._getPromise().catch(r)};Lt.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(r,e){this._once("end",r),this._once("error",e)}.bind(this)),this._promise)};Lt.prototype.submit=function(r){this.state="running";let e=this;this.native=r.native,r.native.arrayMode=this._arrayMode;let t=function(s,n,i){if(r.native.arrayMode=!1,setImmediate(function(){e.emit("_done")}),s)return e.handleError(s);e._emitRowEvents&&(i.length>1?n.forEach((o,a)=>{o.forEach(u=>{e.emit("row",u,i[a])})}):n.forEach(function(o){e.emit("row",o,i)})),e.state="end",e.emit("end",i),e.callback&&e.callback(null,i)};if(process.domain&&(t=process.domain.bind(t)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));let s=(this.values||[]).map(Mi.prepareValue);if(r.namedQueries[this.name]){if(this.text&&r.namedQueries[this.name]!==this.text){let n=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return t(n)}return r.native.execute(this.name,s,t)}return r.native.prepare(this.name,this.text,s.length,function(n){return n?t(n):(r.namedQueries[e.name]=e.text,e.native.execute(e.name,s,t))})}else if(this.values){if(!Array.isArray(this.values)){let n=new Error("Query values must be an array");return t(n)}let s=this.values.map(Mi.prepareValue);r.native.query(this.text,s,t)}else this.queryMode==="extended"?r.native.query(this.text,[],t):r.native.query(this.text,t)}});var Wc=f((kC,Gc)=>{"use strict";var Fc;try{Fc=require("pg-native")}catch(r){throw r}var Tv=as(),Uc=require("events").EventEmitter,Av=require("util"),Cv=Jn(),jc=Bc(),oe=Gc.exports=function(r){Uc.call(this),r=r||{},this._Promise=r.Promise||global.Promise,this._types=new Tv(r.types),this.native=new Fc({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;let e=this.connectionParameters=new Cv(r);r.nativeConnectionString&&(e.nativeConnectionString=r.nativeConnectionString),this.user=e.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:e.password}),this.database=e.database,this.host=e.host,this.port=e.port,this.namedQueries={}};oe.Query=jc;Av.inherits(oe,Uc);oe.prototype._errorAllQueries=function(r){let e=t=>{process.nextTick(()=>{t.native=this.native,t.handleError(r)})};this._hasActiveQuery()&&(e(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(e),this._queryQueue.length=0};oe.prototype._connect=function(r){let e=this;if(this._connecting){process.nextTick(()=>r(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(t,s){if(e.connectionParameters.nativeConnectionString&&(s=e.connectionParameters.nativeConnectionString),t)return r(t);e.native.connect(s,function(n){if(n)return e.native.end(),r(n);e._connected=!0,e.native.on("error",function(i){e._queryable=!1,e._errorAllQueries(i),e.emit("error",i)}),e.native.on("notification",function(i){e.emit("notification",{channel:i.relname,payload:i.extra})}),e.emit("connect"),e._pulseQueryQueue(!0),r()})})};oe.prototype.connect=function(r){if(r){this._connect(r);return}return new this._Promise((e,t)=>{this._connect(s=>{s?t(s):e()})})};oe.prototype.query=function(r,e,t){let s,n,i,o,a;if(r==null)throw new TypeError("Client was passed a null or undefined query");if(typeof r.submit=="function")i=r.query_timeout||this.connectionParameters.query_timeout,n=s=r,typeof e=="function"&&(r.callback=e);else if(i=r.query_timeout||this.connectionParameters.query_timeout,s=new jc(r,e,t),!s.callback){let u,c;n=new this._Promise((l,d)=>{u=l,c=d}).catch(l=>{throw Error.captureStackTrace(l),l}),s.callback=(l,d)=>l?c(l):u(d)}return i&&(a=s.callback,o=setTimeout(()=>{let u=new Error("Query read timeout");process.nextTick(()=>{s.handleError(u,this.connection)}),a(u),s.callback=()=>{};let c=this._queryQueue.indexOf(s);c>-1&&this._queryQueue.splice(c,1),this._pulseQueryQueue()},i),s.callback=(u,c)=>{clearTimeout(o),a(u,c)}),this._queryable?this._ending?(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client was closed and is not queryable"))}),n):(this._queryQueue.push(s),this._pulseQueryQueue(),n):(s.native=this.native,process.nextTick(()=>{s.handleError(new Error("Client has encountered a connection error and is not queryable"))}),n)};oe.prototype.end=function(r){let e=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,r));let t;return r||(t=new this._Promise(function(s,n){r=i=>i?n(i):s()})),this.native.end(function(){e._errorAllQueries(new Error("Connection terminated")),process.nextTick(()=>{e.emit("end"),r&&r()})}),t};oe.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"};oe.prototype._pulseQueryQueue=function(r){if(!this._connected||this._hasActiveQuery())return;let e=this._queryQueue.shift();if(!e){r||this.emit("drain");return}this._activeQuery=e,e.submit(this);let t=this;e.once("_done",function(){t._pulseQueryQueue()})};oe.prototype.cancel=function(r){this._activeQuery===r?this.native.cancel(function(){}):this._queryQueue.indexOf(r)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(r),1)};oe.prototype.ref=function(){};oe.prototype.unref=function(){};oe.prototype.setTypeParser=function(r,e,t){return this._types.setTypeParser(r,e,t)};oe.prototype.getTypeParser=function(r,e){return this._types.getTypeParser(r,e)}});var Pi=f(($C,Vc)=>{"use strict";Vc.exports=Wc()});var qi=f((FC,hr)=>{"use strict";var Rv=Nc(),Iv=lr(),Lv=Ci(),Ov=ei(),xv=bt(),Nv=Dc(),qv=as(),{DatabaseError:Mv}=wi(),{escapeIdentifier:Pv,escapeLiteral:Dv}=bt(),kv=r=>class extends Nv{constructor(t){super(t,r)}},Di=function(r){this.defaults=Iv,this.Client=r,this.Query=this.Client.Query,this.Pool=kv(this.Client),this._pools=[],this.Connection=Lv,this.types=cr(),this.DatabaseError=Mv,this.TypeOverrides=qv,this.escapeIdentifier=Pv,this.escapeLiteral=Dv,this.Result=Ov,this.utils=xv};typeof process.env.NODE_PG_FORCE_NATIVE<"u"?hr.exports=new Di(Pi()):(hr.exports=new Di(Rv),Object.defineProperty(hr.exports,"native",{configurable:!0,enumerable:!1,get(){let r=null;try{r=new Di(Pi())}catch(e){if(e.code!=="MODULE_NOT_FOUND")throw e}return Object.defineProperty(hr.exports,"native",{value:r}),r}}))});var zc=f((JC,Kc)=>{"use strict";function ki(r){return typeof r=="function"}var ee=console.error.bind(console);function pr(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function mr(r){r&&r.logger&&(ki(r.logger)?ee=r.logger:ee("new logger isn't a function, not replacing"))}function Hc(r,e,t){if(!r||!r[e]){ee("no original function "+e+" to wrap");return}if(!t){ee("no wrapper function"),ee(new Error().stack);return}if(!ki(r[e])||!ki(t)){ee("original object and wrapper must be functions");return}var s=r[e],n=t(s,e);return pr(n,"__original",s),pr(n,"__unwrap",function(){r[e]===n&&pr(r,e,s)}),pr(n,"__wrapped",!0),pr(r,e,n),n}function $v(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{ee("must provide one or more modules to patch"),ee(new Error().stack);return}if(!(e&&Array.isArray(e))){ee("must provide one or more functions to wrap on modules");return}r.forEach(function(s){e.forEach(function(n){Hc(s,n,t)})})}function Xc(r,e){if(!r||!r[e]){ee("no function to unwrap."),ee(new Error().stack);return}if(!r[e].__unwrap)ee("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function Bv(r,e){if(r)Array.isArray(r)||(r=[r]);else{ee("must provide one or more modules to patch"),ee(new Error().stack);return}if(!(e&&Array.isArray(e))){ee("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(s){Xc(t,s)})})}mr.wrap=Hc;mr.massWrap=$v;mr.unwrap=Xc;mr.massUnwrap=Bv;Kc.exports=mr});var tl=f((ZC,el)=>{"use strict";var Jc=zc(),Ot=Jc.wrap,_s=Jc.unwrap,qe="wrap@before";function vs(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function Fv(r,e){for(var t=e.length,s=0;s<t;s++){var n=e[s],i=r[qe];if(typeof i=="function")i(n);else if(Array.isArray(i))for(var o=i.length,a=0;a<o;a++)i[a](n)}}function Zc(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function Uv(r,e,t){var s=Zc(r,e),n=s.filter(function(i){return t.indexOf(i)===-1});n.length>0&&Fv(r,n)}function Yc(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var s=0;s<r.length;s++)t[s]=e(r[s])}return t}}el.exports=function(e,t,s){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!s)throw new Error("must have function to wrap listeners when emitting");function n(o){return function(u,c){var l=Zc(this,u).slice();try{var d=o.call(this,u,c);return Uv(this,u,l),d}finally{this.on.__wrapped||Ot(this,"on",n),this.addListener.__wrapped||Ot(this,"addListener",n)}}}function i(o){return function(u){if(!this._events||!this._events[u])return o.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Yc(c,s)}}}Ot(this,"removeListener",l);try{return this._events[u]=Yc(c,s),o.apply(this,arguments)}finally{_s(this,"removeListener"),this._events[u]=c}}}e[qe]?typeof e[qe]=="function"?vs(e,qe,[e[qe],t]):Array.isArray(e[qe])&&e[qe].push(t):vs(e,qe,t),e.__wrapped||(Ot(e,"addListener",n),Ot(e,"on",n),Ot(e,"emit",i),vs(e,"__unwrap",function(){_s(e,"addListener"),_s(e,"on"),_s(e,"emit"),delete e[qe],delete e.__wrapped}),vs(e,"__wrapped",!0))}});var il=f((eR,nl)=>{"use strict";var A=require("util"),Me=require("assert"),jv=tl(),N=require("async_hooks"),gr="cls@contexts",yr="error@context",U=process.env.DEBUG_CLS_HOOKED,T=-1;nl.exports={getNamespace:rl,createNamespace:Gv,destroyNamespace:sl,reset:Wv,ERROR_SYMBOL:yr};function fe(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}fe.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,U){let s=" ".repeat(this._indent<0?0:this._indent);P(s+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+T+" active:"+A.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};fe.prototype.get=function(e){if(!this.active){if(U){let t=N.currentId(),s=N.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);P(`${n}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${T} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length}`)}return}if(U){let t=N.executionAsyncId(),s=N.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);P(n+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+T+" active:"+A.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),P(`${n}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${T} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} active:${A.inspect(this.active)}`)}return this.active[e]};fe.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=T,U){let t=N.executionAsyncId(),s=N.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);P(`${n}CONTEXT-CREATED Context: (${this.name}) currentUid:${T} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} context:${A.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};fe.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(U){let s=N.triggerAsyncId(),n=N.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);P(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${T} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} context:${A.inspect(t)}`)}return e(t),t}catch(s){throw s&&(s[yr]=t),s}finally{if(U){let s=N.triggerAsyncId(),n=N.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);P(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${T} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${A.inspect(t)}`)}this.exit(t)}};fe.prototype.runAndReturn=function(e){let t;return this.run(function(s){t=e(s)}),t};fe.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let s=e(t);if(!s||!s.then||!s.catch)throw new Error("fn must return a promise.");return U&&P("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+T+" len:"+this._set.length+" "+A.inspect(t)),s.then(n=>(U&&P("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+T+" len:"+this._set.length+" "+A.inspect(t)),this.exit(t),n)).catch(n=>{throw n[yr]=t,U&&P("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+T+" len:"+this._set.length+" "+A.inspect(t)),this.exit(t),n})};fe.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let s=this;return function(){s.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[yr]=t),i}finally{s.exit(t)}}};fe.prototype.enter=function(e){if(Me.ok(e,"context must be provided for entering"),U){let t=N.executionAsyncId(),s=N.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);P(`${n}CONTEXT-ENTER: (${this.name}) currentUid:${T} triggerId:${s} asyncHooksCurrentId:${t} len:${this._set.length} ${A.inspect(e)}`)}this._set.push(this.active),this.active=e};fe.prototype.exit=function(e){if(Me.ok(e,"context must be provided for exiting"),U){let s=N.executionAsyncId(),n=N.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);P(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${T} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${A.inspect(e)}`)}if(this.active===e){Me.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(U&&P("??ERROR?? context exiting but not entered - ignoring: "+A.inspect(e)),Me.ok(t>=0,`context not currently entered; can't exit. 
`+A.inspect(this)+`
`+A.inspect(e))):(Me.ok(t,"can't remove top context"),this._set.splice(t,1))};fe.prototype.bindEmitter=function(e){Me.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,s="context@"+this.name;function n(o){o&&(o[gr]||(o[gr]=Object.create(null)),o[gr][s]={namespace:t,context:t.active})}function i(o){if(!(o&&o[gr]))return o;let a=o,u=o[gr];return Object.keys(u).forEach(function(c){let l=u[c];a=l.namespace.bind(a,l.context)}),a}jv(e,n,i)};fe.prototype.fromException=function(e){return e[yr]};function rl(r){return process.namespaces[r]}function Gv(r){Me.ok(r,"namespace must be given a name."),U&&P(`NS-CREATING NAMESPACE (${r})`);let e=new fe(r);return e.id=T,N.createHook({init(s,n,i,o){if(T=N.executionAsyncId(),e.active){if(e._contexts.set(s,e.active),U){let a=" ".repeat(e._indent<0?0:e._indent);P(`${a}INIT [${n}] (${r}) asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(T===0){let a=N.triggerAsyncId(),u=e._contexts.get(a);if(u){if(e._contexts.set(s,u),U){let c=" ".repeat(e._indent<0?0:e._indent);P(`${c}INIT USING CONTEXT FROM TRIGGERID [${n}] (${r}) asyncId:${s} currentUid:${T} triggerId:${a} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}else if(U){let c=" ".repeat(e._indent<0?0:e._indent);P(`${c}INIT MISSING CONTEXT [${n}] (${r}) asyncId:${s} currentUid:${T} triggerId:${a} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}}if(U&&n==="PROMISE"){P(A.inspect(o,{showHidden:!0}));let a=o.parentId,u=" ".repeat(e._indent<0?0:e._indent);P(`${u}INIT RESOURCE-PROMISE [${n}] (${r}) parentId:${a} asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${o}`)}},before(s){T=N.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(T),n){if(U){let i=N.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);P(`${o}BEFORE (${r}) asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${A.inspect(n)}`),e._indent+=2}e.enter(n)}else if(U){let i=N.triggerAsyncId(),o=" ".repeat(e._indent<0?0:e._indent);P(`${o}BEFORE MISSING CONTEXT (${r}) asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${A.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(s){T=N.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(T),n){if(U){let i=N.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);P(`${o}AFTER (${r}) asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${A.inspect(n)}`)}e.exit(n)}else if(U){let i=N.triggerAsyncId();e._indent-=2;let o=" ".repeat(e._indent<0?0:e._indent);P(`${o}AFTER MISSING CONTEXT (${r}) asyncId:${s} currentUid:${T} triggerId:${i} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${A.inspect(n)}`)}},destroy(s){if(T=N.executionAsyncId(),U){let n=N.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);P(`${i}DESTROY (${r}) currentUid:${T} asyncId:${s} triggerId:${n} active:${A.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${A.inspect(e._contexts.get(T))}`)}e._contexts.delete(s)}}).enable(),process.namespaces[r]=e,e}function sl(r){let e=rl(r);Me.ok(e,`can't delete nonexistent namespace! "`+r+'"'),Me.ok(e.id,"don't assign to process.namespaces directly! "+A.inspect(e)),process.namespaces[r]=null}function Wv(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){sl(r)}),process.namespaces=Object.create(null)}process.namespaces={};function P(...r){U&&process._rawDebug(`${A.format(...r)}`)}});var D=f((tR,ul)=>{"use strict";var $i=["debug","info","warn","error","silent"],ol=$i.indexOf("error"),Vv=Qv(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),al={error:Ss("error"),info:Ss("info"),warn:Ss("warn"),debug:Ss("debug")};function Ss(r){var e=$i.indexOf(r),t=console[r]||console.log||(()=>{});return e>=Vv?(s,n)=>{(s||n)&&t(Kv(r,s,n))}:()=>{}}function Qv(r){if(r){var e=r.toLowerCase(),t=$i.indexOf(e);return t>=0?t:ol}return ol}function Hv(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",s=function(n){var i=Math.floor(Math.abs(n));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+s(e/60)+":"+s(e%60)}function Xv(){return process.env.LAMBDA_TASK_ROOT!==void 0}function Kv(r,e,t){var s=[];Xv()||(s.push(Hv(new Date)),s.push(`[${r.toUpperCase()}]`)),e&&s.push(e);var n=s.join(" "),i=zv(t);return[n,i].filter(o=>o.length>0).join(`
  `)}function zv(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var Yv={setLogger:function(e){al=e},getLogger:function(){return al}};ul.exports=Yv});var Bi=f((rR,ll)=>{"use strict";var Jv=require("crypto");function cl(r,e){this.init(r,e)}cl.prototype.init=function(e,t){var s=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=s.message,this.type=s.name,this.stack=[],this.remote=!!t,this.id=Jv.randomBytes(8).toString("hex"),s.stack){var n=s.stack.split(`
`);n.shift(),n.forEach(i=>{var o=i.trim().replace(/\(|\)/g,"");o=o.substring(o.indexOf(" ")+1);var a=o.lastIndexOf(" ")>=0?o.slice(0,o.lastIndexOf(" ")):null,u=Array.isArray(a)&&!a.length?o:o.slice(o.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:a||"anonymous"};this.stack.push(c)},this)}};ll.exports=cl});var fl=f((sR,dl)=>{dl.exports=Zv;function Zv(r){var e=!1,t=null,s=null,n=null;return o;function i(a){n&&rS(n,a),e=!1,n=s;var u=t;if(t=null,s=null,!u||!u.length){if(!n||!n.length){n=null;return}u||(u=[])}e=!0,r(u,i)}function o(a,u){e?(t||(t=[],s=[]),eS(t,a),u&&s.push(u)):(u&&(n=[u]),e=!0,r(Array.isArray(a)?a:[a],i))}}function eS(r,e){Array.isArray(e)?tS(r,e):r.push(e)}function tS(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function rS(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Es=f((nR,ml)=>{"use strict";var hl=D(),Se={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?hl.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(pl(e),hl.getLogger().info("Configured daemon address to "+e+"."))}},pl=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var s=e.split(":");if(!s[0])throw new Error("Invalid Daemon Address. You must specify an ip.");Se.udp_ip=s[0],Se.tcp_ip=s[0],Se.udp_port=s[1],Se.tcp_port=s[1]}else if(t.length===2){var n=t[0].split(":"),i=t[1].split(":"),o={};if(o[n[0]]=n,o[i[0]]=i,Se.udp_ip=o.udp[1],Se.udp_port=parseInt(o.udp[2]),Se.tcp_ip=o.tcp[1],Se.tcp_port=parseInt(o.tcp[2]),!Se.udp_port||!Se.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&pl(process.env.AWS_XRAY_DAEMON_ADDRESS);ml.exports=Se});var ws=f((iR,El)=>{"use strict";var _l=require("dgram"),sS=fl(),bs=D(),gl='{"format":"json","version":1}',yl=`
`;function nS(r,e){var t=_l.createSocket("udp4");vl(t,r,0,function(){try{t.close()}finally{e()}})}function vl(r,e,t,s){if(t>=e.length){s();return}iS(r,e[t],function(){vl(r,e,t+1,s)})}function iS(r,e,t){var s=e.msg,n=e.offset,i=e.length,o=e.port,a=e.address,u=e.callback;r.send(s,n,i,o,a,function(c){try{u(c)}finally{t()}})}function Sl(){this.batchSend=sS(nS)}Sl.prototype.send=function(r,e,t,s,n,i){var o={msg:r,offset:e,length:t,port:s,address:n,callback:i};this.batchSend(o)};var oS={daemonConfig:Es(),format:function(e){return gl+yl+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new Sl:this.socket=_l.createSocket("udp4").unref());var t=this.socket,s=e.format(),n=gl+yl+s,i=Buffer.from(n),o='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',a=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?bs.getLogger().error(a+" too large to send: "+o+" ("+i.length+" bytes)."):bs.getLogger().error("Error occured sending segment: ",u):(bs.getLogger().debug(a+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),bs.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};El.exports=oS});var As=f((oR,bl)=>{"use strict";var aS=require("crypto"),Ts=D(),Fi=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||aS.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var s=new r,n,i;if(!e||typeof e!="string")return Ts.getLogger().error("Empty or non-string trace ID provided"),s;let o=e.trim().split(t);return o.length!==3?(Ts.getLogger().error("Unrecognized trace ID format"),s):(n=parseInt(o[0]),isNaN(n)||n<1?(Ts.getLogger().error("Trace ID version must be positive integer"),s):(i=parseInt(o[1],16).toString(16),i==="NaN"?(Ts.getLogger().error("Trace ID timestamp must be a hex-encoded value"),s):(i=i.padStart(8,"0"),s.version=n,s.timestamp=i,s.id=o[2],s)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};bl.exports=Fi});var K=f((aR,wl)=>{"use strict";var uS=require("crypto"),_r=D(),cS=As(),Ui={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var s=e.length,n=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===s-1){var o=function(){for(var m=0,h=0;h<s;h++){var E=e.charAt(h);if(E==="*")return!0;if(E==="?"){if(m===n)return!1;m++}else{if(m>=n||E!=t.charAt(m))return!1;m++}}return m===n};return o()}var a=[];a[0]=!0;for(var u=0;u<s;u++){var c,l=e.charAt(u);if(l!="*")for(c=n-1;c>=0;c--)a[c+1]=!!a[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=n&&!a[c];)c++;for(c;c<=n;c++)a[c]=!0}a[0]=a[0]&&l==="*"}return a[n]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=Ui.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){_r.getLogger().debug("Lambda trace data found: "+e);let t=Ui.processTraceData(e);var s=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,s=!0):!t.root||!t.parent||!t.sampled?_r.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):s=!0:(t={},_r.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=cS.FromString(t.root).toString(),r.id=t.parent||uS.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(_r.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),s=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),_r.getLogger().debug("Segment started: "+JSON.stringify(t)),s}},processTraceData:function(e){var t={},s={},n=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(o){if(o){var a=o.split("=");if(a[0]&&a[1]){let u=a[0].trim(),c=a[1].trim(),l=u.toLowerCase(),d=n.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(s[u]=c,i-=u.length+c.length)}}}),t.data=s),t},objectWithoutProperties:function(e,t,s){t=Array.isArray(t)?t:[],s=typeof s=="boolean"?s:!1;var n=s?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};wl.exports=Ui});var We=f((uR,Cl)=>{"use strict";var{safeParseInt:Tl}=K(),Al=D(),lS=100,ji={streamingThreshold:lS,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(ji.streamingThreshold=e,Al.getLogger().debug("Subsegment streaming threshold set to: "+e)):Al.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return ji.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=Tl(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=Tl(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};Cl.exports=ji});var Ll=f((cR,Il)=>{"use strict";var{getHttpResponseData:dS}=We(),{stripQueryStringFromPath:fS}=K();function Rl(r,e,t){this.init(r,e,t)}Rl.prototype.init=function(e,t,s){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+fS(e.path):"",method:e.method||""},s&&(this.request.traced=!0),t&&(this.response=dS(t))};Il.exports=Rl});var vr=f((lR,Ol)=>{"use strict";var hS=require("crypto"),pS=Bi(),mS=Ll(),gS=ws(),Cs=We(),yS=K(),Pe=D();function C(r){this.init(r)}C.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=hS.randomBytes(8).toString("hex"),this.name=e,this.start_time=Cs.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};C.prototype.addNewSubsegment=function(e){let t=new C(e);return this.addSubsegment(t),t};C.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};C.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new C(e);return this.addSubsegment(t),t.notTraced=!0,t};C.prototype.addSubsegment=function(r){if(!(r instanceof C))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};C.prototype.removeSubsegment=function(e){if(!(e instanceof C))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};C.prototype.addAttribute=function(e,t){this[e]=t};C.prototype.addPrecursorId=function(r){typeof r!="string"&&Pe.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};C.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){Pe.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){Pe.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};C.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){Pe.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){Pe.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};C.prototype.addSqlData=function(e){this.sql=e};C.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){Pe.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new pS(e,t))};C.prototype.addRemoteRequestData=function(e,t,s){this.http=new mS(e,t,s),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};C.prototype.addFaultFlag=function(){this.fault=!0};C.prototype.addErrorFlag=function(){this.error=!0};C.prototype.addThrottleFlag=function(){this.throttle=!0};C.prototype.close=function(e,t){var s=this.segment;this.end_time=Cs.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),s&&s.counter>Cs.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};C.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};C.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};C.prototype.isClosed=function(){return!this.in_progress};C.prototype.flush=function(){if(!this.parent||!this.segment){Pe.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?gS.send(this):Pe.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):Pe.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};C.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};C.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};C.prototype.toString=function(){return this.serialize()};C.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=yS.objectWithoutProperties(this,e,!1);return t};C.prototype.serialize=function(e){return JSON.stringify(e??this,Cs.getJsonStringifyReplacer())};Ol.exports=C});var Sr=f((dR,ql)=>{"use strict";var _S=require("crypto"),vS=Bi(),SS=ws(),he=We(),Rs=vr(),xl=As(),Nl=K(),Ve=D();function O(r,e,t){this.init(r,e,t)}O.prototype.init=function(e,t,s){if(typeof e!="string")throw new Error("Segment name must be of type string.");var n;t&&typeof t=="string"?n=xl.FromString(t):n=new xl;var i=_S.randomBytes(8).toString("hex"),o=he.getCurrentTime();this.trace_id=n.toString(),this.id=i,this.start_time=o,this.name=e||"",this.in_progress=!0,this.counter=0,s&&(this.parent_id=s),he.serviceData&&this.setServiceData(he.serviceData),he.pluginData&&this.addPluginData(he.pluginData),he.origin&&(this.origin=he.origin),he.sdkData&&this.setSDKData(he.sdkData)};O.prototype.addIncomingRequestData=function(e){this.http=e};O.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){Ve.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){Ve.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};O.prototype.setUser=function(r){typeof r!="string"&&Ve.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};O.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){Ve.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){Ve.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};O.prototype.setSDKData=function(e){if(!e){Ve.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};O.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};O.prototype.setServiceData=function(e){if(!e){Ve.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};O.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};O.prototype.addNewSubsegment=function(e){var t=new Rs(e);return this.addSubsegment(t),t};O.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};O.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new Rs(e);return this.addSubsegment(t),t.notTraced=!0,t};O.prototype.addSubsegment=function(e){if(!(e instanceof Rs))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};O.prototype.removeSubsegment=function(e){if(!(e instanceof Rs))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};O.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){Ve.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new vS(e,t))};O.prototype.addFaultFlag=function(){this.fault=!0};O.prototype.addErrorFlag=function(){this.error=!0};O.prototype.addThrottleFlag=function(){this.throttle=!0};O.prototype.isClosed=function(){return!this.in_progress};O.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>he.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(s){s.streamSubsegments()||t.push(s)}),this.subsegments=t}};O.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};O.prototype.close=function(r,e){this.end_time||(this.end_time=he.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};O.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Nl.objectWithoutProperties(this,["counter","notTraced"],!0);SS.send(e)}};O.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=Nl.objectWithoutProperties(this,e,!1);return this.serialize(t)};O.prototype.toString=function(){return this.serialize()};O.prototype.serialize=function(e){return JSON.stringify(e??this,he.getJsonStringifyReplacer())};ql.exports=O});var He=f((fR,kl)=>{"use strict";var Er=il(),Ee=D(),Gi=Sr(),Ml=vr(),De=!0,Qe="AWSXRay",Pl="segment",Dl=!1,z={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);Ee.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!z.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,s=e.Segment,n=null;return t&&(t instanceof Gi||t instanceof Ml)?(n=t,delete e.XRaySegment,delete e.XraySegment):s&&(s instanceof Gi||s instanceof Ml)&&(n=s,delete e.Segment),n}},getNamespace:function(){return Er.getNamespace(Qe)||Er.createNamespace(Qe)},resolveSegment:function(e){if(De)return this.getSegment();if(e&&!De)return e;!e&&!De&&z.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(De){var e=z.getNamespace(Qe).get(Pl);return e?e instanceof Gi&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():z.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else z.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){De?z.getNamespace(Qe).set(Pl,e)||Ee.getLogger().warn("Failed to set the current sub/segment on the context."):z.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return De},enableAutomaticMode:function(){De=!0,z.getNamespace(Qe),Ee.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){De=!1,Er.getNamespace(Qe)&&Er.destroyNamespace(Qe),Ee.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Dl)Ee.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=z.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)z.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Ee.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Ee.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(z.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")z.contextMissingStrategy.contextMissing=e,Ee.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(De=!1,Ee.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(Er.createNamespace(Qe),Ee.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(z.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Dl=!0):(z.contextMissingStrategy.contextMissing=z.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Ee.getLogger().debug("Using default context missing strategy: LOG_ERROR"));kl.exports=z});var Vi=f((hR,$l)=>{"use strict";var{getHttpResponseData:ES}=We();function Wi(r){this.init(r)}Wi.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],s;e.connection&&(s=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:bS(e)||"",url:s||""},t&&(this.request.x_forwarded_for=t)};var bS=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};Wi.prototype.close=function(e){this.response=ES(e)};$l.exports=Wi});var Fl=f((pR,Bl)=>{"use strict";function Qi(r,e){this.init(r,e)}Qi.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};Qi.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Bl.exports=Qi});var Ul=f((mR,wS)=>{wS.exports={default:{fixed_target:1,rate:.05},version:2}});var Xi=f((gR,Ql)=>{"use strict";var TS=require("fs"),jl=Fl(),Hi=K(),AS=Ul(),Is=D(),Wl={shouldSample:function(e){var t=e.host,s=e.httpMethod,n=e.urlPath,i="{ http_method: "+s+", host: "+t+", url_path: "+n+" }",o;return this.rules.some(function(a){if(a.default||t==null||Hi.wildcardMatch(a.host,t)&&(s==null||Hi.wildcardMatch(a.http_method,s))&&(n==null||Hi.wildcardMatch(a.url_path,n)))return o=a.reservoir,Is.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(a.default?"default":"{ http_method: "+a.http_method+", host: "+a.host+", url_path: "+a.url_path+" }")+". Using fixed_target: "+o.fixedTarget+" and rate: "+o.fallbackRate+"."),!0}),o?o.isSampled():(Is.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Is.getLogger().info("Using custom sampling rules file: "+e),this.rules=Gl(JSON.parse(TS.readFileSync(e,"utf8")))):(Is.getLogger().info("Using custom sampling rules source."),this.rules=Gl(e)):this.rules=Vl(AS)}},Gl=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Vl(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Vl=function(e){var t,s=[];if(e.default){var n=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&n.push("fixed_target"),typeof e.default.rate>"u"&&n.push("rate"),n.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+n+".");t={default:!0,reservoir:new jl(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(o){var a={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in o){var l=o[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(a[c]=l),e.version===1&&c==="service_name"?a.host=l:a[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(o)+" is missing required attributes: "+Object.keys(u)+".");var d=a;d.reservoir=new jl(o.fixed_target,o.rate),s.push(d)}),s.push(t),s};Wl.setLocalRules();Ql.exports=Wl});var Xl=f((yR,Hl)=>{"use strict";function xt(){this.init()}xt.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};xt.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};xt.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};xt.prototype.loadNewQuota=function(e,t,s){e&&(this.quota=e),t&&(this.TTL=t),s&&(this.reportInterval=s/10)};xt.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Hl.exports=xt});var zl=f((_R,Kl)=>{"use strict";var br=K(),CS=Xl();function H(r,e,t,s,n,i,o,a,u){this.init(r,e,t,s,n,i,o,a,u)}H.prototype.init=function(e,t,s,n,i,o,a,u,c){this.name=e,this.priority=t,this.rate=s,this.host=i,this.httpMethod=o,this.urlPath=a,this.serviceName=u,this.serviceType=c,this.reservoir=new CS,this.borrow=!!n,this.resetStatistics()};H.prototype.match=function(e){var t=e.host,s=e.httpMethod,n=e.serviceName,i=e.urlPath,o=e.serviceType;return this.isDefault()||(!t||br.wildcardMatch(this.host,t))&&(!s||br.wildcardMatch(this.httpMethod,s))&&(!n||br.wildcardMatch(this.serviceName,n))&&(!i||br.wildcardMatch(this.urlPath,i))&&(!o||br.wildcardMatch(this.serviceType,o))};H.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};H.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};H.prototype.isDefault=function(){return this.name==="Default"};H.prototype.incrementRequestCount=function(){this.requestCount++};H.prototype.incrementBorrowCount=function(){this.borrowCount++};H.prototype.incrementSampledCount=function(){this.sampledCount++};H.prototype.setRate=function(e){this.rate=e};H.prototype.getRate=function(){return this.rate};H.prototype.getName=function(){return this.name};H.prototype.getPriority=function(){return this.priority};H.prototype.getReservoir=function(){return this.reservoir};H.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};H.prototype.canBorrow=function(){return this.borrow};H.prototype.everMatched=function(){return this.requestCount>0};H.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Kl.exports=H});var Ki=f((vR,ed)=>{"use strict";var RS=require("crypto"),IS=D(),LS=zl(),Ls=Es(),OS=require("util"),xS=require("http"),Jl={clientId:RS.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:IS,httpClient:xS,fetchSamplingRules:function(e){let t="{}",s=Yl(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,o=>{var a="";o.on("data",u=>{a+=u}),o.on("error",u=>{e(u)}),o.on("end",()=>{var u;try{u=JSON.parse(a)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=qS(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let s=JSON.stringify(NS(e)),n=Yl(this.samplingTargetsPath,s.length),o=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var u="";a.on("data",c=>{u+=c}),a.on("error",c=>{t(c)}),a.on("end",()=>{var c;try{c=JSON.parse(u)}catch(m){t(m);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=MS(c),d=Zl(c.LastRuleModification);t(null,l,d)})});o.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling targets.`))}),o.write(s),o.end()}},NS=function(e){var t=[],s=Math.floor(new Date().getTime()/1e3);return e.forEach(function(n){var i=n.snapshotStatistics(),o={RuleName:n.getName(),ClientID:Jl.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:s};t.push(o)}),{SamplingStatisticsDocuments:t}},qS=function(e){var t=[],s=e.SamplingRuleRecords||[];return s.forEach(function(n){if(n=n.SamplingRule,PS(n)){var i=new LS(n.RuleName,n.Priority,n.FixedRate,n.ReservoirSize,n.Host,n.HTTPMethod,n.URLPath,n.ServiceName,n.ServiceType);t.push(i)}}),t},MS=function(e){var t=e.SamplingTargetDocuments||[],s={};return t.forEach(function(n){var i={rate:n.FixedRate,quota:n.ReservoirQuota,TTL:Zl(n.ReservoirQuotaTTL),interval:n.Interval};s[n.RuleName]=i}),s},PS=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Zl=function(e){return new Date(e).getTime()/1e3},Yl=function(e,t){return{hostname:Ls.tcp_ip,port:Ls.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:OS.format("%s:%d",Ls.tcp_ip,Ls.tcp_port)}}};ed.exports=Jl});var Os=f((SR,td)=>{"use strict";var DS=3600,zi={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(kS(t))return null;var s;return this.rules.forEach(function(n){!s&&n.match(e)&&(s=n),n.isDefault()&&!s&&(s=n)}),s},loadRules:function(e){var t={};this.rules.forEach(function(s){t[s.getName()]=s}),this.rules=e,this.rules.forEach(function(s){var n=t[s.getName()];n&&s.merge(n)}),this.rules.sort(function(s,n){var i=s.getPriority()-n.getPriority();return i!==0?i:s.getName()>n.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var s=e[t.getName()];s&&(t.getReservoir().loadNewQuota(s.quota,s.TTL,s.interval),t.setRate(s.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},kS=function(e){return zi.getLastUpdated()?e>zi.getLastUpdated()+DS:!0};td.exports=zi});var Ji=f((ER,id)=>{"use strict";var Yi=D(),$S=Ki(),rd=Os(),BS=5*60*1e3,FS={start:function(){this.poller&&clearInterval(this.poller),sd(!1),this.poller=setInterval(sd,BS),this.poller.unref()}},sd=function(e){if(e=typeof e>"u"?!0:e,e){var t=jS();setTimeout(nd,t)}else nd()},nd=function(){try{US()}catch(e){Yi.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},US=function(){var e=Math.floor(new Date().getTime()/1e3);$S.fetchSamplingRules(function(t,s){t?Yi.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):s.length!==0&&(rd.loadRules(s),rd.timestamp(e),Yi.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},jS=function(){return Math.random()*5};id.exports=FS});var cd=f((bR,ud)=>{"use strict";var GS=Ji(),WS=Ki(),Zi=Os(),xs=D(),od=10*1e3,ad={interval:od,start:function(){this.poller=setInterval(VS,od+XS()),this.poller.unref()}},VS=function(){try{QS()}catch(e){xs.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},QS=function(){var e=HS();e&&e.length>0&&WS.fetchTargets(e,function(t,s,n){if(t){xs.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}Zi.loadTargets(s),n>Zi.getLastUpdated()&&(xs.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),GS.start()),xs.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},HS=function(){var e=Zi.getRules(),t=[];return e.forEach(function(s){s.everMatched()&&s.timeToReport()&&t.push(s)}),t},XS=function(){return Math.random()/ad.interval};ud.exports=ad});var dd=f((wR,ld)=>{"use strict";var eo=D(),KS=require("util"),zS=We(),YS={localSampler:Xi(),rulePoller:Ji(),targetPoller:cd(),ruleCache:Os(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=zS.origin);var t=Math.floor(new Date().getTime()/1e3),s=this.ruleCache.getMatchedRule(e,t);return s?(eo.getLogger().debug(KS.format("Rule %s is matched.",s.getName())),JS(s,t)):(eo.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(n){eo.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+n)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},JS=function(e,t){e.incrementRequestCount();var s=e.getReservoir(),n=!0,i=s.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():n=!1,n?e.getName():!1};ld.exports=YS});var ro=f((TR,fd)=>{"use strict";var ZS=Sr(),eE=Vi(),tE=D(),rE=K(),sE=K().wildcardMatch,nE=K().processTraceData,to="x-amzn-trace-id",iE=!!process.env.AWS_XRAY_TRACING_NAME,oE={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:dd(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[to]&&(t=nE(e.headers[to])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?sE(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,s){var n;if(e.sampled==="1")n=!0;else if(e.sampled==="0")n=!1;else{var i={host:s.req.headers.host,httpMethod:s.req.method,urlPath:s.req.url,serviceName:t.name};n=this.sampler.shouldSample(i),(n instanceof String||typeof n=="string")&&(t.setMatchedSamplingRule(n),n=!0)}e.sampled==="?"&&s.header&&s.header(to,"Root="+e.root+";Sampled="+(n?"1":"0")),n||(t.notTraced=!0)},setDefaultName:function(e){iE||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=Xi()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,s){tE.getLogger().debug(e+": { url: "+t+", name: "+s.name+", trace_id: "+s.trace_id+", id: "+s.id+", sampled: "+!s.notTraced+" }")},traceRequestResponseCycle:function(e,t){var s=this.processHeaders(e),n=this.resolveName(e.headers.host),i=new ZS(n,s.root,s.parent);t.req||(t.req=e),this.resolveSampling(s,i,t),i.addIncomingRequestData(new eE(e)),this.middlewareLog("Starting middleware segment",e.url,i);var o=this.middlewareLog,a=!1,u=function(){if(a)return;a=!0,t.statusCode===429&&i.addThrottleFlag();let c=rE.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),o("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};fd.exports=oE});var hd=f(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.InvokeStore=void 0;var aE=require("async_hooks"),so=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";so||(globalThis.awslambda=globalThis.awslambda||{});var uE={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},wr=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let s=this.storage.getStore();s&&(s[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};v(wr,"storage",new aE.AsyncLocalStorage),v(wr,"PROTECTED_KEYS",uE);var Ns;!so&&globalThis.awslambda?.InvokeStore?Ns=globalThis.awslambda.InvokeStore:(Ns=wr,!so&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=Ns));qs.InvokeStore=Ns});var gd=f((RR,md)=>{"use strict";var Ms=He(),cE=ro(),no=K().LambdaUtils,lE=Sr(),dE=ws(),fE=We(),oo=D(),pd=As(),{InvokeStore:hE}=hd(),io=null;md.exports.init=function(){Ms.enableManualMode=function(){oo.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},dE.disableReusableSocket(),fE.setStreamingThreshold(0),oo.getLogger().info("Disabling centralized sampling in Lambda environment."),cE.disableCentralizedSampling();var e=Ms.getNamespace();e.enter(e.createContext()),Ms.setSegment(pE())};var pE=function(){var e=new lE("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],s=["incrementCounter","decrementCounter","isClosed","close","format","flush"],n=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(s.indexOf(i)===-1?e[i]=function(){var o=i;return function(){oo.getLogger().warn('Function "'+o+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=pd.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=pd.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let a=hE.getXRayTraceId(),u=process.env._X_AMZN_TRACE_ID;var c=a??u;c?c!=io&&(this.reset(),no.populateTraceData(e,c)&&(io=c)):(this.reset(),Ms.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},no.validTraceData(n)&&no.populateTraceData(e,n)&&(io=n),e}});var yd=f((IR,mE)=>{mE.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var Sd=f((LR,vd)=>{"use strict";var ao=require("http"),_d={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var n=5,i=function(){var o=ao.__request?ao.__request:ao.request,a=o(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else n>0&&Math.floor(this.statusCode/100)===5?(n--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});a.on("error",function(u){e(u)}),a.on("timeout",function(){a.abort()}),a.setTimeout(_d.METADATA_TIMEOUT),a.end()};i()}};vd.exports=_d});var Ad=f((OR,Td)=>{"use strict";var bd=Sd(),Ed=D(),uo=require("http"),gE={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(s){let n=wd(e,"GET",s?{"X-aws-ec2-metadata-token":s}:{});bd.getPluginMetadata(n,function(i,o){if(i||!o){Ed.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let a={ec2:{instance_id:o.instanceId,availability_zone:o.availabilityZone,instance_size:o.instanceType,ami_id:o.imageId}};r(a)})}yE(function(s){s===null&&Ed.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(s)})},originName:"AWS::EC2::Instance"};function yE(r){let e=uo.__request?uo.__request:uo.request,n=wd("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(n,function(o){let a="";o.on("data",function(u){a+=u}),o.on("end",function(){this.statusCode===200||this.statusCode===300?r(a):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(bd.METADATA_TIMEOUT),i.end()}function wd(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}Td.exports=gE});var Rd=f((xR,Cd)=>{"use strict";var _E=require("os"),vE={getData:function(r){r({ecs:{container:_E.hostname()}})},originName:"AWS::ECS::Container"};Cd.exports=vE});var Ld=f((NR,Id)=>{"use strict";var SE=require("fs"),EE=D(),bE="/var/elasticbeanstalk/xray/environment.conf",wE={getData:function(r){SE.readFile(bE,"utf8",function(e,t){if(e)EE.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var s=JSON.parse(t),n={elastic_beanstalk:{environment:s.environment_name,version_label:s.version_label,deployment_id:s.deployment_id}};r(n)}})},originName:"AWS::ElasticBeanstalk::Environment"};Id.exports=wE});var Od=f((qR,TE)=>{TE.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Dd=f((MR,Pd)=>{"use strict";var qd=require("fs"),Nt=D(),AE=Od(),Ps={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function ks(r){this.init(r)}ks.prototype.init=function(e){e?typeof e=="string"?(Nt.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Ds(JSON.parse(qd.readFileSync(e,"utf8")))):(Nt.getLogger().info("Using custom AWS whitelist source."),this.services=Ds(e)):this.services=AE.services};ks.prototype.append=function(e){var t={};typeof e=="string"?(Nt.getLogger().info("Appending AWS whitelist with custom file: "+e),t=Ds(JSON.parse(qd.readFileSync(e,"utf8")))):(Nt.getLogger().info("Appending AWS whitelist with a custom source."),t=Ds(e));for(var s in t)this.services[s]=t[s]};ks.prototype.capture=function(e,t){var s=t.request.operation,n=this.services[e]!==void 0?this.services[e].operations[s]:null;if(n===null){Nt.getLogger().debug('Call "'+e+"."+s+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var o in n){var a=n[o];o===Ps.REQ_PARAMS?xd(a,t.request.params,i):o===Ps.REQ_DESC?Nd(a,t.request.params,i):o===Ps.RES_PARAMS?t.data&&xd(a,t.data,i):o===Ps.RES_DESC?t.data&&Nd(a,t.data,i):Nt.getLogger().error('Unknown parameter type "'+o+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function xd(r,e,t){r.forEach(function(s){if(typeof e[s]<"u"){var n=Md(s);this[n]=e[s]}},t)}function Nd(r,e,t){for(var s in r){var n=r[s];if(typeof e[s]<"u"){var i;if(n.list&&n.get_count?i=e[s]?e[s].length:0:i=n.get_keys===!0?Object.keys(e[s]):e[s],typeof n.rename_to=="string")t[n.rename_to]=i;else{var o=Md(s);t[o]=i}}}}function Md(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function Ds(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Pd.exports=ks});var Tr=f((PR,$s)=>{"use strict";var kd=Dd(),co=new kd;function lo(r,e){this.init(r,e)}lo.prototype.init=function(e,t){this.operation=IE(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(co.capture(t.toLowerCase(),e))};lo.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var CE=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");co=new kd(e)},RE=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");co.append(e)};function IE(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}$s.exports=lo;$s.exports.appendAWSWhitelist=RE;$s.exports.setAWSWhitelist=CE});var Fs=f((DR,Bs)=>{"use strict";var nt=He(),Ar=D(),$d=function(e,t,s){fo(e,t);var n,i,o=nt.resolveSegment(s);if(!o)return Ar.getLogger().warn("Failed to capture function."),t();n=o.addNewSubsegment(e),i=Bd(t,n);try{let a=i(n);return n.close(),a}catch(a){throw n.close(a),a}},LE=function(e,t,s){fo(e,t);var n,i,o=nt.resolveSegment(s);if(!o)return Ar.getLogger().warn("Failed to capture async function."),t();n=o.addNewSubsegment(e),i=Bd(t,n);try{return i(n)}catch(a){throw n.close(a),a}},OE=function(e,t,s){fo(e,t);var n=nt.resolveSegment(s);return n?(n.incrementCounter(),function(){var i=nt.resolveSegment(s),o=Array.prototype.slice.call(arguments);$d(e,t.bind.apply(t,[null].concat(o)),i),n.decrementCounter()}.bind(this)):(Ar.getLogger().warn("Failed to capture callback function."),t)};function Bd(r,e){var t;if(nt.isAutomaticMode()){var s=nt.getNamespace(),n=function(){var i;return s.run(function(){nt.setSegment(e),i=r(e)}),i};t=n}else t=r;return t}function fo(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',Ar.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',Ar.getLogger().error(t),new Error(t)}Bs.exports.captureFunc=$d;Bs.exports.captureAsyncFunc=LE;Bs.exports.captureCallbackFunc=OE});var Cr=f((kR,Fd)=>{"use strict";var xE="2.0.0",NE=Number.MAX_SAFE_INTEGER||9007199254740991,qE=16,ME=250,PE=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Fd.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:qE,MAX_SAFE_BUILD_LENGTH:ME,MAX_SAFE_INTEGER:NE,RELEASE_TYPES:PE,SEMVER_SPEC_VERSION:xE,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Rr=f(($R,Ud)=>{"use strict";var DE=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Ud.exports=DE});var qt=f((Te,jd)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:ho,MAX_SAFE_BUILD_LENGTH:kE,MAX_LENGTH:$E}=Cr(),BE=Rr();Te=jd.exports={};var FE=Te.re=[],UE=Te.safeRe=[],g=Te.src=[],jE=Te.safeSrc=[],y=Te.t={},GE=0,po="[a-zA-Z0-9-]",WE=[["\\s",1],["\\d",$E],[po,kE]],VE=r=>{for(let[e,t]of WE)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},S=(r,e,t)=>{let s=VE(e),n=GE++;BE(r,n,e),y[r]=n,g[n]=e,jE[n]=s,FE[n]=new RegExp(e,t?"g":void 0),UE[n]=new RegExp(s,t?"g":void 0)};S("NUMERICIDENTIFIER","0|[1-9]\\d*");S("NUMERICIDENTIFIERLOOSE","\\d+");S("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${po}*`);S("MAINVERSION",`(${g[y.NUMERICIDENTIFIER]})\\.(${g[y.NUMERICIDENTIFIER]})\\.(${g[y.NUMERICIDENTIFIER]})`);S("MAINVERSIONLOOSE",`(${g[y.NUMERICIDENTIFIERLOOSE]})\\.(${g[y.NUMERICIDENTIFIERLOOSE]})\\.(${g[y.NUMERICIDENTIFIERLOOSE]})`);S("PRERELEASEIDENTIFIER",`(?:${g[y.NONNUMERICIDENTIFIER]}|${g[y.NUMERICIDENTIFIER]})`);S("PRERELEASEIDENTIFIERLOOSE",`(?:${g[y.NONNUMERICIDENTIFIER]}|${g[y.NUMERICIDENTIFIERLOOSE]})`);S("PRERELEASE",`(?:-(${g[y.PRERELEASEIDENTIFIER]}(?:\\.${g[y.PRERELEASEIDENTIFIER]})*))`);S("PRERELEASELOOSE",`(?:-?(${g[y.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${g[y.PRERELEASEIDENTIFIERLOOSE]})*))`);S("BUILDIDENTIFIER",`${po}+`);S("BUILD",`(?:\\+(${g[y.BUILDIDENTIFIER]}(?:\\.${g[y.BUILDIDENTIFIER]})*))`);S("FULLPLAIN",`v?${g[y.MAINVERSION]}${g[y.PRERELEASE]}?${g[y.BUILD]}?`);S("FULL",`^${g[y.FULLPLAIN]}$`);S("LOOSEPLAIN",`[v=\\s]*${g[y.MAINVERSIONLOOSE]}${g[y.PRERELEASELOOSE]}?${g[y.BUILD]}?`);S("LOOSE",`^${g[y.LOOSEPLAIN]}$`);S("GTLT","((?:<|>)?=?)");S("XRANGEIDENTIFIERLOOSE",`${g[y.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);S("XRANGEIDENTIFIER",`${g[y.NUMERICIDENTIFIER]}|x|X|\\*`);S("XRANGEPLAIN",`[v=\\s]*(${g[y.XRANGEIDENTIFIER]})(?:\\.(${g[y.XRANGEIDENTIFIER]})(?:\\.(${g[y.XRANGEIDENTIFIER]})(?:${g[y.PRERELEASE]})?${g[y.BUILD]}?)?)?`);S("XRANGEPLAINLOOSE",`[v=\\s]*(${g[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${g[y.XRANGEIDENTIFIERLOOSE]})(?:${g[y.PRERELEASELOOSE]})?${g[y.BUILD]}?)?)?`);S("XRANGE",`^${g[y.GTLT]}\\s*${g[y.XRANGEPLAIN]}$`);S("XRANGELOOSE",`^${g[y.GTLT]}\\s*${g[y.XRANGEPLAINLOOSE]}$`);S("COERCEPLAIN",`(^|[^\\d])(\\d{1,${ho}})(?:\\.(\\d{1,${ho}}))?(?:\\.(\\d{1,${ho}}))?`);S("COERCE",`${g[y.COERCEPLAIN]}(?:$|[^\\d])`);S("COERCEFULL",g[y.COERCEPLAIN]+`(?:${g[y.PRERELEASE]})?(?:${g[y.BUILD]})?(?:$|[^\\d])`);S("COERCERTL",g[y.COERCE],!0);S("COERCERTLFULL",g[y.COERCEFULL],!0);S("LONETILDE","(?:~>?)");S("TILDETRIM",`(\\s*)${g[y.LONETILDE]}\\s+`,!0);Te.tildeTrimReplace="$1~";S("TILDE",`^${g[y.LONETILDE]}${g[y.XRANGEPLAIN]}$`);S("TILDELOOSE",`^${g[y.LONETILDE]}${g[y.XRANGEPLAINLOOSE]}$`);S("LONECARET","(?:\\^)");S("CARETTRIM",`(\\s*)${g[y.LONECARET]}\\s+`,!0);Te.caretTrimReplace="$1^";S("CARET",`^${g[y.LONECARET]}${g[y.XRANGEPLAIN]}$`);S("CARETLOOSE",`^${g[y.LONECARET]}${g[y.XRANGEPLAINLOOSE]}$`);S("COMPARATORLOOSE",`^${g[y.GTLT]}\\s*(${g[y.LOOSEPLAIN]})$|^$`);S("COMPARATOR",`^${g[y.GTLT]}\\s*(${g[y.FULLPLAIN]})$|^$`);S("COMPARATORTRIM",`(\\s*)${g[y.GTLT]}\\s*(${g[y.LOOSEPLAIN]}|${g[y.XRANGEPLAIN]})`,!0);Te.comparatorTrimReplace="$1$2$3";S("HYPHENRANGE",`^\\s*(${g[y.XRANGEPLAIN]})\\s+-\\s+(${g[y.XRANGEPLAIN]})\\s*$`);S("HYPHENRANGELOOSE",`^\\s*(${g[y.XRANGEPLAINLOOSE]})\\s+-\\s+(${g[y.XRANGEPLAINLOOSE]})\\s*$`);S("STAR","(<|>)?=?\\s*\\*");S("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");S("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Us=f((BR,Gd)=>{"use strict";var QE=Object.freeze({loose:!0}),HE=Object.freeze({}),XE=r=>r?typeof r!="object"?QE:r:HE;Gd.exports=XE});var mo=f((FR,Qd)=>{"use strict";var Wd=/^[0-9]+$/,Vd=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Wd.test(r),s=Wd.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},KE=(r,e)=>Vd(e,r);Qd.exports={compareIdentifiers:Vd,rcompareIdentifiers:KE}});var Y=f((UR,Xd)=>{"use strict";var js=Rr(),{MAX_LENGTH:Hd,MAX_SAFE_INTEGER:Gs}=Cr(),{safeRe:Ws,t:Vs}=qt(),zE=Us(),{compareIdentifiers:go}=mo(),yo=class r{constructor(e,t){if(t=zE(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Hd)throw new TypeError(`version is longer than ${Hd} characters`);js("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?Ws[Vs.LOOSE]:Ws[Vs.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Gs||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Gs||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Gs||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<Gs)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(js("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(js("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return go(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(js("build compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return go(s,n)}while(++t)}inc(e,t,s){if(e.startsWith("pre")){if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?Ws[Vs.PRERELEASELOOSE]:Ws[Vs.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),go(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Xd.exports=yo});var it=f((jR,zd)=>{"use strict";var Kd=Y(),YE=(r,e,t=!1)=>{if(r instanceof Kd)return r;try{return new Kd(r,e)}catch(s){if(!t)return null;throw s}};zd.exports=YE});var Jd=f((GR,Yd)=>{"use strict";var JE=it(),ZE=(r,e)=>{let t=JE(r,e);return t?t.version:null};Yd.exports=ZE});var ef=f((WR,Zd)=>{"use strict";var eb=it(),tb=(r,e)=>{let t=eb(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Zd.exports=tb});var sf=f((VR,rf)=>{"use strict";var tf=Y(),rb=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new tf(r instanceof tf?r.version:r,t).inc(e,s,n).version}catch{return null}};rf.exports=rb});var af=f((QR,of)=>{"use strict";var nf=it(),sb=(r,e)=>{let t=nf(r,null,!0),s=nf(e,null,!0),n=t.compare(s);if(n===0)return null;let i=n>0,o=i?t:s,a=i?s:t,u=!!o.prerelease.length;if(!!a.prerelease.length&&!u){if(!a.patch&&!a.minor)return"major";if(a.compareMain(o)===0)return a.minor&&!a.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};of.exports=sb});var cf=f((HR,uf)=>{"use strict";var nb=Y(),ib=(r,e)=>new nb(r,e).major;uf.exports=ib});var df=f((XR,lf)=>{"use strict";var ob=Y(),ab=(r,e)=>new ob(r,e).minor;lf.exports=ab});var hf=f((KR,ff)=>{"use strict";var ub=Y(),cb=(r,e)=>new ub(r,e).patch;ff.exports=cb});var mf=f((zR,pf)=>{"use strict";var lb=it(),db=(r,e)=>{let t=lb(r,e);return t&&t.prerelease.length?t.prerelease:null};pf.exports=db});var pe=f((YR,yf)=>{"use strict";var gf=Y(),fb=(r,e,t)=>new gf(r,t).compare(new gf(e,t));yf.exports=fb});var vf=f((JR,_f)=>{"use strict";var hb=pe(),pb=(r,e,t)=>hb(e,r,t);_f.exports=pb});var Ef=f((ZR,Sf)=>{"use strict";var mb=pe(),gb=(r,e)=>mb(r,e,!0);Sf.exports=gb});var Qs=f((eI,wf)=>{"use strict";var bf=Y(),yb=(r,e,t)=>{let s=new bf(r,t),n=new bf(e,t);return s.compare(n)||s.compareBuild(n)};wf.exports=yb});var Af=f((tI,Tf)=>{"use strict";var _b=Qs(),vb=(r,e)=>r.sort((t,s)=>_b(t,s,e));Tf.exports=vb});var Rf=f((rI,Cf)=>{"use strict";var Sb=Qs(),Eb=(r,e)=>r.sort((t,s)=>Sb(s,t,e));Cf.exports=Eb});var Ir=f((sI,If)=>{"use strict";var bb=pe(),wb=(r,e,t)=>bb(r,e,t)>0;If.exports=wb});var Hs=f((nI,Lf)=>{"use strict";var Tb=pe(),Ab=(r,e,t)=>Tb(r,e,t)<0;Lf.exports=Ab});var _o=f((iI,Of)=>{"use strict";var Cb=pe(),Rb=(r,e,t)=>Cb(r,e,t)===0;Of.exports=Rb});var vo=f((oI,xf)=>{"use strict";var Ib=pe(),Lb=(r,e,t)=>Ib(r,e,t)!==0;xf.exports=Lb});var Xs=f((aI,Nf)=>{"use strict";var Ob=pe(),xb=(r,e,t)=>Ob(r,e,t)>=0;Nf.exports=xb});var Ks=f((uI,qf)=>{"use strict";var Nb=pe(),qb=(r,e,t)=>Nb(r,e,t)<=0;qf.exports=qb});var So=f((cI,Mf)=>{"use strict";var Mb=_o(),Pb=vo(),Db=Ir(),kb=Xs(),$b=Hs(),Bb=Ks(),Fb=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Mb(r,t,s);case"!=":return Pb(r,t,s);case">":return Db(r,t,s);case">=":return kb(r,t,s);case"<":return $b(r,t,s);case"<=":return Bb(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};Mf.exports=Fb});var Df=f((lI,Pf)=>{"use strict";var Ub=Y(),jb=it(),{safeRe:zs,t:Ys}=qt(),Gb=(r,e)=>{if(r instanceof Ub)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?zs[Ys.COERCEFULL]:zs[Ys.COERCE]);else{let u=e.includePrerelease?zs[Ys.COERCERTLFULL]:zs[Ys.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let s=t[2],n=t[3]||"0",i=t[4]||"0",o=e.includePrerelease&&t[5]?`-${t[5]}`:"",a=e.includePrerelease&&t[6]?`+${t[6]}`:"";return jb(`${s}.${n}.${i}${o}${a}`,e)};Pf.exports=Gb});var $f=f((dI,kf)=>{"use strict";var Eo=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(e,t)}return this}};kf.exports=Eo});var me=f((fI,jf)=>{"use strict";var Wb=/\s+/g,bo=class r{constructor(e,t){if(t=Qb(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof wo)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Wb," "),this.set=this.raw.split("||").map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let s=this.set[0];if(this.set=this.set.filter(n=>!Ff(n[0])),this.set.length===0)this.set=[s];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&Zb(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let s=0;s<t.length;s++)s>0&&(this.formatted+=" "),this.formatted+=t[s].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let s=((this.options.includePrerelease&&Yb)|(this.options.loose&&Jb))+":"+e,n=Bf.get(s);if(n)return n;let i=this.options.loose,o=i?te[J.HYPHENRANGELOOSE]:te[J.HYPHENRANGE];e=e.replace(o,c0(this.options.includePrerelease)),q("hyphen replace",e),e=e.replace(te[J.COMPARATORTRIM],Xb),q("comparator trim",e),e=e.replace(te[J.TILDETRIM],Kb),q("tilde trim",e),e=e.replace(te[J.CARETTRIM],zb),q("caret trim",e);let a=e.split(" ").map(d=>e0(d,this.options)).join(" ").split(/\s+/).map(d=>u0(d,this.options));i&&(a=a.filter(d=>(q("loose invalid filter",d,this.options),!!d.match(te[J.COMPARATORLOOSE])))),q("range list",a);let u=new Map,c=a.map(d=>new wo(d,this.options));for(let d of c){if(Ff(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return Bf.set(s,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>Uf(s,t)&&e.set.some(n=>Uf(n,t)&&s.every(i=>n.every(o=>i.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Hb(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(l0(this.set[t],e,this.options))return!0;return!1}};jf.exports=bo;var Vb=$f(),Bf=new Vb,Qb=Us(),wo=Lr(),q=Rr(),Hb=Y(),{safeRe:te,t:J,comparatorTrimReplace:Xb,tildeTrimReplace:Kb,caretTrimReplace:zb}=qt(),{FLAG_INCLUDE_PRERELEASE:Yb,FLAG_LOOSE:Jb}=Cr(),Ff=r=>r.value==="<0.0.0-0",Zb=r=>r.value==="",Uf=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(i=>n.intersects(i,e)),n=s.pop();return t},e0=(r,e)=>(r=r.replace(te[J.BUILD],""),q("comp",r,e),r=s0(r,e),q("caret",r),r=t0(r,e),q("tildes",r),r=i0(r,e),q("xrange",r),r=a0(r,e),q("stars",r),r),re=r=>!r||r.toLowerCase()==="x"||r==="*",t0=(r,e)=>r.trim().split(/\s+/).map(t=>r0(t,e)).join(" "),r0=(r,e)=>{let t=e.loose?te[J.TILDELOOSE]:te[J.TILDE];return r.replace(t,(s,n,i,o,a)=>{q("tilde",r,s,n,i,o,a);let u;return re(n)?u="":re(i)?u=`>=${n}.0.0 <${+n+1}.0.0-0`:re(o)?u=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:a?(q("replaceTilde pr",a),u=`>=${n}.${i}.${o}-${a} <${n}.${+i+1}.0-0`):u=`>=${n}.${i}.${o} <${n}.${+i+1}.0-0`,q("tilde return",u),u})},s0=(r,e)=>r.trim().split(/\s+/).map(t=>n0(t,e)).join(" "),n0=(r,e)=>{q("caret",r,e);let t=e.loose?te[J.CARETLOOSE]:te[J.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,i,o,a,u)=>{q("caret",r,n,i,o,a,u);let c;return re(i)?c="":re(o)?c=`>=${i}.0.0${s} <${+i+1}.0.0-0`:re(a)?i==="0"?c=`>=${i}.${o}.0${s} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.0${s} <${+i+1}.0.0-0`:u?(q("replaceCaret pr",u),i==="0"?o==="0"?c=`>=${i}.${o}.${a}-${u} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}-${u} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a}-${u} <${+i+1}.0.0-0`):(q("no pr"),i==="0"?o==="0"?c=`>=${i}.${o}.${a}${s} <${i}.${o}.${+a+1}-0`:c=`>=${i}.${o}.${a}${s} <${i}.${+o+1}.0-0`:c=`>=${i}.${o}.${a} <${+i+1}.0.0-0`),q("caret return",c),c})},i0=(r,e)=>(q("replaceXRanges",r,e),r.split(/\s+/).map(t=>o0(t,e)).join(" ")),o0=(r,e)=>{r=r.trim();let t=e.loose?te[J.XRANGELOOSE]:te[J.XRANGE];return r.replace(t,(s,n,i,o,a,u)=>{q("xRange",r,s,n,i,o,a,u);let c=re(i),l=c||re(o),d=l||re(a),m=d;return n==="="&&m&&(n=""),u=e.includePrerelease?"-0":"",c?n===">"||n==="<"?s="<0.0.0-0":s="*":n&&m?(l&&(o=0),a=0,n===">"?(n=">=",l?(i=+i+1,o=0,a=0):(o=+o+1,a=0)):n==="<="&&(n="<",l?i=+i+1:o=+o+1),n==="<"&&(u="-0"),s=`${n+i}.${o}.${a}${u}`):l?s=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(s=`>=${i}.${o}.0${u} <${i}.${+o+1}.0-0`),q("xRange return",s),s})},a0=(r,e)=>(q("replaceStars",r,e),r.trim().replace(te[J.STAR],"")),u0=(r,e)=>(q("replaceGTE0",r,e),r.trim().replace(te[e.includePrerelease?J.GTE0PRE:J.GTE0],"")),c0=r=>(e,t,s,n,i,o,a,u,c,l,d,m)=>(re(s)?t="":re(n)?t=`>=${s}.0.0${r?"-0":""}`:re(i)?t=`>=${s}.${n}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,re(c)?u="":re(l)?u=`<${+c+1}.0.0-0`:re(d)?u=`<${c}.${+l+1}.0-0`:m?u=`<=${c}.${l}.${d}-${m}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),l0=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(q(r[s].semver),r[s].semver!==wo.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}});var Lr=f((hI,Xf)=>{"use strict";var Or=Symbol("SemVer ANY"),Co=class r{static get ANY(){return Or}constructor(e,t){if(t=Gf(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ao("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Or?this.value="":this.value=this.operator+this.semver.version,Ao("comp",this)}parse(e){let t=this.options.loose?Wf[Vf.COMPARATORLOOSE]:Wf[Vf.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new Qf(s[2],this.options.loose):this.semver=Or}toString(){return this.value}test(e){if(Ao("Comparator.test",e,this.options.loose),this.semver===Or||e===Or)return!0;if(typeof e=="string")try{e=new Qf(e,this.options)}catch{return!1}return To(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Hf(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Hf(this.value,t).test(e.semver):(t=Gf(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||To(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||To(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Xf.exports=Co;var Gf=Us(),{safeRe:Wf,t:Vf}=qt(),To=So(),Ao=Rr(),Qf=Y(),Hf=me()});var xr=f((pI,Kf)=>{"use strict";var d0=me(),f0=(r,e,t)=>{try{e=new d0(e,t)}catch{return!1}return e.test(r)};Kf.exports=f0});var Yf=f((mI,zf)=>{"use strict";var h0=me(),p0=(r,e)=>new h0(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));zf.exports=p0});var Zf=f((gI,Jf)=>{"use strict";var m0=Y(),g0=me(),y0=(r,e,t)=>{let s=null,n=null,i=null;try{i=new g0(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!s||n.compare(o)===-1)&&(s=o,n=new m0(s,t))}),s};Jf.exports=y0});var th=f((yI,eh)=>{"use strict";var _0=Y(),v0=me(),S0=(r,e,t)=>{let s=null,n=null,i=null;try{i=new v0(e,t)}catch{return null}return r.forEach(o=>{i.test(o)&&(!s||n.compare(o)===1)&&(s=o,n=new _0(s,t))}),s};eh.exports=S0});var nh=f((_I,sh)=>{"use strict";var Ro=Y(),E0=me(),rh=Ir(),b0=(r,e)=>{r=new E0(r,e);let t=new Ro("0.0.0");if(r.test(t)||(t=new Ro("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){let n=r.set[s],i=null;n.forEach(o=>{let a=new Ro(o.semver.version);switch(o.operator){case">":a.prerelease.length===0?a.patch++:a.prerelease.push(0),a.raw=a.format();case"":case">=":(!i||rh(a,i))&&(i=a);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${o.operator}`)}}),i&&(!t||rh(t,i))&&(t=i)}return t&&r.test(t)?t:null};sh.exports=b0});var oh=f((vI,ih)=>{"use strict";var w0=me(),T0=(r,e)=>{try{return new w0(r,e).range||"*"}catch{return null}};ih.exports=T0});var Js=f((SI,lh)=>{"use strict";var A0=Y(),ch=Lr(),{ANY:C0}=ch,R0=me(),I0=xr(),ah=Ir(),uh=Hs(),L0=Ks(),O0=Xs(),x0=(r,e,t,s)=>{r=new A0(r,s),e=new R0(e,s);let n,i,o,a,u;switch(t){case">":n=ah,i=L0,o=uh,a=">",u=">=";break;case"<":n=uh,i=O0,o=ah,a="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(I0(r,e,s))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,m=null;if(l.forEach(h=>{h.semver===C0&&(h=new ch(">=0.0.0")),d=d||h,m=m||h,n(h.semver,d.semver,s)?d=h:o(h.semver,m.semver,s)&&(m=h)}),d.operator===a||d.operator===u||(!m.operator||m.operator===a)&&i(r,m.semver))return!1;if(m.operator===u&&o(r,m.semver))return!1}return!0};lh.exports=x0});var fh=f((EI,dh)=>{"use strict";var N0=Js(),q0=(r,e,t)=>N0(r,e,">",t);dh.exports=q0});var ph=f((bI,hh)=>{"use strict";var M0=Js(),P0=(r,e,t)=>M0(r,e,"<",t);hh.exports=P0});var yh=f((wI,gh)=>{"use strict";var mh=me(),D0=(r,e,t)=>(r=new mh(r,t),e=new mh(e,t),r.intersects(e,t));gh.exports=D0});var vh=f((TI,_h)=>{"use strict";var k0=xr(),$0=pe();_h.exports=(r,e,t)=>{let s=[],n=null,i=null,o=r.sort((l,d)=>$0(l,d,t));for(let l of o)k0(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);let a=[];for(let[l,d]of s)l===d?a.push(l):!d&&l===o[0]?a.push("*"):d?l===o[0]?a.push(`<=${d}`):a.push(`${l} - ${d}`):a.push(`>=${l}`);let u=a.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var Ah=f((AI,Th)=>{"use strict";var Sh=me(),Lo=Lr(),{ANY:Io}=Lo,Nr=xr(),Oo=pe(),B0=(r,e,t={})=>{if(r===e)return!0;r=new Sh(r,t),e=new Sh(e,t);let s=!1;e:for(let n of r.set){for(let i of e.set){let o=U0(n,i,t);if(s=s||o!==null,o)continue e}if(s)return!1}return!0},F0=[new Lo(">=0.0.0-0")],Eh=[new Lo(">=0.0.0")],U0=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Io){if(e.length===1&&e[0].semver===Io)return!0;t.includePrerelease?r=F0:r=Eh}if(e.length===1&&e[0].semver===Io){if(t.includePrerelease)return!0;e=Eh}let s=new Set,n,i;for(let h of r)h.operator===">"||h.operator===">="?n=bh(n,h,t):h.operator==="<"||h.operator==="<="?i=wh(i,h,t):s.add(h.semver);if(s.size>1)return null;let o;if(n&&i){if(o=Oo(n.semver,i.semver,t),o>0)return null;if(o===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let h of s){if(n&&!Nr(h,String(n),t)||i&&!Nr(h,String(i),t))return null;for(let E of e)if(!Nr(h,String(E),t))return!1;return!0}let a,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,m=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let h of e){if(l=l||h.operator===">"||h.operator===">=",c=c||h.operator==="<"||h.operator==="<=",n){if(m&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===m.major&&h.semver.minor===m.minor&&h.semver.patch===m.patch&&(m=!1),h.operator===">"||h.operator===">="){if(a=bh(n,h,t),a===h&&a!==n)return!1}else if(n.operator===">="&&!Nr(n.semver,String(h),t))return!1}if(i){if(d&&h.semver.prerelease&&h.semver.prerelease.length&&h.semver.major===d.major&&h.semver.minor===d.minor&&h.semver.patch===d.patch&&(d=!1),h.operator==="<"||h.operator==="<="){if(u=wh(i,h,t),u===h&&u!==i)return!1}else if(i.operator==="<="&&!Nr(i.semver,String(h),t))return!1}if(!h.operator&&(i||n)&&o!==0)return!1}return!(n&&c&&!i&&o!==0||i&&l&&!n&&o!==0||m||d)},bh=(r,e,t)=>{if(!r)return e;let s=Oo(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},wh=(r,e,t)=>{if(!r)return e;let s=Oo(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};Th.exports=B0});var Lh=f((CI,Ih)=>{"use strict";var xo=qt(),Ch=Cr(),j0=Y(),Rh=mo(),G0=it(),W0=Jd(),V0=ef(),Q0=sf(),H0=af(),X0=cf(),K0=df(),z0=hf(),Y0=mf(),J0=pe(),Z0=vf(),ew=Ef(),tw=Qs(),rw=Af(),sw=Rf(),nw=Ir(),iw=Hs(),ow=_o(),aw=vo(),uw=Xs(),cw=Ks(),lw=So(),dw=Df(),fw=Lr(),hw=me(),pw=xr(),mw=Yf(),gw=Zf(),yw=th(),_w=nh(),vw=oh(),Sw=Js(),Ew=fh(),bw=ph(),ww=yh(),Tw=vh(),Aw=Ah();Ih.exports={parse:G0,valid:W0,clean:V0,inc:Q0,diff:H0,major:X0,minor:K0,patch:z0,prerelease:Y0,compare:J0,rcompare:Z0,compareLoose:ew,compareBuild:tw,sort:rw,rsort:sw,gt:nw,lt:iw,eq:ow,neq:aw,gte:uw,lte:cw,cmp:lw,coerce:dw,Comparator:fw,Range:hw,satisfies:pw,toComparators:mw,maxSatisfying:gw,minSatisfying:yw,minVersion:_w,validRange:vw,outside:Sw,gtr:Ew,ltr:bw,intersects:ww,simplifyRange:Tw,subset:Aw,SemVer:j0,re:xo.re,src:xo.src,tokens:xo.t,SEMVER_SPEC_VERSION:Ch.SEMVER_SPEC_VERSION,RELEASE_TYPES:Ch.RELEASE_TYPES,compareIdentifiers:Rh.compareIdentifiers,rcompareIdentifiers:Rh.rcompareIdentifiers}});var qo=f((RI,No)=>{"use strict";var Cw=Lh(),Rw=Tr(),Mt=He(),Oh=K(),xh=D(),Nh="2.7.15",Iw=function(){return!1},Lw=function(e){if(!Cw.gte(e.VERSION,Nh))throw new Error("AWS SDK version "+Nh+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var s=e[t];s.prototype.customizeRequests(qh)}return e},Ow=function(e){return e.customizeRequests(qh),e};function qh(r){var e=Mt.resolveSegment(Mt.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return Mt.isAutomaticMode()?xh.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):xh.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var s=this.throttledError||Iw,n=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var o=e.segment?e.segment.trace_id:e.trace_id;let a=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+o+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(a!=null)for(let[m,h]of Object.entries(a))d+=";"+m+"="+h;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new Rw(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new Mh(d)),(d.statusCode===429||l.error&&s(l.error))&&i.addThrottleFlag()),l.error){var m={message:l.error.message,name:l.error.code,stack:n};d&&d.statusCode?(Oh.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(m,!0)):i.close(m)}else{if(d&&d.statusCode){var h=Oh.getCauseTypeFromHttpStatus(d.statusCode);h&&(i[h]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(Mt.isAutomaticMode()){var d=Mt.getNamespace();d.run(function(){Mt.setSegment(i),r.__send(l)})}else r.__send(l)})}function Mh(r){this.init(r)}Mh.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};No.exports.captureAWSClient=Ow;No.exports.captureAWS=Lw});var Bh=f((II,$h)=>{var Zs=Object.defineProperty,xw=Object.getOwnPropertyDescriptor,Nw=Object.getOwnPropertyNames,qw=Object.prototype.hasOwnProperty,Pt=(r,e)=>Zs(r,"name",{value:e,configurable:!0}),Mw=(r,e)=>{for(var t in e)Zs(r,t,{get:e[t],enumerable:!0})},Pw=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Nw(e))!qw.call(r,n)&&n!==t&&Zs(r,n,{get:()=>e[n],enumerable:!(s=xw(e,n))||s.enumerable});return r},Dw=r=>Pw(Zs({},"__esModule",{value:!0}),r),Ph={};Mw(Ph,{isClockSkewCorrectedError:()=>Dh,isClockSkewError:()=>Gw,isRetryableByTrait:()=>jw,isServerError:()=>Vw,isThrottlingError:()=>Ww,isTransientError:()=>kh});$h.exports=Dw(Ph);var kw=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],$w=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],Bw=["TimeoutError","RequestTimeout","RequestTimeoutException"],Fw=[500,502,503,504],Uw=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],jw=Pt(r=>r.$retryable!==void 0,"isRetryableByTrait"),Gw=Pt(r=>kw.includes(r.name),"isClockSkewError"),Dh=Pt(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),Ww=Pt(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||$w.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),kh=Pt(r=>{var e;return Dh(r)||Bw.includes(r.name)||Uw.includes(r?.code||"")||Fw.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),Vw=Pt(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!kh(r)}return!1},"isServerError")});var Vh=f(Dt=>{"use strict";var Gh=Dt&&Dt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Dt,"__esModule",{value:!0});Dt.captureAWSClient=void 0;var Qw=Bh(),Hw=Gh(Tr()),Xw=require("querystring"),Kw=Gh(vr()),Mo=He(),Fh=D(),{safeParseInt:en}=K(),zw=K(),Wh="XRaySDKInstrumentation",Uh=async(r,e,t,s,n,i)=>{var o,a,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:m}=((o=n?.output)===null||o===void 0?void 0:o.$metadata)||i?.$metadata,h=new Hw.default({extendedRequestId:c,requestId:l,retryCount:m,data:n?.output,request:{operation:e,params:s,httpRequest:{region:t,statusCode:d}}},r),E={};return d&&(E.response={},E.response.status=d),!((a=n?.response)===null||a===void 0)&&a.headers&&((u=n?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(E.response||(E.response={}),E.response.content_length=en(n.response.headers["content-length"])),[h,E]};function jh(r,e,t){var s,n,i;(t&&(0,Qw.isThrottlingError)(t)||en((s=r.response)===null||s===void 0?void 0:s.status)===429||en((n=t?.$metadata)===null||n===void 0?void 0:n.httpStatusCode)===429)&&e.addThrottleFlag();let o=(0,zw.getCauseTypeFromHttpStatus)(en((i=r.response)===null||i===void 0?void 0:i.status));o==="fault"?e.addFaultFlag():o==="error"&&e.addErrorFlag()}var Yw=(r,e)=>(t,s)=>async n=>{var i;let o=Mo.isAutomaticMode()?Mo.resolveSegment():e,{clientName:a,commandName:u}=s,c=(i=n?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),m=a.slice(0,-6);if(!o){let W=m+"."+d;return Mo.isAutomaticMode()?Fh.getLogger().info("Call "+W+" is missing the sub/segment context for automatic mode. Ignoring."):Fh.getLogger().info("Call "+W+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(n)}let h;o.notTraced?h=o.addNewSubsegmentWithoutSampling(m):h=o.addNewSubsegment(m),h.addAttribute("namespace","aws");let E=o instanceof Kw.default?o.segment:o,w=E.segment?E.segment.additionalTraceData:E.additionalTraceData,Ae=(0,Xw.stringify)({Root:E.trace_id,Parent:h.id,Sampled:h.notTraced?"0":"1"},";");if(w!=null)for(let[W,se]of Object.entries(w))Ae+=";"+W+"="+se;o.noOp||(n.request.headers["X-Amzn-Trace-Id"]=Ae);let ge;try{if(ge=await t(n),!ge)throw new Error("Failed to get response from instrumented AWS Client.");let[W,se]=await Uh(m,d,await r.region(),c,ge,null);return h.addAttribute("aws",W),h.addAttribute("http",se),jh(se,h),h.close(),ge}catch(W){if(W.$metadata){let[k,ae]=await Uh(m,d,await r.region(),c,null,W);h.addAttribute("aws",k),h.addAttribute("http",ae),jh(ae,h,W)}let se={message:W.message,name:W.name,stack:W.stack||new Error().stack};throw h.close(se,!0),W}},Jw={name:Wh,step:"build"},Zw=(r,e)=>({applyToStack:t=>{t.add(Yw(r,e),Jw)}});function eT(r,e){return r.middlewareStack.remove(Wh),r.middlewareStack.use(Zw(r.config,e)),r}Dt.captureAWSClient=eT});var Do=f((OI,Po)=>{"use strict";var Qh=require("url"),kt=He(),tn=K(),Hh=D(),tT=require("events"),rT=function(e,t,s){e.__request||Xh(e,t,s)},sT=function(e,t,s){if(e.__request)return e;var n={};return Object.keys(e).forEach(function(i){n[i]=e[i]}),Xh(n,t,s),n};function Xh(r,e,t){function s(o,...a){let u,c,l,d,m=a[0];if(typeof a[1]=="object"?(l=!0,d=typeof m=="string"?new Qh.URL(m):m,u=a[1],c=a[2]):(l=!1,u=m,c=a[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return o(...a);typeof u=="string"&&(u=new Qh.URL(u)),l||(d=u);let h=kt.resolveSegment(kt.resolveManualSegmentParams(u)),E=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!h){let k="[ host: "+E;return k=u.method?k+", method: "+u.method:k,k+=", path: "+(d.pathname||tn.stripQueryStringFromPath(u.path))+" ]",kt.isAutomaticMode()?Hh.getLogger().info("Options for request "+k+" is missing the sub/segment context for automatic mode. Ignoring."):Hh.getLogger().info("Options for request "+k+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),o(...a)}let w;h.notTraced?w=h.addNewSubsegmentWithoutSampling(E):w=h.addNewSubsegment(E);let Ae=h.segment?h.segment:h;w.namespace="remote",u.headers||(u.headers={}),h.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+Ae.trace_id+";Parent="+w.id+";Sampled="+(w.notTraced?"0":"1"));let ge=function(ae){if(t&&t(w,this,null,ae),w.http&&w.http.response)tn.getCauseTypeFromHttpStatus(w.http.response.status)==="error"&&w.addErrorFlag(),w.close(ae,!0);else{let _p=ae.code!=="ECONNREFUSED";w.addRemoteRequestData(this,null,_p&&e),w.close(ae)}},W=tn.objectWithoutProperties(u,["Segment"],!0),se=o(...l?[m,W]:[u],function(k){k.on("end",function(){t&&t(w,this.req,k),k.statusCode===429&&w.addThrottleFlag();let ae=tn.getCauseTypeFromHttpStatus(k.statusCode);ae&&(w[ae]=!0),w.addRemoteRequestData(k.req,k,!!e),w.close()}),typeof c=="function"?kt.isAutomaticMode()?kt.getNamespace().run(function(){kt.setSegment(w),c(k)}):c(k):k.req&&k.req.listenerCount("response")===0&&k.resume()});return se.on(tT.errorMonitor||"error",ge),se}r.__request=r.request;function n(...o){return s(r.__request,...o)}r.__get=r.get;function i(...o){return s(r.__get,...o)}Object.defineProperties(r,{request:{value:n,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}Po.exports.captureHTTPsGlobal=rT;Po.exports.captureHTTPs=sT});var Jh=f((xI,ko)=>{"use strict";var qr=He(),rn=Symbol("original then"),sn=Symbol("original catch");function zh(r){let e=r.prototype.then;e[rn]||(r.prototype.then=function(s,n){if(qr.isAutomaticMode()&&Kh()){let i=qr.getNamespace();s=s&&i.bind(s),n=n&&i.bind(n)}return e.call(this,s,n)},r.prototype.then[rn]=e);let t=r.prototype.catch;t&&!t[sn]&&(r.prototype.catch=function(s){if(qr.isAutomaticMode()&&Kh()){let n=qr.getNamespace();s=s&&n.bind(s)}return t.call(this,s)},r.prototype.catch[sn]=t)}function nT(r){let e=r.prototype.then;e[rn]&&(r.prototype.then=e[rn]);let t=r.prototype.catch;t&&t[sn]&&(r.prototype.catch=t[sn])}function Kh(){try{return qr.getSegment()}catch{return}}function Yh(){zh(Promise)}function iT(){nT(Promise)}Yh.patchThirdPartyPromise=zh;ko.exports.capturePromise=Yh;ko.exports.uncapturePromise=iT});var tp=f((NI,ep)=>{"use strict";function Zh(r,e,t,s,n){this.init(r,e,t,s,n)}Zh.prototype.init=function(e,t,s,n,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=n,this.user=s};ep.exports=Zh});var np=f((qI,sp)=>{"use strict";var ke=He(),$o=D(),$t=We(),oT=K(),aT=gd(),Pr={};try{Pr=yd()}catch(r){$o.getLogger().debug("Failed to load SDK data:",r)}var Mr="unknown",rp={plugins:{EC2Plugin:Ad(),ECSPlugin:Rd(),ElasticBeanstalkPlugin:Ld()},config:function(r){var e={};r.forEach(function(t){t.getData(function(s){if(s)for(var n in s)e[n]=s[n]}),$t.setOrigin(t.originName),$t.setPluginData(e)})},setAWSWhitelist:Tr().setAWSWhitelist,appendAWSWhitelist:Tr().appendAWSWhitelist,setStreamingThreshold:$t.setStreamingThreshold,setLogger:$o.setLogger,getLogger:$o.getLogger,setDaemonAddress:Es().setDaemonAddress,captureFunc:Fs().captureFunc,captureAsyncFunc:Fs().captureAsyncFunc,captureCallbackFunc:Fs().captureCallbackFunc,captureAWS:qo().captureAWS,captureAWSClient:qo().captureAWSClient,captureAWSv3Client:Vh().captureAWSClient,captureHTTPs:Do().captureHTTPs,captureHTTPsGlobal:Do().captureHTTPsGlobal,capturePromise:Jh().capturePromise,utils:oT,database:{SqlData:tp()},middleware:ro(),getNamespace:ke.getNamespace,resolveSegment:ke.resolveSegment,resolveManualSegmentParams:ke.resolveManualSegmentParams,getSegment:ke.getSegment,setSegment:ke.setSegment,isAutomaticMode:ke.isAutomaticMode,enableAutomaticMode:ke.enableAutomaticMode,enableManualMode:ke.enableManualMode,setContextMissingStrategy:ke.setContextMissingStrategy,Segment:Sr(),Subsegment:vr(),SegmentUtils:$t};rp.middleware.IncomingRequestData=Vi(),function(){var r={runtime:process.release&&process.release.name?process.release.name:Mr,runtime_version:process.version,version:process.env.npm_package_version||Mr,name:process.env.npm_package_name||Mr},e={sdk:"X-Ray for Node.js",sdk_version:Pr.version?Pr.version:Mr,package:Pr.name?Pr.name:Mr};$t.setSDKData(e),$t.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&aT.init()}();sp.exports=rp});var Bo=f((MI,ip)=>{"use strict";ip.exports=np()});var CT={};Ap(CT,{handler:()=>AT});module.exports=Cp(CT);var Xo="ColdStart",Ko="default_namespace";var be={Seconds:"Seconds",Microseconds:"Microseconds",Milliseconds:"Milliseconds",Bytes:"Bytes",Kilobytes:"Kilobytes",Megabytes:"Megabytes",Gigabytes:"Gigabytes",Terabytes:"Terabytes",Bits:"Bits",Kilobits:"Kilobits",Megabits:"Megabits",Gigabits:"Gigabits",Terabits:"Terabits",Percent:"Percent",Count:"Count",BytesPerSecond:"Bytes/Second",KilobytesPerSecond:"Kilobytes/Second",MegabytesPerSecond:"Megabytes/Second",GigabytesPerSecond:"Gigabytes/Second",TerabytesPerSecond:"Terabytes/Second",BitsPerSecond:"Bits/Second",KilobitsPerSecond:"Kilobits/Second",MegabitsPerSecond:"Megabits/Second",GigabitsPerSecond:"Gigabits/Second",TerabitsPerSecond:"Terabits/Second",CountPerSecond:"Count/Second",NoUnit:"None"},ut={Standard:60,High:1};var da=require("console");var Be="2.28.1";var ln=process.env.AWS_EXECUTION_ENV||"NA",Rp={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},zo=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",Ip=r=>e=>async t=>{let s=t.request.headers["user-agent"]||"";if(s.includes("PT/NO-OP")){let n=s.replace("PT/NO-OP",`PT/${r}/${Be} PTEnv/${ln}`);return t.request.headers["user-agent"]=n,await e(t)}return s.includes("PT/")?await e(t):(t.request.headers["user-agent"]=s===""?`PT/${r}/${Be} PTEnv/${ln}`:`${s} PT/${r}/${Be} PTEnv/${ln}`,await e(t))},Lp=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},dn=(r,e)=>{try{if(zo(r)){if(Lp(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(Ip(e),Rp)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var kr="powertools-for-aws",Yo=`${kr}.tracer`,Jo=`${kr}.metrics`,Zo=`${kr}.logger`,ea=`${kr}.idempotency`;var ct=r=>typeof r=="string",$r=r=>typeof r=="number",Br=r=>$r(r)&&Number.isInteger(r);var ta=r=>Object.is(r,null),Fr=r=>ta(r)||Object.is(r,void 0),lt=r=>!!(Fr(r)||!ct(r)||r.trim().length===0);var dt,Re=class{constructor(){b(this,dt);v(this,"coldStart",!0);v(this,"defaultServiceName","service_undefined");j(this,dt,this.getInitializationType()),p(this,dt)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return p(this,dt)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};dt=new WeakMap;var ra=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${Be}/PTEnv/${ra}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${Be}/PTEnv/${ra}`;var sa="POWERTOOLS_DEV",na="POWERTOOLS_SERVICE_NAME",ia="_X_AMZN_TRACE_ID";var $=({key:r,defaultValue:e,errorMessage:t})=>{let s=process.env[r];if(s===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return s.trim()},oa=({key:r,defaultValue:e,errorMessage:t})=>{let s=$({key:r,defaultValue:String(e),errorMessage:t}),n=Number(s);if(Number.isNaN(n))throw new TypeError(`Environment variable ${r} must be a number`);return n},Op=new Set(["1","y","yes","t","true","on"]),xp=new Set(["0","n","no","f","false","off"]),jt=({key:r,defaultValue:e,errorMessage:t,extendedParsing:s})=>{let i=$({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(s){if(Op.has(i))return!0;if(xp.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},Xe=()=>{try{return jt({key:sa,extendedParsing:!0})}catch{return!1}},Ur=()=>$({key:na,defaultValue:""}),aa=()=>{let r=$({key:ia,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[s,n]=t.split("=");e[s]=n}return e},ua=()=>aa()?.Sampled==="1",Ie=()=>aa()?.Root;var ue,ne,Wt,ye,fa,ha,pa,fn,hn=class hn extends Re{constructor(t={}){super();b(this,ye);v(this,"console");v(this,"customConfigService");v(this,"defaultDimensions",{});v(this,"dimensions",{});v(this,"dimensionSets",[]);v(this,"functionName");b(this,ue);v(this,"isSingleMetric",!1);v(this,"metadata",{});v(this,"namespace");v(this,"shouldThrowOnEmptyMetrics",!1);v(this,"storedMetrics",{});v(this,"disabled",!1);b(this,ne,{namespace:"",functionName:"",serviceName:"",disabled:!1,devMode:!1});b(this,Wt);this.dimensions={},this.setEnvConfig(),this.setConsole(),j(this,ue,t.logger||this.console),this.setOptions(t)}addDimension(t,s){if(lt(t)||lt(s)){p(this,ue).warn(`The dimension ${t} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);return}if(29<=this.getCurrentDimensionsCount())throw new RangeError(`The number of metric dimensions must be lower than ${29}`);(Object.hasOwn(this.dimensions,t)||Object.hasOwn(this.defaultDimensions,t))&&p(this,ue).warn(`Dimension "${t}" has already been added. The previous value will be overwritten.`),this.dimensions[t]=s}addDimensions(t){let s=R(this,ye,fn).call(this,t),n=this.getCurrentDimensionsCount(),i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.dimensionSets.push(s)}addMetadata(t,s){this.metadata[t]=s}addMetric(t,s,n,i=ut.Standard){this.storeMetric(t,s,n,i),this.isSingleMetric&&this.publishStoredMetrics()}captureColdStartMetric(t){if(!this.getColdStart())return;let s=this.singleMetric(),n=this.functionName?.trim()??t?.trim();n&&n.length>0&&s.addDimension("function_name",n),s.addMetric(Xo,be.Count,1)}clearDefaultDimensions(){this.defaultDimensions={}}clearDimensions(){this.dimensions={},this.dimensionSets=[]}clearMetadata(){this.metadata={}}clearMetrics(){this.storedMetrics={}}hasStoredMetrics(){return Object.keys(this.storedMetrics).length>0}isDisabled(){return this.disabled}logMetrics(t={}){let{throwOnEmptyMetrics:s,defaultDimensions:n,captureColdStartMetric:i}=t;return s&&this.setThrowOnEmptyMetrics(s),n!==void 0&&this.setDefaultDimensions(n),(o,a,u)=>{let c=u.value,l=this;return u.value=async function(...d){i&&l.captureColdStartMetric(d[1].functionName);let m;try{m=await c.apply(this,d)}finally{l.publishStoredMetrics()}return m},u}}publishStoredMetrics(){let t=this.hasStoredMetrics();if(!this.shouldThrowOnEmptyMetrics&&!t&&p(this,ue).warn("No application metrics to publish. The cold-start metric may be published if enabled. If application metrics should never be empty, consider using `throwOnEmptyMetrics`"),!this.disabled){let s=this.serializeMetrics();t&&this.console.log(JSON.stringify(s))}this.clearMetrics(),this.clearDimensions(),this.clearMetadata()}setTimestamp(t){R(this,ye,ha).call(this,t)||p(this,ue).warn("This metric doesn't meet the requirements and will be skipped by Amazon CloudWatch. Ensure the timestamp is within 14 days in the past or up to 2 hours in the future and is also a valid number or Date object."),j(this,Wt,R(this,ye,pa).call(this,t))}serializeMetrics(){let t=Object.values(this.storedMetrics).map(o=>({Name:o.name,Unit:o.unit,...o.resolution===ut.High?{StorageResolution:o.resolution}:{}}));if(t.length===0&&this.shouldThrowOnEmptyMetrics)throw new RangeError("The number of metrics recorded must be higher than zero");this.namespace||p(this,ue).warn("Namespace should be defined, default used");let s=Object.values(this.storedMetrics).reduce((o,{name:a,value:u})=>(o[a]=u,o),{}),n=[],i=new Set([...Object.keys(this.defaultDimensions),...Object.keys(this.dimensions)]);Object.keys(this.dimensions).length>0&&n.push([...i]);for(let o of this.dimensionSets){let a=new Set([...Object.keys(this.defaultDimensions),...Object.keys(o)]);n.push([...a])}return n.length===0&&Object.keys(this.defaultDimensions).length>0&&n.push([...Object.keys(this.defaultDimensions)]),{_aws:{Timestamp:p(this,Wt)??Date.now(),CloudWatchMetrics:[{Namespace:this.namespace||Ko,Dimensions:n,Metrics:t}]},...this.defaultDimensions,...this.dimensions,...this.dimensionSets.reduce((o,a)=>{for(let[u,c]of Object.entries(a))o[u]=c;return o},{}),...s,...this.metadata}}setDefaultDimensions(t){let s=R(this,ye,fn).call(this,t),n=Object.keys(this.defaultDimensions).length,i=Object.keys(s).length;if(n+i>=29)throw new RangeError(`The number of metric dimensions must be lower than ${29}`);this.defaultDimensions={...this.defaultDimensions,...s}}setFunctionName(t){this.functionName=t}setThrowOnEmptyMetrics(t){this.shouldThrowOnEmptyMetrics=t}singleMetric(){return new hn({namespace:this.namespace,defaultDimensions:this.defaultDimensions,singleMetric:!0,logger:p(this,ue)})}throwOnEmptyMetrics(){this.shouldThrowOnEmptyMetrics=!0}getCurrentDimensionsCount(){let t=this.dimensionSets.reduce((s,n)=>s+Object.keys(n).length,0);return Object.keys(this.dimensions).length+Object.keys(this.defaultDimensions).length+t}getCustomConfigService(){return this.customConfigService}isNewMetric(t,s){if(this.storedMetrics[t]){if(this.storedMetrics[t].unit!==s){let n=this.storedMetrics[t].unit;throw new Error(`Metric "${t}" has already been added with unit "${n}", but we received unit "${s}". Did you mean to use metric unit "${n}"?`)}return!1}return!0}setConsole(){p(this,ne).devMode?this.console=console:this.console=new da.Console({stdout:process.stdout,stderr:process.stderr})}setCustomConfigService(t){this.customConfigService=t||void 0}setEnvConfig(){p(this,ne).namespace=$({key:"POWERTOOLS_METRICS_NAMESPACE",defaultValue:""}),p(this,ne).functionName=$({key:"POWERTOOLS_METRICS_FUNCTION_NAME",defaultValue:""}),p(this,ne).serviceName=Ur(),p(this,ne).disabled=jt({key:"POWERTOOLS_METRICS_DISABLED",defaultValue:!1,extendedParsing:!0}),p(this,ne).devMode=Xe()}setFunctionNameForColdStartMetric(t){let s=t?.trim()??p(this,ne).functionName;s&&s.length>0&&(this.functionName=s)}setNamespace(t){this.namespace=t||this.getCustomConfigService()?.getNamespace()||p(this,ne).namespace}setDisabled(){if("POWERTOOLS_METRICS_DISABLED"in process.env&&process.env.POWERTOOLS_METRICS_DISABLED!==void 0){this.disabled=p(this,ne).disabled;return}this.disabled=p(this,ne).devMode}setOptions(t){let{customConfigService:s,namespace:n,serviceName:i,singleMetric:o,defaultDimensions:a,functionName:u}=t;this.setCustomConfigService(s),this.setDisabled(),this.setNamespace(n);let c=R(this,ye,fa).call(this,i);return this.setDefaultDimensions(a?{service:c,...a}:{service:c}),this.setFunctionNameForColdStartMetric(u),this.isSingleMetric=o||!1,this}storeMetric(t,s,n,i){if(!ct(t))throw new Error(`${t} is not a valid string`);if(t.length<1||t.length>255)throw new RangeError(`The metric name should be between ${1} and ${255} characters`);if(!$r(n))throw new RangeError(`${n} is not a valid number`);if(!Object.values(be).includes(s))throw new RangeError(`Invalid metric unit '${s}', expected either option: ${Object.values(be).join(",")}`);if(!Object.values(ut).includes(i))throw new RangeError(`Invalid metric resolution '${i}', expected either option: ${Object.values(ut).join(",")}`);if(Object.keys(this.storedMetrics).length>=100&&this.publishStoredMetrics(),this.isNewMetric(t,s))this.storedMetrics[t]={unit:s,value:n,name:t,resolution:i};else{let o=this.storedMetrics[t];Array.isArray(o.value)||(o.value=[o.value]),o.value.push(n),o.value.length===100&&this.publishStoredMetrics()}}};ue=new WeakMap,ne=new WeakMap,Wt=new WeakMap,ye=new WeakSet,fa=function(t){return t||this.getCustomConfigService()?.getServiceName()||p(this,ne).serviceName||this.defaultServiceName},ha=function(t){let s=t instanceof Date;if(!s&&!Br(t))return!1;let n=s?t.getTime():t,i=Date.now(),o=i-12096e5,a=i+72e5;return n>=o&&n<=a},pa=function(t){return Br(t)?t:t instanceof Date?t.getTime():0},fn=function(t){let s={};for(let[n,i]of Object.entries(t)){if(lt(n)||lt(i)){p(this,ue).warn(`The dimension ${n} doesn't meet the requirements and won't be added. Ensure the dimension name and value are non empty strings`);continue}(Object.hasOwn(this.dimensions,n)||Object.hasOwn(this.defaultDimensions,n)||Object.hasOwn(s,n))&&p(this,ue).warn(`Dimension "${n}" has already been added. The previous value will be overwritten.`),s[n]=i}return s};var Gt=hn;var pn={PRETTY:4,COMPACT:0};var I={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},ma=["level","message","sampling_rate","service","timestamp"],ga="Uncaught error detected, flushing log buffer before exit";var jr,Gr,ya,Vt=class{constructor(){b(this,Gr);b(this,jr,e=>{let t="2-digit",s=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:s})})}formatError(e){let{name:t,message:s,stack:n,cause:i,...o}=e,a={name:t,location:this.getCodeLocation(e.stack),message:s,stack:Xe()&&typeof n=="string"?n?.split(`
`):n,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(a[u]=o[u]);return a}formatTimestamp(e){let t="UTC",s=$({key:"TZ",defaultValue:""});return s&&!s.includes(t)?R(this,Gr,ya).call(this,e,s):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),s=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let n of t){let i=s.exec(n);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};jr=new WeakMap,Gr=new WeakSet,ya=function(e,t){let{year:s,month:n,day:i,hour:o,minute:a,second:u}=p(this,jr).call(this,t).formatToParts(e).reduce((Ae,ge)=>(Ae[ge.type]=ge.value,Ae),{}),c=`${s}-${n}-${i}T${o}:${a}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",m=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),h=Math.abs(l%60).toString().padStart(2,"0"),E=e.getMilliseconds().toString().padStart(3,"0"),w=`${d}${m}:${h}`;return`${c}.${E}${w}`};var Qa=Ce(An(),1);var gt=class{constructor(e){v(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,Qa.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let s in e)e[s]!==void 0&&e[s]!==""&&e[s]!==null&&(t[s]=e[s]);return t}setAttributes(e){this.attributes=e}};var Xa=require("console"),Ka=require("crypto");var Yt=Ce(An(),1);var yt,Jr=class extends Vt{constructor(t){super();b(this,yt);j(this,yt,t?.logRecordOrder)}formatAttributes(t,s){let n={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(p(this,yt)===void 0)return new gt({attributes:n}).addAttributes(s);let i={};for(let a of p(this,yt))a in n&&!(a in i)?i[a]=n[a]:a in s&&!(a in i)&&(i[a]=s[a]);for(let a in n)a in i||(i[a]=n[a]);for(let a in s)a in i||(i[a]=s[a]);return new gt({attributes:i})}};yt=new WeakMap;var Cn=class{constructor(e,t){v(this,"value");v(this,"logLevel");v(this,"byteSize");if(!ct(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},Rn=class extends Set{constructor(){super(...arguments);v(this,"currentBytesSize",0);v(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let s=super.delete(t);return s&&(this.currentBytesSize-=t.byteSize),s}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},Je,_t,es,Ha,Zr=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:s}){super();b(this,es);b(this,Je);b(this,_t);j(this,Je,t),j(this,_t,s)}setItem(t,s,n){let i=new Cn(s,n);if(i.byteSize>p(this,Je))throw new Error("Item too big");let o=this.get(t)||new Rn;return o.currentBytesSize+i.byteSize>=p(this,Je)&&(R(this,es,Ha).call(this,o,i),p(this,_t)&&p(this,_t).call(this)),o.add(i),super.set(t,o),this}};Je=new WeakMap,_t=new WeakMap,es=new WeakSet,Ha=function(t,s){for(;t.currentBytesSize+s.byteSize>=p(this,Je);)t.shift(),t.hasEvictedLog=!0};var _e,vt,tr,ve,Fe,Ze,V,we,et,xe,rr,L,Jt,In,za,Ya,Ja,Za,Ln,Zt,eu,On=class On extends Re{constructor(t={}){super();b(this,L);v(this,"console");v(this,"customConfigService");v(this,"logEvent",!1);v(this,"logFormatter");v(this,"logIndentation",pn.COMPACT);v(this,"logLevel",I.INFO);b(this,_e);v(this,"persistentLogAttributes",{});v(this,"powertoolsLogData",{sampleRateValue:0});v(this,"temporaryLogAttributes",{});b(this,vt,[]);b(this,tr,!1);b(this,ve,new Map);b(this,Fe,I.INFO);b(this,Ze);b(this,V,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:I.DEBUG});b(this,we);b(this,et);b(this,xe,{sampleRateValue:0,refreshedTimes:0});b(this,rr,new Map);let{customConfigService:s,...n}=t;this.customConfigService=s||void 0,this.setOptions(n),j(this,tr,!0);for(let[i,o]of p(this,vt))this.printLog(i,this.createAndPopulateLogItem(...o));j(this,vt,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){R(this,L,In).call(this,t,"temp")}appendPersistentKeys(t){R(this,L,In).call(this,t,"persistent")}createChild(t={}){let s=this.createLogger((0,Yt.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:p(this,xe).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:p(this,Ze),correlationIdSearchFn:p(this,et),...p(this,V).enabled&&{logBufferOptions:{maxBytes:p(this,V).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(p(this,V).bufferAtVerbosity),flushOnErrorLog:p(this,V).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&s.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&s.appendKeys(this.temporaryLogAttributes),s}critical(t,...s){this.processLogItem(I.CRITICAL,t,s)}debug(t,...s){this.processLogItem(I.DEBUG,t,s)}error(t,...s){p(this,V).enabled&&p(this,V).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(I.ERROR,t,s)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...s){this.processLogItem(I.INFO,t,s)}injectLambdaContext(t){return(s,n,i)=>{let o=i.value,a=this;i.value=async function(...u){a.refreshSampleRateCalculation(),a.addContext(u[1]),a.logEventIfEnabled(u[0],t?.logEvent),t?.correlationIdPath&&a.setCorrelationId(u[0],t?.correlationIdPath);try{return await o.apply(this,u)}catch(c){throw t?.flushBufferOnUncaughtError&&(a.flushBuffer(),a.error({message:ga,error:c})),c}finally{(t?.clearState||t?.resetKeys)&&a.resetKeys(),a.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,s,n){n&&(n.clearState||n?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,s,n,i){t.addContext(n),t.logEventIfEnabled(s,i?.logEvent)}logEventIfEnabled(t,s){this.shouldLogEvent(s)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(p(this,xe).refreshedTimes===0){p(this,xe).refreshedTimes++;return}R(this,L,Ln).call(this)&&this.logLevel>I.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(p(this,Fe)))}removeKeys(t){for(let s of t)this.temporaryLogAttributes[s]=void 0,this.persistentLogAttributes[s]?p(this,ve).set(s,"persistent"):p(this,ve).delete(s)}removePersistentKeys(t){for(let s of t)this.persistentLogAttributes[s]=void 0,this.temporaryLogAttributes[s]?p(this,ve).set(s,"temp"):p(this,ve).delete(s)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?p(this,ve).set(t,"persistent"):p(this,ve).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=I[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...s){this.processLogItem(I.TRACE,t,s)}warn(t,...s){this.processLogItem(I.WARN,t,s)}createLogger(t){return new On(t)}getJsonReplacer(){let t=new WeakSet;return(s,n)=>{var o;let i=n;if(p(this,Ze)&&(i=(o=p(this,Ze))==null?void 0:o.call(this,s,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,Yt.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return p(this,_e)!==void 0?(this.logLevel=I[p(this,_e)],this.isValidLogLevel(t)&&this.logLevel>I[t]&&R(this,L,Jt).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${p(this,_e)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,s,n){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:Ie(),...this.getPowertoolsLogData(),message:""},o=R(this,L,za).call(this);return R(this,L,Ya).call(this,s,i,o),R(this,L,Ja).call(this,n,o),this.getLogFormatter().formatAttributes(i,o)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let s;for(let[n,i]of Object.entries(I))if(i===t){s=n;break}return s}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in I}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,s){s.prepareForPrint();let n=t===I.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[n](JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,s,n){let i=Ie();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,s,n),t)}catch(o){this.printLog(I.WARN,this.createAndPopulateLogItem(I.WARN,`Unable to buffer log: ${o.message}`,[o])),this.printLog(t,this.createAndPopulateLogItem(t,s,n))}return}t>=this.logLevel&&(p(this,tr)?this.printLog(t,this.createAndPopulateLogItem(t,s,n)):p(this,vt).push([t,[t,s,n]]))}setConsole(){Xe()?this.console=console:this.console=new Xa.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...s)=>{this.console.log(t,...s)}}setInitialLogLevel(t){let s=t?.toUpperCase();if(this.awsLogLevelShortCircuit(s)){j(this,Fe,this.logLevel);return}if(this.isValidLogLevel(s)){this.logLevel=I[s],j(this,Fe,this.logLevel);return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=I[n],j(this,Fe,this.logLevel);return}let i=$({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),o=$({key:"LOG_LEVEL",defaultValue:""}),a=i!==""?i:o;this.isValidLogLevel(a)&&(this.logLevel=I[a],j(this,Fe,this.logLevel))}setInitialSampleRate(t){let s=t,n=this.getCustomConfigService()?.getSampleRateValue(),i=oa({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let o of[s,n,i])if(this.isValidSampleRate(o)){p(this,xe).sampleRateValue=o,this.powertoolsLogData.sampleRateValue=o,R(this,L,Ln).call(this)&&this.logLevel>I.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=jt({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,s){this.logFormatter=t??new Jr({logRecordOrder:s})}setLogIndentation(){Xe()&&(this.logIndentation=pn.PRETTY)}setOptions(t){let{logLevel:s,serviceName:n,sampleRateValue:i,logFormatter:o,persistentKeys:a,persistentLogAttributes:u,environment:c,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:m,correlationIdSearchFn:h}=t;u&&Object.keys(u).length>0&&a&&Object.keys(a).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(n,c,a||u);let E=$({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),w=E==="FATAL"?"CRITICAL":E;return this.isValidLogLevel(w)&&j(this,_e,w),this.setLogEvent(),this.setInitialLogLevel(s),this.setInitialSampleRate(i),this.setLogFormatter(o,d),this.setConsole(),this.setLogIndentation(),j(this,Ze,l),R(this,L,eu).call(this,m),j(this,et,h),this}setPowertoolsLogData(t,s,n){this.addToPowertoolsLogData({awsRegion:$({key:"AWS_REGION",defaultValue:""}),environment:s||this.getCustomConfigService()?.getCurrentEnvironment()||$({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||$({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),n&&this.appendPersistentKeys(n)}bufferLogItem(t,s,n){s.prepareForPrint(),p(this,we)?.has(t)===!1&&p(this,we)?.clear(),p(this,we)?.setItem(t,JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation),n)}flushBuffer(){let t=Ie();if(t===void 0)return;let s=p(this,we)?.get(t);if(s!==void 0){for(let n of s){let i=this.getLogLevelNameFromNumber(n.logLevel).toLowerCase();this.console[i](n.value)}s.hasEvictedLog&&this.printLog(I.WARN,this.createAndPopulateLogItem(I.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),p(this,_e)!==void 0&&I[p(this,_e)]>p(this,V).bufferAtVerbosity&&R(this,L,Jt).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),p(this,we)?.delete(t)}}clearBuffer(){let t=Ie();t!==void 0&&p(this,we)?.delete(t)}shouldBufferLog(t,s){return p(this,V).enabled&&t!==void 0&&s<=p(this,V).bufferAtVerbosity}setCorrelationId(t,s){if(typeof s=="string"){if(!p(this,et)){R(this,L,Jt).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let n=p(this,et).call(this,s,t);n&&this.appendKeys({correlation_id:n});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};_e=new WeakMap,vt=new WeakMap,tr=new WeakMap,ve=new WeakMap,Fe=new WeakMap,Ze=new WeakMap,V=new WeakMap,we=new WeakMap,et=new WeakMap,xe=new WeakMap,rr=new WeakMap,L=new WeakSet,Jt=function(t){p(this,rr).has(t)||(p(this,rr).set(t,!0),this.warn(t))},In=function(t,s){for(let n of Object.keys(t))R(this,L,Zt).call(this,n)===!1&&p(this,ve).set(n,s);s==="temp"?(0,Yt.default)(this.temporaryLogAttributes,t):(0,Yt.default)(this.persistentLogAttributes,t)},za=function(){let t={};for(let[s,n]of p(this,ve))R(this,L,Zt).call(this,s)||(t[s]=n==="persistent"?this.persistentLogAttributes[s]:this.temporaryLogAttributes[s]);return t},Ya=function(t,s,n){if(typeof t=="string"){s.message=t;return}let{message:i,...o}=t;s.message=i;for(let[a,u]of Object.entries(o))R(this,L,Zt).call(this,a)||(n[a]=u)},Ja=function(t,s){for(let n of t)Fr(n)||(n instanceof Error?s.error=n:typeof n=="string"?s.extra=n:R(this,L,Za).call(this,n,s))},Za=function(t,s){for(let[n,i]of Object.entries(t))R(this,L,Zt).call(this,n)||(s[n]=i)},Ln=function(){return p(this,xe).sampleRateValue&&(0,Ka.randomInt)(0,100)/100<=p(this,xe).sampleRateValue},Zt=function(t){return ma.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},eu=function(t){if(t===void 0||(p(this,V).enabled=t?.enabled!==!1,p(this,V).enabled===!1))return;t?.maxBytes!==void 0&&(p(this,V).maxBytes=t.maxBytes),j(this,we,new Zr({maxBytesSize:p(this,V).maxBytes})),t?.flushOnErrorLog===!1&&(p(this,V).flushOnErrorLog=!1);let s=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(s)&&(p(this,V).bufferAtVerbosity=I[s]),p(this,_e)!==void 0&&I[p(this,_e)]>p(this,V).bufferAtVerbosity&&R(this,L,Jt).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var er=On;var tu=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Ig(r){return typeof r=="string"&&tu.test(r)}var xn=Ig;var X=[];for(let r=0;r<256;++r)X.push((r+256).toString(16).slice(1));function ru(r,e=0){return(X[r[e+0]]+X[r[e+1]]+X[r[e+2]]+X[r[e+3]]+"-"+X[r[e+4]]+X[r[e+5]]+"-"+X[r[e+6]]+X[r[e+7]]+"-"+X[r[e+8]]+X[r[e+9]]+"-"+X[r[e+10]]+X[r[e+11]]+X[r[e+12]]+X[r[e+13]]+X[r[e+14]]+X[r[e+15]]).toLowerCase()}var su=Ce(require("crypto")),rs=new Uint8Array(256),ts=rs.length;function Nn(){return ts>rs.length-16&&(su.default.randomFillSync(rs),ts=0),rs.slice(ts,ts+=16)}var nu=Ce(require("crypto")),qn={randomUUID:nu.default.randomUUID};function Lg(r,e,t){if(qn.randomUUID&&!e&&!r)return qn.randomUUID();r=r||{};let s=r.random||(r.rng||Nn)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=s[n];return e}return ru(s)}var sr=Lg;var tt=class r{constructor(e,t){this.logger=new er({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||sr(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,s){let n=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...n,...s})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,s){this.info(`Custom metric: ${e}`,{metric:e,value:t,...s})}logApiRequest(e,t,s){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...s})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};var zA=new tt;var de=Ce(qi(),1),UC=de.default.Client,Qc=de.default.Pool,jC=de.default.Connection,GC=de.default.types,WC=de.default.Query,VC=de.default.DatabaseError,QC=de.default.escapeIdentifier,HC=de.default.escapeLiteral,XC=de.default.Result,KC=de.default.TypeOverrides,zC=de.default.defaults;var yp=require("aws-sdk");var pp=Ce(Bo(),1);var dp=Ce(Bo(),1),nn=require("diagnostics_channel"),fp=Ce(require("http"),1),hp=Ce(require("https"),1);var Fo=require("url"),op=new TextDecoder,ap=(r,e)=>{let t=-1;for(let s=0;s<r.length;s+=2)if(op.decode(r[s]).toLowerCase()===e){t=s;break}return t===-1?null:op.decode(r[t+1])},Uo=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",up=r=>{if(typeof r.origin=="string")return new Fo.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof Fo.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:uT,captureAWSClient:cT,captureAWSv3Client:lT,captureAsyncFunc:dT,captureFunc:fT,captureHTTPsGlobal:cp,getNamespace:hT,getSegment:pT,setSegment:mT,Segment:lp,setContextMissingStrategy:gT,setDaemonAddress:yT,setLogger:_T}=dp.default,on=class{captureAWS(e){return uT(e)}captureAWSClient(e){return cT(e)}captureAWSv3Client(e){return dn(e,"tracer"),lT(e)}captureAsyncFunc(e,t,s){return dT(e,t)}captureFunc(e,t,s){return fT(e,t)}captureHTTPsGlobal(){cp(fp.default),cp(hp.default)}getNamespace(){return hT()}getSegment(){return pT()}instrumentFetch(){let e=n=>{let{request:i}=n,o=i.method;if(o==="CONNECT")return;let a=this.getSegment(),u=up(i);if(a&&u){let c=a.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${Ie()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:o}},this.setSegment(c)}},t=n=>{let{response:i}=n,o=this.getSegment();if(Uo(o)){let a=i.statusCode,u=ap(i.headers,"content-length");o.http={...o.http,response:{status:a,...u&&{content_length:Number.parseInt(u,10)}}},a===429&&o.addThrottleFlag(),a>=400&&a<500?o.addErrorFlag():a>=500&&a<600&&o.addFaultFlag(),o.close(),this.setSegment(o.parent)}},s=n=>{let{error:i}=n,o=this.getSegment();Uo(o)&&(o.addErrorFlag(),i instanceof Error&&o.addError(i,!0),o.close(),this.setSegment(o.parent))};(0,nn.subscribe)("undici:request:create",e),(0,nn.subscribe)("undici:request:headers",t),(0,nn.subscribe)("undici:request:error",s)}putAnnotation(e,t){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(s instanceof lp){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}s.addAnnotation(e,t)}putMetadata(e,t,s){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(n instanceof lp){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}n.addMetadata(e,t,s)}setContextMissingStrategy(e){gT(e)}setDaemonAddress(e){yT(e)}setLogger(e){_T(e)}setSegment(e){mT(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:vT}=pp.default,G,an,mp,Dr=class extends Re{constructor(t={}){super();b(this,an);v(this,"provider");v(this,"captureError",!0);v(this,"captureHTTPsRequests",!0);v(this,"captureResponse",!0);v(this,"customConfigService");b(this,G,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});v(this,"serviceName");v(this,"tracingEnabled",!0);R(this,an,mp).call(this),this.setOptions(t),this.provider=new on,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,s){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(t,s||!1)}}addResponseAsMetadata(t,s){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${s} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(s){try{return this.provider.captureAWSClient(t.service),t}catch{throw s}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(s,n,i)=>{let o=i.value,a=this;return i.value=function(...u){return a.isTracingEnabled()?a.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async c=>{a.annotateColdStart(),a.addServiceNameAnnotation();let l;try{l=await o.apply(this,u),(t?.captureResponse??!0)&&a.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw a.addErrorAsMetadata(d),d}finally{try{c?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",c?.name,d)}}return l}):o.apply(this,u)},i}}captureMethod(t){return(s,n,i)=>{let o=i.value,a=this;return i.value=function(...u){if(!a.isTracingEnabled())return o.apply(this,[...u]);let c=String(n),l=t?.subSegmentName?t.subSegmentName:`### ${c}`;return a.provider.captureAsyncFunc(l,async d=>{let m;try{m=await o.apply(this,[...u]),(t?.captureResponse??!0)&&a.addResponseAsMetadata(m,c)}catch(h){throw a.addErrorAsMetadata(h),h}finally{try{d?.close()}catch(h){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,h)}}return m})},i}}getRootXrayTraceId(){return Ie()}getSegment(){if(!this.isTracingEnabled())return new vT("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?ua():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,s){this.isTracingEnabled()&&this.provider.putAnnotation(t,s)}putMetadata(t,s,n){this.isTracingEnabled()&&this.provider.putMetadata(t,s,n||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return p(this,G).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return p(this,G).awsExecutionEnv!==""}isLambdaSamCli(){return p(this,G).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(p(this,G).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let s=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(s!==void 0&&s.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}p(this,G).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(p(this,G).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:s,serviceName:n,captureHTTPsRequests:i,customConfigService:o}=t;return this.setCustomConfigService(o),this.setTracingEnabled(s),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let s=this.getCustomConfigService()?.getServiceName();if(s!==void 0&&this.isValidServiceName(s)){this.serviceName=s;return}if(p(this,G).serviceName!==void 0&&this.isValidServiceName(p(this,G).serviceName)){this.serviceName=p(this,G).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let s=this.getCustomConfigService()?.getTracingEnabled();if(s!==void 0&&s.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(p(this,G).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};G=new WeakMap,an=new WeakSet,mp=function(){p(this,G).awsExecutionEnv=$({key:"AWS_EXECUTION_ENV",defaultValue:""}),p(this,G).samLocal=$({key:"AWS_SAM_LOCAL",defaultValue:""}),p(this,G).captureError=$({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),p(this,G).captureHTTPsRequests=$({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),p(this,G).captureResponse=$({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),p(this,G).tracingEnabled=$({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),p(this,G).serviceName=Ur()};var ST=new Dr({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service"});function jo(){try{return ST.getSegment()}catch(r){console.warn("Failed to get X-Ray segment:",r);return}}function ET(r,e,t){try{let s=jo();if(!s)return;let n=s.addNewSubsegment(r);if(e)for(let[i,o]of Object.entries(e))o!==void 0&&n.addAnnotation(i,o);if(t)for(let[i,o]of Object.entries(t))n.addMetadata(i,o);return n}catch(s){console.warn("Failed to create X-Ray subsegment:",s);return}}function gp(r,e="success",t){if(r)try{r.addAnnotation("status",e),t&&(r.addError(t),r.addMetadata("error",{name:t.name,message:t.message,stack:t.stack})),r.close()}catch(s){console.warn("Failed to close X-Ray subsegment:",s)}}async function Bt(r,e,t,s){let n=ET(r,t,s);try{let i=await e();return gp(n,"success"),i}catch(i){throw gp(n,"error",i),i}}function ot(r){try{let e=jo();if(!e)return;for(let[t,s]of Object.entries(r))s!==void 0&&e.addAnnotation(t,s)}catch(e){console.warn("Failed to add X-Ray annotations:",e)}}function Go(r,e){try{let t=jo();if(!t)return;if(e)t.addMetadata(e,r);else for(let[s,n]of Object.entries(r))t.addMetadata(s,n)}catch(t){console.warn("Failed to add X-Ray metadata:",t)}}async function un(r,e,t){return Bt(`DB:${r}`,e,{operation:"database"},{queryParams:t})}var at=new tt("database"),bT=new yp.SecretsManager,Wo=class{constructor(e){this.pool=null;this.credentials=null;this.secretArn=e||process.env.DB_SECRET_ARN||""}async getCredentials(){if(this.credentials)return this.credentials;try{at.info("Fetching database credentials from Secrets Manager",{secretArn:this.secretArn});let e=await bT.getSecretValue({SecretId:this.secretArn}).promise();if(!e.SecretString)throw new Error("Secret string is empty");let t=JSON.parse(e.SecretString);return this.credentials={username:t.username,password:t.password,host:t.host,port:t.port||5432,dbname:t.dbname||"fibonacci"},at.info("Database credentials fetched successfully"),this.credentials}catch(e){throw at.error("Failed to fetch database credentials",e),e}}async initializePool(){if(this.pool)return this.pool;let e=await this.getCredentials();return at.info("Initializing database connection pool",{host:e.host,port:e.port,database:e.dbname}),this.pool=new Qc({user:e.username,password:e.password,host:e.host,port:e.port,database:e.dbname,max:10,idleTimeoutMillis:3e4,connectionTimeoutMillis:1e4,ssl:{rejectUnauthorized:!1}}),this.pool.on("error",t=>{at.error("Unexpected error on idle database client",t)}),at.info("Database connection pool initialized"),this.pool}async getPool(){return await this.initializePool()}async close(){this.pool&&(at.info("Closing database connection pool"),await this.pool.end(),this.pool=null,this.credentials=null)}},wT=new Wo;async function Vo(){return await(await wT.getPool()).connect()}var Ft=new Gt({namespace:"Nigredo/Prospecting",serviceName:"nigredo-get-lead"}),$e=new tt("nigredo-get-lead"),TT=process.env.DEFAULT_TENANT_ID||"00000000-0000-0000-0000-000000000000",AT=async(r,e)=>{let t=sr();$e.updateContext({traceId:t,requestId:e.awsRequestId,functionName:e.functionName}),ot({correlationId:t,service:"nigredo-prospecting",operation:"get-lead"});let s=Date.now();try{$e.info("Processing get lead request",{correlationId:t,requestId:e.awsRequestId});let n=await Bt("ValidateLeadId",()=>{let l=r.pathParameters?.id;if(!l)throw new Error("MISSING_LEAD_ID");if(!xn(l))throw new Error("INVALID_LEAD_ID");return $e.info("Lead ID validated",{correlationId:t,leadId:l}),ot({leadId:l}),l},{operation:"validate_lead_id"});$e.updateContext({leadId:n});let i=await Bt("ExtractTenantId",()=>{let l=TT;return $e.info("Tenant ID extracted",{correlationId:t,leadId:n,tenantId:l}),ot({tenantId:l}),l},{operation:"extract_tenant"}),o=await Bt("QueryLead",async()=>{let l=await Vo();try{let d=`
            SELECT 
              id, tenant_id, name, email, phone, company, message,
              source, utm_source, utm_medium, utm_campaign,
              status, ip_address, user_agent, created_at, updated_at
            FROM nigredo_leads.leads
            WHERE id = $1 AND tenant_id = $2
          `,m=await un("SelectLead",()=>l.query(d,[n,i]),{leadId:n,tenantId:i});if(m.rows.length===0)throw new Error("LEAD_NOT_FOUND");let h=m.rows[0];return $e.info("Lead retrieved successfully",{correlationId:t,leadId:n,email:h.email}),h}finally{l.release()}},{operation:"database",leadId:n,tenantId:i}),a=await Bt("QueryWebhookHistory",async()=>{let l=await Vo();try{let d=`
            SELECT 
              id, webhook_url, status_code, attempt_number,
              success, error_message, sent_at
            FROM nigredo_leads.webhook_logs
            WHERE lead_id = $1
            ORDER BY sent_at DESC
            LIMIT 10
          `,h=(await un("SelectWebhookLogs",()=>l.query(d,[n]),{leadId:n})).rows;return $e.info("Webhook history retrieved",{correlationId:t,leadId:n,webhookCount:h.length}),h}finally{l.release()}},{operation:"database",leadId:n}),u={lead:{id:o.id,name:o.name,email:o.email,phone:o.phone,company:o.company,message:o.message,source:o.source,utm_params:{utm_source:o.utm_source,utm_medium:o.utm_medium,utm_campaign:o.utm_campaign},status:o.status,created_at:o.created_at,updated_at:o.updated_at},webhook_history:a.map(l=>({id:l.id,webhook_url:l.webhook_url,status_code:l.status_code,attempt_number:l.attempt_number,success:l.success,error_message:l.error_message,sent_at:l.sent_at}))},c=Date.now()-s;return Ft.addMetric("GetLeadSuccess",be.Count,1),Ft.addMetric("GetLeadDuration",be.Milliseconds,c),Ft.publishStoredMetrics(),ot({status:"success",hasWebhookHistory:a.length>0}),Go({lead:{id:o.id,status:o.status,webhookCount:a.length}},"response"),$e.info("Get lead completed successfully",{correlationId:t,leadId:n,durationMs:c}),{statusCode:200,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify(u)}}catch(n){return $e.error("Error getting lead",n,{correlationId:t}),ot({error:!0,status:"error"}),Ft.addMetric("GetLeadError",be.Count,1),Ft.publishStoredMetrics(),n.message==="MISSING_LEAD_ID"?{statusCode:400,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Bad Request",message:"Lead ID is required",requestId:t})}:n.message==="INVALID_LEAD_ID"?{statusCode:400,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Bad Request",message:"Invalid lead ID format",requestId:t})}:n.message==="LEAD_NOT_FOUND"?(Ft.addMetric("LeadNotFound",be.Count,1),{statusCode:404,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Not Found",message:"Lead not found",requestId:t})}):{statusCode:500,headers:{"Content-Type":"application/json","X-Correlation-Id":t,"X-Request-Id":e.awsRequestId},body:JSON.stringify({error:"Internal Server Error",message:"Failed to retrieve lead",requestId:t})}}};0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
