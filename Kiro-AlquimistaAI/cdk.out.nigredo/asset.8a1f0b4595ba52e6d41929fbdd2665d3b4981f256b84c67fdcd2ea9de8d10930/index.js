"use strict";var Cf=Object.create;var cr=Object.defineProperty;var If=Object.getOwnPropertyDescriptor;var Lf=Object.getOwnPropertyNames;var Nf=Object.getPrototypeOf,Of=Object.prototype.hasOwnProperty;var la=r=>{throw TypeError(r)};var kf=(r,e,t)=>e in r?cr(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var G=(r,e)=>()=>(r&&(e=r(r=0)),e);var h=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),vs=(r,e)=>{for(var t in e)cr(r,t,{get:e[t],enumerable:!0})},da=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Lf(e))!Of.call(r,s)&&s!==t&&cr(r,s,{get:()=>e[s],enumerable:!(n=If(e,s))||n.enumerable});return r};var Ie=(r,e,t)=>(t=r!=null?Cf(Nf(r)):{},da(e||!r||!r.__esModule?cr(t,"default",{value:r,enumerable:!0}):t,r)),_s=r=>da(cr({},"__esModule",{value:!0}),r);var I=(r,e,t)=>kf(r,typeof e!="symbol"?e+"":e,t),Es=(r,e,t)=>e.has(r)||la("Cannot "+t);var m=(r,e,t)=>(Es(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?la("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Z=(r,e,t,n)=>(Es(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),B=(r,e,t)=>(Es(r,e,"access private method"),t);var ks=h((dr,Pt)=>{var Mf=200,Na="__lodash_hash_undefined__",$f=800,Df=16,Oa=9007199254740991,ka="[object Arguments]",Ff="[object Array]",Uf="[object AsyncFunction]",Bf="[object Boolean]",jf="[object Date]",Vf="[object Error]",qa="[object Function]",Wf="[object GeneratorFunction]",Xf="[object Map]",Gf="[object Number]",zf="[object Null]",Pa="[object Object]",Hf="[object Proxy]",Kf="[object RegExp]",Zf="[object Set]",Yf="[object String]",Qf="[object Undefined]",Jf="[object WeakMap]",ep="[object ArrayBuffer]",tp="[object DataView]",rp="[object Float32Array]",np="[object Float64Array]",sp="[object Int8Array]",ip="[object Int16Array]",ap="[object Int32Array]",op="[object Uint8Array]",cp="[object Uint8ClampedArray]",up="[object Uint16Array]",lp="[object Uint32Array]",dp=/[\\^$.*+?()[\]{}|]/g,fp=/^\[object .+?Constructor\]$/,pp=/^(?:0|[1-9]\d*)$/,D={};D[rp]=D[np]=D[sp]=D[ip]=D[ap]=D[op]=D[cp]=D[up]=D[lp]=!0;D[ka]=D[Ff]=D[ep]=D[Bf]=D[tp]=D[jf]=D[Vf]=D[qa]=D[Xf]=D[Gf]=D[Pa]=D[Kf]=D[Zf]=D[Yf]=D[Jf]=!1;var Ma=typeof global=="object"&&global&&global.Object===Object&&global,hp=typeof self=="object"&&self&&self.Object===Object&&self,hr=Ma||hp||Function("return this")(),$a=typeof dr=="object"&&dr&&!dr.nodeType&&dr,fr=$a&&typeof Pt=="object"&&Pt&&!Pt.nodeType&&Pt,Da=fr&&fr.exports===$a,Ts=Da&&Ma.process,ba=function(){try{var r=fr&&fr.require&&fr.require("util").types;return r||Ts&&Ts.binding&&Ts.binding("util")}catch{}}(),Ta=ba&&ba.isTypedArray;function mp(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function gp(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}function yp(r){return function(e){return r(e)}}function vp(r,e){return r?.[e]}function _p(r,e){return function(t){return r(e(t))}}var Ep=Array.prototype,Sp=Function.prototype,nn=Object.prototype,xs=hr["__core-js_shared__"],sn=Sp.toString,$e=nn.hasOwnProperty,xa=function(){var r=/[^.]+$/.exec(xs&&xs.keys&&xs.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Fa=nn.toString,bp=sn.call(Object),Tp=RegExp("^"+sn.call($e).replace(dp,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tn=Da?hr.Buffer:void 0,Ra=hr.Symbol,wa=hr.Uint8Array,Aa=tn?tn.allocUnsafe:void 0,Ua=_p(Object.getPrototypeOf,Object),Ca=Object.create,xp=nn.propertyIsEnumerable,Rp=Ep.splice,ut=Ra?Ra.toStringTag:void 0,rn=function(){try{var r=Ls(Object,"defineProperty");return r({},"",{}),r}catch{}}(),wp=tn?tn.isBuffer:void 0,Ia=Math.max,Ap=Date.now,Ba=Ls(hr,"Map"),pr=Ls(Object,"create"),Cp=function(){function r(){}return function(e){if(!dt(e))return{};if(Ca)return Ca(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function lt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Ip(){this.__data__=pr?pr(null):{},this.size=0}function Lp(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function Np(r){var e=this.__data__;if(pr){var t=e[r];return t===Na?void 0:t}return $e.call(e,r)?e[r]:void 0}function Op(r){var e=this.__data__;return pr?e[r]!==void 0:$e.call(e,r)}function kp(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=pr&&e===void 0?Na:e,this}lt.prototype.clear=Ip;lt.prototype.delete=Lp;lt.prototype.get=Np;lt.prototype.has=Op;lt.prototype.set=kp;function De(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function qp(){this.__data__=[],this.size=0}function Pp(r){var e=this.__data__,t=an(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():Rp.call(e,t,1),--this.size,!0}function Mp(r){var e=this.__data__,t=an(e,r);return t<0?void 0:e[t][1]}function $p(r){return an(this.__data__,r)>-1}function Dp(r,e){var t=this.__data__,n=an(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}De.prototype.clear=qp;De.prototype.delete=Pp;De.prototype.get=Mp;De.prototype.has=$p;De.prototype.set=Dp;function Mt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}function Fp(){this.size=0,this.__data__={hash:new lt,map:new(Ba||De),string:new lt}}function Up(r){var e=cn(this,r).delete(r);return this.size-=e?1:0,e}function Bp(r){return cn(this,r).get(r)}function jp(r){return cn(this,r).has(r)}function Vp(r,e){var t=cn(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}Mt.prototype.clear=Fp;Mt.prototype.delete=Up;Mt.prototype.get=Bp;Mt.prototype.has=jp;Mt.prototype.set=Vp;function $t(r){var e=this.__data__=new De(r);this.size=e.size}function Wp(){this.__data__=new De,this.size=0}function Xp(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function Gp(r){return this.__data__.get(r)}function zp(r){return this.__data__.has(r)}function Hp(r,e){var t=this.__data__;if(t instanceof De){var n=t.__data__;if(!Ba||n.length<Mf-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new Mt(n)}return t.set(r,e),this.size=t.size,this}$t.prototype.clear=Wp;$t.prototype.delete=Xp;$t.prototype.get=Gp;$t.prototype.has=zp;$t.prototype.set=Hp;function Kp(r,e){var t=Cs(r),n=!t&&As(r),s=!t&&!n&&Xa(r),i=!t&&!n&&!s&&za(r),a=t||n||s||i,o=a?gp(r.length,String):[],c=o.length;for(var u in r)(e||$e.call(r,u))&&!(a&&(u=="length"||s&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||Va(u,c)))&&o.push(u);return o}function Rs(r,e,t){(t!==void 0&&!un(r[e],t)||t===void 0&&!(e in r))&&Is(r,e,t)}function Zp(r,e,t){var n=r[e];(!($e.call(r,e)&&un(n,t))||t===void 0&&!(e in r))&&Is(r,e,t)}function an(r,e){for(var t=r.length;t--;)if(un(r[t][0],e))return t;return-1}function Is(r,e,t){e=="__proto__"&&rn?rn(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Yp=lh();function on(r){return r==null?r===void 0?Qf:zf:ut&&ut in Object(r)?dh(r):yh(r)}function La(r){return mr(r)&&on(r)==ka}function Qp(r){if(!dt(r)||mh(r))return!1;var e=Os(r)?Tp:fp;return e.test(Sh(r))}function Jp(r){return mr(r)&&Ga(r.length)&&!!D[on(r)]}function eh(r){if(!dt(r))return gh(r);var e=Wa(r),t=[];for(var n in r)n=="constructor"&&(e||!$e.call(r,n))||t.push(n);return t}function ja(r,e,t,n,s){r!==e&&Yp(e,function(i,a){if(s||(s=new $t),dt(i))th(r,e,a,t,ja,n,s);else{var o=n?n(ws(r,a),i,a+"",r,e,s):void 0;o===void 0&&(o=i),Rs(r,a,o)}},Ha)}function th(r,e,t,n,s,i,a){var o=ws(r,t),c=ws(e,t),u=a.get(c);if(u){Rs(r,t,u);return}var l=i?i(o,c,t+"",r,e,a):void 0,d=l===void 0;if(d){var g=Cs(c),f=!g&&Xa(c),L=!g&&!f&&za(c);l=c,g||f||L?Cs(o)?l=o:bh(o)?l=oh(o):f?(d=!1,l=sh(c,!0)):L?(d=!1,l=ah(c,!0)):l=[]:Th(c)||As(c)?(l=o,As(o)?l=xh(o):(!dt(o)||Os(o))&&(l=fh(c))):d=!1}d&&(a.set(c,l),s(l,c,n,i,a),a.delete(c)),Rs(r,t,l)}function rh(r,e){return _h(vh(r,e,Ka),r+"")}var nh=rn?function(r,e){return rn(r,"toString",{configurable:!0,enumerable:!1,value:wh(e),writable:!0})}:Ka;function sh(r,e){if(e)return r.slice();var t=r.length,n=Aa?Aa(t):new r.constructor(t);return r.copy(n),n}function ih(r){var e=new r.constructor(r.byteLength);return new wa(e).set(new wa(r)),e}function ah(r,e){var t=e?ih(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function oh(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}function ch(r,e,t,n){var s=!t;t||(t={});for(var i=-1,a=e.length;++i<a;){var o=e[i],c=n?n(t[o],r[o],o,t,r):void 0;c===void 0&&(c=r[o]),s?Is(t,o,c):Zp(t,o,c)}return t}function uh(r){return rh(function(e,t){var n=-1,s=t.length,i=s>1?t[s-1]:void 0,a=s>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(s--,i):void 0,a&&ph(t[0],t[1],a)&&(i=s<3?void 0:i,s=1),e=Object(e);++n<s;){var o=t[n];o&&r(e,o,n,i)}return e})}function lh(r){return function(e,t,n){for(var s=-1,i=Object(e),a=n(e),o=a.length;o--;){var c=a[r?o:++s];if(t(i[c],c,i)===!1)break}return e}}function cn(r,e){var t=r.__data__;return hh(e)?t[typeof e=="string"?"string":"hash"]:t.map}function Ls(r,e){var t=vp(r,e);return Qp(t)?t:void 0}function dh(r){var e=$e.call(r,ut),t=r[ut];try{r[ut]=void 0;var n=!0}catch{}var s=Fa.call(r);return n&&(e?r[ut]=t:delete r[ut]),s}function fh(r){return typeof r.constructor=="function"&&!Wa(r)?Cp(Ua(r)):{}}function Va(r,e){var t=typeof r;return e=e??Oa,!!e&&(t=="number"||t!="symbol"&&pp.test(r))&&r>-1&&r%1==0&&r<e}function ph(r,e,t){if(!dt(t))return!1;var n=typeof e;return(n=="number"?Ns(t)&&Va(e,t.length):n=="string"&&e in t)?un(t[e],r):!1}function hh(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function mh(r){return!!xa&&xa in r}function Wa(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||nn;return r===t}function gh(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function yh(r){return Fa.call(r)}function vh(r,e,t){return e=Ia(e===void 0?r.length-1:e,0),function(){for(var n=arguments,s=-1,i=Ia(n.length-e,0),a=Array(i);++s<i;)a[s]=n[e+s];s=-1;for(var o=Array(e+1);++s<e;)o[s]=n[s];return o[e]=t(a),mp(r,this,o)}}function ws(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var _h=Eh(nh);function Eh(r){var e=0,t=0;return function(){var n=Ap(),s=Df-(n-t);if(t=n,s>0){if(++e>=$f)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function Sh(r){if(r!=null){try{return sn.call(r)}catch{}try{return r+""}catch{}}return""}function un(r,e){return r===e||r!==r&&e!==e}var As=La(function(){return arguments}())?La:function(r){return mr(r)&&$e.call(r,"callee")&&!xp.call(r,"callee")},Cs=Array.isArray;function Ns(r){return r!=null&&Ga(r.length)&&!Os(r)}function bh(r){return mr(r)&&Ns(r)}var Xa=wp||Ah;function Os(r){if(!dt(r))return!1;var e=on(r);return e==qa||e==Wf||e==Uf||e==Hf}function Ga(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Oa}function dt(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function mr(r){return r!=null&&typeof r=="object"}function Th(r){if(!mr(r)||on(r)!=Pa)return!1;var e=Ua(r);if(e===null)return!0;var t=$e.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&sn.call(t)==bp}var za=Ta?yp(Ta):Jp;function xh(r){return ch(r,Ha(r))}function Ha(r){return Ns(r)?Kp(r,!0):eh(r)}var Rh=uh(function(r,e,t){ja(r,e,t)});function wh(r){return function(){return r}}function Ka(r){return r}function Ah(){return!1}Pt.exports=Rh});var po,ho=G(()=>{po="ffffffff-ffff-ffff-ffff-ffffffffffff"});var mo,go=G(()=>{mo="00000000-0000-0000-0000-000000000000"});var yo,vo=G(()=>{yo=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});function Nh(r){return typeof r=="string"&&yo.test(r)}var Qe,br=G(()=>{vo();Qe=Nh});function Oh(r){if(!Qe(r))throw TypeError("Invalid UUID");let e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Je,Tr=G(()=>{br();Je=Oh});function ae(r,e=0){return(Q[r[e+0]]+Q[r[e+1]]+Q[r[e+2]]+Q[r[e+3]]+"-"+Q[r[e+4]]+Q[r[e+5]]+"-"+Q[r[e+6]]+Q[r[e+7]]+"-"+Q[r[e+8]]+Q[r[e+9]]+"-"+Q[r[e+10]]+Q[r[e+11]]+Q[r[e+12]]+Q[r[e+13]]+Q[r[e+14]]+Q[r[e+15]]).toLowerCase()}function kh(r,e=0){let t=ae(r,e);if(!Qe(t))throw TypeError("Stringified UUID is invalid");return t}var Q,_o,Ue=G(()=>{br();Q=[];for(let r=0;r<256;++r)Q.push((r+256).toString(16).slice(1));_o=kh});function gt(){return hn>mn.length-16&&(Eo.default.randomFillSync(mn),hn=0),mn.slice(hn,hn+=16)}var Eo,mn,hn,gn=G(()=>{Eo=Ie(require("crypto")),mn=new Uint8Array(256),hn=mn.length});function qh(r,e,t){let n=e&&t||0,s=e||new Array(16);r=r||{};let i=r.node,a=r.clockseq;if(r._v6||(i||(i=Vs),a==null&&(a=yn)),i==null||a==null){let g=r.random||(r.rng||gt)();i==null&&(i=[g[0],g[1],g[2],g[3],g[4],g[5]],!Vs&&!r._v6&&(i[0]|=1,Vs=i)),a==null&&(a=(g[6]<<8|g[7])&16383,yn===void 0&&!r._v6&&(yn=a))}let o=r.msecs!==void 0?r.msecs:Date.now(),c=r.nsecs!==void 0?r.nsecs:Xs+1,u=o-Ws+(c-Xs)/1e4;if(u<0&&r.clockseq===void 0&&(a=a+1&16383),(u<0||o>Ws)&&r.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Ws=o,Xs=c,yn=a,o+=122192928e5;let l=((o&268435455)*1e4+c)%4294967296;s[n++]=l>>>24&255,s[n++]=l>>>16&255,s[n++]=l>>>8&255,s[n++]=l&255;let d=o/4294967296*1e4&268435455;s[n++]=d>>>8&255,s[n++]=d&255,s[n++]=d>>>24&15|16,s[n++]=d>>>16&255,s[n++]=a>>>8|128,s[n++]=a&255;for(let g=0;g<6;++g)s[n+g]=i[g];return e||ae(s)}var Vs,yn,Ws,Xs,vn,Gs=G(()=>{gn();Ue();Ws=0,Xs=0;vn=qh});function xr(r){let e=typeof r=="string"?Je(r):r,t=Ph(e);return typeof r=="string"?ae(t):t}function Ph(r,e=!1){return Uint8Array.of((r[6]&15)<<4|r[7]>>4&15,(r[7]&15)<<4|(r[4]&240)>>4,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,(r[1]&15)<<4|(r[2]&240)>>4,96|r[2]&15,r[3],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}var zs=G(()=>{Tr();Ue()});function Mh(r){r=unescape(encodeURIComponent(r));let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}function Rr(r,e,t){function n(s,i,a,o){var c;if(typeof s=="string"&&(s=Mh(s)),typeof i=="string"&&(i=Je(i)),((c=i)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let u=new Uint8Array(16+s.length);if(u.set(i),u.set(s,i.length),u=t(u),u[6]=u[6]&15|e,u[8]=u[8]&63|128,a){o=o||0;for(let l=0;l<16;++l)a[o+l]=u[l];return a}return ae(u)}try{n.name=r}catch{}return n.DNS=$h,n.URL=Dh,n}var $h,Dh,Hs=G(()=>{Ue();Tr();$h="6ba7b810-9dad-11d1-80b4-00c04fd430c8",Dh="6ba7b811-9dad-11d1-80b4-00c04fd430c8"});function Fh(r){return Array.isArray(r)?r=Buffer.from(r):typeof r=="string"&&(r=Buffer.from(r,"utf8")),So.default.createHash("md5").update(r).digest()}var So,bo,To=G(()=>{So=Ie(require("crypto"));bo=Fh});var Uh,xo,Ro=G(()=>{Hs();To();Uh=Rr("v3",48,bo),xo=Uh});var wo,Ks,Ao=G(()=>{wo=Ie(require("crypto")),Ks={randomUUID:wo.default.randomUUID}});function Bh(r,e,t){if(Ks.randomUUID&&!e&&!r)return Ks.randomUUID();r=r||{};let n=r.random||(r.rng||gt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){t=t||0;for(let s=0;s<16;++s)e[t+s]=n[s];return e}return ae(n)}var et,Co=G(()=>{Ao();gn();Ue();et=Bh});function jh(r){return Array.isArray(r)?r=Buffer.from(r):typeof r=="string"&&(r=Buffer.from(r,"utf8")),Io.default.createHash("sha1").update(r).digest()}var Io,Lo,No=G(()=>{Io=Ie(require("crypto"));Lo=jh});var Vh,Oo,ko=G(()=>{Hs();No();Vh=Rr("v5",80,Lo),Oo=Vh});function Zs(r={},e,t=0){let n=vn({...r,_v6:!0},new Uint8Array(16));if(n=xr(n),e){for(let s=0;s<16;s++)e[t+s]=n[s];return e}return ae(n)}var qo=G(()=>{Ue();Gs();zs()});function Ys(r){let e=typeof r=="string"?Je(r):r,t=Wh(e);return typeof r=="string"?ae(t):t}function Wh(r){return Uint8Array.of((r[3]&15)<<4|r[4]>>4&15,(r[4]&15)<<4|(r[5]&240)>>4,(r[5]&15)<<4|r[6]&15,r[7],(r[1]&15)<<4|(r[2]&240)>>4,(r[2]&15)<<4|(r[3]&240)>>4,16|(r[0]&240)>>4,(r[0]&15)<<4|(r[1]&240)>>4,r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])}var Po=G(()=>{Tr();Ue()});function Xh(r,e,t){r=r||{};let n=e&&t||0,s=e||new Uint8Array(16),i=r.random||(r.rng||gt)(),a=r.msecs!==void 0?r.msecs:Date.now(),o=r.seq!==void 0?r.seq:null,c=$o,u=Mo;return a>Re&&r.msecs===void 0&&(Re=a,o!==null&&(c=null,u=null)),o!==null&&(o>2147483647&&(o=2147483647),c=o>>>19&4095,u=o&524287),(c===null||u===null)&&(c=i[6]&127,c=c<<8|i[7],u=i[8]&63,u=u<<8|i[9],u=u<<5|i[10]>>>3),a+1e4>Re&&o===null?++u>524287&&(u=0,++c>4095&&(c=0,Re++)):Re=a,$o=c,Mo=u,s[n++]=Re/1099511627776&255,s[n++]=Re/4294967296&255,s[n++]=Re/16777216&255,s[n++]=Re/65536&255,s[n++]=Re/256&255,s[n++]=Re&255,s[n++]=c>>>4&15|112,s[n++]=c&255,s[n++]=u>>>13&63|128,s[n++]=u>>>5&255,s[n++]=u<<3&255|i[10]&7,s[n++]=i[11],s[n++]=i[12],s[n++]=i[13],s[n++]=i[14],s[n++]=i[15],e||ae(s)}var Mo,$o,Re,Do,Fo=G(()=>{gn();Ue();Mo=null,$o=null,Re=0;Do=Xh});function Gh(r){if(!Qe(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}var Uo,Bo=G(()=>{br();Uo=Gh});var Qs={};vs(Qs,{MAX:()=>po,NIL:()=>mo,parse:()=>Je,stringify:()=>_o,v1:()=>vn,v1ToV6:()=>xr,v3:()=>xo,v4:()=>et,v5:()=>Oo,v6:()=>Zs,v6ToV1:()=>Ys,v7:()=>Do,validate:()=>Qe,version:()=>Uo});var Vt=G(()=>{ho();go();Tr();Ue();Gs();zs();Ro();Co();ko();qo();Po();Fo();br();Bo()});var Go=h((u0,Xo)=>{"use strict";function Js(r){return typeof r=="function"}var oe=console.error.bind(console);function wr(r,e,t){var n=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:n,writable:!0,value:t})}function Ar(r){r&&r.logger&&(Js(r.logger)?oe=r.logger:oe("new logger isn't a function, not replacing"))}function Vo(r,e,t){if(!r||!r[e]){oe("no original function "+e+" to wrap");return}if(!t){oe("no wrapper function"),oe(new Error().stack);return}if(!Js(r[e])||!Js(t)){oe("original object and wrapper must be functions");return}var n=r[e],s=t(n,e);return wr(s,"__original",n),wr(s,"__unwrap",function(){r[e]===s&&wr(r,e,n)}),wr(s,"__wrapped",!0),wr(r,e,s),s}function zh(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{oe("must provide one or more modules to patch"),oe(new Error().stack);return}if(!(e&&Array.isArray(e))){oe("must provide one or more functions to wrap on modules");return}r.forEach(function(n){e.forEach(function(s){Vo(n,s,t)})})}function Wo(r,e){if(!r||!r[e]){oe("no function to unwrap."),oe(new Error().stack);return}if(!r[e].__unwrap)oe("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function Hh(r,e){if(r)Array.isArray(r)||(r=[r]);else{oe("must provide one or more modules to patch"),oe(new Error().stack);return}if(!(e&&Array.isArray(e))){oe("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(n){Wo(t,n)})})}Ar.wrap=Vo;Ar.massWrap=zh;Ar.unwrap=Wo;Ar.massUnwrap=Hh;Xo.exports=Ar});var Yo=h((l0,Zo)=>{"use strict";var Ho=Go(),Wt=Ho.wrap,En=Ho.unwrap,Be="wrap@before";function Sn(r,e,t){var n=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:n,writable:!0,value:t})}function Kh(r,e){for(var t=e.length,n=0;n<t;n++){var s=e[n],i=r[Be];if(typeof i=="function")i(s);else if(Array.isArray(i))for(var a=i.length,o=0;o<a;o++)i[o](s)}}function Ko(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function Zh(r,e,t){var n=Ko(r,e),s=n.filter(function(i){return t.indexOf(i)===-1});s.length>0&&Kh(r,s)}function zo(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var n=0;n<r.length;n++)t[n]=e(r[n])}return t}}Zo.exports=function(e,t,n){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!n)throw new Error("must have function to wrap listeners when emitting");function s(a){return function(c,u){var l=Ko(this,c).slice();try{var d=a.call(this,c,u);return Zh(this,c,l),d}finally{this.on.__wrapped||Wt(this,"on",s),this.addListener.__wrapped||Wt(this,"addListener",s)}}}function i(a){return function(c){if(!this._events||!this._events[c])return a.apply(this,arguments);var u=this._events[c];function l(d){return function(){this._events[c]=u;try{return d.apply(this,arguments)}finally{u=this._events[c],this._events[c]=zo(u,n)}}}Wt(this,"removeListener",l);try{return this._events[c]=zo(u,n),a.apply(this,arguments)}finally{En(this,"removeListener"),this._events[c]=u}}}e[Be]?typeof e[Be]=="function"?Sn(e,Be,[e[Be],t]):Array.isArray(e[Be])&&e[Be].push(t):Sn(e,Be,t),e.__wrapped||(Wt(e,"addListener",s),Wt(e,"on",s),Wt(e,"emit",i),Sn(e,"__unwrap",function(){En(e,"addListener"),En(e,"on"),En(e,"emit"),delete e[Be],delete e.__wrapped}),Sn(e,"__wrapped",!0))}});var tc=h((d0,ec)=>{"use strict";var O=require("util"),je=require("assert"),Yh=Yo(),F=require("async_hooks"),Cr="cls@contexts",Ir="error@context",W=process.env.DEBUG_CLS_HOOKED,N=-1;ec.exports={getNamespace:Qo,createNamespace:Qh,destroyNamespace:Jo,reset:Jh,ERROR_SYMBOL:Ir};function pe(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}pe.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,W){let n=" ".repeat(this._indent<0?0:this._indent);j(n+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+N+" active:"+O.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};pe.prototype.get=function(e){if(!this.active){if(W){let t=F.currentId(),n=F.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);j(`${s}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${N} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length}`)}return}if(W){let t=F.executionAsyncId(),n=F.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);j(s+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+N+" active:"+O.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),j(`${s}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${N} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length} active:${O.inspect(this.active)}`)}return this.active[e]};pe.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=N,W){let t=F.executionAsyncId(),n=F.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);j(`${s}CONTEXT-CREATED Context: (${this.name}) currentUid:${N} asyncHooksCurrentId:${t} triggerId:${n} len:${this._set.length} context:${O.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};pe.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(W){let n=F.triggerAsyncId(),s=F.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);j(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${N} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} context:${O.inspect(t)}`)}return e(t),t}catch(n){throw n&&(n[Ir]=t),n}finally{if(W){let n=F.triggerAsyncId(),s=F.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);j(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${N} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${O.inspect(t)}`)}this.exit(t)}};pe.prototype.runAndReturn=function(e){let t;return this.run(function(n){t=e(n)}),t};pe.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let n=e(t);if(!n||!n.then||!n.catch)throw new Error("fn must return a promise.");return W&&j("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+O.inspect(t)),n.then(s=>(W&&j("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+O.inspect(t)),this.exit(t),s)).catch(s=>{throw s[Ir]=t,W&&j("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+N+" len:"+this._set.length+" "+O.inspect(t)),this.exit(t),s})};pe.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let n=this;return function(){n.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[Ir]=t),i}finally{n.exit(t)}}};pe.prototype.enter=function(e){if(je.ok(e,"context must be provided for entering"),W){let t=F.executionAsyncId(),n=F.triggerAsyncId(),s=" ".repeat(this._indent<0?0:this._indent);j(`${s}CONTEXT-ENTER: (${this.name}) currentUid:${N} triggerId:${n} asyncHooksCurrentId:${t} len:${this._set.length} ${O.inspect(e)}`)}this._set.push(this.active),this.active=e};pe.prototype.exit=function(e){if(je.ok(e,"context must be provided for exiting"),W){let n=F.executionAsyncId(),s=F.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);j(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${N} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${O.inspect(e)}`)}if(this.active===e){je.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(W&&j("??ERROR?? context exiting but not entered - ignoring: "+O.inspect(e)),je.ok(t>=0,`context not currently entered; can't exit. 
`+O.inspect(this)+`
`+O.inspect(e))):(je.ok(t,"can't remove top context"),this._set.splice(t,1))};pe.prototype.bindEmitter=function(e){je.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,n="context@"+this.name;function s(a){a&&(a[Cr]||(a[Cr]=Object.create(null)),a[Cr][n]={namespace:t,context:t.active})}function i(a){if(!(a&&a[Cr]))return a;let o=a,c=a[Cr];return Object.keys(c).forEach(function(u){let l=c[u];o=l.namespace.bind(o,l.context)}),o}Yh(e,s,i)};pe.prototype.fromException=function(e){return e[Ir]};function Qo(r){return process.namespaces[r]}function Qh(r){je.ok(r,"namespace must be given a name."),W&&j(`NS-CREATING NAMESPACE (${r})`);let e=new pe(r);return e.id=N,F.createHook({init(n,s,i,a){if(N=F.executionAsyncId(),e.active){if(e._contexts.set(n,e.active),W){let o=" ".repeat(e._indent<0?0:e._indent);j(`${o}INIT [${s}] (${r}) asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(N===0){let o=F.triggerAsyncId(),c=e._contexts.get(o);if(c){if(e._contexts.set(n,c),W){let u=" ".repeat(e._indent<0?0:e._indent);j(`${u}INIT USING CONTEXT FROM TRIGGERID [${s}] (${r}) asyncId:${n} currentUid:${N} triggerId:${o} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(W){let u=" ".repeat(e._indent<0?0:e._indent);j(`${u}INIT MISSING CONTEXT [${s}] (${r}) asyncId:${n} currentUid:${N} triggerId:${o} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(W&&s==="PROMISE"){j(O.inspect(a,{showHidden:!0}));let o=a.parentId,c=" ".repeat(e._indent<0?0:e._indent);j(`${c}INIT RESOURCE-PROMISE [${s}] (${r}) parentId:${o} asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(n){N=F.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(N),s){if(W){let i=F.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);j(`${a}BEFORE (${r}) asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${O.inspect(s)}`),e._indent+=2}e.enter(s)}else if(W){let i=F.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);j(`${a}BEFORE MISSING CONTEXT (${r}) asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${O.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(n){N=F.executionAsyncId();let s;if(s=e._contexts.get(n)||e._contexts.get(N),s){if(W){let i=F.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);j(`${a}AFTER (${r}) asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${O.inspect(s)}`)}e.exit(s)}else if(W){let i=F.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);j(`${a}AFTER MISSING CONTEXT (${r}) asyncId:${n} currentUid:${N} triggerId:${i} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${O.inspect(s)}`)}},destroy(n){if(N=F.executionAsyncId(),W){let s=F.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);j(`${i}DESTROY (${r}) currentUid:${N} asyncId:${n} triggerId:${s} active:${O.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${O.inspect(e._contexts.get(N))}`)}e._contexts.delete(n)}}).enable(),process.namespaces[r]=e,e}function Jo(r){let e=Qo(r);je.ok(e,`can't delete nonexistent namespace! "`+r+'"'),je.ok(e.id,"don't assign to process.namespaces directly! "+O.inspect(e)),process.namespaces[r]=null}function Jh(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){Jo(r)}),process.namespaces=Object.create(null)}process.namespaces={};function j(...r){W&&process._rawDebug(`${O.format(...r)}`)}});var V=h((f0,sc)=>{"use strict";var ei=["debug","info","warn","error","silent"],rc=ei.indexOf("error"),em=tm(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),nc={error:bn("error"),info:bn("info"),warn:bn("warn"),debug:bn("debug")};function bn(r){var e=ei.indexOf(r),t=console[r]||console.log||(()=>{});return e>=em?(n,s)=>{(n||s)&&t(sm(r,n,s))}:()=>{}}function tm(r){if(r){var e=r.toLowerCase(),t=ei.indexOf(e);return t>=0?t:rc}return rc}function rm(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",n=function(s){var i=Math.floor(Math.abs(s));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+n(e/60)+":"+n(e%60)}function nm(){return process.env.LAMBDA_TASK_ROOT!==void 0}function sm(r,e,t){var n=[];nm()||(n.push(rm(new Date)),n.push(`[${r.toUpperCase()}]`)),e&&n.push(e);var s=n.join(" "),i=im(t);return[s,i].filter(a=>a.length>0).join(`
  `)}function im(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var am={setLogger:function(e){nc=e},getLogger:function(){return nc}};sc.exports=am});var ti=h((p0,ac)=>{"use strict";var om=require("crypto");function ic(r,e){this.init(r,e)}ic.prototype.init=function(e,t){var n=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=n.message,this.type=n.name,this.stack=[],this.remote=!!t,this.id=om.randomBytes(8).toString("hex"),n.stack){var s=n.stack.split(`
`);s.shift(),s.forEach(i=>{var a=i.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,c=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);c=c.split(":");var u={path:c[0],line:parseInt(c[1]),label:o||"anonymous"};this.stack.push(u)},this)}};ac.exports=ic});var cc=h((h0,oc)=>{oc.exports=cm;function cm(r){var e=!1,t=null,n=null,s=null;return a;function i(o){s&&dm(s,o),e=!1,s=n;var c=t;if(t=null,n=null,!c||!c.length){if(!s||!s.length){s=null;return}c||(c=[])}e=!0,r(c,i)}function a(o,c){e?(t||(t=[],n=[]),um(t,o),c&&n.push(c)):(c&&(s=[c]),e=!0,r(Array.isArray(o)?o:[o],i))}}function um(r,e){Array.isArray(e)?lm(r,e):r.push(e)}function lm(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function dm(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Tn=h((m0,dc)=>{"use strict";var uc=V(),we={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?uc.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(lc(e),uc.getLogger().info("Configured daemon address to "+e+"."))}},lc=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var n=e.split(":");if(!n[0])throw new Error("Invalid Daemon Address. You must specify an ip.");we.udp_ip=n[0],we.tcp_ip=n[0],we.udp_port=n[1],we.tcp_port=n[1]}else if(t.length===2){var s=t[0].split(":"),i=t[1].split(":"),a={};if(a[s[0]]=s,a[i[0]]=i,we.udp_ip=a.udp[1],we.udp_port=parseInt(a.udp[2]),we.tcp_ip=a.tcp[1],we.tcp_port=parseInt(a.tcp[2]),!we.udp_port||!we.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&lc(process.env.AWS_XRAY_DAEMON_ADDRESS);dc.exports=we});var Rn=h((g0,yc)=>{"use strict";var hc=require("dgram"),fm=cc(),xn=V(),fc='{"format":"json","version":1}',pc=`
`;function pm(r,e){var t=hc.createSocket("udp4");mc(t,r,0,function(){try{t.close()}finally{e()}})}function mc(r,e,t,n){if(t>=e.length){n();return}hm(r,e[t],function(){mc(r,e,t+1,n)})}function hm(r,e,t){var n=e.msg,s=e.offset,i=e.length,a=e.port,o=e.address,c=e.callback;r.send(n,s,i,a,o,function(u){try{c(u)}finally{t()}})}function gc(){this.batchSend=fm(pm)}gc.prototype.send=function(r,e,t,n,s,i){var a={msg:r,offset:e,length:t,port:n,address:s,callback:i};this.batchSend(a)};var mm={daemonConfig:Tn(),format:function(e){return fc+pc+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new gc:this.socket=hc.createSocket("udp4").unref());var t=this.socket,n=e.format(),s=fc+pc+n,i=Buffer.from(s),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(c){c?c.code==="EMSGSIZE"?xn.getLogger().error(o+" too large to send: "+a+" ("+i.length+" bytes)."):xn.getLogger().error("Error occured sending segment: ",c):(xn.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),xn.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};yc.exports=mm});var An=h((y0,vc)=>{"use strict";var gm=require("crypto"),wn=V(),ri=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||gm.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var n=new r,s,i;if(!e||typeof e!="string")return wn.getLogger().error("Empty or non-string trace ID provided"),n;let a=e.trim().split(t);return a.length!==3?(wn.getLogger().error("Unrecognized trace ID format"),n):(s=parseInt(a[0]),isNaN(s)||s<1?(wn.getLogger().error("Trace ID version must be positive integer"),n):(i=parseInt(a[1],16).toString(16),i==="NaN"?(wn.getLogger().error("Trace ID timestamp must be a hex-encoded value"),n):(i=i.padStart(8,"0"),n.version=s,n.timestamp=i,n.id=a[2],n)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};vc.exports=ri});var te=h((v0,_c)=>{"use strict";var ym=require("crypto"),Lr=V(),vm=An(),ni={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var n=e.length,s=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===n-1){var a=function(){for(var g=0,f=0;f<n;f++){var L=e.charAt(f);if(L==="*")return!0;if(L==="?"){if(g===s)return!1;g++}else{if(g>=s||L!=t.charAt(g))return!1;g++}}return g===s};return a()}var o=[];o[0]=!0;for(var c=0;c<n;c++){var u,l=e.charAt(c);if(l!="*")for(u=s-1;u>=0;u--)o[u+1]=!!o[u]&&(l==="?"||l===t.charAt(u));else{for(u=0;u<=s&&!o[u];)u++;for(u;u<=s;u++)o[u]=!0}o[0]=o[0]&&l==="*"}return o[s]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=ni.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){Lr.getLogger().debug("Lambda trace data found: "+e);let t=ni.processTraceData(e);var n=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,n=!0):!t.root||!t.parent||!t.sampled?Lr.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):n=!0:(t={},Lr.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=vm.FromString(t.root).toString(),r.id=t.parent||ym.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(Lr.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),n=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),Lr.getLogger().debug("Segment started: "+JSON.stringify(t)),n}},processTraceData:function(e){var t={},n={},s=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let c=o[0].trim(),u=o[1].trim(),l=c.toLowerCase(),d=s.indexOf(l)!==-1;d?t[l]=u:!d&&i-(l.length+u.length)>=0&&(n[c]=u,i-=c.length+u.length)}}}),t.data=n),t},objectWithoutProperties:function(e,t,n){t=Array.isArray(t)?t:[],n=typeof n=="boolean"?n:!1;var s=n?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};_c.exports=ni});var tt=h((_0,bc)=>{"use strict";var{safeParseInt:Ec}=te(),Sc=V(),_m=100,si={streamingThreshold:_m,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(si.streamingThreshold=e,Sc.getLogger().debug("Subsegment streaming threshold set to: "+e)):Sc.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return si.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=Ec(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=Ec(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};bc.exports=si});var Rc=h((E0,xc)=>{"use strict";var{getHttpResponseData:Em}=tt(),{stripQueryStringFromPath:Sm}=te();function Tc(r,e,t){this.init(r,e,t)}Tc.prototype.init=function(e,t,n){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+Sm(e.path):"",method:e.method||""},n&&(this.request.traced=!0),t&&(this.response=Em(t))};xc.exports=Tc});var Nr=h((S0,wc)=>{"use strict";var bm=require("crypto"),Tm=ti(),xm=Rc(),Rm=Rn(),Cn=tt(),wm=te(),Ve=V();function k(r){this.init(r)}k.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=bm.randomBytes(8).toString("hex"),this.name=e,this.start_time=Cn.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};k.prototype.addNewSubsegment=function(e){let t=new k(e);return this.addSubsegment(t),t};k.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};k.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new k(e);return this.addSubsegment(t),t.notTraced=!0,t};k.prototype.addSubsegment=function(r){if(!(r instanceof k))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};k.prototype.removeSubsegment=function(e){if(!(e instanceof k))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};k.prototype.addAttribute=function(e,t){this[e]=t};k.prototype.addPrecursorId=function(r){typeof r!="string"&&Ve.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};k.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){Ve.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){Ve.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};k.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){Ve.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){Ve.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var n=t||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][r]=e??"")};k.prototype.addSqlData=function(e){this.sql=e};k.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){Ve.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new Tm(e,t))};k.prototype.addRemoteRequestData=function(e,t,n){this.http=new xm(e,t,n),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};k.prototype.addFaultFlag=function(){this.fault=!0};k.prototype.addErrorFlag=function(){this.error=!0};k.prototype.addThrottleFlag=function(){this.throttle=!0};k.prototype.close=function(e,t){var n=this.segment;this.end_time=Cn.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),n&&n.counter>Cn.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};k.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};k.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};k.prototype.isClosed=function(){return!this.in_progress};k.prototype.flush=function(){if(!this.parent||!this.segment){Ve.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?Rm.send(this):Ve.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):Ve.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};k.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};k.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};k.prototype.toString=function(){return this.serialize()};k.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=wm.objectWithoutProperties(this,e,!1);return t};k.prototype.serialize=function(e){return JSON.stringify(e??this,Cn.getJsonStringifyReplacer())};wc.exports=k});var Or=h((b0,Ic)=>{"use strict";var Am=require("crypto"),Cm=ti(),Im=Rn(),he=tt(),In=Nr(),Ac=An(),Cc=te(),rt=V();function $(r,e,t){this.init(r,e,t)}$.prototype.init=function(e,t,n){if(typeof e!="string")throw new Error("Segment name must be of type string.");var s;t&&typeof t=="string"?s=Ac.FromString(t):s=new Ac;var i=Am.randomBytes(8).toString("hex"),a=he.getCurrentTime();this.trace_id=s.toString(),this.id=i,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,n&&(this.parent_id=n),he.serviceData&&this.setServiceData(he.serviceData),he.pluginData&&this.addPluginData(he.pluginData),he.origin&&(this.origin=he.origin),he.sdkData&&this.setSDKData(he.sdkData)};$.prototype.addIncomingRequestData=function(e){this.http=e};$.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){rt.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){rt.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};$.prototype.setUser=function(r){typeof r!="string"&&rt.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};$.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){rt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){rt.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var n=t||"default";this.metadata||(this.metadata={}),this.metadata[n]||(this.metadata[n]={}),n!=="__proto__"&&(this.metadata[n][r]=e??"")};$.prototype.setSDKData=function(e){if(!e){rt.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};$.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};$.prototype.setServiceData=function(e){if(!e){rt.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};$.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};$.prototype.addNewSubsegment=function(e){var t=new In(e);return this.addSubsegment(t),t};$.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};$.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new In(e);return this.addSubsegment(t),t.notTraced=!0,t};$.prototype.addSubsegment=function(e){if(!(e instanceof In))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};$.prototype.removeSubsegment=function(e){if(!(e instanceof In))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};$.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){rt.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new Cm(e,t))};$.prototype.addFaultFlag=function(){this.fault=!0};$.prototype.addErrorFlag=function(){this.error=!0};$.prototype.addThrottleFlag=function(){this.throttle=!0};$.prototype.isClosed=function(){return!this.in_progress};$.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>he.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(n){n.streamSubsegments()||t.push(n)}),this.subsegments=t}};$.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};$.prototype.close=function(r,e){this.end_time||(this.end_time=he.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};$.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=Cc.objectWithoutProperties(this,["counter","notTraced"],!0);Im.send(e)}};$.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=Cc.objectWithoutProperties(this,e,!1);return this.serialize(t)};$.prototype.toString=function(){return this.serialize()};$.prototype.serialize=function(e){return JSON.stringify(e??this,he.getJsonStringifyReplacer())};Ic.exports=$});var st=h((T0,kc)=>{"use strict";var kr=tc(),Ae=V(),ii=Or(),Lc=Nr(),We=!0,nt="AWSXRay",Nc="segment",Oc=!1,re={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);Ae.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!re.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,n=e.Segment,s=null;return t&&(t instanceof ii||t instanceof Lc)?(s=t,delete e.XRaySegment,delete e.XraySegment):n&&(n instanceof ii||n instanceof Lc)&&(s=n,delete e.Segment),s}},getNamespace:function(){return kr.getNamespace(nt)||kr.createNamespace(nt)},resolveSegment:function(e){if(We)return this.getSegment();if(e&&!We)return e;!e&&!We&&re.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(We){var e=re.getNamespace(nt).get(Nc);return e?e instanceof ii&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():re.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else re.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){We?re.getNamespace(nt).set(Nc,e)||Ae.getLogger().warn("Failed to set the current sub/segment on the context."):re.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return We},enableAutomaticMode:function(){We=!0,re.getNamespace(nt),Ae.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){We=!1,kr.getNamespace(nt)&&kr.destroyNamespace(nt),Ae.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Oc)Ae.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=re.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)re.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?Ae.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):Ae.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(re.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")re.contextMissingStrategy.contextMissing=e,Ae.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(We=!1,Ae.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(kr.createNamespace(nt),Ae.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(re.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Oc=!0):(re.contextMissingStrategy.contextMissing=re.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,Ae.getLogger().debug("Using default context missing strategy: LOG_ERROR"));kc.exports=re});var oi=h((x0,qc)=>{"use strict";var{getHttpResponseData:Lm}=tt();function ai(r){this.init(r)}ai.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],n;e.connection&&(n=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:Nm(e)||"",url:n||""},t&&(this.request.x_forwarded_for=t)};var Nm=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};ai.prototype.close=function(e){this.response=Lm(e)};qc.exports=ai});var Mc=h((R0,Pc)=>{"use strict";function ci(r,e){this.init(r,e)}ci.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};ci.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};Pc.exports=ci});var $c=h((w0,Om)=>{Om.exports={default:{fixed_target:1,rate:.05},version:2}});var li=h((A0,jc)=>{"use strict";var km=require("fs"),Dc=Mc(),ui=te(),qm=$c(),Ln=V(),Uc={shouldSample:function(e){var t=e.host,n=e.httpMethod,s=e.urlPath,i="{ http_method: "+n+", host: "+t+", url_path: "+s+" }",a;return this.rules.some(function(o){if(o.default||t==null||ui.wildcardMatch(o.host,t)&&(n==null||ui.wildcardMatch(o.http_method,n))&&(s==null||ui.wildcardMatch(o.url_path,s)))return a=o.reservoir,Ln.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(Ln.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Ln.getLogger().info("Using custom sampling rules file: "+e),this.rules=Fc(JSON.parse(km.readFileSync(e,"utf8")))):(Ln.getLogger().info("Using custom sampling rules source."),this.rules=Fc(e)):this.rules=Bc(qm)}},Fc=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Bc(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Bc=function(e){var t,n=[];if(e.default){var s=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&s.push("fixed_target"),typeof e.default.rate>"u"&&s.push("rate"),s.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+s+".");t={default:!0,reservoir:new Dc(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},c;e.version===2&&(c={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(c={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var u in a){var l=a[u];if(!c[u]&&u!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+u+".");if(u!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+u+'" has invalid value: '+l+".");e.version===2&&(o[u]=l),e.version===1&&u==="service_name"?o.host=l:o[u]=l,delete c[u]}if(Object.keys(c).length!==0&&c.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(c)+".");var d=o;d.reservoir=new Dc(a.fixed_target,a.rate),n.push(d)}),n.push(t),n};Uc.setLocalRules();jc.exports=Uc});var Wc=h((C0,Vc)=>{"use strict";function Xt(){this.init()}Xt.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Xt.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Xt.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Xt.prototype.loadNewQuota=function(e,t,n){e&&(this.quota=e),t&&(this.TTL=t),n&&(this.reportInterval=n/10)};Xt.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Vc.exports=Xt});var Gc=h((I0,Xc)=>{"use strict";var qr=te(),Pm=Wc();function Y(r,e,t,n,s,i,a,o,c){this.init(r,e,t,n,s,i,a,o,c)}Y.prototype.init=function(e,t,n,s,i,a,o,c,u){this.name=e,this.priority=t,this.rate=n,this.host=i,this.httpMethod=a,this.urlPath=o,this.serviceName=c,this.serviceType=u,this.reservoir=new Pm,this.borrow=!!s,this.resetStatistics()};Y.prototype.match=function(e){var t=e.host,n=e.httpMethod,s=e.serviceName,i=e.urlPath,a=e.serviceType;return this.isDefault()||(!t||qr.wildcardMatch(this.host,t))&&(!n||qr.wildcardMatch(this.httpMethod,n))&&(!s||qr.wildcardMatch(this.serviceName,s))&&(!i||qr.wildcardMatch(this.urlPath,i))&&(!a||qr.wildcardMatch(this.serviceType,a))};Y.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};Y.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};Y.prototype.isDefault=function(){return this.name==="Default"};Y.prototype.incrementRequestCount=function(){this.requestCount++};Y.prototype.incrementBorrowCount=function(){this.borrowCount++};Y.prototype.incrementSampledCount=function(){this.sampledCount++};Y.prototype.setRate=function(e){this.rate=e};Y.prototype.getRate=function(){return this.rate};Y.prototype.getName=function(){return this.name};Y.prototype.getPriority=function(){return this.priority};Y.prototype.getReservoir=function(){return this.reservoir};Y.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};Y.prototype.canBorrow=function(){return this.borrow};Y.prototype.everMatched=function(){return this.requestCount>0};Y.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Xc.exports=Y});var di=h((L0,Zc)=>{"use strict";var Mm=require("crypto"),$m=V(),Dm=Gc(),Nn=Tn(),Fm=require("util"),Um=require("http"),Hc={clientId:Mm.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:$m,httpClient:Um,fetchSamplingRules:function(e){let t="{}",n=zc(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,a=>{var o="";a.on("data",c=>{o+=c}),a.on("error",c=>{e(c)}),a.on("end",()=>{var c;try{c=JSON.parse(o)}catch(l){e(l);return}if(!c){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var u=jm(c);e(null,u)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let n=JSON.stringify(Bm(e)),s=zc(this.samplingTargetsPath,n.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,o=>{var c="";o.on("data",u=>{c+=u}),o.on("error",u=>{t(u)}),o.on("end",()=>{var u;try{u=JSON.parse(c)}catch(g){t(g);return}if(!u||typeof u.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=Vm(u),d=Kc(u.LastRuleModification);t(null,l,d)})});a.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling targets.`))}),a.write(n),a.end()}},Bm=function(e){var t=[],n=Math.floor(new Date().getTime()/1e3);return e.forEach(function(s){var i=s.snapshotStatistics(),a={RuleName:s.getName(),ClientID:Hc.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:n};t.push(a)}),{SamplingStatisticsDocuments:t}},jm=function(e){var t=[],n=e.SamplingRuleRecords||[];return n.forEach(function(s){if(s=s.SamplingRule,Wm(s)){var i=new Dm(s.RuleName,s.Priority,s.FixedRate,s.ReservoirSize,s.Host,s.HTTPMethod,s.URLPath,s.ServiceName,s.ServiceType);t.push(i)}}),t},Vm=function(e){var t=e.SamplingTargetDocuments||[],n={};return t.forEach(function(s){var i={rate:s.FixedRate,quota:s.ReservoirQuota,TTL:Kc(s.ReservoirQuotaTTL),interval:s.Interval};n[s.RuleName]=i}),n},Wm=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},Kc=function(e){return new Date(e).getTime()/1e3},zc=function(e,t){return{hostname:Nn.tcp_ip,port:Nn.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:Fm.format("%s:%d",Nn.tcp_ip,Nn.tcp_port)}}};Zc.exports=Hc});var On=h((N0,Yc)=>{"use strict";var Xm=3600,fi={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(Gm(t))return null;var n;return this.rules.forEach(function(s){!n&&s.match(e)&&(n=s),s.isDefault()&&!n&&(n=s)}),n},loadRules:function(e){var t={};this.rules.forEach(function(n){t[n.getName()]=n}),this.rules=e,this.rules.forEach(function(n){var s=t[n.getName()];s&&n.merge(s)}),this.rules.sort(function(n,s){var i=n.getPriority()-s.getPriority();return i!==0?i:n.getName()>s.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var n=e[t.getName()];n&&(t.getReservoir().loadNewQuota(n.quota,n.TTL,n.interval),t.setRate(n.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},Gm=function(e){return fi.getLastUpdated()?e>fi.getLastUpdated()+Xm:!0};Yc.exports=fi});var hi=h((O0,tu)=>{"use strict";var pi=V(),zm=di(),Qc=On(),Hm=5*60*1e3,Km={start:function(){this.poller&&clearInterval(this.poller),Jc(!1),this.poller=setInterval(Jc,Hm),this.poller.unref()}},Jc=function(e){if(e=typeof e>"u"?!0:e,e){var t=Ym();setTimeout(eu,t)}else eu()},eu=function(){try{Zm()}catch(e){pi.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Zm=function(){var e=Math.floor(new Date().getTime()/1e3);zm.fetchSamplingRules(function(t,n){t?pi.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):n.length!==0&&(Qc.loadRules(n),Qc.timestamp(e),pi.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Ym=function(){return Math.random()*5};tu.exports=Km});var iu=h((k0,su)=>{"use strict";var Qm=hi(),Jm=di(),mi=On(),kn=V(),ru=10*1e3,nu={interval:ru,start:function(){this.poller=setInterval(eg,ru+ng()),this.poller.unref()}},eg=function(){try{tg()}catch(e){kn.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},tg=function(){var e=rg();e&&e.length>0&&Jm.fetchTargets(e,function(t,n,s){if(t){kn.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}mi.loadTargets(n),s>mi.getLastUpdated()&&(kn.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),Qm.start()),kn.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},rg=function(){var e=mi.getRules(),t=[];return e.forEach(function(n){n.everMatched()&&n.timeToReport()&&t.push(n)}),t},ng=function(){return Math.random()/nu.interval};su.exports=nu});var ou=h((q0,au)=>{"use strict";var gi=V(),sg=require("util"),ig=tt(),ag={localSampler:li(),rulePoller:hi(),targetPoller:iu(),ruleCache:On(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=ig.origin);var t=Math.floor(new Date().getTime()/1e3),n=this.ruleCache.getMatchedRule(e,t);return n?(gi.getLogger().debug(sg.format("Rule %s is matched.",n.getName())),og(n,t)):(gi.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(s){gi.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+s)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},og=function(e,t){e.incrementRequestCount();var n=e.getReservoir(),s=!0,i=n.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():s=!1,s?e.getName():!1};au.exports=ag});var vi=h((P0,cu)=>{"use strict";var cg=Or(),ug=oi(),lg=V(),dg=te(),fg=te().wildcardMatch,pg=te().processTraceData,yi="x-amzn-trace-id",hg=!!process.env.AWS_XRAY_TRACING_NAME,mg={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:ou(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[yi]&&(t=pg(e.headers[yi])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?fg(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,n){var s;if(e.sampled==="1")s=!0;else if(e.sampled==="0")s=!1;else{var i={host:n.req.headers.host,httpMethod:n.req.method,urlPath:n.req.url,serviceName:t.name};s=this.sampler.shouldSample(i),(s instanceof String||typeof s=="string")&&(t.setMatchedSamplingRule(s),s=!0)}e.sampled==="?"&&n.header&&n.header(yi,"Root="+e.root+";Sampled="+(s?"1":"0")),s||(t.notTraced=!0)},setDefaultName:function(e){hg||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=li()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,n){lg.getLogger().debug(e+": { url: "+t+", name: "+n.name+", trace_id: "+n.trace_id+", id: "+n.id+", sampled: "+!n.notTraced+" }")},traceRequestResponseCycle:function(e,t){var n=this.processHeaders(e),s=this.resolveName(e.headers.host),i=new cg(s,n.root,n.parent);t.req||(t.req=e),this.resolveSampling(n,i,t),i.addIncomingRequestData(new ug(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,o=!1,c=function(){if(o)return;o=!0,t.statusCode===429&&i.addThrottleFlag();let u=dg.getCauseTypeFromHttpStatus(t.statusCode);u&&(i[u]=!0),i.http.close(t),i.close(),a("Closed middleware segment successfully",e.url,i)};return t.on("finish",c),t.on("close",c),i}};cu.exports=mg});var uu=h(Pn=>{"use strict";Object.defineProperty(Pn,"__esModule",{value:!0});Pn.InvokeStore=void 0;var gg=require("async_hooks"),_i=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";_i||(globalThis.awslambda=globalThis.awslambda||{});var yg={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},Pr=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let n=this.storage.getStore();n&&(n[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};I(Pr,"storage",new gg.AsyncLocalStorage),I(Pr,"PROTECTED_KEYS",yg);var qn;!_i&&globalThis.awslambda?.InvokeStore?qn=globalThis.awslambda.InvokeStore:(qn=Pr,!_i&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=qn));Pn.InvokeStore=qn});var fu=h((D0,du)=>{"use strict";var Mn=st(),vg=vi(),Ei=te().LambdaUtils,_g=Or(),Eg=Rn(),Sg=tt(),bi=V(),lu=An(),{InvokeStore:bg}=uu(),Si=null;du.exports.init=function(){Mn.enableManualMode=function(){bi.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},Eg.disableReusableSocket(),Sg.setStreamingThreshold(0),bi.getLogger().info("Disabling centralized sampling in Lambda environment."),vg.disableCentralizedSampling();var e=Mn.getNamespace();e.enter(e.createContext()),Mn.setSegment(Tg())};var Tg=function(){var e=new _g("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],n=["incrementCounter","decrementCounter","isClosed","close","format","flush"],s=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(n.indexOf(i)===-1?e[i]=function(){var a=i;return function(){bi.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=lu.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=lu.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let o=bg.getXRayTraceId(),c=process.env._X_AMZN_TRACE_ID;var u=o??c;u?u!=Si&&(this.reset(),Ei.populateTraceData(e,u)&&(Si=u)):(this.reset(),Mn.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},Ei.validTraceData(s)&&Ei.populateTraceData(e,s)&&(Si=s),e}});var pu=h((F0,xg)=>{xg.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var gu=h((U0,mu)=>{"use strict";var Ti=require("http"),hu={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var s=5,i=function(){var a=Ti.__request?Ti.__request:Ti.request,o=a(r,function(c){var u="";c.on("data",function(l){u+=l}),c.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{u=JSON.parse(u)}catch(l){e(l);return}e(null,u)}else s>0&&Math.floor(this.statusCode/100)===5?(s--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});o.on("error",function(c){e(c)}),o.on("timeout",function(){o.abort()}),o.setTimeout(hu.METADATA_TIMEOUT),o.end()};i()}};mu.exports=hu});var Su=h((B0,Eu)=>{"use strict";var vu=gu(),yu=V(),xi=require("http"),Rg={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(n){let s=_u(e,"GET",n?{"X-aws-ec2-metadata-token":n}:{});vu.getPluginMetadata(s,function(i,a){if(i||!a){yu.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};r(o)})}wg(function(n){n===null&&yu.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(n)})},originName:"AWS::EC2::Instance"};function wg(r){let e=xi.__request?xi.__request:xi.request,s=_u("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(s,function(a){let o="";a.on("data",function(c){o+=c}),a.on("end",function(){this.statusCode===200||this.statusCode===300?r(o):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(vu.METADATA_TIMEOUT),i.end()}function _u(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}Eu.exports=Rg});var Tu=h((j0,bu)=>{"use strict";var Ag=require("os"),Cg={getData:function(r){r({ecs:{container:Ag.hostname()}})},originName:"AWS::ECS::Container"};bu.exports=Cg});var Ru=h((V0,xu)=>{"use strict";var Ig=require("fs"),Lg=V(),Ng="/var/elasticbeanstalk/xray/environment.conf",Og={getData:function(r){Ig.readFile(Ng,"utf8",function(e,t){if(e)Lg.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var n=JSON.parse(t),s={elastic_beanstalk:{environment:n.environment_name,version_label:n.version_label,deployment_id:n.deployment_id}};r(s)}})},originName:"AWS::ElasticBeanstalk::Environment"};xu.exports=Og});var wu=h((W0,kg)=>{kg.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Ou=h((X0,Nu)=>{"use strict";var Iu=require("fs"),Gt=V(),qg=wu(),$n={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function Fn(r){this.init(r)}Fn.prototype.init=function(e){e?typeof e=="string"?(Gt.getLogger().info("Using custom AWS whitelist file: "+e),this.services=Dn(JSON.parse(Iu.readFileSync(e,"utf8")))):(Gt.getLogger().info("Using custom AWS whitelist source."),this.services=Dn(e)):this.services=qg.services};Fn.prototype.append=function(e){var t={};typeof e=="string"?(Gt.getLogger().info("Appending AWS whitelist with custom file: "+e),t=Dn(JSON.parse(Iu.readFileSync(e,"utf8")))):(Gt.getLogger().info("Appending AWS whitelist with a custom source."),t=Dn(e));for(var n in t)this.services[n]=t[n]};Fn.prototype.capture=function(e,t){var n=t.request.operation,s=this.services[e]!==void 0?this.services[e].operations[n]:null;if(s===null){Gt.getLogger().debug('Call "'+e+"."+n+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var a in s){var o=s[a];a===$n.REQ_PARAMS?Au(o,t.request.params,i):a===$n.REQ_DESC?Cu(o,t.request.params,i):a===$n.RES_PARAMS?t.data&&Au(o,t.data,i):a===$n.RES_DESC?t.data&&Cu(o,t.data,i):Gt.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function Au(r,e,t){r.forEach(function(n){if(typeof e[n]<"u"){var s=Lu(n);this[s]=e[n]}},t)}function Cu(r,e,t){for(var n in r){var s=r[n];if(typeof e[n]<"u"){var i;if(s.list&&s.get_count?i=e[n]?e[n].length:0:i=s.get_keys===!0?Object.keys(e[n]):e[n],typeof s.rename_to=="string")t[s.rename_to]=i;else{var a=Lu(n);t[a]=i}}}}function Lu(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function Dn(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Nu.exports=Fn});var Mr=h((G0,Un)=>{"use strict";var ku=Ou(),Ri=new ku;function wi(r,e){this.init(r,e)}wi.prototype.init=function(e,t){this.operation=$g(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(Ri.capture(t.toLowerCase(),e))};wi.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var Pg=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Ri=new ku(e)},Mg=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");Ri.append(e)};function $g(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}Un.exports=wi;Un.exports.appendAWSWhitelist=Mg;Un.exports.setAWSWhitelist=Pg});var jn=h((z0,Bn)=>{"use strict";var yt=st(),$r=V(),qu=function(e,t,n){Ai(e,t);var s,i,a=yt.resolveSegment(n);if(!a)return $r.getLogger().warn("Failed to capture function."),t();s=a.addNewSubsegment(e),i=Pu(t,s);try{let o=i(s);return s.close(),o}catch(o){throw s.close(o),o}},Dg=function(e,t,n){Ai(e,t);var s,i,a=yt.resolveSegment(n);if(!a)return $r.getLogger().warn("Failed to capture async function."),t();s=a.addNewSubsegment(e),i=Pu(t,s);try{return i(s)}catch(o){throw s.close(o),o}},Fg=function(e,t,n){Ai(e,t);var s=yt.resolveSegment(n);return s?(s.incrementCounter(),function(){var i=yt.resolveSegment(n),a=Array.prototype.slice.call(arguments);qu(e,t.bind.apply(t,[null].concat(a)),i),s.decrementCounter()}.bind(this)):($r.getLogger().warn("Failed to capture callback function."),t)};function Pu(r,e){var t;if(yt.isAutomaticMode()){var n=yt.getNamespace(),s=function(){var i;return n.run(function(){yt.setSegment(e),i=r(e)}),i};t=s}else t=r;return t}function Ai(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',$r.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',$r.getLogger().error(t),new Error(t)}Bn.exports.captureFunc=qu;Bn.exports.captureAsyncFunc=Dg;Bn.exports.captureCallbackFunc=Fg});var Dr=h((H0,Mu)=>{"use strict";var Ug="2.0.0",Bg=Number.MAX_SAFE_INTEGER||9007199254740991,jg=16,Vg=250,Wg=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Mu.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:jg,MAX_SAFE_BUILD_LENGTH:Vg,MAX_SAFE_INTEGER:Bg,RELEASE_TYPES:Wg,SEMVER_SPEC_VERSION:Ug,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var Fr=h((K0,$u)=>{"use strict";var Xg=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};$u.exports=Xg});var zt=h((Ne,Du)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:Ci,MAX_SAFE_BUILD_LENGTH:Gg,MAX_LENGTH:zg}=Dr(),Hg=Fr();Ne=Du.exports={};var Kg=Ne.re=[],Zg=Ne.safeRe=[],_=Ne.src=[],Yg=Ne.safeSrc=[],E=Ne.t={},Qg=0,Ii="[a-zA-Z0-9-]",Jg=[["\\s",1],["\\d",zg],[Ii,Gg]],ey=r=>{for(let[e,t]of Jg)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},x=(r,e,t)=>{let n=ey(e),s=Qg++;Hg(r,s,e),E[r]=s,_[s]=e,Yg[s]=n,Kg[s]=new RegExp(e,t?"g":void 0),Zg[s]=new RegExp(n,t?"g":void 0)};x("NUMERICIDENTIFIER","0|[1-9]\\d*");x("NUMERICIDENTIFIERLOOSE","\\d+");x("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Ii}*`);x("MAINVERSION",`(${_[E.NUMERICIDENTIFIER]})\\.(${_[E.NUMERICIDENTIFIER]})\\.(${_[E.NUMERICIDENTIFIER]})`);x("MAINVERSIONLOOSE",`(${_[E.NUMERICIDENTIFIERLOOSE]})\\.(${_[E.NUMERICIDENTIFIERLOOSE]})\\.(${_[E.NUMERICIDENTIFIERLOOSE]})`);x("PRERELEASEIDENTIFIER",`(?:${_[E.NONNUMERICIDENTIFIER]}|${_[E.NUMERICIDENTIFIER]})`);x("PRERELEASEIDENTIFIERLOOSE",`(?:${_[E.NONNUMERICIDENTIFIER]}|${_[E.NUMERICIDENTIFIERLOOSE]})`);x("PRERELEASE",`(?:-(${_[E.PRERELEASEIDENTIFIER]}(?:\\.${_[E.PRERELEASEIDENTIFIER]})*))`);x("PRERELEASELOOSE",`(?:-?(${_[E.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${_[E.PRERELEASEIDENTIFIERLOOSE]})*))`);x("BUILDIDENTIFIER",`${Ii}+`);x("BUILD",`(?:\\+(${_[E.BUILDIDENTIFIER]}(?:\\.${_[E.BUILDIDENTIFIER]})*))`);x("FULLPLAIN",`v?${_[E.MAINVERSION]}${_[E.PRERELEASE]}?${_[E.BUILD]}?`);x("FULL",`^${_[E.FULLPLAIN]}$`);x("LOOSEPLAIN",`[v=\\s]*${_[E.MAINVERSIONLOOSE]}${_[E.PRERELEASELOOSE]}?${_[E.BUILD]}?`);x("LOOSE",`^${_[E.LOOSEPLAIN]}$`);x("GTLT","((?:<|>)?=?)");x("XRANGEIDENTIFIERLOOSE",`${_[E.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);x("XRANGEIDENTIFIER",`${_[E.NUMERICIDENTIFIER]}|x|X|\\*`);x("XRANGEPLAIN",`[v=\\s]*(${_[E.XRANGEIDENTIFIER]})(?:\\.(${_[E.XRANGEIDENTIFIER]})(?:\\.(${_[E.XRANGEIDENTIFIER]})(?:${_[E.PRERELEASE]})?${_[E.BUILD]}?)?)?`);x("XRANGEPLAINLOOSE",`[v=\\s]*(${_[E.XRANGEIDENTIFIERLOOSE]})(?:\\.(${_[E.XRANGEIDENTIFIERLOOSE]})(?:\\.(${_[E.XRANGEIDENTIFIERLOOSE]})(?:${_[E.PRERELEASELOOSE]})?${_[E.BUILD]}?)?)?`);x("XRANGE",`^${_[E.GTLT]}\\s*${_[E.XRANGEPLAIN]}$`);x("XRANGELOOSE",`^${_[E.GTLT]}\\s*${_[E.XRANGEPLAINLOOSE]}$`);x("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Ci}})(?:\\.(\\d{1,${Ci}}))?(?:\\.(\\d{1,${Ci}}))?`);x("COERCE",`${_[E.COERCEPLAIN]}(?:$|[^\\d])`);x("COERCEFULL",_[E.COERCEPLAIN]+`(?:${_[E.PRERELEASE]})?(?:${_[E.BUILD]})?(?:$|[^\\d])`);x("COERCERTL",_[E.COERCE],!0);x("COERCERTLFULL",_[E.COERCEFULL],!0);x("LONETILDE","(?:~>?)");x("TILDETRIM",`(\\s*)${_[E.LONETILDE]}\\s+`,!0);Ne.tildeTrimReplace="$1~";x("TILDE",`^${_[E.LONETILDE]}${_[E.XRANGEPLAIN]}$`);x("TILDELOOSE",`^${_[E.LONETILDE]}${_[E.XRANGEPLAINLOOSE]}$`);x("LONECARET","(?:\\^)");x("CARETTRIM",`(\\s*)${_[E.LONECARET]}\\s+`,!0);Ne.caretTrimReplace="$1^";x("CARET",`^${_[E.LONECARET]}${_[E.XRANGEPLAIN]}$`);x("CARETLOOSE",`^${_[E.LONECARET]}${_[E.XRANGEPLAINLOOSE]}$`);x("COMPARATORLOOSE",`^${_[E.GTLT]}\\s*(${_[E.LOOSEPLAIN]})$|^$`);x("COMPARATOR",`^${_[E.GTLT]}\\s*(${_[E.FULLPLAIN]})$|^$`);x("COMPARATORTRIM",`(\\s*)${_[E.GTLT]}\\s*(${_[E.LOOSEPLAIN]}|${_[E.XRANGEPLAIN]})`,!0);Ne.comparatorTrimReplace="$1$2$3";x("HYPHENRANGE",`^\\s*(${_[E.XRANGEPLAIN]})\\s+-\\s+(${_[E.XRANGEPLAIN]})\\s*$`);x("HYPHENRANGELOOSE",`^\\s*(${_[E.XRANGEPLAINLOOSE]})\\s+-\\s+(${_[E.XRANGEPLAINLOOSE]})\\s*$`);x("STAR","(<|>)?=?\\s*\\*");x("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");x("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var Vn=h((Z0,Fu)=>{"use strict";var ty=Object.freeze({loose:!0}),ry=Object.freeze({}),ny=r=>r?typeof r!="object"?ty:r:ry;Fu.exports=ny});var Li=h((Y0,ju)=>{"use strict";var Uu=/^[0-9]+$/,Bu=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Uu.test(r),n=Uu.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},sy=(r,e)=>Bu(e,r);ju.exports={compareIdentifiers:Bu,rcompareIdentifiers:sy}});var ne=h((Q0,Wu)=>{"use strict";var Wn=Fr(),{MAX_LENGTH:Vu,MAX_SAFE_INTEGER:Xn}=Dr(),{safeRe:Gn,t:zn}=zt(),iy=Vn(),{compareIdentifiers:Ni}=Li(),Oi=class r{constructor(e,t){if(t=iy(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Vu)throw new TypeError(`version is longer than ${Vu} characters`);Wn("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?Gn[zn.LOOSE]:Gn[zn.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>Xn||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Xn||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Xn||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(s=>{if(/^[0-9]+$/.test(s)){let i=+s;if(i>=0&&i<Xn)return i}return s}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Wn("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],s=e.prerelease[t];if(Wn("prerelease compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Ni(n,s)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],s=e.build[t];if(Wn("build compare",t,n,s),n===void 0&&s===void 0)return 0;if(s===void 0)return 1;if(n===void 0)return-1;if(n===s)continue;return Ni(n,s)}while(++t)}inc(e,t,n){if(e.startsWith("pre")){if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let s=`-${t}`.match(this.options.loose?Gn[zn.PRERELEASELOOSE]:Gn[zn.PRERELEASE]);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let s=Number(n)?1:0;if(this.prerelease.length===0)this.prerelease=[s];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(s)}}if(t){let i=[t,s];n===!1&&(i=[t]),Ni(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Wu.exports=Oi});var vt=h((J0,Gu)=>{"use strict";var Xu=ne(),ay=(r,e,t=!1)=>{if(r instanceof Xu)return r;try{return new Xu(r,e)}catch(n){if(!t)return null;throw n}};Gu.exports=ay});var Hu=h((ex,zu)=>{"use strict";var oy=vt(),cy=(r,e)=>{let t=oy(r,e);return t?t.version:null};zu.exports=cy});var Zu=h((tx,Ku)=>{"use strict";var uy=vt(),ly=(r,e)=>{let t=uy(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};Ku.exports=ly});var Ju=h((rx,Qu)=>{"use strict";var Yu=ne(),dy=(r,e,t,n,s)=>{typeof t=="string"&&(s=n,n=t,t=void 0);try{return new Yu(r instanceof Yu?r.version:r,t).inc(e,n,s).version}catch{return null}};Qu.exports=dy});var rl=h((nx,tl)=>{"use strict";var el=vt(),fy=(r,e)=>{let t=el(r,null,!0),n=el(e,null,!0),s=t.compare(n);if(s===0)return null;let i=s>0,a=i?t:n,o=i?n:t,c=!!a.prerelease.length;if(!!o.prerelease.length&&!c){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let l=c?"pre":"";return t.major!==n.major?l+"major":t.minor!==n.minor?l+"minor":t.patch!==n.patch?l+"patch":"prerelease"};tl.exports=fy});var sl=h((sx,nl)=>{"use strict";var py=ne(),hy=(r,e)=>new py(r,e).major;nl.exports=hy});var al=h((ix,il)=>{"use strict";var my=ne(),gy=(r,e)=>new my(r,e).minor;il.exports=gy});var cl=h((ax,ol)=>{"use strict";var yy=ne(),vy=(r,e)=>new yy(r,e).patch;ol.exports=vy});var ll=h((ox,ul)=>{"use strict";var _y=vt(),Ey=(r,e)=>{let t=_y(r,e);return t&&t.prerelease.length?t.prerelease:null};ul.exports=Ey});var me=h((cx,fl)=>{"use strict";var dl=ne(),Sy=(r,e,t)=>new dl(r,t).compare(new dl(e,t));fl.exports=Sy});var hl=h((ux,pl)=>{"use strict";var by=me(),Ty=(r,e,t)=>by(e,r,t);pl.exports=Ty});var gl=h((lx,ml)=>{"use strict";var xy=me(),Ry=(r,e)=>xy(r,e,!0);ml.exports=Ry});var Hn=h((dx,vl)=>{"use strict";var yl=ne(),wy=(r,e,t)=>{let n=new yl(r,t),s=new yl(e,t);return n.compare(s)||n.compareBuild(s)};vl.exports=wy});var El=h((fx,_l)=>{"use strict";var Ay=Hn(),Cy=(r,e)=>r.sort((t,n)=>Ay(t,n,e));_l.exports=Cy});var bl=h((px,Sl)=>{"use strict";var Iy=Hn(),Ly=(r,e)=>r.sort((t,n)=>Iy(n,t,e));Sl.exports=Ly});var Ur=h((hx,Tl)=>{"use strict";var Ny=me(),Oy=(r,e,t)=>Ny(r,e,t)>0;Tl.exports=Oy});var Kn=h((mx,xl)=>{"use strict";var ky=me(),qy=(r,e,t)=>ky(r,e,t)<0;xl.exports=qy});var ki=h((gx,Rl)=>{"use strict";var Py=me(),My=(r,e,t)=>Py(r,e,t)===0;Rl.exports=My});var qi=h((yx,wl)=>{"use strict";var $y=me(),Dy=(r,e,t)=>$y(r,e,t)!==0;wl.exports=Dy});var Zn=h((vx,Al)=>{"use strict";var Fy=me(),Uy=(r,e,t)=>Fy(r,e,t)>=0;Al.exports=Uy});var Yn=h((_x,Cl)=>{"use strict";var By=me(),jy=(r,e,t)=>By(r,e,t)<=0;Cl.exports=jy});var Pi=h((Ex,Il)=>{"use strict";var Vy=ki(),Wy=qi(),Xy=Ur(),Gy=Zn(),zy=Kn(),Hy=Yn(),Ky=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Vy(r,t,n);case"!=":return Wy(r,t,n);case">":return Xy(r,t,n);case">=":return Gy(r,t,n);case"<":return zy(r,t,n);case"<=":return Hy(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};Il.exports=Ky});var Nl=h((Sx,Ll)=>{"use strict";var Zy=ne(),Yy=vt(),{safeRe:Qn,t:Jn}=zt(),Qy=(r,e)=>{if(r instanceof Zy)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?Qn[Jn.COERCEFULL]:Qn[Jn.COERCE]);else{let c=e.includePrerelease?Qn[Jn.COERCERTLFULL]:Qn[Jn.COERCERTL],u;for(;(u=c.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(t===null)return null;let n=t[2],s=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return Yy(`${n}.${s}.${i}${a}${o}`,e)};Ll.exports=Qy});var kl=h((bx,Ol)=>{"use strict";var Mi=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let s=this.map.keys().next().value;this.delete(s)}this.map.set(e,t)}return this}};Ol.exports=Mi});var ge=h((Tx,$l)=>{"use strict";var Jy=/\s+/g,$i=class r{constructor(e,t){if(t=tv(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Di)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Jy," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(s=>!Pl(s[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let s of this.set)if(s.length===1&&cv(s[0])){this.set=[s];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&av)|(this.options.loose&&ov))+":"+e,s=ql.get(n);if(s)return s;let i=this.options.loose,a=i?ce[se.HYPHENRANGELOOSE]:ce[se.HYPHENRANGE];e=e.replace(a,vv(this.options.includePrerelease)),U("hyphen replace",e),e=e.replace(ce[se.COMPARATORTRIM],nv),U("comparator trim",e),e=e.replace(ce[se.TILDETRIM],sv),U("tilde trim",e),e=e.replace(ce[se.CARETTRIM],iv),U("caret trim",e);let o=e.split(" ").map(d=>uv(d,this.options)).join(" ").split(/\s+/).map(d=>yv(d,this.options));i&&(o=o.filter(d=>(U("loose invalid filter",d,this.options),!!d.match(ce[se.COMPARATORLOOSE])))),U("range list",o);let c=new Map,u=o.map(d=>new Di(d,this.options));for(let d of u){if(Pl(d))return[d];c.set(d.value,d)}c.size>1&&c.has("")&&c.delete("");let l=[...c.values()];return ql.set(n,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Ml(n,t)&&e.set.some(s=>Ml(s,t)&&n.every(i=>s.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new rv(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(_v(this.set[t],e,this.options))return!0;return!1}};$l.exports=$i;var ev=kl(),ql=new ev,tv=Vn(),Di=Br(),U=Fr(),rv=ne(),{safeRe:ce,t:se,comparatorTrimReplace:nv,tildeTrimReplace:sv,caretTrimReplace:iv}=zt(),{FLAG_INCLUDE_PRERELEASE:av,FLAG_LOOSE:ov}=Dr(),Pl=r=>r.value==="<0.0.0-0",cv=r=>r.value==="",Ml=(r,e)=>{let t=!0,n=r.slice(),s=n.pop();for(;t&&n.length;)t=n.every(i=>s.intersects(i,e)),s=n.pop();return t},uv=(r,e)=>(r=r.replace(ce[se.BUILD],""),U("comp",r,e),r=fv(r,e),U("caret",r),r=lv(r,e),U("tildes",r),r=hv(r,e),U("xrange",r),r=gv(r,e),U("stars",r),r),ue=r=>!r||r.toLowerCase()==="x"||r==="*",lv=(r,e)=>r.trim().split(/\s+/).map(t=>dv(t,e)).join(" "),dv=(r,e)=>{let t=e.loose?ce[se.TILDELOOSE]:ce[se.TILDE];return r.replace(t,(n,s,i,a,o)=>{U("tilde",r,n,s,i,a,o);let c;return ue(s)?c="":ue(i)?c=`>=${s}.0.0 <${+s+1}.0.0-0`:ue(a)?c=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:o?(U("replaceTilde pr",o),c=`>=${s}.${i}.${a}-${o} <${s}.${+i+1}.0-0`):c=`>=${s}.${i}.${a} <${s}.${+i+1}.0-0`,U("tilde return",c),c})},fv=(r,e)=>r.trim().split(/\s+/).map(t=>pv(t,e)).join(" "),pv=(r,e)=>{U("caret",r,e);let t=e.loose?ce[se.CARETLOOSE]:ce[se.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(s,i,a,o,c)=>{U("caret",r,s,i,a,o,c);let u;return ue(i)?u="":ue(a)?u=`>=${i}.0.0${n} <${+i+1}.0.0-0`:ue(o)?i==="0"?u=`>=${i}.${a}.0${n} <${i}.${+a+1}.0-0`:u=`>=${i}.${a}.0${n} <${+i+1}.0.0-0`:c?(U("replaceCaret pr",c),i==="0"?a==="0"?u=`>=${i}.${a}.${o}-${c} <${i}.${a}.${+o+1}-0`:u=`>=${i}.${a}.${o}-${c} <${i}.${+a+1}.0-0`:u=`>=${i}.${a}.${o}-${c} <${+i+1}.0.0-0`):(U("no pr"),i==="0"?a==="0"?u=`>=${i}.${a}.${o}${n} <${i}.${a}.${+o+1}-0`:u=`>=${i}.${a}.${o}${n} <${i}.${+a+1}.0-0`:u=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),U("caret return",u),u})},hv=(r,e)=>(U("replaceXRanges",r,e),r.split(/\s+/).map(t=>mv(t,e)).join(" ")),mv=(r,e)=>{r=r.trim();let t=e.loose?ce[se.XRANGELOOSE]:ce[se.XRANGE];return r.replace(t,(n,s,i,a,o,c)=>{U("xRange",r,n,s,i,a,o,c);let u=ue(i),l=u||ue(a),d=l||ue(o),g=d;return s==="="&&g&&(s=""),c=e.includePrerelease?"-0":"",u?s===">"||s==="<"?n="<0.0.0-0":n="*":s&&g?(l&&(a=0),o=0,s===">"?(s=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):s==="<="&&(s="<",l?i=+i+1:a=+a+1),s==="<"&&(c="-0"),n=`${s+i}.${a}.${o}${c}`):l?n=`>=${i}.0.0${c} <${+i+1}.0.0-0`:d&&(n=`>=${i}.${a}.0${c} <${i}.${+a+1}.0-0`),U("xRange return",n),n})},gv=(r,e)=>(U("replaceStars",r,e),r.trim().replace(ce[se.STAR],"")),yv=(r,e)=>(U("replaceGTE0",r,e),r.trim().replace(ce[e.includePrerelease?se.GTE0PRE:se.GTE0],"")),vv=r=>(e,t,n,s,i,a,o,c,u,l,d,g)=>(ue(n)?t="":ue(s)?t=`>=${n}.0.0${r?"-0":""}`:ue(i)?t=`>=${n}.${s}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,ue(u)?c="":ue(l)?c=`<${+u+1}.0.0-0`:ue(d)?c=`<${u}.${+l+1}.0-0`:g?c=`<=${u}.${l}.${d}-${g}`:r?c=`<${u}.${l}.${+d+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),_v=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(U(r[n].semver),r[n].semver!==Di.ANY&&r[n].semver.prerelease.length>0){let s=r[n].semver;if(s.major===e.major&&s.minor===e.minor&&s.patch===e.patch)return!0}return!1}return!0}});var Br=h((xx,Vl)=>{"use strict";var jr=Symbol("SemVer ANY"),Bi=class r{static get ANY(){return jr}constructor(e,t){if(t=Dl(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Ui("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===jr?this.value="":this.value=this.operator+this.semver.version,Ui("comp",this)}parse(e){let t=this.options.loose?Fl[Ul.COMPARATORLOOSE]:Fl[Ul.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Bl(n[2],this.options.loose):this.semver=jr}toString(){return this.value}test(e){if(Ui("Comparator.test",e,this.options.loose),this.semver===jr||e===jr)return!0;if(typeof e=="string")try{e=new Bl(e,this.options)}catch{return!1}return Fi(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new jl(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new jl(this.value,t).test(e.semver):(t=Dl(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Fi(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Fi(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Vl.exports=Bi;var Dl=Vn(),{safeRe:Fl,t:Ul}=zt(),Fi=Pi(),Ui=Fr(),Bl=ne(),jl=ge()});var Vr=h((Rx,Wl)=>{"use strict";var Ev=ge(),Sv=(r,e,t)=>{try{e=new Ev(e,t)}catch{return!1}return e.test(r)};Wl.exports=Sv});var Gl=h((wx,Xl)=>{"use strict";var bv=ge(),Tv=(r,e)=>new bv(r,e).set.map(t=>t.map(n=>n.value).join(" ").trim().split(" "));Xl.exports=Tv});var Hl=h((Ax,zl)=>{"use strict";var xv=ne(),Rv=ge(),wv=(r,e,t)=>{let n=null,s=null,i=null;try{i=new Rv(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===-1)&&(n=a,s=new xv(n,t))}),n};zl.exports=wv});var Zl=h((Cx,Kl)=>{"use strict";var Av=ne(),Cv=ge(),Iv=(r,e,t)=>{let n=null,s=null,i=null;try{i=new Cv(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!n||s.compare(a)===1)&&(n=a,s=new Av(n,t))}),n};Kl.exports=Iv});var Jl=h((Ix,Ql)=>{"use strict";var ji=ne(),Lv=ge(),Yl=Ur(),Nv=(r,e)=>{r=new Lv(r,e);let t=new ji("0.0.0");if(r.test(t)||(t=new ji("0.0.0-0"),r.test(t)))return t;t=null;for(let n=0;n<r.set.length;++n){let s=r.set[n],i=null;s.forEach(a=>{let o=new ji(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||Yl(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||Yl(t,i))&&(t=i)}return t&&r.test(t)?t:null};Ql.exports=Nv});var td=h((Lx,ed)=>{"use strict";var Ov=ge(),kv=(r,e)=>{try{return new Ov(r,e).range||"*"}catch{return null}};ed.exports=kv});var es=h((Nx,id)=>{"use strict";var qv=ne(),sd=Br(),{ANY:Pv}=sd,Mv=ge(),$v=Vr(),rd=Ur(),nd=Kn(),Dv=Yn(),Fv=Zn(),Uv=(r,e,t,n)=>{r=new qv(r,n),e=new Mv(e,n);let s,i,a,o,c;switch(t){case">":s=rd,i=Dv,a=nd,o=">",c=">=";break;case"<":s=nd,i=Fv,a=rd,o="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if($v(r,e,n))return!1;for(let u=0;u<e.set.length;++u){let l=e.set[u],d=null,g=null;if(l.forEach(f=>{f.semver===Pv&&(f=new sd(">=0.0.0")),d=d||f,g=g||f,s(f.semver,d.semver,n)?d=f:a(f.semver,g.semver,n)&&(g=f)}),d.operator===o||d.operator===c||(!g.operator||g.operator===o)&&i(r,g.semver))return!1;if(g.operator===c&&a(r,g.semver))return!1}return!0};id.exports=Uv});var od=h((Ox,ad)=>{"use strict";var Bv=es(),jv=(r,e,t)=>Bv(r,e,">",t);ad.exports=jv});var ud=h((kx,cd)=>{"use strict";var Vv=es(),Wv=(r,e,t)=>Vv(r,e,"<",t);cd.exports=Wv});var fd=h((qx,dd)=>{"use strict";var ld=ge(),Xv=(r,e,t)=>(r=new ld(r,t),e=new ld(e,t),r.intersects(e,t));dd.exports=Xv});var hd=h((Px,pd)=>{"use strict";var Gv=Vr(),zv=me();pd.exports=(r,e,t)=>{let n=[],s=null,i=null,a=r.sort((l,d)=>zv(l,d,t));for(let l of a)Gv(l,e,t)?(i=l,s||(s=l)):(i&&n.push([s,i]),i=null,s=null);s&&n.push([s,null]);let o=[];for(let[l,d]of n)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let c=o.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return c.length<u.length?c:e}});var Ed=h((Mx,_d)=>{"use strict";var md=ge(),Wi=Br(),{ANY:Vi}=Wi,Wr=Vr(),Xi=me(),Hv=(r,e,t={})=>{if(r===e)return!0;r=new md(r,t),e=new md(e,t);let n=!1;e:for(let s of r.set){for(let i of e.set){let a=Zv(s,i,t);if(n=n||a!==null,a)continue e}if(n)return!1}return!0},Kv=[new Wi(">=0.0.0-0")],gd=[new Wi(">=0.0.0")],Zv=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Vi){if(e.length===1&&e[0].semver===Vi)return!0;t.includePrerelease?r=Kv:r=gd}if(e.length===1&&e[0].semver===Vi){if(t.includePrerelease)return!0;e=gd}let n=new Set,s,i;for(let f of r)f.operator===">"||f.operator===">="?s=yd(s,f,t):f.operator==="<"||f.operator==="<="?i=vd(i,f,t):n.add(f.semver);if(n.size>1)return null;let a;if(s&&i){if(a=Xi(s.semver,i.semver,t),a>0)return null;if(a===0&&(s.operator!==">="||i.operator!=="<="))return null}for(let f of n){if(s&&!Wr(f,String(s),t)||i&&!Wr(f,String(i),t))return null;for(let L of e)if(!Wr(f,String(L),t))return!1;return!0}let o,c,u,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,g=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(l=l||f.operator===">"||f.operator===">=",u=u||f.operator==="<"||f.operator==="<=",s){if(g&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===g.major&&f.semver.minor===g.minor&&f.semver.patch===g.patch&&(g=!1),f.operator===">"||f.operator===">="){if(o=yd(s,f,t),o===f&&o!==s)return!1}else if(s.operator===">="&&!Wr(s.semver,String(f),t))return!1}if(i){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(c=vd(i,f,t),c===f&&c!==i)return!1}else if(i.operator==="<="&&!Wr(i.semver,String(f),t))return!1}if(!f.operator&&(i||s)&&a!==0)return!1}return!(s&&u&&!i&&a!==0||i&&l&&!s&&a!==0||g||d)},yd=(r,e,t)=>{if(!r)return e;let n=Xi(r.semver,e.semver,t);return n>0?r:n<0||e.operator===">"&&r.operator===">="?e:r},vd=(r,e,t)=>{if(!r)return e;let n=Xi(r.semver,e.semver,t);return n<0?r:n>0||e.operator==="<"&&r.operator==="<="?e:r};_d.exports=Hv});var xd=h(($x,Td)=>{"use strict";var Gi=zt(),Sd=Dr(),Yv=ne(),bd=Li(),Qv=vt(),Jv=Hu(),e_=Zu(),t_=Ju(),r_=rl(),n_=sl(),s_=al(),i_=cl(),a_=ll(),o_=me(),c_=hl(),u_=gl(),l_=Hn(),d_=El(),f_=bl(),p_=Ur(),h_=Kn(),m_=ki(),g_=qi(),y_=Zn(),v_=Yn(),__=Pi(),E_=Nl(),S_=Br(),b_=ge(),T_=Vr(),x_=Gl(),R_=Hl(),w_=Zl(),A_=Jl(),C_=td(),I_=es(),L_=od(),N_=ud(),O_=fd(),k_=hd(),q_=Ed();Td.exports={parse:Qv,valid:Jv,clean:e_,inc:t_,diff:r_,major:n_,minor:s_,patch:i_,prerelease:a_,compare:o_,rcompare:c_,compareLoose:u_,compareBuild:l_,sort:d_,rsort:f_,gt:p_,lt:h_,eq:m_,neq:g_,gte:y_,lte:v_,cmp:__,coerce:E_,Comparator:S_,Range:b_,satisfies:T_,toComparators:x_,maxSatisfying:R_,minSatisfying:w_,minVersion:A_,validRange:C_,outside:I_,gtr:L_,ltr:N_,intersects:O_,simplifyRange:k_,subset:q_,SemVer:Yv,re:Gi.re,src:Gi.src,tokens:Gi.t,SEMVER_SPEC_VERSION:Sd.SEMVER_SPEC_VERSION,RELEASE_TYPES:Sd.RELEASE_TYPES,compareIdentifiers:bd.compareIdentifiers,rcompareIdentifiers:bd.rcompareIdentifiers}});var Hi=h((Dx,zi)=>{"use strict";var P_=xd(),M_=Mr(),Ht=st(),Rd=te(),wd=V(),Ad="2.7.15",$_=function(){return!1},D_=function(e){if(!P_.gte(e.VERSION,Ad))throw new Error("AWS SDK version "+Ad+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var n=e[t];n.prototype.customizeRequests(Cd)}return e},F_=function(e){return e.customizeRequests(Cd),e};function Cd(r){var e=Ht.resolveSegment(Ht.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return Ht.isAutomaticMode()?wd.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):wd.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var n=this.throttledError||$_,s=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var c=function(l){if(e.noOp)return;let d="Root="+a+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(o!=null)for(let[g,f]of Object.entries(o))d+=";"+g+"="+f;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},u=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new M_(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new Id(d)),(d.statusCode===429||l.error&&n(l.error))&&i.addThrottleFlag()),l.error){var g={message:l.error.message,name:l.error.code,stack:s};d&&d.statusCode?(Rd.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(g,!0)):i.close(g)}else{if(d&&d.statusCode){var f=Rd.getCauseTypeFromHttpStatus(d.statusCode);f&&(i[f]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",c),l.removeListener("complete",u)}),r.on("build",c).on("complete",u),r.__send||(r.__send=r.send,r.send=function(l){if(Ht.isAutomaticMode()){var d=Ht.getNamespace();d.run(function(){Ht.setSegment(i),r.__send(l)})}else r.__send(l)})}function Id(r){this.init(r)}Id.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};zi.exports.captureAWSClient=F_;zi.exports.captureAWS=D_});var qd=h((Fx,kd)=>{var ts=Object.defineProperty,U_=Object.getOwnPropertyDescriptor,B_=Object.getOwnPropertyNames,j_=Object.prototype.hasOwnProperty,Kt=(r,e)=>ts(r,"name",{value:e,configurable:!0}),V_=(r,e)=>{for(var t in e)ts(r,t,{get:e[t],enumerable:!0})},W_=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of B_(e))!j_.call(r,s)&&s!==t&&ts(r,s,{get:()=>e[s],enumerable:!(n=U_(e,s))||n.enumerable});return r},X_=r=>W_(ts({},"__esModule",{value:!0}),r),Ld={};V_(Ld,{isClockSkewCorrectedError:()=>Nd,isClockSkewError:()=>Q_,isRetryableByTrait:()=>Y_,isServerError:()=>eE,isThrottlingError:()=>J_,isTransientError:()=>Od});kd.exports=X_(Ld);var G_=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],z_=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],H_=["TimeoutError","RequestTimeout","RequestTimeoutException"],K_=[500,502,503,504],Z_=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Y_=Kt(r=>r.$retryable!==void 0,"isRetryableByTrait"),Q_=Kt(r=>G_.includes(r.name),"isClockSkewError"),Nd=Kt(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),J_=Kt(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||z_.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Od=Kt(r=>{var e;return Nd(r)||H_.includes(r.name)||Z_.includes(r?.code||"")||K_.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),eE=Kt(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Od(r)}return!1},"isServerError")});var Ud=h(Zt=>{"use strict";var Dd=Zt&&Zt.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Zt,"__esModule",{value:!0});Zt.captureAWSClient=void 0;var tE=qd(),rE=Dd(Mr()),nE=require("querystring"),sE=Dd(Nr()),Ki=st(),Pd=V(),{safeParseInt:rs}=te(),iE=te(),Fd="XRaySDKInstrumentation",Md=async(r,e,t,n,s,i)=>{var a,o,c;let{extendedRequestId:u,requestId:l,httpStatusCode:d,attempts:g}=((a=s?.output)===null||a===void 0?void 0:a.$metadata)||i?.$metadata,f=new rE.default({extendedRequestId:u,requestId:l,retryCount:g,data:s?.output,request:{operation:e,params:n,httpRequest:{region:t,statusCode:d}}},r),L={};return d&&(L.response={},L.response.status=d),!((o=s?.response)===null||o===void 0)&&o.headers&&((c=s?.response)===null||c===void 0?void 0:c.headers["content-length"])!==void 0&&(L.response||(L.response={}),L.response.content_length=rs(s.response.headers["content-length"])),[f,L]};function $d(r,e,t){var n,s,i;(t&&(0,tE.isThrottlingError)(t)||rs((n=r.response)===null||n===void 0?void 0:n.status)===429||rs((s=t?.$metadata)===null||s===void 0?void 0:s.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,iE.getCauseTypeFromHttpStatus)(rs((i=r.response)===null||i===void 0?void 0:i.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var aE=(r,e)=>(t,n)=>async s=>{var i;let a=Ki.isAutomaticMode()?Ki.resolveSegment():e,{clientName:o,commandName:c}=n,u=(i=s?.input)!==null&&i!==void 0?i:{},l=c.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),g=o.slice(0,-6);if(!a){let ee=g+"."+d;return Ki.isAutomaticMode()?Pd.getLogger().info("Call "+ee+" is missing the sub/segment context for automatic mode. Ignoring."):Pd.getLogger().info("Call "+ee+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(s)}let f;a.notTraced?f=a.addNewSubsegmentWithoutSampling(g):f=a.addNewSubsegment(g),f.addAttribute("namespace","aws");let L=a instanceof sE.default?a.segment:a,C=L.segment?L.segment.additionalTraceData:L.additionalTraceData,fe=(0,nE.stringify)({Root:L.trace_id,Parent:f.id,Sampled:f.notTraced?"0":"1"},";");if(C!=null)for(let[ee,Pe]of Object.entries(C))fe+=";"+ee+"="+Pe;a.noOp||(s.request.headers["X-Amzn-Trace-Id"]=fe);let Se;try{if(Se=await t(s),!Se)throw new Error("Failed to get response from instrumented AWS Client.");let[ee,Pe]=await Md(g,d,await r.region(),u,Se,null);return f.addAttribute("aws",ee),f.addAttribute("http",Pe),$d(Pe,f),f.close(),Se}catch(ee){if(ee.$metadata){let[X,be]=await Md(g,d,await r.region(),u,null,ee);f.addAttribute("aws",X),f.addAttribute("http",be),$d(be,f,ee)}let Pe={message:ee.message,name:ee.name,stack:ee.stack||new Error().stack};throw f.close(Pe,!0),ee}},oE={name:Fd,step:"build"},cE=(r,e)=>({applyToStack:t=>{t.add(aE(r,e),oE)}});function uE(r,e){return r.middlewareStack.remove(Fd),r.middlewareStack.use(cE(r.config,e)),r}Zt.captureAWSClient=uE});var Yi=h((Bx,Zi)=>{"use strict";var Bd=require("url"),Yt=st(),ns=te(),jd=V(),lE=require("events"),dE=function(e,t,n){e.__request||Vd(e,t,n)},fE=function(e,t,n){if(e.__request)return e;var s={};return Object.keys(e).forEach(function(i){s[i]=e[i]}),Vd(s,t,n),s};function Vd(r,e,t){function n(a,...o){let c,u,l,d,g=o[0];if(typeof o[1]=="object"?(l=!0,d=typeof g=="string"?new Bd.URL(g):g,c=o[1],u=o[2]):(l=!1,c=g,u=o[1]),!c||c.headers&&c.headers["X-Amzn-Trace-Id"])return a(...o);typeof c=="string"&&(c=new Bd.URL(c)),l||(d=c);let f=Yt.resolveSegment(Yt.resolveManualSegmentParams(c)),L=c.hostname||c.host||d.hostname||d.host||"Unknown host";if(!f){let X="[ host: "+L;return X=c.method?X+", method: "+c.method:X,X+=", path: "+(d.pathname||ns.stripQueryStringFromPath(c.path))+" ]",Yt.isAutomaticMode()?jd.getLogger().info("Options for request "+X+" is missing the sub/segment context for automatic mode. Ignoring."):jd.getLogger().info("Options for request "+X+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let C;f.notTraced?C=f.addNewSubsegmentWithoutSampling(L):C=f.addNewSubsegment(L);let fe=f.segment?f.segment:f;C.namespace="remote",c.headers||(c.headers={}),f.noOp||(c.headers["X-Amzn-Trace-Id"]="Root="+fe.trace_id+";Parent="+C.id+";Sampled="+(C.notTraced?"0":"1"));let Se=function(be){if(t&&t(C,this,null,be),C.http&&C.http.response)ns.getCauseTypeFromHttpStatus(C.http.response.status)==="error"&&C.addErrorFlag(),C.close(be,!0);else{let Af=be.code!=="ECONNREFUSED";C.addRemoteRequestData(this,null,Af&&e),C.close(be)}},ee=ns.objectWithoutProperties(c,["Segment"],!0),Pe=a(...l?[g,ee]:[c],function(X){X.on("end",function(){t&&t(C,this.req,X),X.statusCode===429&&C.addThrottleFlag();let be=ns.getCauseTypeFromHttpStatus(X.statusCode);be&&(C[be]=!0),C.addRemoteRequestData(X.req,X,!!e),C.close()}),typeof u=="function"?Yt.isAutomaticMode()?Yt.getNamespace().run(function(){Yt.setSegment(C),u(X)}):u(X):X.req&&X.req.listenerCount("response")===0&&X.resume()});return Pe.on(lE.errorMonitor||"error",Se),Pe}r.__request=r.request;function s(...a){return n(r.__request,...a)}r.__get=r.get;function i(...a){return n(r.__get,...a)}Object.defineProperties(r,{request:{value:s,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}Zi.exports.captureHTTPsGlobal=dE;Zi.exports.captureHTTPs=fE});var zd=h((jx,Qi)=>{"use strict";var Xr=st(),ss=Symbol("original then"),is=Symbol("original catch");function Xd(r){let e=r.prototype.then;e[ss]||(r.prototype.then=function(n,s){if(Xr.isAutomaticMode()&&Wd()){let i=Xr.getNamespace();n=n&&i.bind(n),s=s&&i.bind(s)}return e.call(this,n,s)},r.prototype.then[ss]=e);let t=r.prototype.catch;t&&!t[is]&&(r.prototype.catch=function(n){if(Xr.isAutomaticMode()&&Wd()){let s=Xr.getNamespace();n=n&&s.bind(n)}return t.call(this,n)},r.prototype.catch[is]=t)}function pE(r){let e=r.prototype.then;e[ss]&&(r.prototype.then=e[ss]);let t=r.prototype.catch;t&&t[is]&&(r.prototype.catch=t[is])}function Wd(){try{return Xr.getSegment()}catch{return}}function Gd(){Xd(Promise)}function hE(){pE(Promise)}Gd.patchThirdPartyPromise=Xd;Qi.exports.capturePromise=Gd;Qi.exports.uncapturePromise=hE});var Zd=h((Vx,Kd)=>{"use strict";function Hd(r,e,t,n,s){this.init(r,e,t,n,s)}Hd.prototype.init=function(e,t,n,s,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=s,this.user=n};Kd.exports=Hd});var Jd=h((Wx,Qd)=>{"use strict";var Xe=st(),Ji=V(),Qt=tt(),mE=te(),gE=fu(),zr={};try{zr=pu()}catch(r){Ji.getLogger().debug("Failed to load SDK data:",r)}var Gr="unknown",Yd={plugins:{EC2Plugin:Su(),ECSPlugin:Tu(),ElasticBeanstalkPlugin:Ru()},config:function(r){var e={};r.forEach(function(t){t.getData(function(n){if(n)for(var s in n)e[s]=n[s]}),Qt.setOrigin(t.originName),Qt.setPluginData(e)})},setAWSWhitelist:Mr().setAWSWhitelist,appendAWSWhitelist:Mr().appendAWSWhitelist,setStreamingThreshold:Qt.setStreamingThreshold,setLogger:Ji.setLogger,getLogger:Ji.getLogger,setDaemonAddress:Tn().setDaemonAddress,captureFunc:jn().captureFunc,captureAsyncFunc:jn().captureAsyncFunc,captureCallbackFunc:jn().captureCallbackFunc,captureAWS:Hi().captureAWS,captureAWSClient:Hi().captureAWSClient,captureAWSv3Client:Ud().captureAWSClient,captureHTTPs:Yi().captureHTTPs,captureHTTPsGlobal:Yi().captureHTTPsGlobal,capturePromise:zd().capturePromise,utils:mE,database:{SqlData:Zd()},middleware:vi(),getNamespace:Xe.getNamespace,resolveSegment:Xe.resolveSegment,resolveManualSegmentParams:Xe.resolveManualSegmentParams,getSegment:Xe.getSegment,setSegment:Xe.setSegment,isAutomaticMode:Xe.isAutomaticMode,enableAutomaticMode:Xe.enableAutomaticMode,enableManualMode:Xe.enableManualMode,setContextMissingStrategy:Xe.setContextMissingStrategy,Segment:Or(),Subsegment:Nr(),SegmentUtils:Qt};Yd.middleware.IncomingRequestData=oi(),function(){var r={runtime:process.release&&process.release.name?process.release.name:Gr,runtime_version:process.version,version:process.env.npm_package_version||Gr,name:process.env.npm_package_name||Gr},e={sdk:"X-Ray for Node.js",sdk_version:zr.version?zr.version:Gr,package:zr.name?zr.name:Gr};Qt.setSDKData(e),Qt.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&gE.init()}();Qd.exports=Yd});var ea=h((Xx,ef)=>{"use strict";ef.exports=Jd()});var QS={};vs(QS,{handler:()=>KS});module.exports=_s(QS);var ds=require("aws-sdk");var Ss={PRETTY:4,COMPACT:0};var q={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},fa=["level","message","sampling_rate","service","timestamp"],pa="Uncaught error detected, flushing log buffer before exit";var ha="POWERTOOLS_DEV",ma="POWERTOOLS_SERVICE_NAME",ga="_X_AMZN_TRACE_ID";var z=({key:r,defaultValue:e,errorMessage:t})=>{let n=process.env[r];if(n===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return n.trim()},ya=({key:r,defaultValue:e,errorMessage:t})=>{let n=z({key:r,defaultValue:String(e),errorMessage:t}),s=Number(n);if(Number.isNaN(s))throw new TypeError(`Environment variable ${r} must be a number`);return s},qf=new Set(["1","y","yes","t","true","on"]),Pf=new Set(["0","n","no","f","false","off"]),bs=({key:r,defaultValue:e,errorMessage:t,extendedParsing:n})=>{let i=z({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(n){if(qf.has(i))return!0;if(Pf.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},ur=()=>{try{return bs({key:ha,extendedParsing:!0})}catch{return!1}},va=()=>z({key:ma,defaultValue:""}),_a=()=>{let r=z({key:ga,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[n,s]=t.split("=");e[n]=s}return e},Ea=()=>_a()?.Sampled==="1",Me=()=>_a()?.Root;var Jr,en,Sa,lr=class{constructor(){M(this,en);M(this,Jr,e=>{let t="2-digit",n=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:n})})}formatError(e){let{name:t,message:n,stack:s,cause:i,...a}=e,o={name:t,location:this.getCodeLocation(e.stack),message:n,stack:ur()&&typeof s=="string"?s?.split(`
`):s,cause:i instanceof Error?this.formatError(i):i};for(let c in e)typeof c=="string"&&!["name","message","stack","cause"].includes(c)&&(o[c]=a[c]);return o}formatTimestamp(e){let t="UTC",n=z({key:"TZ",defaultValue:""});return n&&!n.includes(t)?B(this,en,Sa).call(this,e,n):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),n=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let s of t){let i=n.exec(s);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};Jr=new WeakMap,en=new WeakSet,Sa=function(e,t){let{year:n,month:s,day:i,hour:a,minute:o,second:c}=m(this,Jr).call(this,t).formatToParts(e).reduce((fe,Se)=>(fe[Se.type]=Se.value,fe),{}),u=`${n}-${s}-${i}T${a}:${o}:${c}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",g=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),f=Math.abs(l%60).toString().padStart(2,"0"),L=e.getMilliseconds().toString().padStart(3,"0"),C=`${d}${g}:${f}`;return`${u}.${L}${C}`};var Za=Ie(ks(),1);var Dt=class{constructor(e){I(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,Za.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let n in e)e[n]!==void 0&&e[n]!==""&&e[n]!==null&&(t[n]=e[n]);return t}setAttributes(e){this.attributes=e}};var io=require("console"),ao=require("crypto");var Ze="2.28.1";var qs=process.env.AWS_EXECUTION_ENV||"NA",Ch={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},Ya=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",Ih=r=>e=>async t=>{let n=t.request.headers["user-agent"]||"";if(n.includes("PT/NO-OP")){let s=n.replace("PT/NO-OP",`PT/${r}/${Ze} PTEnv/${qs}`);return t.request.headers["user-agent"]=s,await e(t)}return n.includes("PT/")?await e(t):(t.request.headers["user-agent"]=n===""?`PT/${r}/${Ze} PTEnv/${qs}`:`${n} PT/${r}/${Ze} PTEnv/${qs}`,await e(t))},Lh=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},Ps=(r,e)=>{try{if(Ya(r)){if(Lh(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(Ih(e),Ch)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var ln="powertools-for-aws",Qa=`${ln}.tracer`,Ja=`${ln}.metrics`,eo=`${ln}.logger`,to=`${ln}.idempotency`;var Ms=r=>typeof r=="string";var ro=r=>Object.is(r,null),$s=r=>ro(r)||Object.is(r,void 0);var Ft,ft=class{constructor(){M(this,Ft);I(this,"coldStart",!0);I(this,"defaultServiceName","service_undefined");Z(this,Ft,this.getInitializationType()),m(this,Ft)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return m(this,Ft)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};Ft=new WeakMap;var no=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${Ze}/PTEnv/${no}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${Ze}/PTEnv/${no}`;var gr=Ie(ks(),1);var Ut,dn=class extends lr{constructor(t){super();M(this,Ut);Z(this,Ut,t?.logRecordOrder)}formatAttributes(t,n){let s={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(m(this,Ut)===void 0)return new Dt({attributes:s}).addAttributes(n);let i={};for(let o of m(this,Ut))o in s&&!(o in i)?i[o]=s[o]:o in n&&!(o in i)&&(i[o]=n[o]);for(let o in s)o in i||(i[o]=s[o]);for(let o in n)o in i||(i[o]=n[o]);return new Dt({attributes:i})}};Ut=new WeakMap;var Ds=class{constructor(e,t){I(this,"value");I(this,"logLevel");I(this,"byteSize");if(!Ms(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},Fs=class extends Set{constructor(){super(...arguments);I(this,"currentBytesSize",0);I(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let n=super.delete(t);return n&&(this.currentBytesSize-=t.byteSize),n}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},pt,Bt,pn,so,fn=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:n}){super();M(this,pn);M(this,pt);M(this,Bt);Z(this,pt,t),Z(this,Bt,n)}setItem(t,n,s){let i=new Ds(n,s);if(i.byteSize>m(this,pt))throw new Error("Item too big");let a=this.get(t)||new Fs;return a.currentBytesSize+i.byteSize>=m(this,pt)&&(B(this,pn,so).call(this,a,i),m(this,Bt)&&m(this,Bt).call(this)),a.add(i),super.set(t,a),this}};pt=new WeakMap,Bt=new WeakMap,pn=new WeakSet,so=function(t,n){for(;t.currentBytesSize+n.byteSize>=m(this,pt);)t.shift(),t.hasEvictedLog=!0};var Te,jt,Er,xe,Ye,ht,K,Le,mt,Fe,Sr,P,yr,Us,oo,co,uo,lo,Bs,vr,fo,js=class js extends ft{constructor(t={}){super();M(this,P);I(this,"console");I(this,"customConfigService");I(this,"logEvent",!1);I(this,"logFormatter");I(this,"logIndentation",Ss.COMPACT);I(this,"logLevel",q.INFO);M(this,Te);I(this,"persistentLogAttributes",{});I(this,"powertoolsLogData",{sampleRateValue:0});I(this,"temporaryLogAttributes",{});M(this,jt,[]);M(this,Er,!1);M(this,xe,new Map);M(this,Ye,q.INFO);M(this,ht);M(this,K,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:q.DEBUG});M(this,Le);M(this,mt);M(this,Fe,{sampleRateValue:0,refreshedTimes:0});M(this,Sr,new Map);let{customConfigService:n,...s}=t;this.customConfigService=n||void 0,this.setOptions(s),Z(this,Er,!0);for(let[i,a]of m(this,jt))this.printLog(i,this.createAndPopulateLogItem(...a));Z(this,jt,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){B(this,P,Us).call(this,t,"temp")}appendPersistentKeys(t){B(this,P,Us).call(this,t,"persistent")}createChild(t={}){let n=this.createLogger((0,gr.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:m(this,Fe).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:m(this,ht),correlationIdSearchFn:m(this,mt),...m(this,K).enabled&&{logBufferOptions:{maxBytes:m(this,K).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(m(this,K).bufferAtVerbosity),flushOnErrorLog:m(this,K).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&n.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&n.appendKeys(this.temporaryLogAttributes),n}critical(t,...n){this.processLogItem(q.CRITICAL,t,n)}debug(t,...n){this.processLogItem(q.DEBUG,t,n)}error(t,...n){m(this,K).enabled&&m(this,K).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(q.ERROR,t,n)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...n){this.processLogItem(q.INFO,t,n)}injectLambdaContext(t){return(n,s,i)=>{let a=i.value,o=this;i.value=async function(...c){o.refreshSampleRateCalculation(),o.addContext(c[1]),o.logEventIfEnabled(c[0],t?.logEvent),t?.correlationIdPath&&o.setCorrelationId(c[0],t?.correlationIdPath);try{return await a.apply(this,c)}catch(u){throw t?.flushBufferOnUncaughtError&&(o.flushBuffer(),o.error({message:pa,error:u})),u}finally{(t?.clearState||t?.resetKeys)&&o.resetKeys(),o.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,n,s){s&&(s.clearState||s?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,n,s,i){t.addContext(s),t.logEventIfEnabled(n,i?.logEvent)}logEventIfEnabled(t,n){this.shouldLogEvent(n)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(m(this,Fe).refreshedTimes===0){m(this,Fe).refreshedTimes++;return}B(this,P,Bs).call(this)&&this.logLevel>q.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(m(this,Ye)))}removeKeys(t){for(let n of t)this.temporaryLogAttributes[n]=void 0,this.persistentLogAttributes[n]?m(this,xe).set(n,"persistent"):m(this,xe).delete(n)}removePersistentKeys(t){for(let n of t)this.persistentLogAttributes[n]=void 0,this.temporaryLogAttributes[n]?m(this,xe).set(n,"temp"):m(this,xe).delete(n)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?m(this,xe).set(t,"persistent"):m(this,xe).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=q[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...n){this.processLogItem(q.TRACE,t,n)}warn(t,...n){this.processLogItem(q.WARN,t,n)}createLogger(t){return new js(t)}getJsonReplacer(){let t=new WeakSet;return(n,s)=>{var a;let i=s;if(m(this,ht)&&(i=(a=m(this,ht))==null?void 0:a.call(this,n,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,gr.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return m(this,Te)!==void 0?(this.logLevel=q[m(this,Te)],this.isValidLogLevel(t)&&this.logLevel>q[t]&&B(this,P,yr).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${m(this,Te)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,n,s){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:Me(),...this.getPowertoolsLogData(),message:""},a=B(this,P,oo).call(this);return B(this,P,co).call(this,n,i,a),B(this,P,uo).call(this,s,a),this.getLogFormatter().formatAttributes(i,a)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let n;for(let[s,i]of Object.entries(q))if(i===t){n=s;break}return n}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in q}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,n){n.prepareForPrint();let s=t===q.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[s](JSON.stringify(n.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,n,s){let i=Me();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,n,s),t)}catch(a){this.printLog(q.WARN,this.createAndPopulateLogItem(q.WARN,`Unable to buffer log: ${a.message}`,[a])),this.printLog(t,this.createAndPopulateLogItem(t,n,s))}return}t>=this.logLevel&&(m(this,Er)?this.printLog(t,this.createAndPopulateLogItem(t,n,s)):m(this,jt).push([t,[t,n,s]]))}setConsole(){ur()?this.console=console:this.console=new io.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...n)=>{this.console.log(t,...n)}}setInitialLogLevel(t){let n=t?.toUpperCase();if(this.awsLogLevelShortCircuit(n)){Z(this,Ye,this.logLevel);return}if(this.isValidLogLevel(n)){this.logLevel=q[n],Z(this,Ye,this.logLevel);return}let s=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(s)){this.logLevel=q[s],Z(this,Ye,this.logLevel);return}let i=z({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),a=z({key:"LOG_LEVEL",defaultValue:""}),o=i!==""?i:a;this.isValidLogLevel(o)&&(this.logLevel=q[o],Z(this,Ye,this.logLevel))}setInitialSampleRate(t){let n=t,s=this.getCustomConfigService()?.getSampleRateValue(),i=ya({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let a of[n,s,i])if(this.isValidSampleRate(a)){m(this,Fe).sampleRateValue=a,this.powertoolsLogData.sampleRateValue=a,B(this,P,Bs).call(this)&&this.logLevel>q.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=bs({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,n){this.logFormatter=t??new dn({logRecordOrder:n})}setLogIndentation(){ur()&&(this.logIndentation=Ss.PRETTY)}setOptions(t){let{logLevel:n,serviceName:s,sampleRateValue:i,logFormatter:a,persistentKeys:o,persistentLogAttributes:c,environment:u,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:g,correlationIdSearchFn:f}=t;c&&Object.keys(c).length>0&&o&&Object.keys(o).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(s,u,o||c);let L=z({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),C=L==="FATAL"?"CRITICAL":L;return this.isValidLogLevel(C)&&Z(this,Te,C),this.setLogEvent(),this.setInitialLogLevel(n),this.setInitialSampleRate(i),this.setLogFormatter(a,d),this.setConsole(),this.setLogIndentation(),Z(this,ht,l),B(this,P,fo).call(this,g),Z(this,mt,f),this}setPowertoolsLogData(t,n,s){this.addToPowertoolsLogData({awsRegion:z({key:"AWS_REGION",defaultValue:""}),environment:n||this.getCustomConfigService()?.getCurrentEnvironment()||z({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||z({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),s&&this.appendPersistentKeys(s)}bufferLogItem(t,n,s){n.prepareForPrint(),m(this,Le)?.has(t)===!1&&m(this,Le)?.clear(),m(this,Le)?.setItem(t,JSON.stringify(n.getAttributes(),this.getJsonReplacer(),this.logIndentation),s)}flushBuffer(){let t=Me();if(t===void 0)return;let n=m(this,Le)?.get(t);if(n!==void 0){for(let s of n){let i=this.getLogLevelNameFromNumber(s.logLevel).toLowerCase();this.console[i](s.value)}n.hasEvictedLog&&this.printLog(q.WARN,this.createAndPopulateLogItem(q.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),m(this,Te)!==void 0&&q[m(this,Te)]>m(this,K).bufferAtVerbosity&&B(this,P,yr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),m(this,Le)?.delete(t)}}clearBuffer(){let t=Me();t!==void 0&&m(this,Le)?.delete(t)}shouldBufferLog(t,n){return m(this,K).enabled&&t!==void 0&&n<=m(this,K).bufferAtVerbosity}setCorrelationId(t,n){if(typeof n=="string"){if(!m(this,mt)){B(this,P,yr).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let s=m(this,mt).call(this,n,t);s&&this.appendKeys({correlation_id:s});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};Te=new WeakMap,jt=new WeakMap,Er=new WeakMap,xe=new WeakMap,Ye=new WeakMap,ht=new WeakMap,K=new WeakMap,Le=new WeakMap,mt=new WeakMap,Fe=new WeakMap,Sr=new WeakMap,P=new WeakSet,yr=function(t){m(this,Sr).has(t)||(m(this,Sr).set(t,!0),this.warn(t))},Us=function(t,n){for(let s of Object.keys(t))B(this,P,vr).call(this,s)===!1&&m(this,xe).set(s,n);n==="temp"?(0,gr.default)(this.temporaryLogAttributes,t):(0,gr.default)(this.persistentLogAttributes,t)},oo=function(){let t={};for(let[n,s]of m(this,xe))B(this,P,vr).call(this,n)||(t[n]=s==="persistent"?this.persistentLogAttributes[n]:this.temporaryLogAttributes[n]);return t},co=function(t,n,s){if(typeof t=="string"){n.message=t;return}let{message:i,...a}=t;n.message=i;for(let[o,c]of Object.entries(a))B(this,P,vr).call(this,o)||(s[o]=c)},uo=function(t,n){for(let s of t)$s(s)||(s instanceof Error?n.error=s:typeof s=="string"?n.extra=s:B(this,P,lo).call(this,s,n))},lo=function(t,n){for(let[s,i]of Object.entries(t))B(this,P,vr).call(this,s)||(n[s]=i)},Bs=function(){return m(this,Fe).sampleRateValue&&(0,ao.randomInt)(0,100)/100<=m(this,Fe).sampleRateValue},vr=function(t){return fa.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},fo=function(t){if(t===void 0||(m(this,K).enabled=t?.enabled!==!1,m(this,K).enabled===!1))return;t?.maxBytes!==void 0&&(m(this,K).maxBytes=t.maxBytes),Z(this,Le,new fn({maxBytesSize:m(this,K).maxBytes})),t?.flushOnErrorLog===!1&&(m(this,K).flushOnErrorLog=!1);let n=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(n)&&(m(this,K).bufferAtVerbosity=q[n]),m(this,Te)!==void 0&&q[m(this,Te)]>m(this,K).bufferAtVerbosity&&B(this,P,yr).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var _r=js;Vt();var _n=class r{constructor(e,t){this.logger=new _r({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||et(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,n){let s=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...s,...n})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,n){this.info(`Custom metric: ${e}`,{metric:e,value:t,...n})}logApiRequest(e,t,n){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...n})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};function jo(r,e){return new _n(r,e)}var o0=new _n;Vt();var lf=Ie(ea(),1);var of=Ie(ea(),1),as=require("diagnostics_channel"),cf=Ie(require("http"),1),uf=Ie(require("https"),1);var ta=require("url"),tf=new TextDecoder,rf=(r,e)=>{let t=-1;for(let n=0;n<r.length;n+=2)if(tf.decode(r[n]).toLowerCase()===e){t=n;break}return t===-1?null:tf.decode(r[t+1])},ra=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",nf=r=>{if(typeof r.origin=="string")return new ta.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof ta.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:yE,captureAWSClient:vE,captureAWSv3Client:_E,captureAsyncFunc:EE,captureFunc:SE,captureHTTPsGlobal:sf,getNamespace:bE,getSegment:TE,setSegment:xE,Segment:af,setContextMissingStrategy:RE,setDaemonAddress:wE,setLogger:AE}=of.default,os=class{captureAWS(e){return yE(e)}captureAWSClient(e){return vE(e)}captureAWSv3Client(e){return Ps(e,"tracer"),_E(e)}captureAsyncFunc(e,t,n){return EE(e,t)}captureFunc(e,t,n){return SE(e,t)}captureHTTPsGlobal(){sf(cf.default),sf(uf.default)}getNamespace(){return bE()}getSegment(){return TE()}instrumentFetch(){let e=s=>{let{request:i}=s,a=i.method;if(a==="CONNECT")return;let o=this.getSegment(),c=nf(i);if(o&&c){let u=o.addNewSubsegment(c.hostname);u.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${Me()};Parent=${u.id};Sampled=${u.notTraced?"0":"1"}`),u.http={request:{url:`${c.protocol}//${c.hostname}${c.pathname}`,method:a}},this.setSegment(u)}},t=s=>{let{response:i}=s,a=this.getSegment();if(ra(a)){let o=i.statusCode,c=rf(i.headers,"content-length");a.http={...a.http,response:{status:o,...c&&{content_length:Number.parseInt(c,10)}}},o===429&&a.addThrottleFlag(),o>=400&&o<500?a.addErrorFlag():o>=500&&o<600&&a.addFaultFlag(),a.close(),this.setSegment(a.parent)}},n=s=>{let{error:i}=s,a=this.getSegment();ra(a)&&(a.addErrorFlag(),i instanceof Error&&a.addError(i,!0),a.close(),this.setSegment(a.parent))};(0,as.subscribe)("undici:request:create",e),(0,as.subscribe)("undici:request:headers",t),(0,as.subscribe)("undici:request:error",n)}putAnnotation(e,t){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(n instanceof af){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}n.addAnnotation(e,t)}putMetadata(e,t,n){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(s instanceof af){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}s.addMetadata(e,t,n)}setContextMissingStrategy(e){RE(e)}setDaemonAddress(e){wE(e)}setLogger(e){AE(e)}setSegment(e){xE(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:CE}=lf.default,H,cs,df,Hr=class extends ft{constructor(t={}){super();M(this,cs);I(this,"provider");I(this,"captureError",!0);I(this,"captureHTTPsRequests",!0);I(this,"captureResponse",!0);I(this,"customConfigService");M(this,H,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});I(this,"serviceName");I(this,"tracingEnabled",!0);B(this,cs,df).call(this),this.setOptions(t),this.provider=new os,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,n){if(!this.isTracingEnabled())return;let s=this.getSegment();if(s!==void 0){if(!this.captureError){s.addErrorFlag();return}s.addError(t,n||!1)}}addResponseAsMetadata(t,n){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${n} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(n){try{return this.provider.captureAWSClient(t.service),t}catch{throw n}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(n,s,i)=>{let a=i.value,o=this;return i.value=function(...c){return o.isTracingEnabled()?o.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async u=>{o.annotateColdStart(),o.addServiceNameAnnotation();let l;try{l=await a.apply(this,c),(t?.captureResponse??!0)&&o.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw o.addErrorAsMetadata(d),d}finally{try{u?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",u?.name,d)}}return l}):a.apply(this,c)},i}}captureMethod(t){return(n,s,i)=>{let a=i.value,o=this;return i.value=function(...c){if(!o.isTracingEnabled())return a.apply(this,[...c]);let u=String(s),l=t?.subSegmentName?t.subSegmentName:`### ${u}`;return o.provider.captureAsyncFunc(l,async d=>{let g;try{g=await a.apply(this,[...c]),(t?.captureResponse??!0)&&o.addResponseAsMetadata(g,u)}catch(f){throw o.addErrorAsMetadata(f),f}finally{try{d?.close()}catch(f){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,f)}}return g})},i}}getRootXrayTraceId(){return Me()}getSegment(){if(!this.isTracingEnabled())return new CE("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?Ea():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,n){this.isTracingEnabled()&&this.provider.putAnnotation(t,n)}putMetadata(t,n,s){this.isTracingEnabled()&&this.provider.putMetadata(t,n,s||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return m(this,H).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return m(this,H).awsExecutionEnv!==""}isLambdaSamCli(){return m(this,H).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(m(this,H).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let n=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(n!==void 0&&n.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}m(this,H).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(m(this,H).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:n,serviceName:s,captureHTTPsRequests:i,customConfigService:a}=t;return this.setCustomConfigService(a),this.setTracingEnabled(n),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(s),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let n=this.getCustomConfigService()?.getServiceName();if(n!==void 0&&this.isValidServiceName(n)){this.serviceName=n;return}if(m(this,H).serviceName!==void 0&&this.isValidServiceName(m(this,H).serviceName)){this.serviceName=m(this,H).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let n=this.getCustomConfigService()?.getTracingEnabled();if(n!==void 0&&n.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(m(this,H).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};H=new WeakMap,cs=new WeakSet,df=function(){m(this,H).awsExecutionEnv=z({key:"AWS_EXECUTION_ENV",defaultValue:""}),m(this,H).samLocal=z({key:"AWS_SAM_LOCAL",defaultValue:""}),m(this,H).captureError=z({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),m(this,H).captureHTTPsRequests=z({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),m(this,H).captureResponse=z({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),m(this,H).tracingEnabled=z({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),m(this,H).serviceName=va()};var IE=new Hr({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service"});function us(){try{return IE.getSegment()}catch(r){console.warn("Failed to get X-Ray segment:",r);return}}function ls(r){try{let e=us();if(!e)return;for(let[t,n]of Object.entries(r))n!==void 0&&e.addAnnotation(t,n)}catch(e){console.warn("Failed to add X-Ray annotations:",e)}}function ff(r,e){try{let t=us();if(!t)return;if(e)t.addMetadata(e,r);else for(let[n,s]of Object.entries(r))t.addMetadata(n,s)}catch(t){console.warn("Failed to add X-Ray metadata:",t)}}var LE=new ds.SQS,NE=new ds.SNS;function OE(r){let e=r.message.toLowerCase(),t=r.name.toLowerCase(),n=r.code,s=["timeout","econnrefused","econnreset","etimedout","enotfound","network","connection","throttl","rate limit","429","503","504","too many requests","service unavailable","gateway timeout"];for(let o of s)if(e.includes(o)||t.includes(o)||n===o)return{type:"transient",shouldRetry:!0,shouldAlert:!1};let i=["unauthorized","forbidden","access denied","authentication","security","corruption","integrity","out of memory","disk full","database corruption"];for(let o of i)if(e.includes(o)||t.includes(o))return{type:"critical",shouldRetry:!1,shouldAlert:!0};let a=["validation","invalid","not found","404","400","bad request","malformed","schema","parse error"];for(let o of a)if(e.includes(o)||t.includes(o)||n===o)return{type:"permanent",shouldRetry:!1,shouldAlert:!1};return{type:"permanent",shouldRetry:!1,shouldAlert:!1}}async function kE(r,e,t,n){let s=process.env.DLQ_URL;if(!s){console.warn("DLQ_URL not configured, skipping DLQ send");return}try{let i={originalEvent:r,error:{name:e.name,message:e.message,stack:e.stack},traceId:t,context:{functionName:n.functionName,functionVersion:n.functionVersion,requestId:n.awsRequestId,timestamp:new Date().toISOString()}};await LE.sendMessage({QueueUrl:s,MessageBody:JSON.stringify(i),MessageAttributes:{traceId:{DataType:"String",StringValue:t},errorType:{DataType:"String",StringValue:e.name}}}).promise(),console.log("Message sent to DLQ",{traceId:t,dlqUrl:s})}catch(i){console.error("Failed to send message to DLQ",i)}}async function qE(r,e,t,n){let s=process.env.ALERT_TOPIC_ARN;if(!s){console.warn("ALERT_TOPIC_ARN not configured, skipping alert");return}try{let i={severity:"CRITICAL",service:t.functionName,error:{name:r.name,message:r.message,stack:r.stack},traceId:e,timestamp:new Date().toISOString(),requestId:t.awsRequestId,event:JSON.stringify(n).substring(0,500)};await NE.publish({TopicArn:s,Subject:`\u{1F6A8} CRITICAL ERROR: ${t.functionName}`,Message:JSON.stringify(i,null,2),MessageAttributes:{severity:{DataType:"String",StringValue:"CRITICAL"},service:{DataType:"String",StringValue:t.functionName}}}).promise(),console.log("Critical alert sent",{traceId:e,alertTopicArn:s})}catch(i){console.error("Failed to send alert",i)}}function pf(r){return async(e,t)=>{let n=et(),s=jo(t.functionName,{traceId:n}),i=us();ls({traceId:n,functionName:t.functionName,requestId:t.awsRequestId});try{s.info("Processing event",{functionName:t.functionName});let a=await r(e,t,s);return ls({status:"success"}),s.info("Event processed successfully"),a}catch(a){let o=a,c=OE(o);throw ls({status:"error",errorType:c.type,errorName:o.name}),ff({error:{name:o.name,message:o.message,stack:o.stack,classification:c.type}},"error"),i&&i.addError(o),s.error("Event processing failed",o,{errorType:c.type}),c.shouldRetry||await kE(e,o,n,t),c.shouldAlert&&await qE(o,n,t,e),o}}}Vt();var or={};vs(or,{BRAND:()=>aS,DIRTY:()=>_t,EMPTY_PATH:()=>DE,INVALID:()=>b,NEVER:()=>WS,OK:()=>ie,ParseStatus:()=>J,Schema:()=>w,ZodAny:()=>ot,ZodArray:()=>Ke,ZodBigInt:()=>St,ZodBoolean:()=>bt,ZodBranded:()=>Zr,ZodCatch:()=>kt,ZodDate:()=>Tt,ZodDefault:()=>Ot,ZodDiscriminatedUnion:()=>hs,ZodEffects:()=>_e,ZodEnum:()=>Lt,ZodError:()=>le,ZodFirstPartyTypeKind:()=>T,ZodFunction:()=>gs,ZodIntersection:()=>At,ZodIssueCode:()=>p,ZodLazy:()=>Ct,ZodLiteral:()=>It,ZodMap:()=>sr,ZodNaN:()=>ar,ZodNativeEnum:()=>Nt,ZodNever:()=>Ce,ZodNull:()=>Rt,ZodNullable:()=>qe,ZodNumber:()=>Et,ZodObject:()=>de,ZodOptional:()=>ye,ZodParsedType:()=>v,ZodPipeline:()=>Yr,ZodPromise:()=>ct,ZodReadonly:()=>qt,ZodRecord:()=>ms,ZodSchema:()=>w,ZodSet:()=>ir,ZodString:()=>at,ZodSymbol:()=>rr,ZodTransformer:()=>_e,ZodTuple:()=>ke,ZodType:()=>w,ZodUndefined:()=>xt,ZodUnion:()=>wt,ZodUnknown:()=>He,ZodVoid:()=>nr,addIssueToContext:()=>y,any:()=>mS,array:()=>_S,bigint:()=>lS,boolean:()=>xf,coerce:()=>VS,custom:()=>Sf,date:()=>dS,datetimeRegex:()=>_f,defaultErrorMap:()=>Ge,discriminatedUnion:()=>TS,effect:()=>PS,enum:()=>OS,function:()=>IS,getErrorMap:()=>Jt,getParsedType:()=>Oe,instanceof:()=>cS,intersection:()=>xS,isAborted:()=>fs,isAsync:()=>er,isDirty:()=>ps,isValid:()=>it,late:()=>oS,lazy:()=>LS,literal:()=>NS,makeIssue:()=>Kr,map:()=>AS,nan:()=>uS,nativeEnum:()=>kS,never:()=>yS,null:()=>hS,nullable:()=>$S,number:()=>Tf,object:()=>ES,objectUtil:()=>na,oboolean:()=>jS,onumber:()=>BS,optional:()=>MS,ostring:()=>US,pipeline:()=>FS,preprocess:()=>DS,promise:()=>qS,quotelessJson:()=>PE,record:()=>wS,set:()=>CS,setErrorMap:()=>$E,strictObject:()=>SS,string:()=>bf,symbol:()=>fS,transformer:()=>PS,tuple:()=>RS,undefined:()=>pS,union:()=>bS,unknown:()=>gS,util:()=>A,void:()=>vS});var A;(function(r){r.assertEqual=s=>{};function e(s){}r.assertIs=e;function t(s){throw new Error}r.assertNever=t,r.arrayToEnum=s=>{let i={};for(let a of s)i[a]=a;return i},r.getValidEnumValues=s=>{let i=r.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),a={};for(let o of i)a[o]=s[o];return r.objectValues(a)},r.objectValues=s=>r.objectKeys(s).map(function(i){return s[i]}),r.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let i=[];for(let a in s)Object.prototype.hasOwnProperty.call(s,a)&&i.push(a);return i},r.find=(s,i)=>{for(let a of s)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function n(s,i=" | "){return s.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=n,r.jsonStringifyReplacer=(s,i)=>typeof i=="bigint"?i.toString():i})(A||(A={}));var na;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(na||(na={}));var v=A.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Oe=r=>{switch(typeof r){case"undefined":return v.undefined;case"string":return v.string;case"number":return Number.isNaN(r)?v.nan:v.number;case"boolean":return v.boolean;case"function":return v.function;case"bigint":return v.bigint;case"symbol":return v.symbol;case"object":return Array.isArray(r)?v.array:r===null?v.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?v.promise:typeof Map<"u"&&r instanceof Map?v.map:typeof Set<"u"&&r instanceof Set?v.set:typeof Date<"u"&&r instanceof Date?v.date:v.object;default:return v.unknown}};var p=A.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),PE=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),le=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},n={_errors:[]},s=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(s);else if(a.code==="invalid_return_type")s(a.returnTypeError);else if(a.code==="invalid_arguments")s(a.argumentsError);else if(a.path.length===0)n._errors.push(t(a));else{let o=n,c=0;for(;c<a.path.length;){let u=a.path[c];c===a.path.length-1?(o[u]=o[u]||{_errors:[]},o[u]._errors.push(t(a))):o[u]=o[u]||{_errors:[]},o=o[u],c++}}};return s(this),n}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,A.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},n=[];for(let s of this.issues)if(s.path.length>0){let i=s.path[0];t[i]=t[i]||[],t[i].push(e(s))}else n.push(e(s));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}};le.create=r=>new le(r);var ME=(r,e)=>{let t;switch(r.code){case p.invalid_type:r.received===v.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,A.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${A.joinValues(r.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${A.joinValues(r.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${A.joinValues(r.options)}, received '${r.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:A.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case p.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case p.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,A.assertNever(r)}return{message:t}},Ge=ME;var hf=Ge;function $E(r){hf=r}function Jt(){return hf}var Kr=r=>{let{data:e,path:t,errorMaps:n,issueData:s}=r,i=[...t,...s.path||[]],a={...s,path:i};if(s.message!==void 0)return{...s,path:i,message:s.message};let o="",c=n.filter(u=>!!u).slice().reverse();for(let u of c)o=u(a,{data:e,defaultError:o}).message;return{...s,path:i,message:o}},DE=[];function y(r,e){let t=Jt(),n=Kr({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Ge?void 0:Ge].filter(s=>!!s)});r.common.issues.push(n)}var J=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let n=[];for(let s of t){if(s.status==="aborted")return b;s.status==="dirty"&&e.dirty(),n.push(s.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){let n=[];for(let s of t){let i=await s.key,a=await s.value;n.push({key:i,value:a})}return r.mergeObjectSync(e,n)}static mergeObjectSync(e,t){let n={};for(let s of t){let{key:i,value:a}=s;if(i.status==="aborted"||a.status==="aborted")return b;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||s.alwaysSet)&&(n[i.value]=a.value)}return{status:e.value,value:n}}},b=Object.freeze({status:"aborted"}),_t=r=>({status:"dirty",value:r}),ie=r=>({status:"valid",value:r}),fs=r=>r.status==="aborted",ps=r=>r.status==="dirty",it=r=>r.status==="valid",er=r=>typeof Promise<"u"&&r instanceof Promise;var S;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(S||(S={}));var ve=class{constructor(e,t,n,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},mf=(r,e)=>{if(it(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new le(r.common.issues);return this._error=t,this._error}}};function R(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:n,description:s}=r;if(e&&(t||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(a,o)=>{let{message:c}=r;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:c??n??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:c??t??o.defaultError}},description:s}}var w=class{get description(){return this._def.description}_getType(e){return Oe(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Oe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new J,ctx:{common:e.parent.common,data:e.data,parsedType:Oe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(er(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){let n={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)},s=this._parseSync({data:e,path:n.path,parent:n});return mf(n,s)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)};if(!this["~standard"].async)try{let n=this._parseSync({data:e,path:[],parent:t});return it(n)?{value:n.value}:{issues:t.common.issues}}catch(n){n?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(n=>it(n)?{value:n.value}:{issues:t.common.issues})}async parseAsync(e,t){let n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){let n={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Oe(e)},s=this._parse({data:e,path:n.path,parent:n}),i=await(er(s)?s:Promise.resolve(s));return mf(n,i)}refine(e,t){let n=s=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(s):t;return this._refinement((s,i)=>{let a=e(s),o=()=>i.addIssue({code:p.custom,...n(s)});return typeof Promise<"u"&&a instanceof Promise?a.then(c=>c?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((n,s)=>e(n)?!0:(s.addIssue(typeof t=="function"?t(n,s):t),!1))}_refinement(e){return new _e({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return ye.create(this,this._def)}nullable(){return qe.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ke.create(this)}promise(){return ct.create(this,this._def)}or(e){return wt.create([this,e],this._def)}and(e){return At.create(this,e,this._def)}transform(e){return new _e({...R(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new Ot({...R(this._def),innerType:this,defaultValue:t,typeName:T.ZodDefault})}brand(){return new Zr({typeName:T.ZodBranded,type:this,...R(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new kt({...R(this._def),innerType:this,catchValue:t,typeName:T.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Yr.create(this,e)}readonly(){return qt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},FE=/^c[^\s-]{8,}$/i,UE=/^[0-9a-z]+$/,BE=/^[0-9A-HJKMNP-TV-Z]{26}$/i,jE=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,VE=/^[a-z0-9_-]{21}$/i,WE=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,XE=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,GE=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,zE="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",sa,HE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,KE=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ZE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,YE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,QE=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,JE=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,yf="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",eS=new RegExp(`^${yf}$`);function vf(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function tS(r){return new RegExp(`^${vf(r)}$`)}function _f(r){let e=`${yf}T${vf(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function rS(r,e){return!!((e==="v4"||!e)&&HE.test(r)||(e==="v6"||!e)&&ZE.test(r))}function nS(r,e){if(!WE.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let n=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),s=JSON.parse(atob(n));return!(typeof s!="object"||s===null||"typ"in s&&s?.typ!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function sS(r,e){return!!((e==="v4"||!e)&&KE.test(r)||(e==="v6"||!e)&&YE.test(r))}var at=class r extends w{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==v.string){let i=this._getOrReturnCtx(e);return y(i,{code:p.invalid_type,expected:v.string,received:i.parsedType}),b}let n=new J,s;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="max")e.data.length>i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),n.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(s=this._getOrReturnCtx(e,s),a?y(s,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&y(s,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),n.dirty())}else if(i.kind==="email")GE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"email",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="emoji")sa||(sa=new RegExp(zE,"u")),sa.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"emoji",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="uuid")jE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"uuid",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="nanoid")VE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"nanoid",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid")FE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cuid",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="cuid2")UE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cuid2",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="ulid")BE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"ulid",code:p.invalid_string,message:i.message}),n.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),y(s,{validation:"url",code:p.invalid_string,message:i.message}),n.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"regex",code:p.invalid_string,message:i.message}),n.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),n.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:{startsWith:i.value},message:i.message}),n.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:{endsWith:i.value},message:i.message}),n.dirty()):i.kind==="datetime"?_f(i).test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:"datetime",message:i.message}),n.dirty()):i.kind==="date"?eS.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:"date",message:i.message}),n.dirty()):i.kind==="time"?tS(i).test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{code:p.invalid_string,validation:"time",message:i.message}),n.dirty()):i.kind==="duration"?XE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"duration",code:p.invalid_string,message:i.message}),n.dirty()):i.kind==="ip"?rS(e.data,i.version)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"ip",code:p.invalid_string,message:i.message}),n.dirty()):i.kind==="jwt"?nS(e.data,i.alg)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"jwt",code:p.invalid_string,message:i.message}),n.dirty()):i.kind==="cidr"?sS(e.data,i.version)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"cidr",code:p.invalid_string,message:i.message}),n.dirty()):i.kind==="base64"?QE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"base64",code:p.invalid_string,message:i.message}),n.dirty()):i.kind==="base64url"?JE.test(e.data)||(s=this._getOrReturnCtx(e,s),y(s,{validation:"base64url",code:p.invalid_string,message:i.message}),n.dirty()):A.assertNever(i);return{status:n.value,value:e.data}}_regex(e,t,n){return this.refinement(s=>e.test(s),{validation:t,code:p.invalid_string,...S.errToObj(n)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...S.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...S.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...S.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...S.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...S.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};at.create=r=>new at({checks:[],typeName:T.ZodString,coerce:r?.coerce??!1,...R(r)});function iS(r,e){let t=(r.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,s=t>n?t:n,i=Number.parseInt(r.toFixed(s).replace(".","")),a=Number.parseInt(e.toFixed(s).replace(".",""));return i%a/10**s}var Et=class r extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==v.number){let i=this._getOrReturnCtx(e);return y(i,{code:p.invalid_type,expected:v.number,received:i.parsedType}),b}let n,s=new J;for(let i of this._def.checks)i.kind==="int"?A.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:p.invalid_type,expected:"integer",received:"float",message:i.message}),s.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),s.dirty()):i.kind==="multipleOf"?iS(e.data,i.value)!==0&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),y(n,{code:p.not_finite,message:i.message}),s.dirty()):A.assertNever(i);return{status:s.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:S.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&A.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(t===null||n.value>t)&&(t=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}};Et.create=r=>new Et({checks:[],typeName:T.ZodNumber,coerce:r?.coerce||!1,...R(r)});var St=class r extends w{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==v.bigint)return this._getInvalidInput(e);let n,s=new J;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),s.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),y(n,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),s.dirty()):A.assertNever(i);return{status:s.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return y(t,{code:p.invalid_type,expected:v.bigint,received:t.parsedType}),b}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,n,s){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:S.toString(s)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};St.create=r=>new St({checks:[],typeName:T.ZodBigInt,coerce:r?.coerce??!1,...R(r)});var bt=class extends w{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==v.boolean){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.boolean,received:n.parsedType}),b}return ie(e.data)}};bt.create=r=>new bt({typeName:T.ZodBoolean,coerce:r?.coerce||!1,...R(r)});var Tt=class r extends w{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==v.date){let i=this._getOrReturnCtx(e);return y(i,{code:p.invalid_type,expected:v.date,received:i.parsedType}),b}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return y(i,{code:p.invalid_date}),b}let n=new J,s;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:p.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),n.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(s=this._getOrReturnCtx(e,s),y(s,{code:p.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),n.dirty()):A.assertNever(i);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};Tt.create=r=>new Tt({checks:[],coerce:r?.coerce||!1,typeName:T.ZodDate,...R(r)});var rr=class extends w{_parse(e){if(this._getType(e)!==v.symbol){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.symbol,received:n.parsedType}),b}return ie(e.data)}};rr.create=r=>new rr({typeName:T.ZodSymbol,...R(r)});var xt=class extends w{_parse(e){if(this._getType(e)!==v.undefined){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.undefined,received:n.parsedType}),b}return ie(e.data)}};xt.create=r=>new xt({typeName:T.ZodUndefined,...R(r)});var Rt=class extends w{_parse(e){if(this._getType(e)!==v.null){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.null,received:n.parsedType}),b}return ie(e.data)}};Rt.create=r=>new Rt({typeName:T.ZodNull,...R(r)});var ot=class extends w{constructor(){super(...arguments),this._any=!0}_parse(e){return ie(e.data)}};ot.create=r=>new ot({typeName:T.ZodAny,...R(r)});var He=class extends w{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ie(e.data)}};He.create=r=>new He({typeName:T.ZodUnknown,...R(r)});var Ce=class extends w{_parse(e){let t=this._getOrReturnCtx(e);return y(t,{code:p.invalid_type,expected:v.never,received:t.parsedType}),b}};Ce.create=r=>new Ce({typeName:T.ZodNever,...R(r)});var nr=class extends w{_parse(e){if(this._getType(e)!==v.undefined){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.void,received:n.parsedType}),b}return ie(e.data)}};nr.create=r=>new nr({typeName:T.ZodVoid,...R(r)});var Ke=class r extends w{_parse(e){let{ctx:t,status:n}=this._processInputParams(e),s=this._def;if(t.parsedType!==v.array)return y(t,{code:p.invalid_type,expected:v.array,received:t.parsedType}),b;if(s.exactLength!==null){let a=t.data.length>s.exactLength.value,o=t.data.length<s.exactLength.value;(a||o)&&(y(t,{code:a?p.too_big:p.too_small,minimum:o?s.exactLength.value:void 0,maximum:a?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),n.dirty())}if(s.minLength!==null&&t.data.length<s.minLength.value&&(y(t,{code:p.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),n.dirty()),s.maxLength!==null&&t.data.length>s.maxLength.value&&(y(t,{code:p.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>s.type._parseAsync(new ve(t,a,t.path,o)))).then(a=>J.mergeArray(n,a));let i=[...t.data].map((a,o)=>s.type._parseSync(new ve(t,a,t.path,o)));return J.mergeArray(n,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}};Ke.create=(r,e)=>new Ke({type:r,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...R(e)});function tr(r){if(r instanceof de){let e={};for(let t in r.shape){let n=r.shape[t];e[t]=ye.create(tr(n))}return new de({...r._def,shape:()=>e})}else return r instanceof Ke?new Ke({...r._def,type:tr(r.element)}):r instanceof ye?ye.create(tr(r.unwrap())):r instanceof qe?qe.create(tr(r.unwrap())):r instanceof ke?ke.create(r.items.map(e=>tr(e))):r}var de=class r extends w{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=A.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==v.object){let u=this._getOrReturnCtx(e);return y(u,{code:p.invalid_type,expected:v.object,received:u.parsedType}),b}let{status:n,ctx:s}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ce&&this._def.unknownKeys==="strip"))for(let u in s.data)a.includes(u)||o.push(u);let c=[];for(let u of a){let l=i[u],d=s.data[u];c.push({key:{status:"valid",value:u},value:l._parse(new ve(s,d,s.path,u)),alwaysSet:u in s.data})}if(this._def.catchall instanceof Ce){let u=this._def.unknownKeys;if(u==="passthrough")for(let l of o)c.push({key:{status:"valid",value:l},value:{status:"valid",value:s.data[l]}});else if(u==="strict")o.length>0&&(y(s,{code:p.unrecognized_keys,keys:o}),n.dirty());else if(u!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let u=this._def.catchall;for(let l of o){let d=s.data[l];c.push({key:{status:"valid",value:l},value:u._parse(new ve(s,d,s.path,l)),alwaysSet:l in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let u=[];for(let l of c){let d=await l.key,g=await l.value;u.push({key:d,value:g,alwaysSet:l.alwaysSet})}return u}).then(u=>J.mergeObjectSync(n,u)):J.mergeObjectSync(n,c)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,n)=>{let s=this._def.errorMap?.(t,n).message??n.defaultError;return t.code==="unrecognized_keys"?{message:S.errToObj(e).message??s}:{message:s}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let n of A.objectKeys(e))e[n]&&this.shape[n]&&(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let n of A.objectKeys(this.shape))e[n]||(t[n]=this.shape[n]);return new r({...this._def,shape:()=>t})}deepPartial(){return tr(this)}partial(e){let t={};for(let n of A.objectKeys(this.shape)){let s=this.shape[n];e&&!e[n]?t[n]=s:t[n]=s.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let n of A.objectKeys(this.shape))if(e&&!e[n])t[n]=this.shape[n];else{let i=this.shape[n];for(;i instanceof ye;)i=i._def.innerType;t[n]=i}return new r({...this._def,shape:()=>t})}keyof(){return Ef(A.objectKeys(this.shape))}};de.create=(r,e)=>new de({shape:()=>r,unknownKeys:"strip",catchall:Ce.create(),typeName:T.ZodObject,...R(e)});de.strictCreate=(r,e)=>new de({shape:()=>r,unknownKeys:"strict",catchall:Ce.create(),typeName:T.ZodObject,...R(e)});de.lazycreate=(r,e)=>new de({shape:r,unknownKeys:"strip",catchall:Ce.create(),typeName:T.ZodObject,...R(e)});var wt=class extends w{_parse(e){let{ctx:t}=this._processInputParams(e),n=this._def.options;function s(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new le(o.ctx.common.issues));return y(t,{code:p.invalid_union,unionErrors:a}),b}if(t.common.async)return Promise.all(n.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(s);{let i,a=[];for(let c of n){let u={...t,common:{...t.common,issues:[]},parent:null},l=c._parseSync({data:t.data,path:t.path,parent:u});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:u}),u.common.issues.length&&a.push(u.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(c=>new le(c));return y(t,{code:p.invalid_union,unionErrors:o}),b}}get options(){return this._def.options}};wt.create=(r,e)=>new wt({options:r,typeName:T.ZodUnion,...R(e)});var ze=r=>r instanceof Ct?ze(r.schema):r instanceof _e?ze(r.innerType()):r instanceof It?[r.value]:r instanceof Lt?r.options:r instanceof Nt?A.objectValues(r.enum):r instanceof Ot?ze(r._def.innerType):r instanceof xt?[void 0]:r instanceof Rt?[null]:r instanceof ye?[void 0,...ze(r.unwrap())]:r instanceof qe?[null,...ze(r.unwrap())]:r instanceof Zr||r instanceof qt?ze(r.unwrap()):r instanceof kt?ze(r._def.innerType):[],hs=class r extends w{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.object)return y(t,{code:p.invalid_type,expected:v.object,received:t.parsedType}),b;let n=this.discriminator,s=t.data[n],i=this.optionsMap.get(s);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(y(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),b)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){let s=new Map;for(let i of t){let a=ze(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(s.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,i)}}return new r({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...R(n)})}};function ia(r,e){let t=Oe(r),n=Oe(e);if(r===e)return{valid:!0,data:r};if(t===v.object&&n===v.object){let s=A.objectKeys(e),i=A.objectKeys(r).filter(o=>s.indexOf(o)!==-1),a={...r,...e};for(let o of i){let c=ia(r[o],e[o]);if(!c.valid)return{valid:!1};a[o]=c.data}return{valid:!0,data:a}}else if(t===v.array&&n===v.array){if(r.length!==e.length)return{valid:!1};let s=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],c=ia(a,o);if(!c.valid)return{valid:!1};s.push(c.data)}return{valid:!0,data:s}}else return t===v.date&&n===v.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var At=class extends w{_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=(i,a)=>{if(fs(i)||fs(a))return b;let o=ia(i.value,a.value);return o.valid?((ps(i)||ps(a))&&t.dirty(),{status:t.value,value:o.data}):(y(n,{code:p.invalid_intersection_types}),b)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then(([i,a])=>s(i,a)):s(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}};At.create=(r,e,t)=>new At({left:r,right:e,typeName:T.ZodIntersection,...R(t)});var ke=class r extends w{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==v.array)return y(n,{code:p.invalid_type,expected:v.array,received:n.parsedType}),b;if(n.data.length<this._def.items.length)return y(n,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b;!this._def.rest&&n.data.length>this._def.items.length&&(y(n,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...n.data].map((a,o)=>{let c=this._def.items[o]||this._def.rest;return c?c._parse(new ve(n,a,n.path,o)):null}).filter(a=>!!a);return n.common.async?Promise.all(i).then(a=>J.mergeArray(t,a)):J.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};ke.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new ke({items:r,typeName:T.ZodTuple,rest:null,...R(e)})};var ms=class r extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==v.object)return y(n,{code:p.invalid_type,expected:v.object,received:n.parsedType}),b;let s=[],i=this._def.keyType,a=this._def.valueType;for(let o in n.data)s.push({key:i._parse(new ve(n,o,n.path,o)),value:a._parse(new ve(n,n.data[o],n.path,o)),alwaysSet:o in n.data});return n.common.async?J.mergeObjectAsync(t,s):J.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,n){return t instanceof w?new r({keyType:e,valueType:t,typeName:T.ZodRecord,...R(n)}):new r({keyType:at.create(),valueType:e,typeName:T.ZodRecord,...R(t)})}},sr=class extends w{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==v.map)return y(n,{code:p.invalid_type,expected:v.map,received:n.parsedType}),b;let s=this._def.keyType,i=this._def.valueType,a=[...n.data.entries()].map(([o,c],u)=>({key:s._parse(new ve(n,o,n.path,[u,"key"])),value:i._parse(new ve(n,c,n.path,[u,"value"]))}));if(n.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let c of a){let u=await c.key,l=await c.value;if(u.status==="aborted"||l.status==="aborted")return b;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let c of a){let u=c.key,l=c.value;if(u.status==="aborted"||l.status==="aborted")return b;(u.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(u.value,l.value)}return{status:t.value,value:o}}}};sr.create=(r,e,t)=>new sr({valueType:e,keyType:r,typeName:T.ZodMap,...R(t)});var ir=class r extends w{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==v.set)return y(n,{code:p.invalid_type,expected:v.set,received:n.parsedType}),b;let s=this._def;s.minSize!==null&&n.data.size<s.minSize.value&&(y(n,{code:p.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),s.maxSize!==null&&n.data.size>s.maxSize.value&&(y(n,{code:p.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let i=this._def.valueType;function a(c){let u=new Set;for(let l of c){if(l.status==="aborted")return b;l.status==="dirty"&&t.dirty(),u.add(l.value)}return{status:t.value,value:u}}let o=[...n.data.values()].map((c,u)=>i._parse(new ve(n,c,n.path,u)));return n.common.async?Promise.all(o).then(c=>a(c)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ir.create=(r,e)=>new ir({valueType:r,minSize:null,maxSize:null,typeName:T.ZodSet,...R(e)});var gs=class r extends w{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.function)return y(t,{code:p.invalid_type,expected:v.function,received:t.parsedType}),b;function n(o,c){return Kr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Jt(),Ge].filter(u=>!!u),issueData:{code:p.invalid_arguments,argumentsError:c}})}function s(o,c){return Kr({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Jt(),Ge].filter(u=>!!u),issueData:{code:p.invalid_return_type,returnTypeError:c}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof ct){let o=this;return ie(async function(...c){let u=new le([]),l=await o._def.args.parseAsync(c,i).catch(f=>{throw u.addIssue(n(c,f)),u}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw u.addIssue(s(d,f)),u})})}else{let o=this;return ie(function(...c){let u=o._def.args.safeParse(c,i);if(!u.success)throw new le([n(c,u.error)]);let l=Reflect.apply(a,this,u.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new le([s(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:ke.create(e).rest(He.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new r({args:e||ke.create([]).rest(He.create()),returns:t||He.create(),typeName:T.ZodFunction,...R(n)})}},Ct=class extends w{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};Ct.create=(r,e)=>new Ct({getter:r,typeName:T.ZodLazy,...R(e)});var It=class extends w{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return y(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),b}return{status:"valid",value:e.data}}get value(){return this._def.value}};It.create=(r,e)=>new It({value:r,typeName:T.ZodLiteral,...R(e)});function Ef(r,e){return new Lt({values:r,typeName:T.ZodEnum,...R(e)})}var Lt=class r extends w{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),n=this._def.values;return y(t,{expected:A.joinValues(n),received:t.parsedType,code:p.invalid_type}),b}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),n=this._def.values;return y(t,{received:t.data,code:p.invalid_enum_value,options:n}),b}return ie(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(n=>!e.includes(n)),{...this._def,...t})}};Lt.create=Ef;var Nt=class extends w{_parse(e){let t=A.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==v.string&&n.parsedType!==v.number){let s=A.objectValues(t);return y(n,{expected:A.joinValues(s),received:n.parsedType,code:p.invalid_type}),b}if(this._cache||(this._cache=new Set(A.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let s=A.objectValues(t);return y(n,{received:n.data,code:p.invalid_enum_value,options:s}),b}return ie(e.data)}get enum(){return this._def.values}};Nt.create=(r,e)=>new Nt({values:r,typeName:T.ZodNativeEnum,...R(e)});var ct=class extends w{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.promise&&t.common.async===!1)return y(t,{code:p.invalid_type,expected:v.promise,received:t.parsedType}),b;let n=t.parsedType===v.promise?t.data:Promise.resolve(t.data);return ie(n.then(s=>this._def.type.parseAsync(s,{path:t.path,errorMap:t.common.contextualErrorMap})))}};ct.create=(r,e)=>new ct({type:r,typeName:T.ZodPromise,...R(e)});var _e=class extends w{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:n}=this._processInputParams(e),s=this._def.effect||null,i={addIssue:a=>{y(n,a),a.fatal?t.abort():t.dirty()},get path(){return n.path}};if(i.addIssue=i.addIssue.bind(i),s.type==="preprocess"){let a=s.transform(n.data,i);if(n.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return b;let c=await this._def.schema._parseAsync({data:o,path:n.path,parent:n});return c.status==="aborted"?b:c.status==="dirty"?_t(c.value):t.value==="dirty"?_t(c.value):c});{if(t.value==="aborted")return b;let o=this._def.schema._parseSync({data:a,path:n.path,parent:n});return o.status==="aborted"?b:o.status==="dirty"?_t(o.value):t.value==="dirty"?_t(o.value):o}}if(s.type==="refinement"){let a=o=>{let c=s.refinement(o,i);if(n.common.async)return Promise.resolve(c);if(c instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(n.common.async===!1){let o=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return o.status==="aborted"?b:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(o=>o.status==="aborted"?b:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(s.type==="transform")if(n.common.async===!1){let a=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!it(a))return b;let o=s.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then(a=>it(a)?Promise.resolve(s.transform(a.value,i)).then(o=>({status:t.value,value:o})):b);A.assertNever(s)}};_e.create=(r,e,t)=>new _e({schema:r,typeName:T.ZodEffects,effect:e,...R(t)});_e.createWithPreprocess=(r,e,t)=>new _e({schema:e,effect:{type:"preprocess",transform:r},typeName:T.ZodEffects,...R(t)});var ye=class extends w{_parse(e){return this._getType(e)===v.undefined?ie(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ye.create=(r,e)=>new ye({innerType:r,typeName:T.ZodOptional,...R(e)});var qe=class extends w{_parse(e){return this._getType(e)===v.null?ie(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};qe.create=(r,e)=>new qe({innerType:r,typeName:T.ZodNullable,...R(e)});var Ot=class extends w{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return t.parsedType===v.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};Ot.create=(r,e)=>new Ot({innerType:r,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...R(e)});var kt=class extends w{_parse(e){let{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return er(s)?s.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new le(n.common.issues)},input:n.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new le(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}};kt.create=(r,e)=>new kt({innerType:r,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...R(e)});var ar=class extends w{_parse(e){if(this._getType(e)!==v.nan){let n=this._getOrReturnCtx(e);return y(n,{code:p.invalid_type,expected:v.nan,received:n.parsedType}),b}return{status:"valid",value:e.data}}};ar.create=r=>new ar({typeName:T.ZodNaN,...R(r)});var aS=Symbol("zod_brand"),Zr=class extends w{_parse(e){let{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}},Yr=class r extends w{_parse(e){let{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return i.status==="aborted"?b:i.status==="dirty"?(t.dirty(),_t(i.value)):this._def.out._parseAsync({data:i.value,path:n.path,parent:n})})();{let s=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return s.status==="aborted"?b:s.status==="dirty"?(t.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:n.path,parent:n})}}static create(e,t){return new r({in:e,out:t,typeName:T.ZodPipeline})}},qt=class extends w{_parse(e){let t=this._def.innerType._parse(e),n=s=>(it(s)&&(s.value=Object.freeze(s.value)),s);return er(t)?t.then(s=>n(s)):n(t)}unwrap(){return this._def.innerType}};qt.create=(r,e)=>new qt({innerType:r,typeName:T.ZodReadonly,...R(e)});function gf(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Sf(r,e={},t){return r?ot.create().superRefine((n,s)=>{let i=r(n);if(i instanceof Promise)return i.then(a=>{if(!a){let o=gf(e,n),c=o.fatal??t??!0;s.addIssue({code:"custom",...o,fatal:c})}});if(!i){let a=gf(e,n),o=a.fatal??t??!0;s.addIssue({code:"custom",...a,fatal:o})}}):ot.create()}var oS={object:de.lazycreate},T;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(T||(T={}));var cS=(r,e={message:`Input not instance of ${r.name}`})=>Sf(t=>t instanceof r,e),bf=at.create,Tf=Et.create,uS=ar.create,lS=St.create,xf=bt.create,dS=Tt.create,fS=rr.create,pS=xt.create,hS=Rt.create,mS=ot.create,gS=He.create,yS=Ce.create,vS=nr.create,_S=Ke.create,ES=de.create,SS=de.strictCreate,bS=wt.create,TS=hs.create,xS=At.create,RS=ke.create,wS=ms.create,AS=sr.create,CS=ir.create,IS=gs.create,LS=Ct.create,NS=It.create,OS=Lt.create,kS=Nt.create,qS=ct.create,PS=_e.create,MS=ye.create,$S=qe.create,DS=_e.createWithPreprocess,FS=Yr.create,US=()=>bf().optional(),BS=()=>Tf().optional(),jS=()=>xf().optional(),VS={string:r=>at.create({...r,coerce:!0}),number:r=>Et.create({...r,coerce:!0}),boolean:r=>bt.create({...r,coerce:!0}),bigint:r=>St.create({...r,coerce:!0}),date:r=>Tt.create({...r,coerce:!0})};var WS=b;var{v4:Rf}=(Vt(),_s(Qs)),Ee=class extends Error{constructor(t,n,s,i,a,o=!1){super(t);this.code=n;this.server=s;this.method=i;this.traceId=a;this.isRetryable=o;this.name="MCPError"}},aa=class extends Ee{constructor(e,t,n,s){super(`MCP call timed out after ${s}ms`,"MCP_TIMEOUT",e,t,n,!0),this.name="MCPTimeoutError"}},oa=class extends Ee{constructor(e,t,n,s){super(`Network error during MCP call: ${s.message}`,"MCP_NETWORK_ERROR",e,t,n,!0),this.name="MCPNetworkError"}};var ca=class{info(e,t){console.log(JSON.stringify({level:"INFO",message:e,...t}))}warn(e,t){console.warn(JSON.stringify({level:"WARN",message:e,...t}))}error(e,t,n){console.error(JSON.stringify({level:"ERROR",message:e,error:{name:t.name,message:t.message,stack:t.stack},...n}))}debug(e,t){console.debug(JSON.stringify({level:"DEBUG",message:e,...t}))}},ys=class{constructor(e={}){this.timeout=e.timeout??3e4,this.maxRetries=e.maxRetries??3,this.initialRetryDelay=e.initialRetryDelay??1e3,this.maxRetryDelay=e.maxRetryDelay??3e4,this.logger=e.logger??new ca}async call(e,t,n={}){let s=Rf(),i=Date.now();this.logger.info("MCP call initiated",{traceId:s,server:e,method:t,params:this.sanitizeParams(n)});let a=null;for(let o=1;o<=this.maxRetries;o++)try{let c=await this.executeCall(e,t,n,s,o),u=Date.now()-i;return this.logger.info("MCP call succeeded",{traceId:s,server:e,method:t,attempt:o,duration:u}),c}catch(c){let u=Date.now()-i;if(c instanceof Ee){if(a=c,this.logger.warn("MCP call failed",{traceId:s,server:e,method:t,attempt:o,maxRetries:this.maxRetries,duration:u,error:c.message,code:c.code,isRetryable:c.isRetryable}),!c.isRetryable)throw this.logger.error("MCP call failed with non-retryable error",c,{traceId:s,server:e,method:t}),c;if(o===this.maxRetries)break;let l=this.calculateRetryDelay(o);this.logger.debug("Retrying MCP call after delay",{traceId:s,server:e,method:t,attempt:o,nextAttempt:o+1,delayMs:l}),await this.sleep(l)}else{let l=new Ee(`Unexpected error during MCP call: ${c}`,"MCP_UNEXPECTED_ERROR",e,t,s,!1);throw this.logger.error("MCP call failed with unexpected error",l,{traceId:s,server:e,method:t,originalError:c}),l}}throw this.logger.error("MCP call failed after all retries",a,{traceId:s,server:e,method:t,attempts:this.maxRetries}),a}async listTools(e){let t=Rf();this.logger.info("Listing MCP tools",{traceId:t,server:e});try{let n=await this.executeListTools(e,t);return this.logger.info("MCP tools listed successfully",{traceId:t,server:e,toolCount:n.length}),n}catch(n){throw this.logger.error("Failed to list MCP tools",n,{traceId:t,server:e}),n}}async executeCall(e,t,n,s,i){let a=new AbortController,o=global.setTimeout(()=>a.abort(),this.timeout);try{let c=await this.simulateMCPCall(e,t,n,a.signal);return global.clearTimeout(o),c}catch(c){throw global.clearTimeout(o),c instanceof Error&&c.name==="AbortError"?new aa(e,t,s,this.timeout):this.isNetworkError(c)?new oa(e,t,s,c):c}}async executeListTools(e,t){return[]}async simulateMCPCall(e,t,n,s){return new Promise((i,a)=>{if(s.aborted){a(new Error("AbortError"));return}s.addEventListener("abort",()=>{a(new Error("AbortError"))}),global.setTimeout(()=>{i({})},100)})}calculateRetryDelay(e){let t=this.initialRetryDelay*Math.pow(2,e-1),n=t*.25*(Math.random()*2-1),s=t+n;return Math.min(s,this.maxRetryDelay)}sleep(e){return new Promise(t=>global.setTimeout(t,e))}isNetworkError(e){return e instanceof Error?["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND","ENETUNREACH"].some(n=>e.message.includes(n)):!1}sanitizeParams(e){let t=["password","token","apiKey","secret","authorization"],n={...e};for(let s of Object.keys(n))t.some(i=>s.toLowerCase().includes(i))&&(n[s]="***REDACTED***");return n}};var{v4:Qr}=(Vt(),_s(Qs)),XS=require("aws-sdk"),GS=["pare","parar","stop","descadastre","descadastrar","descadastro","remover","remova","excluir","exclua","deletar","delete","cancelar","cancele","n\xE3o quero","nao quero","n\xE3o tenho interesse","nao tenho interesse","sem interesse","n\xE3o me interessa","nao me interessa","lgpd","dados pessoais","privacidade","prote\xE7\xE3o de dados","protecao de dados","nunca mais","me deixe em paz","deixe-me em paz","me deixa em paz","para de me enviar","pare de me enviar"],ua=class{constructor(e={}){this.mcpClient=new ys(e),this.logger=e.logger??this.mcpClient.logger,this.batchSize=e.batchSize??25,this.comprehend=new XS.Comprehend({region:e.region??process.env.AWS_REGION??"us-east-1",apiVersion:"2017-11-27"}),this.descadastroKeywords=[...GS,...e.descadastroKeywords??[]],this.logger.info("SentimentMCPServer initialized",{region:e.region??process.env.AWS_REGION??"us-east-1",batchSize:this.batchSize,descadastroKeywordsCount:this.descadastroKeywords.length})}async analyze(e){let t=Qr(),n=Date.now();this.validateAnalyzeParams(e);let s=e.language??"pt";this.logger.info("Sentiment analysis initiated",{traceId:t,language:s,textLength:e.text.length});try{let i=this.detectDescadastro(e.text),a=await this.callComprehend(e.text,s,t),o=await this.extractKeywords(e.text,s,t),c={sentiment:a.Sentiment,score:this.calculateConfidenceScore(a.SentimentScore),scores:{positive:Math.round(a.SentimentScore.Positive*100),neutral:Math.round(a.SentimentScore.Neutral*100),negative:Math.round(a.SentimentScore.Negative*100),mixed:Math.round(a.SentimentScore.Mixed*100)},keywords:o,shouldBlock:i.shouldBlock,blockReason:i.reason},u=Date.now()-n;return this.logger.info("Sentiment analysis succeeded",{traceId:t,sentiment:c.sentiment,score:c.score,shouldBlock:c.shouldBlock,duration:u}),c}catch(i){let a=Date.now()-n;throw this.logger.error("Sentiment analysis failed",i,{traceId:t,textLength:e.text.length,duration:a}),i}}async analyzeBatch(e){let t=Qr(),n=Date.now(),s=e.language??"pt";this.logger.info("Batch sentiment analysis initiated",{traceId:t,language:s,textCount:e.texts.length});let i=[],a=[];try{let o=this.splitIntoBatches(e.texts,this.batchSize);for(let u=0;u<o.length;u++){let l=o[u],d=u*this.batchSize;this.logger.debug("Processing batch",{traceId:t,batchIndex:u,batchSize:l.length});try{let g=await this.callComprehendBatch(l,s,t);for(let f=0;f<l.length;f++){let L=l[f],C=g.ResultList[f];if(C){let fe=this.detectDescadastro(L);i.push({sentiment:C.Sentiment,score:this.calculateConfidenceScore(C.SentimentScore),scores:{positive:Math.round(C.SentimentScore.Positive*100),neutral:Math.round(C.SentimentScore.Neutral*100),negative:Math.round(C.SentimentScore.Negative*100),mixed:Math.round(C.SentimentScore.Mixed*100)},keywords:[],shouldBlock:fe.shouldBlock,blockReason:fe.reason})}else{let fe=g.ErrorList.find(Se=>Se.Index===f);a.push({index:d+f,error:fe?.ErrorMessage??"Unknown error"}),i.push({sentiment:"NEUTRAL",score:0,scores:{positive:0,neutral:0,negative:0,mixed:0},keywords:[],shouldBlock:!1})}}}catch(g){this.logger.error("Batch processing failed",g,{traceId:t,batchIndex:u});for(let f=0;f<l.length;f++)a.push({index:d+f,error:g.message}),i.push({sentiment:"NEUTRAL",score:0,scores:{positive:0,neutral:0,negative:0,mixed:0},keywords:[],shouldBlock:!1})}}let c=Date.now()-n;return this.logger.info("Batch sentiment analysis completed",{traceId:t,totalTexts:e.texts.length,successCount:i.length-a.length,errorCount:a.length,duration:c}),{results:i,errorCount:a.length,errors:a}}catch(o){let c=Date.now()-n;throw this.logger.error("Batch sentiment analysis failed",o,{traceId:t,textCount:e.texts.length,duration:c}),o}}async callComprehend(e,t,n){try{this.logger.debug("Calling AWS Comprehend DetectSentiment",{traceId:n,textLength:e.length,language:t});let s={Text:e,LanguageCode:this.mapLanguageCode(t)};return await this.comprehend.detectSentiment(s).promise()}catch(s){throw new Ee(`AWS Comprehend error: ${s}`,"SENTIMENT_API_ERROR","sentiment","analyze",n,this.isRetryableError(s))}}async callComprehendBatch(e,t,n){try{this.logger.debug("Calling AWS Comprehend BatchDetectSentiment",{traceId:n,batchSize:e.length,language:t});let s={TextList:e,LanguageCode:this.mapLanguageCode(t)};return await this.comprehend.batchDetectSentiment(s).promise()}catch(s){throw new Ee(`AWS Comprehend batch error: ${s}`,"SENTIMENT_API_ERROR","sentiment","analyzeBatch",n,this.isRetryableError(s))}}async extractKeywords(e,t,n){try{this.logger.debug("Extracting keywords with AWS Comprehend",{traceId:n,textLength:e.length});let s={Text:e,LanguageCode:this.mapLanguageCode(t)};return(await this.comprehend.detectKeyPhrases(s).promise()).KeyPhrases.sort((o,c)=>c.Score-o.Score).slice(0,5).map(o=>o.Text)}catch(s){return this.logger.warn("Keyword extraction failed",{traceId:n,error:s.message}),[]}}detectDescadastro(e){let t=e.toLowerCase().trim();for(let n of this.descadastroKeywords)if(t.includes(n.toLowerCase()))return{shouldBlock:!0,reason:`Descadastro keyword detected: "${n}"`};return{shouldBlock:!1}}calculateConfidenceScore(e){let t=[e.Positive,e.Neutral,e.Negative,e.Mixed],n=Math.max(...t);return Math.round(n*100)}mapLanguageCode(e){return{pt:"pt","pt-BR":"pt","pt-br":"pt",portuguese:"pt",en:"en","en-US":"en",english:"en",es:"es",spanish:"es"}[e]??"pt"}splitIntoBatches(e,t){let n=[];for(let s=0;s<e.length;s+=t)n.push(e.slice(s,s+t));return n}validateAnalyzeParams(e){if(!e.text)throw new Ee("Missing required parameter: text","SENTIMENT_INVALID_PARAMS","sentiment","analyze",Qr(),!1);if(e.text.length===0)throw new Ee("Text cannot be empty","SENTIMENT_INVALID_PARAMS","sentiment","analyze",Qr(),!1);if(Buffer.byteLength(e.text,"utf8")>5e3)throw new Ee("Text exceeds maximum size of 5000 bytes","SENTIMENT_TEXT_TOO_LONG","sentiment","analyze",Qr(),!1)}isRetryableError(e){return!!(e instanceof Error&&["ECONNREFUSED","ECONNRESET","ETIMEDOUT","ENOTFOUND"].some(n=>e.message.includes(n))||e.code&&(e.code==="ThrottlingException"||e.code==="TooManyRequestsException"||e.code==="ProvisionedThroughputExceededException"||e.code==="ServiceUnavailable"||e.code==="InternalServerError")||e.statusCode>=500&&e.statusCode<600)}};function wf(r){return new ua(r)}var zS=or.object({text:or.string().min(1,"Text is required"),language:or.string().optional().default("pt")}),HS=wf({region:process.env.AWS_REGION||"us-east-1",timeout:1e4,maxRetries:3}),KS=pf(async(r,e,t)=>{let n=et();t.setTraceId(n),t.info("Agente de An\xE1lise de Sentimento iniciado",{functionName:e.functionName,traceId:n});try{let s=ZS(r,t);t.info("Requisi\xE7\xE3o validada",{textLength:s.text.length,language:s.language,traceId:n});let i=YS(s.text,t);t.debug("Texto pr\xE9-processado",{originalLength:s.text.length,processedLength:i.length,traceId:n});let a=await HS.analyze({text:i,language:s.language});t.info("Sentimento analisado",{sentiment:a.sentiment,score:a.score,shouldBlock:a.shouldBlock,keywordsCount:a.keywords.length,traceId:n});let o={sentiment:a.sentiment,score:a.score,scores:a.scores,keywords:a.keywords,shouldBlock:a.shouldBlock,blockReason:a.blockReason,traceId:n};return t.info("Agente de An\xE1lise de Sentimento conclu\xEDdo",{sentiment:o.sentiment,score:o.score,shouldBlock:o.shouldBlock,traceId:n}),o}catch(s){return t.error("Erro ao analisar sentimento",s,{traceId:n}),{sentiment:"NEUTRAL",score:50,scores:{positive:0,neutral:100,negative:0,mixed:0},keywords:[],shouldBlock:!1,traceId:n}}});function ZS(r,e){e.debug("Validando requisi\xE7\xE3o");let t=zS.safeParse(r);if(!t.success)throw e.error("Requisi\xE7\xE3o inv\xE1lida",new Error("Validation failed"),{errors:t.error.errors}),new Error(`Invalid request: ${t.error.errors.map(n=>n.message).join(", ")}`);return t.data}function YS(r,e){e.debug("Pr\xE9-processando texto",{originalLength:r.length});let t=r.trim();t=t.replace(/\s+/g," ");let n=5e3,s=Buffer.byteLength(t,"utf8");if(s>n){for(e.warn("Texto excede limite de bytes, truncando",{originalBytes:s,maxBytes:n});s>n&&t.length>0;)t=t.substring(0,t.length-1),s=Buffer.byteLength(t,"utf8");t=t.trim()+"..."}return e.debug("Texto pr\xE9-processado",{processedLength:t.length,processedBytes:Buffer.byteLength(t,"utf8")}),t}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
