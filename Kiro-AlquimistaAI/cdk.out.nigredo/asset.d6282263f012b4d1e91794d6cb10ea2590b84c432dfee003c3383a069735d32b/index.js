"use strict";var Sd=Object.create;var Qt=Object.defineProperty;var bd=Object.getOwnPropertyDescriptor;var Td=Object.getOwnPropertyNames;var xd=Object.getPrototypeOf,Ad=Object.prototype.hasOwnProperty;var Ni=r=>{throw TypeError(r)};var Rd=(r,e,t)=>e in r?Qt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),ki=(r,e)=>{for(var t in e)Qt(r,t,{get:e[t],enumerable:!0})},qi=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Td(e))!Ad.call(r,n)&&n!==t&&Qt(r,n,{get:()=>e[n],enumerable:!(s=bd(e,n))||s.enumerable});return r};var Ge=(r,e,t)=>(t=r!=null?Sd(xd(r)):{},qi(e||!r||!r.__esModule?Qt(t,"default",{value:r,enumerable:!0}):t,r)),wd=r=>qi(Qt({},"__esModule",{value:!0}),r);var C=(r,e,t)=>Rd(r,typeof e!="symbol"?e+"":e,t),Js=(r,e,t)=>e.has(r)||Ni("Cannot "+t);var m=(r,e,t)=>(Js(r,e,"read from private field"),t?t.call(r):e.get(r)),P=(r,e,t)=>e.has(r)?Ni("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),K=(r,e,t,s)=>(Js(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),j=(r,e,t)=>(Js(r,e,"access private method"),t);var Ji=h((tS,Yi)=>{"use strict";function nn(r){return typeof r=="function"}var ie=console.error.bind(console);function tr(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function rr(r){r&&r.logger&&(nn(r.logger)?ie=r.logger:ie("new logger isn't a function, not replacing"))}function Ki(r,e,t){if(!r||!r[e]){ie("no original function "+e+" to wrap");return}if(!t){ie("no wrapper function"),ie(new Error().stack);return}if(!nn(r[e])||!nn(t)){ie("original object and wrapper must be functions");return}var s=r[e],n=t(s,e);return tr(n,"__original",s),tr(n,"__unwrap",function(){r[e]===n&&tr(r,e,s)}),tr(n,"__wrapped",!0),tr(r,e,n),n}function kd(r,e,t){if(r)Array.isArray(r)||(r=[r]);else{ie("must provide one or more modules to patch"),ie(new Error().stack);return}if(!(e&&Array.isArray(e))){ie("must provide one or more functions to wrap on modules");return}r.forEach(function(s){e.forEach(function(n){Ki(s,n,t)})})}function Zi(r,e){if(!r||!r[e]){ie("no function to unwrap."),ie(new Error().stack);return}if(!r[e].__unwrap)ie("no original to unwrap to -- has "+e+" already been unwrapped?");else return r[e].__unwrap()}function qd(r,e){if(r)Array.isArray(r)||(r=[r]);else{ie("must provide one or more modules to patch"),ie(new Error().stack);return}if(!(e&&Array.isArray(e))){ie("must provide one or more functions to unwrap on modules");return}r.forEach(function(t){e.forEach(function(s){Zi(t,s)})})}rr.wrap=Ki;rr.massWrap=kd;rr.unwrap=Zi;rr.massUnwrap=qd;Yi.exports=rr});var sa=h((rS,ra)=>{"use strict";var ea=Ji(),It=ea.wrap,jr=ea.unwrap,Oe="wrap@before";function Ur(r,e,t){var s=!!r[e]&&r.propertyIsEnumerable(e);Object.defineProperty(r,e,{configurable:!0,enumerable:s,writable:!0,value:t})}function $d(r,e){for(var t=e.length,s=0;s<t;s++){var n=e[s],i=r[Oe];if(typeof i=="function")i(n);else if(Array.isArray(i))for(var a=i.length,o=0;o<a;o++)i[o](n)}}function ta(r,e){var t;return t=r._events&&r._events[e],Array.isArray(t)||(t?t=[t]:t=[]),t}function Pd(r,e,t){var s=ta(r,e),n=s.filter(function(i){return t.indexOf(i)===-1});n.length>0&&$d(r,n)}function Qi(r,e){if(r){var t=r;if(typeof r=="function")t=e(r);else if(Array.isArray(r)){t=[];for(var s=0;s<r.length;s++)t[s]=e(r[s])}return t}}ra.exports=function(e,t,s){if(!e||!e.on||!e.addListener||!e.removeListener||!e.emit)throw new Error("can only wrap real EEs");if(!t)throw new Error("must have function to run on listener addition");if(!s)throw new Error("must have function to wrap listeners when emitting");function n(a){return function(u,c){var l=ta(this,u).slice();try{var d=a.call(this,u,c);return Pd(this,u,l),d}finally{this.on.__wrapped||It(this,"on",n),this.addListener.__wrapped||It(this,"addListener",n)}}}function i(a){return function(u){if(!this._events||!this._events[u])return a.apply(this,arguments);var c=this._events[u];function l(d){return function(){this._events[u]=c;try{return d.apply(this,arguments)}finally{c=this._events[u],this._events[u]=Qi(c,s)}}}It(this,"removeListener",l);try{return this._events[u]=Qi(c,s),a.apply(this,arguments)}finally{jr(this,"removeListener"),this._events[u]=c}}}e[Oe]?typeof e[Oe]=="function"?Ur(e,Oe,[e[Oe],t]):Array.isArray(e[Oe])&&e[Oe].push(t):Ur(e,Oe,t),e.__wrapped||(It(e,"addListener",n),It(e,"on",n),It(e,"emit",i),Ur(e,"__unwrap",function(){jr(e,"addListener"),jr(e,"on"),jr(e,"emit"),delete e[Oe],delete e.__wrapped}),Ur(e,"__wrapped",!0))}});var oa=h((sS,aa)=>{"use strict";var L=require("util"),Ne=require("assert"),Dd=sa(),M=require("async_hooks"),sr="cls@contexts",nr="error@context",W=process.env.DEBUG_CLS_HOOKED,I=-1;aa.exports={getNamespace:na,createNamespace:Md,destroyNamespace:ia,reset:Fd,ERROR_SYMBOL:nr};function le(r){this.name=r,this.active=null,this._set=[],this.id=null,this._contexts=new Map,this._indent=0}le.prototype.set=function(e,t){if(!this.active)throw new Error("No context available. ns.run() or ns.bind() must be called first.");if(this.active[e]=t,W){let s=" ".repeat(this._indent<0?0:this._indent);U(s+"CONTEXT-SET KEY:"+e+"="+t+" in ns:"+this.name+" currentUid:"+I+" active:"+L.inspect(this.active,{showHidden:!0,depth:2,colors:!0}))}return t};le.prototype.get=function(e){if(!this.active){if(W){let t=M.currentId(),s=M.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);U(`${n}CONTEXT-GETTING KEY NO ACTIVE NS: (${this.name}) ${e}=undefined currentUid:${I} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length}`)}return}if(W){let t=M.executionAsyncId(),s=M.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);U(n+"CONTEXT-GETTING KEY:"+e+"="+this.active[e]+" ("+this.name+") currentUid:"+I+" active:"+L.inspect(this.active,{showHidden:!0,depth:2,colors:!0})),U(`${n}CONTEXT-GETTING KEY: (${this.name}) ${e}=${this.active[e]} currentUid:${I} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} active:${L.inspect(this.active)}`)}return this.active[e]};le.prototype.createContext=function(){let e=Object.create(this.active?this.active:Object.prototype);if(e._ns_name=this.name,e.id=I,W){let t=M.executionAsyncId(),s=M.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);U(`${n}CONTEXT-CREATED Context: (${this.name}) currentUid:${I} asyncHooksCurrentId:${t} triggerId:${s} len:${this._set.length} context:${L.inspect(e,{showHidden:!0,depth:2,colors:!0})}`)}return e};le.prototype.run=function(e){let t=this.createContext();this.enter(t);try{if(W){let s=M.triggerAsyncId(),n=M.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);U(`${i}CONTEXT-RUN BEGIN: (${this.name}) currentUid:${I} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} context:${L.inspect(t)}`)}return e(t),t}catch(s){throw s&&(s[nr]=t),s}finally{if(W){let s=M.triggerAsyncId(),n=M.executionAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);U(`${i}CONTEXT-RUN END: (${this.name}) currentUid:${I} triggerId:${s} asyncHooksCurrentId:${n} len:${this._set.length} ${L.inspect(t)}`)}this.exit(t)}};le.prototype.runAndReturn=function(e){let t;return this.run(function(s){t=e(s)}),t};le.prototype.runPromise=function(e){let t=this.createContext();this.enter(t);let s=e(t);if(!s||!s.then||!s.catch)throw new Error("fn must return a promise.");return W&&U("CONTEXT-runPromise BEFORE: ("+this.name+") currentUid:"+I+" len:"+this._set.length+" "+L.inspect(t)),s.then(n=>(W&&U("CONTEXT-runPromise AFTER then: ("+this.name+") currentUid:"+I+" len:"+this._set.length+" "+L.inspect(t)),this.exit(t),n)).catch(n=>{throw n[nr]=t,W&&U("CONTEXT-runPromise AFTER catch: ("+this.name+") currentUid:"+I+" len:"+this._set.length+" "+L.inspect(t)),this.exit(t),n})};le.prototype.bind=function(e,t){t||(this.active?t=this.active:t=this.createContext());let s=this;return function(){s.enter(t);try{return e.apply(this,arguments)}catch(i){throw i&&(i[nr]=t),i}finally{s.exit(t)}}};le.prototype.enter=function(e){if(Ne.ok(e,"context must be provided for entering"),W){let t=M.executionAsyncId(),s=M.triggerAsyncId(),n=" ".repeat(this._indent<0?0:this._indent);U(`${n}CONTEXT-ENTER: (${this.name}) currentUid:${I} triggerId:${s} asyncHooksCurrentId:${t} len:${this._set.length} ${L.inspect(e)}`)}this._set.push(this.active),this.active=e};le.prototype.exit=function(e){if(Ne.ok(e,"context must be provided for exiting"),W){let s=M.executionAsyncId(),n=M.triggerAsyncId(),i=" ".repeat(this._indent<0?0:this._indent);U(`${i}CONTEXT-EXIT: (${this.name}) currentUid:${I} triggerId:${n} asyncHooksCurrentId:${s} len:${this._set.length} ${L.inspect(e)}`)}if(this.active===e){Ne.ok(this._set.length,"can't remove top context"),this.active=this._set.pop();return}let t=this._set.lastIndexOf(e);t<0?(W&&U("??ERROR?? context exiting but not entered - ignoring: "+L.inspect(e)),Ne.ok(t>=0,`context not currently entered; can't exit. 
`+L.inspect(this)+`
`+L.inspect(e))):(Ne.ok(t,"can't remove top context"),this._set.splice(t,1))};le.prototype.bindEmitter=function(e){Ne.ok(e.on&&e.addListener&&e.emit,"can only bind real EEs");let t=this,s="context@"+this.name;function n(a){a&&(a[sr]||(a[sr]=Object.create(null)),a[sr][s]={namespace:t,context:t.active})}function i(a){if(!(a&&a[sr]))return a;let o=a,u=a[sr];return Object.keys(u).forEach(function(c){let l=u[c];o=l.namespace.bind(o,l.context)}),o}Dd(e,n,i)};le.prototype.fromException=function(e){return e[nr]};function na(r){return process.namespaces[r]}function Md(r){Ne.ok(r,"namespace must be given a name."),W&&U(`NS-CREATING NAMESPACE (${r})`);let e=new le(r);return e.id=I,M.createHook({init(s,n,i,a){if(I=M.executionAsyncId(),e.active){if(e._contexts.set(s,e.active),W){let o=" ".repeat(e._indent<0?0:e._indent);U(`${o}INIT [${n}] (${r}) asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(I===0){let o=M.triggerAsyncId(),u=e._contexts.get(o);if(u){if(e._contexts.set(s,u),W){let c=" ".repeat(e._indent<0?0:e._indent);U(`${c}INIT USING CONTEXT FROM TRIGGERID [${n}] (${r}) asyncId:${s} currentUid:${I} triggerId:${o} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}else if(W){let c=" ".repeat(e._indent<0?0:e._indent);U(`${c}INIT MISSING CONTEXT [${n}] (${r}) asyncId:${s} currentUid:${I} triggerId:${o} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}}if(W&&n==="PROMISE"){U(L.inspect(a,{showHidden:!0}));let o=a.parentId,u=" ".repeat(e._indent<0?0:e._indent);U(`${u}INIT RESOURCE-PROMISE [${n}] (${r}) parentId:${o} asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} resource:${a}`)}},before(s){I=M.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(I),n){if(W){let i=M.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);U(`${a}BEFORE (${r}) asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${L.inspect(n)}`),e._indent+=2}e.enter(n)}else if(W){let i=M.triggerAsyncId(),a=" ".repeat(e._indent<0?0:e._indent);U(`${a}BEFORE MISSING CONTEXT (${r}) asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} namespace._contexts:${L.inspect(e._contexts,{showHidden:!0,depth:2,colors:!0})}`),e._indent+=2}},after(s){I=M.executionAsyncId();let n;if(n=e._contexts.get(s)||e._contexts.get(I),n){if(W){let i=M.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);U(`${a}AFTER (${r}) asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${L.inspect(n)}`)}e.exit(n)}else if(W){let i=M.triggerAsyncId();e._indent-=2;let a=" ".repeat(e._indent<0?0:e._indent);U(`${a}AFTER MISSING CONTEXT (${r}) asyncId:${s} currentUid:${I} triggerId:${i} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${L.inspect(n)}`)}},destroy(s){if(I=M.executionAsyncId(),W){let n=M.triggerAsyncId(),i=" ".repeat(e._indent<0?0:e._indent);U(`${i}DESTROY (${r}) currentUid:${I} asyncId:${s} triggerId:${n} active:${L.inspect(e.active,{showHidden:!0,depth:2,colors:!0})} context:${L.inspect(e._contexts.get(I))}`)}e._contexts.delete(s)}}).enable(),process.namespaces[r]=e,e}function ia(r){let e=na(r);Ne.ok(e,`can't delete nonexistent namespace! "`+r+'"'),Ne.ok(e.id,"don't assign to process.namespaces directly! "+L.inspect(e)),process.namespaces[r]=null}function Fd(){process.namespaces&&Object.keys(process.namespaces).forEach(function(r){ia(r)}),process.namespaces=Object.create(null)}process.namespaces={};function U(...r){W&&process._rawDebug(`${L.format(...r)}`)}});var V=h((nS,la)=>{"use strict";var an=["debug","info","warn","error","silent"],ua=an.indexOf("error"),Bd=jd(process.env.AWS_XRAY_DEBUG_MODE?"debug":process.env.AWS_XRAY_LOG_LEVEL),ca={error:Vr("error"),info:Vr("info"),warn:Vr("warn"),debug:Vr("debug")};function Vr(r){var e=an.indexOf(r),t=console[r]||console.log||(()=>{});return e>=Bd?(s,n)=>{(s||n)&&t(Wd(r,s,n))}:()=>{}}function jd(r){if(r){var e=r.toLowerCase(),t=an.indexOf(e);return t>=0?t:ua}return ua}function Ud(r){var e=-r.getTimezoneOffset(),t=e>=0?"+":"-",s=function(n){var i=Math.floor(Math.abs(n));return(i<10?"0":"")+i};return new Date(r.getTime()+e*60*1e3).toISOString().replace(/T/," ").replace(/Z/," ")+t+s(e/60)+":"+s(e%60)}function Vd(){return process.env.LAMBDA_TASK_ROOT!==void 0}function Wd(r,e,t){var s=[];Vd()||(s.push(Ud(new Date)),s.push(`[${r.toUpperCase()}]`)),e&&s.push(e);var n=s.join(" "),i=Gd(t);return[n,i].filter(a=>a.length>0).join(`
  `)}function Gd(r){return r?typeof r=="string"?r:JSON.stringify(r):""}var Xd={setLogger:function(e){ca=e},getLogger:function(){return ca}};la.exports=Xd});var on=h((iS,fa)=>{"use strict";var Hd=require("crypto");function da(r,e){this.init(r,e)}da.prototype.init=function(e,t){var s=typeof e=="string"||e instanceof String?{message:e,name:""}:e;if(this.message=s.message,this.type=s.name,this.stack=[],this.remote=!!t,this.id=Hd.randomBytes(8).toString("hex"),s.stack){var n=s.stack.split(`
`);n.shift(),n.forEach(i=>{var a=i.trim().replace(/\(|\)/g,"");a=a.substring(a.indexOf(" ")+1);var o=a.lastIndexOf(" ")>=0?a.slice(0,a.lastIndexOf(" ")):null,u=Array.isArray(o)&&!o.length?a:a.slice(a.lastIndexOf(" ")+1);u=u.split(":");var c={path:u[0],line:parseInt(u[1]),label:o||"anonymous"};this.stack.push(c)},this)}};fa.exports=da});var ha=h((aS,pa)=>{pa.exports=zd;function zd(r){var e=!1,t=null,s=null,n=null;return a;function i(o){n&&Yd(n,o),e=!1,n=s;var u=t;if(t=null,s=null,!u||!u.length){if(!n||!n.length){n=null;return}u||(u=[])}e=!0,r(u,i)}function a(o,u){e?(t||(t=[],s=[]),Kd(t,o),u&&s.push(u)):(u&&(n=[u]),e=!0,r(Array.isArray(o)?o:[o],i))}}function Kd(r,e){Array.isArray(e)?Zd(r,e):r.push(e)}function Zd(r,e){for(var t=0;t<e.length;t++)r.push(e[t])}function Yd(r,e){for(var t=0;t<r.length;t++)r[t](e)}});var Wr=h((oS,va)=>{"use strict";var ma=V(),_e={udp_ip:"127.0.0.1",udp_port:2e3,tcp_ip:"127.0.0.1",tcp_port:2e3,setDaemonAddress:function(e){process.env.AWS_XRAY_DAEMON_ADDRESS?ma.getLogger().warn("Ignoring call to setDaemonAddress as AWS_XRAY_DAEMON_ADDRESS is set. The current daemon address will not be changed."):(ga(e),ma.getLogger().info("Configured daemon address to "+e+"."))}},ga=function(e){if(e.indexOf(":")===-1)throw new Error("Invalid Daemon Address. You must specify an ip and port.");var t=e.split(" ");if(t.length===1){if(e.indexOf("udp")>-1||e.indexOf("tcp")>-1)throw new Error("Invalid Daemon Address. You must specify both tcp and udp addresses.");var s=e.split(":");if(!s[0])throw new Error("Invalid Daemon Address. You must specify an ip.");_e.udp_ip=s[0],_e.tcp_ip=s[0],_e.udp_port=s[1],_e.tcp_port=s[1]}else if(t.length===2){var n=t[0].split(":"),i=t[1].split(":"),a={};if(a[n[0]]=n,a[i[0]]=i,_e.udp_ip=a.udp[1],_e.udp_port=parseInt(a.udp[2]),_e.tcp_ip=a.tcp[1],_e.tcp_port=parseInt(a.tcp[2]),!_e.udp_port||!_e.tcp_port)throw new Error("Invalid Daemon Address. You must specify port number.")}};process.env.AWS_XRAY_DAEMON_ADDRESS&&ga(process.env.AWS_XRAY_DAEMON_ADDRESS);va.exports=_e});var Xr=h((uS,Ta)=>{"use strict";var Ea=require("dgram"),Jd=ha(),Gr=V(),_a='{"format":"json","version":1}',ya=`
`;function Qd(r,e){var t=Ea.createSocket("udp4");Sa(t,r,0,function(){try{t.close()}finally{e()}})}function Sa(r,e,t,s){if(t>=e.length){s();return}ef(r,e[t],function(){Sa(r,e,t+1,s)})}function ef(r,e,t){var s=e.msg,n=e.offset,i=e.length,a=e.port,o=e.address,u=e.callback;r.send(s,n,i,a,o,function(c){try{u(c)}finally{t()}})}function ba(){this.batchSend=Jd(Qd)}ba.prototype.send=function(r,e,t,s,n,i){var a={msg:r,offset:e,length:t,port:s,address:n,callback:i};this.batchSend(a)};var tf={daemonConfig:Wr(),format:function(e){return _a+ya+e.toString()},send:function(e){this.socket||(this.useBatchingTemporarySocket?this.socket=new ba:this.socket=Ea.createSocket("udp4").unref());var t=this.socket,s=e.format(),n=_a+ya+s,i=Buffer.from(n),a='{"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}',o=e.type==="subsegment"?"Subsegment":"Segment";t.send(i,0,i.length,this.daemonConfig.udp_port,this.daemonConfig.udp_ip,function(u){u?u.code==="EMSGSIZE"?Gr.getLogger().error(o+" too large to send: "+a+" ("+i.length+" bytes)."):Gr.getLogger().error("Error occured sending segment: ",u):(Gr.getLogger().debug(o+' sent: {"trace_id:"'+e.trace_id+'","id":"'+e.id+'"}'),Gr.getLogger().debug("UDP message sent: "+e))})},setDaemonAddress:function(e){this.daemonConfig.setDaemonAddress(e)},getIp:function(){return this.daemonConfig.udp_ip},getPort:function(){return this.daemonConfig.udp_port},disableReusableSocket:function(){this.useBatchingTemporarySocket=!0}};Ta.exports=tf});var zr=h((cS,xa)=>{"use strict";var rf=require("crypto"),Hr=V(),un=class r{constructor(e,t){this.version=1,this.timestamp=e||Math.round(new Date().getTime()/1e3).toString(16),this.id=t||rf.randomBytes(12).toString("hex")}static Invalid(){return new r("00000000","000000000000000000000000")}static FromString(e){let t="-";var s=new r,n,i;if(!e||typeof e!="string")return Hr.getLogger().error("Empty or non-string trace ID provided"),s;let a=e.trim().split(t);return a.length!==3?(Hr.getLogger().error("Unrecognized trace ID format"),s):(n=parseInt(a[0]),isNaN(n)||n<1?(Hr.getLogger().error("Trace ID version must be positive integer"),s):(i=parseInt(a[1],16).toString(16),i==="NaN"?(Hr.getLogger().error("Trace ID timestamp must be a hex-encoded value"),s):(i=i.padStart(8,"0"),s.version=n,s.timestamp=i,s.id=a[2],s)))}toString(){return`${this.version.toString()}-${this.timestamp}-${this.id}`}};xa.exports=un});var ee=h((lS,Aa)=>{"use strict";var sf=require("crypto"),ir=V(),nf=zr(),cn={getCauseTypeFromHttpStatus:function(e){var t=e.toString();if(t.match(/^[4][0-9]{2}$/)!==null)return"error";if(t.match(/^[5][0-9]{2}$/)!==null)return"fault"},stripQueryStringFromPath:function(e){return e?e.split("?")[0]:""},wildcardMatch:function(e,t){if(e===void 0||t===void 0)return!1;if(e.length===1&&e.charAt(0)==="*")return!0;var s=e.length,n=t.length,i=e.indexOf("*");if(e=e.toLowerCase(),t=t.toLowerCase(),i===-1||i===s-1){var a=function(){for(var E=0,f=0;f<s;f++){var N=e.charAt(f);if(N==="*")return!0;if(N==="?"){if(E===n)return!1;E++}else{if(E>=n||N!=t.charAt(E))return!1;E++}}return E===n};return a()}var o=[];o[0]=!0;for(var u=0;u<s;u++){var c,l=e.charAt(u);if(l!="*")for(c=n-1;c>=0;c--)o[c+1]=!!o[c]&&(l==="?"||l===t.charAt(c));else{for(c=0;c<=n&&!o[c];)c++;for(c;c<=n;c++)o[c]=!0}o[0]=o[0]&&l==="*"}return o[n]},LambdaUtils:{validTraceData:function(r){var e=!1;if(r){var t=cn.processTraceData(r);e=!!(t&&t.root&&t.parent&&t.sampled)}return e},populateTraceData:function(r,e){ir.getLogger().debug("Lambda trace data found: "+e);let t=cn.processTraceData(e);var s=!1;return t?t.root&&!t.parent&&!t.sampled?(r.noOp=!0,s=!0):!t.root||!t.parent||!t.sampled?ir.getLogger().error("_X_AMZN_TRACE_ID is missing required information"):s=!0:(t={},ir.getLogger().error("_X_AMZN_TRACE_ID is empty or has an invalid format")),r.trace_id=nf.FromString(t.root).toString(),r.id=t.parent||sf.randomBytes(8).toString("hex"),t.root&&r.trace_id!==t.root&&(ir.getLogger().error("_X_AMZN_TRACE_ID contains invalid trace ID"),s=!1),parseInt(t.sampled)?delete r.notTraced:r.notTraced=!0,t.data&&(r.additionalTraceData=t.data),ir.getLogger().debug("Segment started: "+JSON.stringify(t)),s}},processTraceData:function(e){var t={},s={},n=["root","parent","sampled","self"],i=256;return typeof e=="string"&&e&&(e.split(";").forEach(function(a){if(a){var o=a.split("=");if(o[0]&&o[1]){let u=o[0].trim(),c=o[1].trim(),l=u.toLowerCase(),d=n.indexOf(l)!==-1;d?t[l]=c:!d&&i-(l.length+c.length)>=0&&(s[u]=c,i-=u.length+c.length)}}}),t.data=s),t},objectWithoutProperties:function(e,t,s){t=Array.isArray(t)?t:[],s=typeof s=="boolean"?s:!1;var n=s?Object.create(Object.getPrototypeOf(e)):{};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n},safeParseInt:r=>!r||isNaN(r)?0:parseInt(r)};Aa.exports=cn});var He=h((dS,Ca)=>{"use strict";var{safeParseInt:Ra}=ee(),wa=V(),af=100,ln={streamingThreshold:af,getCurrentTime:function(){return Date.now()/1e3},setOrigin:function(e){this.origin=e},setPluginData:function(e){this.pluginData=e},setSDKData:function(e){this.sdkData=e},setServiceData:function(e){this.serviceData=e},setStreamingThreshold:function(e){isFinite(e)&&e>=0?(ln.streamingThreshold=e,wa.getLogger().debug("Subsegment streaming threshold set to: "+e)):wa.getLogger().error("Invalid threshold: "+e+". Must be a whole number >= 0.")},getStreamingThreshold:function(){return ln.streamingThreshold},getHttpResponseData:r=>{let e={};if(!r)return e;let t=Ra(r.statusCode);return t!==0&&(e.status=t),r.headers&&r.headers["content-length"]&&(e.content_length=Ra(r.headers["content-length"])),e},getJsonStringifyReplacer:()=>(r,e)=>typeof e=="bigint"?e.toString():e};Ca.exports=ln});var Oa=h((fS,La)=>{"use strict";var{getHttpResponseData:of}=He(),{stripQueryStringFromPath:uf}=ee();function Ia(r,e,t){this.init(r,e,t)}Ia.prototype.init=function(e,t,s){this.request={url:e.agent&&e.agent.protocol?e.agent.protocol+"//"+(e.host||e.getHeader("host"))+uf(e.path):"",method:e.method||""},s&&(this.request.traced=!0),t&&(this.response=of(t))};La.exports=Ia});var ar=h((pS,Na)=>{"use strict";var cf=require("crypto"),lf=on(),df=Oa(),ff=Xr(),Kr=He(),pf=ee(),ke=V();function O(r){this.init(r)}O.prototype.init=function(e){if(typeof e!="string")throw new Error("Subsegment name must be of type string.");this.id=cf.randomBytes(8).toString("hex"),this.name=e,this.start_time=Kr.getCurrentTime(),this.in_progress=!0,this.counter=0,this.notTraced=!1};O.prototype.addNewSubsegment=function(e){let t=new O(e);return this.addSubsegment(t),t};O.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};O.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new O(e);return this.addSubsegment(t),t.notTraced=!0,t};O.prototype.addSubsegment=function(r){if(!(r instanceof O))throw new Error("Failed to add subsegment:"+r+' to subsegment "'+this.name+'".  Not a subsegment.');this.subsegments===void 0&&(this.subsegments=[]),r.segment=this.segment,r.parent=this,r.notTraced=r.parent.notTraced,r.noOp=r.parent.noOp,r.end_time===void 0&&this.incrementCounter(r.counter),this.subsegments.push(r)};O.prototype.removeSubsegment=function(e){if(!(e instanceof O))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};O.prototype.addAttribute=function(e,t){this[e]=t};O.prototype.addPrecursorId=function(r){typeof r!="string"&&ke.getLogger().error("Failed to add id:"+r+" to subsegment "+this.name+".  Precursor Ids must be of type string."),this.precursor_ids===void 0&&(this.precursor_ids=[]),this.precursor_ids.push(r)};O.prototype.addAnnotation=function(r,e){if(typeof e!="boolean"&&typeof e!="string"&&!isFinite(e)){ke.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof r!="string"){ke.getLogger().error("Failed to add annotation key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[r]=e};O.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ke.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ke.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to subsegment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};O.prototype.addSqlData=function(e){this.sql=e};O.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ke.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.segment&&this.segment.exception){if(e===this.segment.exception.ex){this.fault=!0,this.cause={id:this.segment.exception.cause,exceptions:[]};return}delete this.segment.exception}this.segment&&(this.segment.exception={ex:e,cause:this.id}),this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.unshift(new lf(e,t))};O.prototype.addRemoteRequestData=function(e,t,s){this.http=new df(e,t,s),"traced"in this.http.request&&(this.traced=this.http.request.traced,delete this.http.request.traced)};O.prototype.addFaultFlag=function(){this.fault=!0};O.prototype.addErrorFlag=function(){this.error=!0};O.prototype.addThrottleFlag=function(){this.throttle=!0};O.prototype.close=function(e,t){var s=this.segment;this.end_time=Kr.getCurrentTime(),delete this.in_progress,e&&this.addError(e,t),this.parent&&this.parent.decrementCounter(),s&&s.counter>Kr.getStreamingThreshold()&&this.streamSubsegments()&&this.parent&&this.parent.removeSubsegment(this)};O.prototype.incrementCounter=function(e){this.counter=e?this.counter+e+1:this.counter+1,this.parent&&this.parent.incrementCounter(e)};O.prototype.decrementCounter=function(){this.counter--,this.parent&&this.parent.decrementCounter()};O.prototype.isClosed=function(){return!this.in_progress};O.prototype.flush=function(){if(!this.parent||!this.segment){ke.getLogger().error("Failed to flush subsegment: "+this.name+". Subsegment must be added to a segment chain to flush.");return}this.segment.trace_id?this.segment.notTraced!==!0&&!this.notTraced?ff.send(this):ke.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is marked as not sampled."):ke.getLogger().debug("Ignoring flush on subsegment "+this.id+". Associated segment is missing a trace ID.")};O.prototype.streamSubsegments=function(){if(this.isClosed()&&this.counter<=0)return this.flush(),!0;if(this.subsegments&&this.subsegments.length>0){var e=[];this.subsegments.forEach(function(t){t.streamSubsegments()||e.push(t)}),this.subsegments=e}};O.prototype.format=function(){return this.type="subsegment",this.parent&&(this.parent_id=this.parent.id),this.segment&&(this.trace_id=this.segment.trace_id),this.serialize()};O.prototype.toString=function(){return this.serialize()};O.prototype.toJSON=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=pf.objectWithoutProperties(this,e,!1);return t};O.prototype.serialize=function(e){return JSON.stringify(e??this,Kr.getJsonStringifyReplacer())};Na.exports=O});var or=h((hS,$a)=>{"use strict";var hf=require("crypto"),mf=on(),gf=Xr(),de=He(),Zr=ar(),ka=zr(),qa=ee(),ze=V();function D(r,e,t){this.init(r,e,t)}D.prototype.init=function(e,t,s){if(typeof e!="string")throw new Error("Segment name must be of type string.");var n;t&&typeof t=="string"?n=ka.FromString(t):n=new ka;var i=hf.randomBytes(8).toString("hex"),a=de.getCurrentTime();this.trace_id=n.toString(),this.id=i,this.start_time=a,this.name=e||"",this.in_progress=!0,this.counter=0,s&&(this.parent_id=s),de.serviceData&&this.setServiceData(de.serviceData),de.pluginData&&this.addPluginData(de.pluginData),de.origin&&(this.origin=de.origin),de.sdkData&&this.setSDKData(de.sdkData)};D.prototype.addIncomingRequestData=function(e){this.http=e};D.prototype.addAnnotation=function(e,t){if(typeof t!="boolean"&&typeof t!="string"&&!isFinite(t)){ze.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Value must be of type string, number or boolean.");return}if(typeof e!="string"){ze.getLogger().error("Failed to add annotation key: "+e+" value: "+t+" to subsegment "+this.name+". Key must be of type string.");return}this.annotations===void 0&&(this.annotations={}),this.annotations[e]=t};D.prototype.setUser=function(r){typeof r!="string"&&ze.getLogger().error("Set user: "+r+" failed. User IDs must be of type string."),this.user=r};D.prototype.addMetadata=function(r,e,t){if(typeof r!="string"){ze.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Key must be of type string.");return}if(t&&typeof t!="string"){ze.getLogger().error("Failed to add metadata key: "+r+" value: "+e+" to segment "+this.name+". Namespace must be of type string.");return}var s=t||"default";this.metadata||(this.metadata={}),this.metadata[s]||(this.metadata[s]={}),s!=="__proto__"&&(this.metadata[s][r]=e??"")};D.prototype.setSDKData=function(e){if(!e){ze.getLogger().error("Add SDK data: "+e+" failed.Must not be empty.");return}this.aws||(this.aws={}),this.aws.xray=e};D.prototype.setMatchedSamplingRule=function(e){this.aws&&(this.aws=JSON.parse(JSON.stringify(this.aws))),this.aws&&this.aws.xray?this.aws.xray.rule_name=e:this.aws={xray:{rule_name:e}}};D.prototype.setServiceData=function(e){if(!e){ze.getLogger().error("Add service data: "+e+" failed.Must not be empty.");return}this.service=e};D.prototype.addPluginData=function(e){this.aws===void 0&&(this.aws={}),Object.assign(this.aws,e)};D.prototype.addNewSubsegment=function(e){var t=new Zr(e);return this.addSubsegment(t),t};D.prototype.addSubsegmentWithoutSampling=function(e){this.addSubsegment(e),e.notTraced=!0};D.prototype.addNewSubsegmentWithoutSampling=function(e){let t=new Zr(e);return this.addSubsegment(t),t.notTraced=!0,t};D.prototype.addSubsegment=function(e){if(!(e instanceof Zr))throw new Error("Cannot add subsegment: "+e+". Not a subsegment.");this.subsegments===void 0&&(this.subsegments=[]),e.segment=this,e.parent=this,e.notTraced=e.parent.notTraced,e.noOp=e.parent.noOp,this.subsegments.push(e),e.end_time||this.incrementCounter(e.counter)};D.prototype.removeSubsegment=function(e){if(!(e instanceof Zr))throw new Error("Failed to remove subsegment:"+e+' from subsegment "'+this.name+'".  Not a subsegment.');if(this.subsegments!==void 0){var t=this.subsegments.indexOf(e);t>=0&&this.subsegments.splice(t,1)}};D.prototype.addError=function(e,t){if(e==null||typeof e!="object"&&typeof e!="string"){ze.getLogger().error("Failed to add error:"+e+' to subsegment "'+this.name+'".  Not an object or string literal.');return}if(this.addFaultFlag(),this.exception){if(e===this.exception.ex){this.cause={id:this.exception.cause},delete this.exception;return}delete this.exception}this.cause===void 0&&(this.cause={working_directory:process.cwd(),exceptions:[]}),this.cause.exceptions.push(new mf(e,t))};D.prototype.addFaultFlag=function(){this.fault=!0};D.prototype.addErrorFlag=function(){this.error=!0};D.prototype.addThrottleFlag=function(){this.throttle=!0};D.prototype.isClosed=function(){return!this.in_progress};D.prototype.incrementCounter=function(e){if(this.counter=e?this.counter+e+1:this.counter+1,this.counter>de.streamingThreshold&&this.subsegments&&this.subsegments.length>0){var t=[];this.subsegments.forEach(function(s){s.streamSubsegments()||t.push(s)}),this.subsegments=t}};D.prototype.decrementCounter=function(){this.counter--,this.counter<=0&&this.isClosed()&&this.flush()};D.prototype.close=function(r,e){this.end_time||(this.end_time=de.getCurrentTime()),r!==void 0&&this.addError(r,e),delete this.in_progress,delete this.exception,this.counter<=0&&this.flush()};D.prototype.flush=function(){if(this.notTraced!==!0){delete this.exception;var e=qa.objectWithoutProperties(this,["counter","notTraced"],!0);gf.send(e)}};D.prototype.format=function(){var e=["segment","parent","counter"];(this.subsegments==null||this.subsegments.length===0)&&e.push("subsegments");var t=qa.objectWithoutProperties(this,e,!1);return this.serialize(t)};D.prototype.toString=function(){return this.serialize()};D.prototype.serialize=function(e){return JSON.stringify(e??this,de.getJsonStringifyReplacer())};$a.exports=D});var Ze=h((mS,Fa)=>{"use strict";var ur=oa(),ye=V(),dn=or(),Pa=ar(),qe=!0,Ke="AWSXRay",Da="segment",Ma=!1,te={CONTEXT_MISSING_STRATEGY:{RUNTIME_ERROR:{contextMissing:function(e){throw new Error(e)}},LOG_ERROR:{contextMissing:function(e){var t=new Error(e);ye.getLogger().error(t.stack)}},IGNORE_ERROR:{contextMissing:function(){}}},contextMissingStrategy:{},resolveManualSegmentParams:function(e){if(e&&!te.isAutomaticMode()){var t=e.XRaySegment||e.XraySegment,s=e.Segment,n=null;return t&&(t instanceof dn||t instanceof Pa)?(n=t,delete e.XRaySegment,delete e.XraySegment):s&&(s instanceof dn||s instanceof Pa)&&(n=s,delete e.Segment),n}},getNamespace:function(){return ur.getNamespace(Ke)||ur.createNamespace(Ke)},resolveSegment:function(e){if(qe)return this.getSegment();if(e&&!qe)return e;!e&&!qe&&te.contextMissingStrategy.contextMissing("No sub/segment specified. A sub/segment must be provided for manual mode.")},getSegment:function(){if(qe){var e=te.getNamespace(Ke).get(Da);return e?e instanceof dn&&process.env.LAMBDA_TASK_ROOT&&e.facade==!0&&e.resolveLambdaTraceData():te.contextMissingStrategy.contextMissing("Failed to get the current sub/segment from the context."),e}else te.contextMissingStrategy.contextMissing("Cannot get sub/segment from context. Not supported in manual mode.")},setSegment:function(e){qe?te.getNamespace(Ke).set(Da,e)||ye.getLogger().warn("Failed to set the current sub/segment on the context."):te.contextMissingStrategy.contextMissing("Cannot set sub/segment on context. Not supported in manual mode.")},isAutomaticMode:function(){return qe},enableAutomaticMode:function(){qe=!0,te.getNamespace(Ke),ye.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to automatic mode.")},enableManualMode:function(){qe=!1,ur.getNamespace(Ke)&&ur.destroyNamespace(Ke),ye.getLogger().debug("Overriding AWS X-Ray SDK mode. Set to manual mode.")},setContextMissingStrategy:function(e){if(Ma)ye.getLogger().warn("Ignoring call to setContextMissingStrategy as AWS_XRAY_CONTEXT_MISSING is set. The current context missing strategy will not be changed.");else if(typeof e=="string"){var t=te.CONTEXT_MISSING_STRATEGY[e.toUpperCase()];if(t)te.contextMissingStrategy.contextMissing=t.contextMissing,process.env.AWS_XRAY_CONTEXT_MISSING?ye.getLogger().debug("AWS_XRAY_CONTEXT_MISSING is set. Configured context missing strategy to "+process.env.AWS_XRAY_CONTEXT_MISSING+"."):ye.getLogger().debug("Configured context missing strategy to: "+e);else throw new Error("Invalid context missing strategy: "+e+". Valid values are "+Object.keys(te.CONTEXT_MISSING_STRATEGY)+".")}else if(typeof e=="function")te.contextMissingStrategy.contextMissing=e,ye.getLogger().info("Configured custom context missing strategy to function: "+e.name);else throw new Error("Context missing strategy must be either a string or a custom function.")}};process.env.AWS_XRAY_MANUAL_MODE?(qe=!1,ye.getLogger().debug("Starting the AWS X-Ray SDK in manual mode.")):(ur.createNamespace(Ke),ye.getLogger().debug("Starting the AWS X-Ray SDK in automatic mode (default)."));process.env.AWS_XRAY_CONTEXT_MISSING?(te.setContextMissingStrategy(process.env.AWS_XRAY_CONTEXT_MISSING),Ma=!0):(te.contextMissingStrategy.contextMissing=te.CONTEXT_MISSING_STRATEGY.LOG_ERROR.contextMissing,ye.getLogger().debug("Using default context missing strategy: LOG_ERROR"));Fa.exports=te});var pn=h((gS,Ba)=>{"use strict";var{getHttpResponseData:vf}=He();function fn(r){this.init(r)}fn.prototype.init=function(e){var t=!!e.headers["x-forwarded-for"],s;e.connection&&(s=(e.connection.secure||e.connection.encrypted?"https://":"http://")+((e.headers.host||"")+(e.url||""))),this.request={method:e.method||"",user_agent:e.headers["user-agent"]||"",client_ip:_f(e)||"",url:s||""},t&&(this.request.x_forwarded_for=t)};var _f=function(e){var t;return e.headers["x-forwarded-for"]?t=(e.headers["x-forwarded-for"]||"").split(",")[0]:e.connection&&e.connection.remoteAddress?t=e.connection.remoteAddress:e.socket&&e.socket.remoteAddress?t=e.socket.remoteAddress:e.connection&&e.connection.socket&&e.connection.socket.remoteAddress&&(t=e.connection.socket.remoteAddress),t};fn.prototype.close=function(e){this.response=vf(e)};Ba.exports=fn});var Ua=h((vS,ja)=>{"use strict";function hn(r,e){this.init(r,e)}hn.prototype.init=function(e,t){if(this.usedThisSecond=0,typeof e=="number"&&e%1===0&&e>=0)this.fixedTarget=e;else throw new Error('Error in sampling file. Rule attribute "fixed_target" must be a non-negative integer.');if(typeof t=="number"&&t>=0&&t<=1)this.fallbackRate=t;else throw new Error('Error in sampling file. Rule attribute "rate" must be a number between 0 and 1 inclusive.')};hn.prototype.isSampled=function(){var e=Math.round(new Date().getTime()/1e3);return e!==this.thisSecond&&(this.usedThisSecond=0,this.thisSecond=e),this.usedThisSecond>=this.fixedTarget?Math.random()<this.fallbackRate:(this.usedThisSecond++,!0)};ja.exports=hn});var Va=h((_S,yf)=>{yf.exports={default:{fixed_target:1,rate:.05},version:2}});var gn=h((yS,za)=>{"use strict";var Ef=require("fs"),Wa=Ua(),mn=ee(),Sf=Va(),Yr=V(),Xa={shouldSample:function(e){var t=e.host,s=e.httpMethod,n=e.urlPath,i="{ http_method: "+s+", host: "+t+", url_path: "+n+" }",a;return this.rules.some(function(o){if(o.default||t==null||mn.wildcardMatch(o.host,t)&&(s==null||mn.wildcardMatch(o.http_method,s))&&(n==null||mn.wildcardMatch(o.url_path,n)))return a=o.reservoir,Yr.getLogger().debug("Local sampling rule match found for "+i+". Matched "+(o.default?"default":"{ http_method: "+o.http_method+", host: "+o.host+", url_path: "+o.url_path+" }")+". Using fixed_target: "+a.fixedTarget+" and rate: "+a.fallbackRate+"."),!0}),a?a.isSampled():(Yr.getLogger().debug("No sampling rule matched for "+i),!1)},setLocalRules:function(e){e?typeof e=="string"?(Yr.getLogger().info("Using custom sampling rules file: "+e),this.rules=Ga(JSON.parse(Ef.readFileSync(e,"utf8")))):(Yr.getLogger().info("Using custom sampling rules source."),this.rules=Ga(e)):this.rules=Ha(Sf)}},Ga=function(e){if(!e.version)throw new Error('Error in sampling file. Missing "version" attribute.');if(e.version===1||e.version===2)return Ha(e);throw new Error('Error in sampling file. Unknown version "'+e.version+'".')},Ha=function(e){var t,s=[];if(e.default){var n=[];for(var i in e.default){if(i!=="fixed_target"&&i!=="rate")throw new Error("Error in sampling file. Invalid attribute for default: "+i+'. Valid attributes for default are "fixed_target" and "rate".');if(typeof e.default[i]!="number")throw new Error("Error in sampling file. Default "+i+" must be a number.")}if(typeof e.default.fixed_target>"u"&&n.push("fixed_target"),typeof e.default.rate>"u"&&n.push("rate"),n.length!==0)throw new Error("Error in sampling file. Missing required attributes for default: "+n+".");t={default:!0,reservoir:new Wa(e.default.fixed_target,e.default.rate)}}else throw new Error('Error in sampling file. Expecting "default" object to be defined with attributes "fixed_target" and "rate".');return Array.isArray(e.rules)&&e.rules.forEach(function(a){var o={},u;e.version===2&&(u={host:1,http_method:1,url_path:1,fixed_target:1,rate:1}),e.version===1&&(u={service_name:1,http_method:1,url_path:1,fixed_target:1,rate:1});for(var c in a){var l=a[c];if(!u[c]&&c!="description")throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" has invalid attribute: "+c+".");if(c!="description"&&!l&&l!==0)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+' attribute "'+c+'" has invalid value: '+l+".");e.version===2&&(o[c]=l),e.version===1&&c==="service_name"?o.host=l:o[c]=l,delete u[c]}if(Object.keys(u).length!==0&&u.constructor===Object)throw new Error("Error in sampling file. Rule "+JSON.stringify(a)+" is missing required attributes: "+Object.keys(u)+".");var d=o;d.reservoir=new Wa(a.fixed_target,a.rate),s.push(d)}),s.push(t),s};Xa.setLocalRules();za.exports=Xa});var Za=h((ES,Ka)=>{"use strict";function Lt(){this.init()}Lt.prototype.init=function(){this.quota=null,this.TTL=null,this.takenThisSec=0,this.borrowedThisSec=0,this.reportInterval=1,this.reportElapsed=0};Lt.prototype.borrowOrTake=function(e,t){if(this.adjustThisSec(e),this.quota>=0&&this.TTL>=e)return this.takenThisSec>=this.quota?!1:(this.takenThisSec++,"take");if(t)return this.borrowedThisSec>=1?!1:(this.borrowedThisSec++,"borrow")};Lt.prototype.adjustThisSec=function(e){e!==this.thisSec&&(this.takenThisSec=0,this.borrowedThisSec=0,this.thisSec=e)};Lt.prototype.loadNewQuota=function(e,t,s){e&&(this.quota=e),t&&(this.TTL=t),s&&(this.reportInterval=s/10)};Lt.prototype.timeToReport=function(){return this.reportElapsed+1>=this.reportInterval?(this.reportElapsed=0,!0):(this.reportElapsed+=1,!1)};Ka.exports=Lt});var Ja=h((SS,Ya)=>{"use strict";var cr=ee(),bf=Za();function Z(r,e,t,s,n,i,a,o,u){this.init(r,e,t,s,n,i,a,o,u)}Z.prototype.init=function(e,t,s,n,i,a,o,u,c){this.name=e,this.priority=t,this.rate=s,this.host=i,this.httpMethod=a,this.urlPath=o,this.serviceName=u,this.serviceType=c,this.reservoir=new bf,this.borrow=!!n,this.resetStatistics()};Z.prototype.match=function(e){var t=e.host,s=e.httpMethod,n=e.serviceName,i=e.urlPath,a=e.serviceType;return this.isDefault()||(!t||cr.wildcardMatch(this.host,t))&&(!s||cr.wildcardMatch(this.httpMethod,s))&&(!n||cr.wildcardMatch(this.serviceName,n))&&(!i||cr.wildcardMatch(this.urlPath,i))&&(!a||cr.wildcardMatch(this.serviceType,a))};Z.prototype.snapshotStatistics=function(){var e={requestCount:this.requestCount,borrowCount:this.borrowCount,sampledCount:this.sampledCount};return this.resetStatistics(),e};Z.prototype.merge=function(e){this.reservoir=e.reservoir,this.requestCount=e.requestCount,this.borrowCount=e.borrowCount,this.sampledCount=e.sampledCount,e=null};Z.prototype.isDefault=function(){return this.name==="Default"};Z.prototype.incrementRequestCount=function(){this.requestCount++};Z.prototype.incrementBorrowCount=function(){this.borrowCount++};Z.prototype.incrementSampledCount=function(){this.sampledCount++};Z.prototype.setRate=function(e){this.rate=e};Z.prototype.getRate=function(){return this.rate};Z.prototype.getName=function(){return this.name};Z.prototype.getPriority=function(){return this.priority};Z.prototype.getReservoir=function(){return this.reservoir};Z.prototype.resetStatistics=function(){this.requestCount=0,this.borrowCount=0,this.sampledCount=0};Z.prototype.canBorrow=function(){return this.borrow};Z.prototype.everMatched=function(){return this.requestCount>0};Z.prototype.timeToReport=function(){return this.reservoir.timeToReport()};Ya.exports=Z});var vn=h((bS,ro)=>{"use strict";var Tf=require("crypto"),xf=V(),Af=Ja(),Jr=Wr(),Rf=require("util"),wf=require("http"),eo={clientId:Tf.randomBytes(12).toString("hex"),samplingRulesPath:"/GetSamplingRules",samplingTargetsPath:"/SamplingTargets",logger:xf,httpClient:wf,fetchSamplingRules:function(e){let t="{}",s=Qa(this.samplingRulesPath,t.length),i=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(s,a=>{var o="";a.on("data",u=>{o+=u}),a.on("error",u=>{e(u)}),a.on("end",()=>{var u;try{u=JSON.parse(o)}catch(l){e(l);return}if(!u){e(new Error("AWS X-Ray GetSamplingRules API returned empty response"));return}var c=If(u);e(null,c)})});i.on("error",()=>{e(new Error(`Failed to connect to X-Ray daemon at ${s.hostname}:${s.port} to get sampling rules.`))}),i.write(t),i.end()},fetchTargets:function(e,t){let s=JSON.stringify(Cf(e)),n=Qa(this.samplingTargetsPath,s.length),a=(this.httpClient.__request?this.httpClient.__request:this.httpClient.request)(n,o=>{var u="";o.on("data",c=>{u+=c}),o.on("error",c=>{t(c)}),o.on("end",()=>{var c;try{c=JSON.parse(u)}catch(E){t(E);return}if(!c||typeof c.LastRuleModification!="number"){t(new Error("AWS X-Ray SamplingTargets API returned invalid response"));return}var l=Lf(c),d=to(c.LastRuleModification);t(null,l,d)})});a.on("error",()=>{t(new Error(`Failed to connect to X-Ray daemon at ${n.hostname}:${n.port} to get sampling targets.`))}),a.write(s),a.end()}},Cf=function(e){var t=[],s=Math.floor(new Date().getTime()/1e3);return e.forEach(function(n){var i=n.snapshotStatistics(),a={RuleName:n.getName(),ClientID:eo.clientId,RequestCount:i.requestCount,BorrowCount:i.borrowCount,SampledCount:i.sampledCount,Timestamp:s};t.push(a)}),{SamplingStatisticsDocuments:t}},If=function(e){var t=[],s=e.SamplingRuleRecords||[];return s.forEach(function(n){if(n=n.SamplingRule,Of(n)){var i=new Af(n.RuleName,n.Priority,n.FixedRate,n.ReservoirSize,n.Host,n.HTTPMethod,n.URLPath,n.ServiceName,n.ServiceType);t.push(i)}}),t},Lf=function(e){var t=e.SamplingTargetDocuments||[],s={};return t.forEach(function(n){var i={rate:n.FixedRate,quota:n.ReservoirQuota,TTL:to(n.ReservoirQuotaTTL),interval:n.Interval};s[n.RuleName]=i}),s},Of=function(e){return e.Version===1&&e.ResourceARN==="*"&&e.Attributes&&Object.keys(e.Attributes).length===0&&e.ServiceType&&e.RuleName&&e.Priority&&typeof e.FixedRate=="number"},to=function(e){return new Date(e).getTime()/1e3},Qa=function(e,t){return{hostname:Jr.tcp_ip,port:Jr.tcp_port,method:"POST",path:e,headers:{"Content-Type":"application/json","Content-Length":t,Host:Rf.format("%s:%d",Jr.tcp_ip,Jr.tcp_port)}}};ro.exports=eo});var Qr=h((TS,so)=>{"use strict";var Nf=3600,_n={rules:[],lastUpdated:null,getMatchedRule:function(e,t){if(kf(t))return null;var s;return this.rules.forEach(function(n){!s&&n.match(e)&&(s=n),n.isDefault()&&!s&&(s=n)}),s},loadRules:function(e){var t={};this.rules.forEach(function(s){t[s.getName()]=s}),this.rules=e,this.rules.forEach(function(s){var n=t[s.getName()];n&&s.merge(n)}),this.rules.sort(function(s,n){var i=s.getPriority()-n.getPriority();return i!==0?i:s.getName()>n.getName()?1:-1})},loadTargets:function(e){this.rules.forEach(function(t){var s=e[t.getName()];s&&(t.getReservoir().loadNewQuota(s.quota,s.TTL,s.interval),t.setRate(s.rate))})},getRules:function(){return this.rules},timestamp:function(e){this.lastUpdated=e},getLastUpdated:function(){return this.lastUpdated}},kf=function(e){return _n.getLastUpdated()?e>_n.getLastUpdated()+Nf:!0};so.exports=_n});var En=h((xS,oo)=>{"use strict";var yn=V(),qf=vn(),no=Qr(),$f=5*60*1e3,Pf={start:function(){this.poller&&clearInterval(this.poller),io(!1),this.poller=setInterval(io,$f),this.poller.unref()}},io=function(e){if(e=typeof e>"u"?!0:e,e){var t=Mf();setTimeout(ao,t)}else ao()},ao=function(){try{Df()}catch(e){yn.getLogger().warn("Encountered unexpected exception when fetching sampling rules: "+e)}},Df=function(){var e=Math.floor(new Date().getTime()/1e3);qf.fetchSamplingRules(function(t,s){t?yn.getLogger().warn("Failed to retrieve sampling rules from X-Ray service:",t):s.length!==0&&(no.loadRules(s),no.timestamp(e),yn.getLogger().info("Successfully refreshed centralized sampling rule cache."))})},Mf=function(){return Math.random()*5};oo.exports=Pf});var fo=h((AS,lo)=>{"use strict";var Ff=En(),Bf=vn(),Sn=Qr(),es=V(),uo=10*1e3,co={interval:uo,start:function(){this.poller=setInterval(jf,uo+Wf()),this.poller.unref()}},jf=function(){try{Uf()}catch(e){es.getLogger().warn("Encountered unexpected exception when fetching sampling targets: "+e)}},Uf=function(){var e=Vf();e&&e.length>0&&Bf.fetchTargets(e,function(t,s,n){if(t){es.getLogger().warn("Failed to retrieve sampling targets from X-Ray service:",t);return}Sn.loadTargets(s),n>Sn.getLastUpdated()&&(es.getLogger().info("Performing out-of-band sampling rule polling to fetch updated rules."),Ff.start()),es.getLogger().info("Successfully reported rule statistics to get new sampling quota.")})},Vf=function(){var e=Sn.getRules(),t=[];return e.forEach(function(s){s.everMatched()&&s.timeToReport()&&t.push(s)}),t},Wf=function(){return Math.random()/co.interval};lo.exports=co});var ho=h((RS,po)=>{"use strict";var bn=V(),Gf=require("util"),Xf=He(),Hf={localSampler:gn(),rulePoller:En(),targetPoller:fo(),ruleCache:Qr(),started:!1,shouldSample:function(e){try{this.started||this.start(),e.serviceType||(e.serviceType=Xf.origin);var t=Math.floor(new Date().getTime()/1e3),s=this.ruleCache.getMatchedRule(e,t);return s?(bn.getLogger().debug(Gf.format("Rule %s is matched.",s.getName())),zf(s,t)):(bn.getLogger().info("No effective centralized sampling rule match. Fallback to local rules."),this.localSampler.shouldSample(e))}catch(n){bn.getLogger().error("Unhandled exception by the SDK during making sampling decisions: "+n)}},setLocalRules:function(e){this.localSampler.setLocalRules(e)},start:function(){this.started||(this.rulePoller.start(),this.targetPoller.start(),this.started=!0)}},zf=function(e,t){e.incrementRequestCount();var s=e.getReservoir(),n=!0,i=s.borrowOrTake(t,e.canBorrow());return i==="borrow"?e.incrementBorrowCount():i==="take"||Math.random()<=e.getRate()?e.incrementSampledCount():n=!1,n?e.getName():!1};po.exports=Hf});var xn=h((wS,mo)=>{"use strict";var Kf=or(),Zf=pn(),Yf=V(),Jf=ee(),Qf=ee().wildcardMatch,ep=ee().processTraceData,Tn="x-amzn-trace-id",tp=!!process.env.AWS_XRAY_TRACING_NAME,rp={defaultName:process.env.AWS_XRAY_TRACING_NAME,dynamicNaming:!1,hostPattern:null,sampler:ho(),enableDynamicNaming:function(r){if(this.dynamicNaming=!0,r&&typeof r!="string")throw new Error("Host pattern must be a string.");this.hostPattern=r||null},processHeaders:function(e){var t={};return e&&e.headers&&e.headers[Tn]&&(t=ep(e.headers[Tn])),t},resolveName:function(e){var t;return this.dynamicNaming&&e?t=this.hostPattern?Qf(this.hostPattern,e)?e:this.defaultName:e:t=this.defaultName,t},resolveSampling:function(e,t,s){var n;if(e.sampled==="1")n=!0;else if(e.sampled==="0")n=!1;else{var i={host:s.req.headers.host,httpMethod:s.req.method,urlPath:s.req.url,serviceName:t.name};n=this.sampler.shouldSample(i),(n instanceof String||typeof n=="string")&&(t.setMatchedSamplingRule(n),n=!0)}e.sampled==="?"&&s.header&&s.header(Tn,"Root="+e.root+";Sampled="+(n?"1":"0")),n||(t.notTraced=!0)},setDefaultName:function(e){tp||(this.defaultName=e)},disableCentralizedSampling:function(){this.sampler=gn()},setSamplingRules:function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local sampling rules file, or supply an object containing the rules.");this.sampler.setLocalRules(e)},middlewareLog:function(e,t,s){Yf.getLogger().debug(e+": { url: "+t+", name: "+s.name+", trace_id: "+s.trace_id+", id: "+s.id+", sampled: "+!s.notTraced+" }")},traceRequestResponseCycle:function(e,t){var s=this.processHeaders(e),n=this.resolveName(e.headers.host),i=new Kf(n,s.root,s.parent);t.req||(t.req=e),this.resolveSampling(s,i,t),i.addIncomingRequestData(new Zf(e)),this.middlewareLog("Starting middleware segment",e.url,i);var a=this.middlewareLog,o=!1,u=function(){if(o)return;o=!0,t.statusCode===429&&i.addThrottleFlag();let c=Jf.getCauseTypeFromHttpStatus(t.statusCode);c&&(i[c]=!0),i.http.close(t),i.close(),a("Closed middleware segment successfully",e.url,i)};return t.on("finish",u),t.on("close",u),i}};mo.exports=rp});var go=h(rs=>{"use strict";Object.defineProperty(rs,"__esModule",{value:!0});rs.InvokeStore=void 0;var sp=require("async_hooks"),An=process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="1"||process.env.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA==="true";An||(globalThis.awslambda=globalThis.awslambda||{});var np={REQUEST_ID:Symbol("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol("_AWS_LAMBDA_X_RAY_TRACE_ID")},lr=class{static run(e,t){return this.storage.run({...e},t)}static getContext(){return this.storage.getStore()}static get(e){return this.storage.getStore()?.[e]}static set(e,t){if(this.isProtectedKey(e))throw new Error("Cannot modify protected Lambda context field");let s=this.storage.getStore();s&&(s[e]=t)}static getRequestId(){return this.get(this.PROTECTED_KEYS.REQUEST_ID)??"-"}static getXRayTraceId(){return this.get(this.PROTECTED_KEYS.X_RAY_TRACE_ID)}static hasContext(){return this.storage.getStore()!==void 0}static isProtectedKey(e){return e===this.PROTECTED_KEYS.REQUEST_ID||e===this.PROTECTED_KEYS.X_RAY_TRACE_ID}};C(lr,"storage",new sp.AsyncLocalStorage),C(lr,"PROTECTED_KEYS",np);var ts;!An&&globalThis.awslambda?.InvokeStore?ts=globalThis.awslambda.InvokeStore:(ts=lr,!An&&globalThis.awslambda&&(globalThis.awslambda.InvokeStore=ts));rs.InvokeStore=ts});var yo=h((LS,_o)=>{"use strict";var ss=Ze(),ip=xn(),Rn=ee().LambdaUtils,ap=or(),op=Xr(),up=He(),Cn=V(),vo=zr(),{InvokeStore:cp}=go(),wn=null;_o.exports.init=function(){ss.enableManualMode=function(){Cn.getLogger().warn("AWS Lambda does not support AWS X-Ray manual mode.")},op.disableReusableSocket(),up.setStreamingThreshold(0),Cn.getLogger().info("Disabling centralized sampling in Lambda environment."),ip.disableCentralizedSampling();var e=ss.getNamespace();e.enter(e.createContext()),ss.setSegment(lp())};var lp=function(){var e=new ap("facade"),t=["addNewSubsegment","addSubsegment","removeSubsegment","toString","addSubsegmentWithoutSampling","addNewSubsegmentWithoutSampling"],s=["incrementCounter","decrementCounter","isClosed","close","format","flush"],n=process.env._X_AMZN_TRACE_ID;for(var i in e)typeof e[i]=="function"&&t.indexOf(i)===-1&&(s.indexOf(i)===-1?e[i]=function(){var a=i;return function(){Cn.getLogger().warn('Function "'+a+'" cannot be called on an AWS Lambda segment. Please use a subsegment to record data.')}}():e[i]=function(){});return e.trace_id=vo.Invalid().toString(),e.isClosed=function(){return!0},e.in_progress=!1,e.counter=1,e.notTraced=!0,e.facade=!0,e.reset=function(){this.trace_id=vo.Invalid().toString(),this.id="00000000",delete this.subsegments,this.notTraced=!0},e.resolveLambdaTraceData=function(){let o=cp.getXRayTraceId(),u=process.env._X_AMZN_TRACE_ID;var c=o??u;c?c!=wn&&(this.reset(),Rn.populateTraceData(e,c)&&(wn=c)):(this.reset(),ss.contextMissingStrategy.contextMissing("Missing AWS Lambda trace data for X-Ray. Ensure Active Tracing is enabled and no subsegments are created outside the function handler."))},Rn.validTraceData(n)&&Rn.populateTraceData(e,n)&&(wn=n),e}});var Eo=h((OS,dp)=>{dp.exports={name:"aws-xray-sdk-core",version:"3.11.0",description:"AWS X-Ray SDK for Javascript",author:"Amazon Web Services",contributors:["Sandra McMullen <mcmuls@amazon.com>","William Armiros <armiros@amazon.com>","Moritz Onken <onken@netcubed.de>"],files:["dist/lib/**/*","LICENSE","README.md"],main:"dist/lib/index.js",types:"dist/lib/index.d.ts",engines:{node:">= 14.x"},directories:{test:"test"},"//":"@types/cls-hooked is exposed in API so must be in dependencies, not devDependencies",dependencies:{"@aws-sdk/types":"^3.4.1","@aws/lambda-invoke-store":"^0.0.1","@smithy/service-error-classification":"^2.0.4","@types/cls-hooked":"^4.3.3","atomic-batcher":"^1.0.2","cls-hooked":"^4.2.2",semver:"^7.5.3"},scripts:{prepare:"npm run compile",compile:"tsc && npm run copy-lib && npm run copy-test","copy-lib":"find lib -type f \\( -name '*.d.ts' -o -name '*.json' \\) | xargs -I % ../../scripts/cp-with-structure.sh % dist","copy-test":"find test -name '*.json' | xargs -I % ../../scripts/cp-with-structure.sh % dist",lint:"eslint .","lint:fix":"eslint . --fix",test:"npm run compile && mocha --recursive ./dist/test/ -R spec && tsd && mocha --recursive ./dist/test_async/ -R spec","test-d":"tsd","test-async":"npm run compile && mocha --recursive ./dist/test_async/ -R spec",clean:"rm -rf dist && rm -rf node_modules",testcov:"nyc npm run test",reportcov:"nyc report --reporter=text-lcov > coverage.lcov"},keywords:["amazon","api","aws","core","xray","x-ray","x ray"],license:"Apache-2.0",repository:"https://github.com/aws/aws-xray-sdk-node/tree/master/packages/core",gitHead:"4e6f43ed3c4686418c2139d4b86ab5513e0ca8ed"}});var To=h((NS,bo)=>{"use strict";var In=require("http"),So={METADATA_TIMEOUT:1e3,getPluginMetadata:function(r,e){var n=5,i=function(){var a=In.__request?In.__request:In.request,o=a(r,function(u){var c="";u.on("data",function(l){c+=l}),u.on("end",function(){if(this.statusCode===200||this.statusCode===300){try{c=JSON.parse(c)}catch(l){e(l);return}e(null,c)}else n>0&&Math.floor(this.statusCode/100)===5?(n--,setTimeout(i,250)):e(new Error(`Failed to retrieve metadata with options: ${r}`))})});o.on("error",function(u){e(u)}),o.on("timeout",function(){o.abort()}),o.setTimeout(So.METADATA_TIMEOUT),o.end()};i()}};bo.exports=So});var Co=h((kS,wo)=>{"use strict";var Ao=To(),xo=V(),Ln=require("http"),fp={getData:function(r){let e="/latest/dynamic/instance-identity/document";function t(s){let n=Ro(e,"GET",s?{"X-aws-ec2-metadata-token":s}:{});Ao.getPluginMetadata(n,function(i,a){if(i||!a){xo.getLogger().error("Error loading EC2 plugin metadata: ",i?i.toString():"Could not retrieve data from IMDS."),r();return}let o={ec2:{instance_id:a.instanceId,availability_zone:a.availabilityZone,instance_size:a.instanceType,ami_id:a.imageId}};r(o)})}pp(function(s){s===null&&xo.getLogger().debug("EC2Plugin failed to get token from IMDSv2. Falling back to IMDSv1."),t(s)})},originName:"AWS::EC2::Instance"};function pp(r){let e=Ln.__request?Ln.__request:Ln.request,n=Ro("/latest/api/token","PUT",{"X-aws-ec2-metadata-token-ttl-seconds":60}),i=e(n,function(a){let o="";a.on("data",function(u){o+=u}),a.on("end",function(){this.statusCode===200||this.statusCode===300?r(o):r(null)})});i.on("error",function(){r(null)}),i.on("timeout",function(){i.abort(),r(null)}),i.setTimeout(Ao.METADATA_TIMEOUT),i.end()}function Ro(r,e,t){return e||(e="GET"),t||(t={}),{host:"169.254.169.254",path:r,method:e,headers:t}}wo.exports=fp});var Lo=h((qS,Io)=>{"use strict";var hp=require("os"),mp={getData:function(r){r({ecs:{container:hp.hostname()}})},originName:"AWS::ECS::Container"};Io.exports=mp});var No=h(($S,Oo)=>{"use strict";var gp=require("fs"),vp=V(),_p="/var/elasticbeanstalk/xray/environment.conf",yp={getData:function(r){gp.readFile(_p,"utf8",function(e,t){if(e)vp.getLogger().error("Error loading Elastic Beanstalk plugin:",e.stack),r();else{var s=JSON.parse(t),n={elastic_beanstalk:{environment:s.environment_name,version_label:s.version_label,deployment_id:s.deployment_id}};r(n)}})},originName:"AWS::ElasticBeanstalk::Environment"};Oo.exports=yp});var ko=h((PS,Ep)=>{Ep.exports={services:{dynamodb:{operations:{batchGetItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity"]},batchWriteItem:{request_descriptors:{RequestItems:{get_keys:!0,rename_to:"table_names"}},response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},createTable:{request_parameters:["GlobalSecondaryIndexes","LocalSecondaryIndexes","ProvisionedThroughput","TableName"]},deleteItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},deleteTable:{request_parameters:["TableName"]},describeTable:{request_parameters:["TableName"]},getItem:{request_parameters:["ConsistentRead","ProjectionExpression","TableName"],response_parameters:["ConsumedCapacity"]},listTables:{request_parameters:["ExclusiveStartTableName","Limit"],response_descriptors:{TableNames:{list:!0,get_count:!0,rename_to:"table_count"}}},putItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},query:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","ScanIndexForward","Select","TableName"],response_parameters:["ConsumedCapacity"]},scan:{request_parameters:["AttributesToGet","ConsistentRead","IndexName","Limit","ProjectionExpression","Segment","Select","TableName","TotalSegments"],response_parameters:["ConsumedCapacity","Count","ScannedCount"]},updateItem:{request_parameters:["TableName"],response_parameters:["ConsumedCapacity","ItemCollectionMetrics"]},updateTable:{request_parameters:["AttributeDefinitions","GlobalSecondaryIndexUpdates","ProvisionedThroughput","TableName"]}}},sqs:{operations:{addPermission:{request_parameters:["Label","QueueUrl"]},changeMessageVisibility:{request_parameters:["QueueUrl","VisibilityTimeout"]},changeMessageVisibilityBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},createQueue:{request_parameters:["Attributes","QueueName"]},deleteMessage:{request_parameters:["QueueUrl"]},deleteMessageBatch:{request_parameters:["QueueUrl"],response_parameters:["Failed"]},deleteQueue:{request_parameters:["QueueUrl"]},getQueueAttributes:{request_parameters:["QueueUrl"],response_parameters:["Attributes"]},getQueueUrl:{request_parameters:["QueueName","QueueOwnerAWSAccountId"],response_parameters:["QueueUrl"]},listDeadLetterSourceQueues:{request_parameters:["QueueUrl"],response_parameters:["QueueUrls"]},listQueues:{request_parameters:["QueueNamePrefix"],response_descriptors:{QueueUrls:{list:!0,get_count:!0,rename_to:"queue_count"}}},purgeQueue:{request_parameters:["QueueUrl"]},receiveMessage:{request_parameters:["AttributeNames","MaxNumberOfMessages","MessageAttributeNames","QueueUrl","VisibilityTimeout","WaitTimeSeconds"],response_descriptors:{Messages:{list:!0,get_count:!0,rename_to:"message_count"}}},removePermission:{request_parameters:["QueueUrl"]},sendMessage:{request_parameters:["DelaySeconds","QueueUrl"],request_descriptors:{MessageAttributes:{get_keys:!0,rename_to:"message_attribute_names"}},response_parameters:["MessageId"]},sendMessageBatch:{request_parameters:["QueueUrl"],request_descriptors:{Entries:{list:!0,get_count:!0,rename_to:"message_count"}},response_descriptors:{Failed:{list:!0,get_count:!0,rename_to:"failed_count"},Successful:{list:!0,get_count:!0,rename_to:"successful_count"}}},setQueueAttributes:{request_parameters:["QueueUrl"],request_descriptors:{Attributes:{get_keys:!0,rename_to:"attribute_names"}}}}},sns:{operations:{publish:{request_parameters:["TopicArn"]},publishBatch:{request_parameters:["TopicArn"]}}},lambda:{operations:{invoke:{request_parameters:["FunctionName","InvocationType","LogType","Qualifier"],response_parameters:["FunctionError","StatusCode"]},invokeAsync:{request_parameters:["FunctionName"],response_parameters:["Status"]}}},s3:{operations:{abortMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},completeMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},copyObject:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},createMultipartUpload:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},deleteObjects:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLocation:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},getObjectTorrent:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headBucket:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},headObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketAnalyticsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketInventoryConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listBucketMetricsConfigurations:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listMultipartUploads:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectVersions:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjects:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listObjectsV2:{request_parameters:["Prefix"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},listParts:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAccelerateConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAcl:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketAnalyticsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketCors:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketEncryption:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketInventoryConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycle:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLifecycleConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketLogging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketMetricsConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotification:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketNotificationConfiguration:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketPolicy:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketReplication:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketRequestPayment:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketTagging:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketVersioning:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putBucketWebsite:{request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObject:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectAcl:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},putObjectTagging:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},restoreObject:{request_parameters:["Key","VersionId"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPart:{request_parameters:["Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}},uploadPartCopy:{request_parameters:["CopySource","Key"],request_descriptors:{Bucket:{rename_to:"bucket_name"}}}}},sagemakerruntime:{operations:{invokeEndpoint:{request_parameters:["EndpointName"]}}}}}});var Fo=h((DS,Mo)=>{"use strict";var Po=require("fs"),Ot=V(),Sp=ko(),ns={REQ_DESC:"request_descriptors",REQ_PARAMS:"request_parameters",RES_DESC:"response_descriptors",RES_PARAMS:"response_parameters"};function as(r){this.init(r)}as.prototype.init=function(e){e?typeof e=="string"?(Ot.getLogger().info("Using custom AWS whitelist file: "+e),this.services=is(JSON.parse(Po.readFileSync(e,"utf8")))):(Ot.getLogger().info("Using custom AWS whitelist source."),this.services=is(e)):this.services=Sp.services};as.prototype.append=function(e){var t={};typeof e=="string"?(Ot.getLogger().info("Appending AWS whitelist with custom file: "+e),t=is(JSON.parse(Po.readFileSync(e,"utf8")))):(Ot.getLogger().info("Appending AWS whitelist with a custom source."),t=is(e));for(var s in t)this.services[s]=t[s]};as.prototype.capture=function(e,t){var s=t.request.operation,n=this.services[e]!==void 0?this.services[e].operations[s]:null;if(n===null){Ot.getLogger().debug('Call "'+e+"."+s+'" is not whitelisted for additional data capturing. Ignoring.');return}var i={};for(var a in n){var o=n[a];a===ns.REQ_PARAMS?qo(o,t.request.params,i):a===ns.REQ_DESC?$o(o,t.request.params,i):a===ns.RES_PARAMS?t.data&&qo(o,t.data,i):a===ns.RES_DESC?t.data&&$o(o,t.data,i):Ot.getLogger().error('Unknown parameter type "'+a+'". Must be "request_descriptors", "response_descriptors", "request_parameters" or "response_parameters".')}return i};function qo(r,e,t){r.forEach(function(s){if(typeof e[s]<"u"){var n=Do(s);this[n]=e[s]}},t)}function $o(r,e,t){for(var s in r){var n=r[s];if(typeof e[s]<"u"){var i;if(n.list&&n.get_count?i=e[s]?e[s].length:0:i=n.get_keys===!0?Object.keys(e[s]):e[s],typeof n.rename_to=="string")t[n.rename_to]=i;else{var a=Do(s);t[a]=i}}}}function Do(r){return r==="IPAddress"?"ip_address":r.split(/(?=[A-Z])/).join("_").toLowerCase()}function is(r){var e=r;if(e.services===void 0)throw new Error('Document formatting is incorrect. Expecting "services" param.');return e.services}Mo.exports=as});var dr=h((MS,os)=>{"use strict";var Bo=Fo(),On=new Bo;function Nn(r,e){this.init(r,e)}Nn.prototype.init=function(e,t){this.operation=xp(e.request.operation)||"",e&&e.request&&e.request.httpRequest&&e.request.httpRequest.region&&(this.region=e.request.httpRequest.region),e&&e.requestId&&(this.request_id=e.requestId),this.retries=e.retryCount||0,e.extendedRequestId&&t&&t.toLowerCase()==="s3"&&(this.id_2=e.extendedRequestId),t&&this.addData(On.capture(t.toLowerCase(),e))};Nn.prototype.addData=function(e){for(var t in e)this[t]=e[t]};var bp=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");On=new Bo(e)},Tp=function(e){if(!e||e instanceof String||!(typeof e=="string"||e instanceof Object))throw new Error("Please specify a path to the local whitelist file, or supply a whitelist source object.");On.append(e)};function xp(r){if(r)return r.charAt(0).toUpperCase()+r.slice(1)}os.exports=Nn;os.exports.appendAWSWhitelist=Tp;os.exports.setAWSWhitelist=bp});var cs=h((FS,us)=>{"use strict";var nt=Ze(),fr=V(),jo=function(e,t,s){kn(e,t);var n,i,a=nt.resolveSegment(s);if(!a)return fr.getLogger().warn("Failed to capture function."),t();n=a.addNewSubsegment(e),i=Uo(t,n);try{let o=i(n);return n.close(),o}catch(o){throw n.close(o),o}},Ap=function(e,t,s){kn(e,t);var n,i,a=nt.resolveSegment(s);if(!a)return fr.getLogger().warn("Failed to capture async function."),t();n=a.addNewSubsegment(e),i=Uo(t,n);try{return i(n)}catch(o){throw n.close(o),o}},Rp=function(e,t,s){kn(e,t);var n=nt.resolveSegment(s);return n?(n.incrementCounter(),function(){var i=nt.resolveSegment(s),a=Array.prototype.slice.call(arguments);jo(e,t.bind.apply(t,[null].concat(a)),i),n.decrementCounter()}.bind(this)):(fr.getLogger().warn("Failed to capture callback function."),t)};function Uo(r,e){var t;if(nt.isAutomaticMode()){var s=nt.getNamespace(),n=function(){var i;return s.run(function(){nt.setSegment(e),i=r(e)}),i};t=n}else t=r;return t}function kn(r,e){var t;if(!r||typeof r!="string")throw t='Param "name" must be a non-empty string.',fr.getLogger().error(t),new Error(t);if(typeof e!="function")throw t='Param "fcn" must be a function.',fr.getLogger().error(t),new Error(t)}us.exports.captureFunc=jo;us.exports.captureAsyncFunc=Ap;us.exports.captureCallbackFunc=Rp});var pr=h((BS,Vo)=>{"use strict";var wp="2.0.0",Cp=Number.MAX_SAFE_INTEGER||9007199254740991,Ip=16,Lp=250,Op=["major","premajor","minor","preminor","patch","prepatch","prerelease"];Vo.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:Ip,MAX_SAFE_BUILD_LENGTH:Lp,MAX_SAFE_INTEGER:Cp,RELEASE_TYPES:Op,SEMVER_SPEC_VERSION:wp,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var hr=h((jS,Wo)=>{"use strict";var Np=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Wo.exports=Np});var Nt=h((Te,Go)=>{"use strict";var{MAX_SAFE_COMPONENT_LENGTH:qn,MAX_SAFE_BUILD_LENGTH:kp,MAX_LENGTH:qp}=pr(),$p=hr();Te=Go.exports={};var Pp=Te.re=[],Dp=Te.safeRe=[],_=Te.src=[],Mp=Te.safeSrc=[],y=Te.t={},Fp=0,$n="[a-zA-Z0-9-]",Bp=[["\\s",1],["\\d",qp],[$n,kp]],jp=r=>{for(let[e,t]of Bp)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},x=(r,e,t)=>{let s=jp(e),n=Fp++;$p(r,n,e),y[r]=n,_[n]=e,Mp[n]=s,Pp[n]=new RegExp(e,t?"g":void 0),Dp[n]=new RegExp(s,t?"g":void 0)};x("NUMERICIDENTIFIER","0|[1-9]\\d*");x("NUMERICIDENTIFIERLOOSE","\\d+");x("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${$n}*`);x("MAINVERSION",`(${_[y.NUMERICIDENTIFIER]})\\.(${_[y.NUMERICIDENTIFIER]})\\.(${_[y.NUMERICIDENTIFIER]})`);x("MAINVERSIONLOOSE",`(${_[y.NUMERICIDENTIFIERLOOSE]})\\.(${_[y.NUMERICIDENTIFIERLOOSE]})\\.(${_[y.NUMERICIDENTIFIERLOOSE]})`);x("PRERELEASEIDENTIFIER",`(?:${_[y.NONNUMERICIDENTIFIER]}|${_[y.NUMERICIDENTIFIER]})`);x("PRERELEASEIDENTIFIERLOOSE",`(?:${_[y.NONNUMERICIDENTIFIER]}|${_[y.NUMERICIDENTIFIERLOOSE]})`);x("PRERELEASE",`(?:-(${_[y.PRERELEASEIDENTIFIER]}(?:\\.${_[y.PRERELEASEIDENTIFIER]})*))`);x("PRERELEASELOOSE",`(?:-?(${_[y.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${_[y.PRERELEASEIDENTIFIERLOOSE]})*))`);x("BUILDIDENTIFIER",`${$n}+`);x("BUILD",`(?:\\+(${_[y.BUILDIDENTIFIER]}(?:\\.${_[y.BUILDIDENTIFIER]})*))`);x("FULLPLAIN",`v?${_[y.MAINVERSION]}${_[y.PRERELEASE]}?${_[y.BUILD]}?`);x("FULL",`^${_[y.FULLPLAIN]}$`);x("LOOSEPLAIN",`[v=\\s]*${_[y.MAINVERSIONLOOSE]}${_[y.PRERELEASELOOSE]}?${_[y.BUILD]}?`);x("LOOSE",`^${_[y.LOOSEPLAIN]}$`);x("GTLT","((?:<|>)?=?)");x("XRANGEIDENTIFIERLOOSE",`${_[y.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);x("XRANGEIDENTIFIER",`${_[y.NUMERICIDENTIFIER]}|x|X|\\*`);x("XRANGEPLAIN",`[v=\\s]*(${_[y.XRANGEIDENTIFIER]})(?:\\.(${_[y.XRANGEIDENTIFIER]})(?:\\.(${_[y.XRANGEIDENTIFIER]})(?:${_[y.PRERELEASE]})?${_[y.BUILD]}?)?)?`);x("XRANGEPLAINLOOSE",`[v=\\s]*(${_[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${_[y.XRANGEIDENTIFIERLOOSE]})(?:\\.(${_[y.XRANGEIDENTIFIERLOOSE]})(?:${_[y.PRERELEASELOOSE]})?${_[y.BUILD]}?)?)?`);x("XRANGE",`^${_[y.GTLT]}\\s*${_[y.XRANGEPLAIN]}$`);x("XRANGELOOSE",`^${_[y.GTLT]}\\s*${_[y.XRANGEPLAINLOOSE]}$`);x("COERCEPLAIN",`(^|[^\\d])(\\d{1,${qn}})(?:\\.(\\d{1,${qn}}))?(?:\\.(\\d{1,${qn}}))?`);x("COERCE",`${_[y.COERCEPLAIN]}(?:$|[^\\d])`);x("COERCEFULL",_[y.COERCEPLAIN]+`(?:${_[y.PRERELEASE]})?(?:${_[y.BUILD]})?(?:$|[^\\d])`);x("COERCERTL",_[y.COERCE],!0);x("COERCERTLFULL",_[y.COERCEFULL],!0);x("LONETILDE","(?:~>?)");x("TILDETRIM",`(\\s*)${_[y.LONETILDE]}\\s+`,!0);Te.tildeTrimReplace="$1~";x("TILDE",`^${_[y.LONETILDE]}${_[y.XRANGEPLAIN]}$`);x("TILDELOOSE",`^${_[y.LONETILDE]}${_[y.XRANGEPLAINLOOSE]}$`);x("LONECARET","(?:\\^)");x("CARETTRIM",`(\\s*)${_[y.LONECARET]}\\s+`,!0);Te.caretTrimReplace="$1^";x("CARET",`^${_[y.LONECARET]}${_[y.XRANGEPLAIN]}$`);x("CARETLOOSE",`^${_[y.LONECARET]}${_[y.XRANGEPLAINLOOSE]}$`);x("COMPARATORLOOSE",`^${_[y.GTLT]}\\s*(${_[y.LOOSEPLAIN]})$|^$`);x("COMPARATOR",`^${_[y.GTLT]}\\s*(${_[y.FULLPLAIN]})$|^$`);x("COMPARATORTRIM",`(\\s*)${_[y.GTLT]}\\s*(${_[y.LOOSEPLAIN]}|${_[y.XRANGEPLAIN]})`,!0);Te.comparatorTrimReplace="$1$2$3";x("HYPHENRANGE",`^\\s*(${_[y.XRANGEPLAIN]})\\s+-\\s+(${_[y.XRANGEPLAIN]})\\s*$`);x("HYPHENRANGELOOSE",`^\\s*(${_[y.XRANGEPLAINLOOSE]})\\s+-\\s+(${_[y.XRANGEPLAINLOOSE]})\\s*$`);x("STAR","(<|>)?=?\\s*\\*");x("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");x("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ls=h((US,Xo)=>{"use strict";var Up=Object.freeze({loose:!0}),Vp=Object.freeze({}),Wp=r=>r?typeof r!="object"?Up:r:Vp;Xo.exports=Wp});var Pn=h((VS,Ko)=>{"use strict";var Ho=/^[0-9]+$/,zo=(r,e)=>{if(typeof r=="number"&&typeof e=="number")return r===e?0:r<e?-1:1;let t=Ho.test(r),s=Ho.test(e);return t&&s&&(r=+r,e=+e),r===e?0:t&&!s?-1:s&&!t?1:r<e?-1:1},Gp=(r,e)=>zo(e,r);Ko.exports={compareIdentifiers:zo,rcompareIdentifiers:Gp}});var re=h((WS,Yo)=>{"use strict";var ds=hr(),{MAX_LENGTH:Zo,MAX_SAFE_INTEGER:fs}=pr(),{safeRe:ps,t:hs}=Nt(),Xp=ls(),{compareIdentifiers:Dn}=Pn(),Mn=class r{constructor(e,t){if(t=Xp(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Zo)throw new TypeError(`version is longer than ${Zo} characters`);ds("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let s=e.trim().match(t.loose?ps[hs.LOOSE]:ps[hs.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>fs||this.major<0)throw new TypeError("Invalid major version");if(this.minor>fs||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>fs||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map(n=>{if(/^[0-9]+$/.test(n)){let i=+n;if(i>=0&&i<fs)return i}return n}):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ds("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),this.major<e.major?-1:this.major>e.major?1:this.minor<e.minor?-1:this.minor>e.minor?1:this.patch<e.patch?-1:this.patch>e.patch?1:0}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let s=this.prerelease[t],n=e.prerelease[t];if(ds("prerelease compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Dn(s,n)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let s=this.build[t],n=e.build[t];if(ds("build compare",t,s,n),s===void 0&&n===void 0)return 0;if(n===void 0)return 1;if(s===void 0)return-1;if(s===n)continue;return Dn(s,n)}while(++t)}inc(e,t,s){if(e.startsWith("pre")){if(!t&&s===!1)throw new Error("invalid increment argument: identifier is empty");if(t){let n=`-${t}`.match(this.options.loose?ps[hs.PRERELEASELOOSE]:ps[hs.PRERELEASE]);if(!n||n[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,s);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,s);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,s),this.inc("pre",t,s);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,s),this.inc("pre",t,s);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let n=Number(s)?1:0;if(this.prerelease.length===0)this.prerelease=[n];else{let i=this.prerelease.length;for(;--i>=0;)typeof this.prerelease[i]=="number"&&(this.prerelease[i]++,i=-2);if(i===-1){if(t===this.prerelease.join(".")&&s===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(n)}}if(t){let i=[t,n];s===!1&&(i=[t]),Dn(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=i):this.prerelease=i}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};Yo.exports=Mn});var it=h((GS,Qo)=>{"use strict";var Jo=re(),Hp=(r,e,t=!1)=>{if(r instanceof Jo)return r;try{return new Jo(r,e)}catch(s){if(!t)return null;throw s}};Qo.exports=Hp});var tu=h((XS,eu)=>{"use strict";var zp=it(),Kp=(r,e)=>{let t=zp(r,e);return t?t.version:null};eu.exports=Kp});var su=h((HS,ru)=>{"use strict";var Zp=it(),Yp=(r,e)=>{let t=Zp(r.trim().replace(/^[=v]+/,""),e);return t?t.version:null};ru.exports=Yp});var au=h((zS,iu)=>{"use strict";var nu=re(),Jp=(r,e,t,s,n)=>{typeof t=="string"&&(n=s,s=t,t=void 0);try{return new nu(r instanceof nu?r.version:r,t).inc(e,s,n).version}catch{return null}};iu.exports=Jp});var cu=h((KS,uu)=>{"use strict";var ou=it(),Qp=(r,e)=>{let t=ou(r,null,!0),s=ou(e,null,!0),n=t.compare(s);if(n===0)return null;let i=n>0,a=i?t:s,o=i?s:t,u=!!a.prerelease.length;if(!!o.prerelease.length&&!u){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}let l=u?"pre":"";return t.major!==s.major?l+"major":t.minor!==s.minor?l+"minor":t.patch!==s.patch?l+"patch":"prerelease"};uu.exports=Qp});var du=h((ZS,lu)=>{"use strict";var eh=re(),th=(r,e)=>new eh(r,e).major;lu.exports=th});var pu=h((YS,fu)=>{"use strict";var rh=re(),sh=(r,e)=>new rh(r,e).minor;fu.exports=sh});var mu=h((JS,hu)=>{"use strict";var nh=re(),ih=(r,e)=>new nh(r,e).patch;hu.exports=ih});var vu=h((QS,gu)=>{"use strict";var ah=it(),oh=(r,e)=>{let t=ah(r,e);return t&&t.prerelease.length?t.prerelease:null};gu.exports=oh});var fe=h((eb,yu)=>{"use strict";var _u=re(),uh=(r,e,t)=>new _u(r,t).compare(new _u(e,t));yu.exports=uh});var Su=h((tb,Eu)=>{"use strict";var ch=fe(),lh=(r,e,t)=>ch(e,r,t);Eu.exports=lh});var Tu=h((rb,bu)=>{"use strict";var dh=fe(),fh=(r,e)=>dh(r,e,!0);bu.exports=fh});var ms=h((sb,Au)=>{"use strict";var xu=re(),ph=(r,e,t)=>{let s=new xu(r,t),n=new xu(e,t);return s.compare(n)||s.compareBuild(n)};Au.exports=ph});var wu=h((nb,Ru)=>{"use strict";var hh=ms(),mh=(r,e)=>r.sort((t,s)=>hh(t,s,e));Ru.exports=mh});var Iu=h((ib,Cu)=>{"use strict";var gh=ms(),vh=(r,e)=>r.sort((t,s)=>gh(s,t,e));Cu.exports=vh});var mr=h((ab,Lu)=>{"use strict";var _h=fe(),yh=(r,e,t)=>_h(r,e,t)>0;Lu.exports=yh});var gs=h((ob,Ou)=>{"use strict";var Eh=fe(),Sh=(r,e,t)=>Eh(r,e,t)<0;Ou.exports=Sh});var Fn=h((ub,Nu)=>{"use strict";var bh=fe(),Th=(r,e,t)=>bh(r,e,t)===0;Nu.exports=Th});var Bn=h((cb,ku)=>{"use strict";var xh=fe(),Ah=(r,e,t)=>xh(r,e,t)!==0;ku.exports=Ah});var vs=h((lb,qu)=>{"use strict";var Rh=fe(),wh=(r,e,t)=>Rh(r,e,t)>=0;qu.exports=wh});var _s=h((db,$u)=>{"use strict";var Ch=fe(),Ih=(r,e,t)=>Ch(r,e,t)<=0;$u.exports=Ih});var jn=h((fb,Pu)=>{"use strict";var Lh=Fn(),Oh=Bn(),Nh=mr(),kh=vs(),qh=gs(),$h=_s(),Ph=(r,e,t,s)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return Lh(r,t,s);case"!=":return Oh(r,t,s);case">":return Nh(r,t,s);case">=":return kh(r,t,s);case"<":return qh(r,t,s);case"<=":return $h(r,t,s);default:throw new TypeError(`Invalid operator: ${e}`)}};Pu.exports=Ph});var Mu=h((pb,Du)=>{"use strict";var Dh=re(),Mh=it(),{safeRe:ys,t:Es}=Nt(),Fh=(r,e)=>{if(r instanceof Dh)return r;if(typeof r=="number"&&(r=String(r)),typeof r!="string")return null;e=e||{};let t=null;if(!e.rtl)t=r.match(e.includePrerelease?ys[Es.COERCEFULL]:ys[Es.COERCE]);else{let u=e.includePrerelease?ys[Es.COERCERTLFULL]:ys[Es.COERCERTL],c;for(;(c=u.exec(r))&&(!t||t.index+t[0].length!==r.length);)(!t||c.index+c[0].length!==t.index+t[0].length)&&(t=c),u.lastIndex=c.index+c[1].length+c[2].length;u.lastIndex=-1}if(t===null)return null;let s=t[2],n=t[3]||"0",i=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return Mh(`${s}.${n}.${i}${a}${o}`,e)};Du.exports=Fh});var Bu=h((hb,Fu)=>{"use strict";var Un=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let n=this.map.keys().next().value;this.delete(n)}this.map.set(e,t)}return this}};Fu.exports=Un});var pe=h((mb,Wu)=>{"use strict";var Bh=/\s+/g,Vn=class r{constructor(e,t){if(t=Uh(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof Wn)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(Bh," "),this.set=this.raw.split("||").map(s=>this.parseRange(s.trim())).filter(s=>s.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let s=this.set[0];if(this.set=this.set.filter(n=>!Uu(n[0])),this.set.length===0)this.set=[s];else if(this.set.length>1){for(let n of this.set)if(n.length===1&&Kh(n[0])){this.set=[n];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let s=0;s<t.length;s++)s>0&&(this.formatted+=" "),this.formatted+=t[s].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let s=((this.options.includePrerelease&&Hh)|(this.options.loose&&zh))+":"+e,n=ju.get(s);if(n)return n;let i=this.options.loose,a=i?ae[se.HYPHENRANGELOOSE]:ae[se.HYPHENRANGE];e=e.replace(a,im(this.options.includePrerelease)),F("hyphen replace",e),e=e.replace(ae[se.COMPARATORTRIM],Wh),F("comparator trim",e),e=e.replace(ae[se.TILDETRIM],Gh),F("tilde trim",e),e=e.replace(ae[se.CARETTRIM],Xh),F("caret trim",e);let o=e.split(" ").map(d=>Zh(d,this.options)).join(" ").split(/\s+/).map(d=>nm(d,this.options));i&&(o=o.filter(d=>(F("loose invalid filter",d,this.options),!!d.match(ae[se.COMPARATORLOOSE])))),F("range list",o);let u=new Map,c=o.map(d=>new Wn(d,this.options));for(let d of c){if(Uu(d))return[d];u.set(d.value,d)}u.size>1&&u.has("")&&u.delete("");let l=[...u.values()];return ju.set(s,l),l}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(s=>Vu(s,t)&&e.set.some(n=>Vu(n,t)&&s.every(i=>n.every(a=>i.intersects(a,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new Vh(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(am(this.set[t],e,this.options))return!0;return!1}};Wu.exports=Vn;var jh=Bu(),ju=new jh,Uh=ls(),Wn=gr(),F=hr(),Vh=re(),{safeRe:ae,t:se,comparatorTrimReplace:Wh,tildeTrimReplace:Gh,caretTrimReplace:Xh}=Nt(),{FLAG_INCLUDE_PRERELEASE:Hh,FLAG_LOOSE:zh}=pr(),Uu=r=>r.value==="<0.0.0-0",Kh=r=>r.value==="",Vu=(r,e)=>{let t=!0,s=r.slice(),n=s.pop();for(;t&&s.length;)t=s.every(i=>n.intersects(i,e)),n=s.pop();return t},Zh=(r,e)=>(r=r.replace(ae[se.BUILD],""),F("comp",r,e),r=Qh(r,e),F("caret",r),r=Yh(r,e),F("tildes",r),r=tm(r,e),F("xrange",r),r=sm(r,e),F("stars",r),r),oe=r=>!r||r.toLowerCase()==="x"||r==="*",Yh=(r,e)=>r.trim().split(/\s+/).map(t=>Jh(t,e)).join(" "),Jh=(r,e)=>{let t=e.loose?ae[se.TILDELOOSE]:ae[se.TILDE];return r.replace(t,(s,n,i,a,o)=>{F("tilde",r,s,n,i,a,o);let u;return oe(n)?u="":oe(i)?u=`>=${n}.0.0 <${+n+1}.0.0-0`:oe(a)?u=`>=${n}.${i}.0 <${n}.${+i+1}.0-0`:o?(F("replaceTilde pr",o),u=`>=${n}.${i}.${a}-${o} <${n}.${+i+1}.0-0`):u=`>=${n}.${i}.${a} <${n}.${+i+1}.0-0`,F("tilde return",u),u})},Qh=(r,e)=>r.trim().split(/\s+/).map(t=>em(t,e)).join(" "),em=(r,e)=>{F("caret",r,e);let t=e.loose?ae[se.CARETLOOSE]:ae[se.CARET],s=e.includePrerelease?"-0":"";return r.replace(t,(n,i,a,o,u)=>{F("caret",r,n,i,a,o,u);let c;return oe(i)?c="":oe(a)?c=`>=${i}.0.0${s} <${+i+1}.0.0-0`:oe(o)?i==="0"?c=`>=${i}.${a}.0${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.0${s} <${+i+1}.0.0-0`:u?(F("replaceCaret pr",u),i==="0"?a==="0"?c=`>=${i}.${a}.${o}-${u} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}-${u} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o}-${u} <${+i+1}.0.0-0`):(F("no pr"),i==="0"?a==="0"?c=`>=${i}.${a}.${o}${s} <${i}.${a}.${+o+1}-0`:c=`>=${i}.${a}.${o}${s} <${i}.${+a+1}.0-0`:c=`>=${i}.${a}.${o} <${+i+1}.0.0-0`),F("caret return",c),c})},tm=(r,e)=>(F("replaceXRanges",r,e),r.split(/\s+/).map(t=>rm(t,e)).join(" ")),rm=(r,e)=>{r=r.trim();let t=e.loose?ae[se.XRANGELOOSE]:ae[se.XRANGE];return r.replace(t,(s,n,i,a,o,u)=>{F("xRange",r,s,n,i,a,o,u);let c=oe(i),l=c||oe(a),d=l||oe(o),E=d;return n==="="&&E&&(n=""),u=e.includePrerelease?"-0":"",c?n===">"||n==="<"?s="<0.0.0-0":s="*":n&&E?(l&&(a=0),o=0,n===">"?(n=">=",l?(i=+i+1,a=0,o=0):(a=+a+1,o=0)):n==="<="&&(n="<",l?i=+i+1:a=+a+1),n==="<"&&(u="-0"),s=`${n+i}.${a}.${o}${u}`):l?s=`>=${i}.0.0${u} <${+i+1}.0.0-0`:d&&(s=`>=${i}.${a}.0${u} <${i}.${+a+1}.0-0`),F("xRange return",s),s})},sm=(r,e)=>(F("replaceStars",r,e),r.trim().replace(ae[se.STAR],"")),nm=(r,e)=>(F("replaceGTE0",r,e),r.trim().replace(ae[e.includePrerelease?se.GTE0PRE:se.GTE0],"")),im=r=>(e,t,s,n,i,a,o,u,c,l,d,E)=>(oe(s)?t="":oe(n)?t=`>=${s}.0.0${r?"-0":""}`:oe(i)?t=`>=${s}.${n}.0${r?"-0":""}`:a?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,oe(c)?u="":oe(l)?u=`<${+c+1}.0.0-0`:oe(d)?u=`<${c}.${+l+1}.0-0`:E?u=`<=${c}.${l}.${d}-${E}`:r?u=`<${c}.${l}.${+d+1}-0`:u=`<=${u}`,`${t} ${u}`.trim()),am=(r,e,t)=>{for(let s=0;s<r.length;s++)if(!r[s].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let s=0;s<r.length;s++)if(F(r[s].semver),r[s].semver!==Wn.ANY&&r[s].semver.prerelease.length>0){let n=r[s].semver;if(n.major===e.major&&n.minor===e.minor&&n.patch===e.patch)return!0}return!1}return!0}});var gr=h((gb,Zu)=>{"use strict";var vr=Symbol("SemVer ANY"),Hn=class r{static get ANY(){return vr}constructor(e,t){if(t=Gu(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),Xn("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===vr?this.value="":this.value=this.operator+this.semver.version,Xn("comp",this)}parse(e){let t=this.options.loose?Xu[Hu.COMPARATORLOOSE]:Xu[Hu.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=s[1]!==void 0?s[1]:"",this.operator==="="&&(this.operator=""),s[2]?this.semver=new zu(s[2],this.options.loose):this.semver=vr}toString(){return this.value}test(e){if(Xn("Comparator.test",e,this.options.loose),this.semver===vr||e===vr)return!0;if(typeof e=="string")try{e=new zu(e,this.options)}catch{return!1}return Gn(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new Ku(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new Ku(this.value,t).test(e.semver):(t=Gu(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||Gn(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||Gn(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Zu.exports=Hn;var Gu=ls(),{safeRe:Xu,t:Hu}=Nt(),Gn=jn(),Xn=hr(),zu=re(),Ku=pe()});var _r=h((vb,Yu)=>{"use strict";var om=pe(),um=(r,e,t)=>{try{e=new om(e,t)}catch{return!1}return e.test(r)};Yu.exports=um});var Qu=h((_b,Ju)=>{"use strict";var cm=pe(),lm=(r,e)=>new cm(r,e).set.map(t=>t.map(s=>s.value).join(" ").trim().split(" "));Ju.exports=lm});var tc=h((yb,ec)=>{"use strict";var dm=re(),fm=pe(),pm=(r,e,t)=>{let s=null,n=null,i=null;try{i=new fm(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===-1)&&(s=a,n=new dm(s,t))}),s};ec.exports=pm});var sc=h((Eb,rc)=>{"use strict";var hm=re(),mm=pe(),gm=(r,e,t)=>{let s=null,n=null,i=null;try{i=new mm(e,t)}catch{return null}return r.forEach(a=>{i.test(a)&&(!s||n.compare(a)===1)&&(s=a,n=new hm(s,t))}),s};rc.exports=gm});var ac=h((Sb,ic)=>{"use strict";var zn=re(),vm=pe(),nc=mr(),_m=(r,e)=>{r=new vm(r,e);let t=new zn("0.0.0");if(r.test(t)||(t=new zn("0.0.0-0"),r.test(t)))return t;t=null;for(let s=0;s<r.set.length;++s){let n=r.set[s],i=null;n.forEach(a=>{let o=new zn(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!i||nc(o,i))&&(i=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),i&&(!t||nc(t,i))&&(t=i)}return t&&r.test(t)?t:null};ic.exports=_m});var uc=h((bb,oc)=>{"use strict";var ym=pe(),Em=(r,e)=>{try{return new ym(r,e).range||"*"}catch{return null}};oc.exports=Em});var Ss=h((Tb,fc)=>{"use strict";var Sm=re(),dc=gr(),{ANY:bm}=dc,Tm=pe(),xm=_r(),cc=mr(),lc=gs(),Am=_s(),Rm=vs(),wm=(r,e,t,s)=>{r=new Sm(r,s),e=new Tm(e,s);let n,i,a,o,u;switch(t){case">":n=cc,i=Am,a=lc,o=">",u=">=";break;case"<":n=lc,i=Rm,a=cc,o="<",u="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(xm(r,e,s))return!1;for(let c=0;c<e.set.length;++c){let l=e.set[c],d=null,E=null;if(l.forEach(f=>{f.semver===bm&&(f=new dc(">=0.0.0")),d=d||f,E=E||f,n(f.semver,d.semver,s)?d=f:a(f.semver,E.semver,s)&&(E=f)}),d.operator===o||d.operator===u||(!E.operator||E.operator===o)&&i(r,E.semver))return!1;if(E.operator===u&&a(r,E.semver))return!1}return!0};fc.exports=wm});var hc=h((xb,pc)=>{"use strict";var Cm=Ss(),Im=(r,e,t)=>Cm(r,e,">",t);pc.exports=Im});var gc=h((Ab,mc)=>{"use strict";var Lm=Ss(),Om=(r,e,t)=>Lm(r,e,"<",t);mc.exports=Om});var yc=h((Rb,_c)=>{"use strict";var vc=pe(),Nm=(r,e,t)=>(r=new vc(r,t),e=new vc(e,t),r.intersects(e,t));_c.exports=Nm});var Sc=h((wb,Ec)=>{"use strict";var km=_r(),qm=fe();Ec.exports=(r,e,t)=>{let s=[],n=null,i=null,a=r.sort((l,d)=>qm(l,d,t));for(let l of a)km(l,e,t)?(i=l,n||(n=l)):(i&&s.push([n,i]),i=null,n=null);n&&s.push([n,null]);let o=[];for(let[l,d]of s)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);let u=o.join(" || "),c=typeof e.raw=="string"?e.raw:String(e);return u.length<c.length?u:e}});var wc=h((Cb,Rc)=>{"use strict";var bc=pe(),Zn=gr(),{ANY:Kn}=Zn,yr=_r(),Yn=fe(),$m=(r,e,t={})=>{if(r===e)return!0;r=new bc(r,t),e=new bc(e,t);let s=!1;e:for(let n of r.set){for(let i of e.set){let a=Dm(n,i,t);if(s=s||a!==null,a)continue e}if(s)return!1}return!0},Pm=[new Zn(">=0.0.0-0")],Tc=[new Zn(">=0.0.0")],Dm=(r,e,t)=>{if(r===e)return!0;if(r.length===1&&r[0].semver===Kn){if(e.length===1&&e[0].semver===Kn)return!0;t.includePrerelease?r=Pm:r=Tc}if(e.length===1&&e[0].semver===Kn){if(t.includePrerelease)return!0;e=Tc}let s=new Set,n,i;for(let f of r)f.operator===">"||f.operator===">="?n=xc(n,f,t):f.operator==="<"||f.operator==="<="?i=Ac(i,f,t):s.add(f.semver);if(s.size>1)return null;let a;if(n&&i){if(a=Yn(n.semver,i.semver,t),a>0)return null;if(a===0&&(n.operator!==">="||i.operator!=="<="))return null}for(let f of s){if(n&&!yr(f,String(n),t)||i&&!yr(f,String(i),t))return null;for(let N of e)if(!yr(f,String(N),t))return!1;return!0}let o,u,c,l,d=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1,E=n&&!t.includePrerelease&&n.semver.prerelease.length?n.semver:!1;d&&d.prerelease.length===1&&i.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(let f of e){if(l=l||f.operator===">"||f.operator===">=",c=c||f.operator==="<"||f.operator==="<=",n){if(E&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===E.major&&f.semver.minor===E.minor&&f.semver.patch===E.patch&&(E=!1),f.operator===">"||f.operator===">="){if(o=xc(n,f,t),o===f&&o!==n)return!1}else if(n.operator===">="&&!yr(n.semver,String(f),t))return!1}if(i){if(d&&f.semver.prerelease&&f.semver.prerelease.length&&f.semver.major===d.major&&f.semver.minor===d.minor&&f.semver.patch===d.patch&&(d=!1),f.operator==="<"||f.operator==="<="){if(u=Ac(i,f,t),u===f&&u!==i)return!1}else if(i.operator==="<="&&!yr(i.semver,String(f),t))return!1}if(!f.operator&&(i||n)&&a!==0)return!1}return!(n&&c&&!i&&a!==0||i&&l&&!n&&a!==0||E||d)},xc=(r,e,t)=>{if(!r)return e;let s=Yn(r.semver,e.semver,t);return s>0?r:s<0||e.operator===">"&&r.operator===">="?e:r},Ac=(r,e,t)=>{if(!r)return e;let s=Yn(r.semver,e.semver,t);return s<0?r:s>0||e.operator==="<"&&r.operator==="<="?e:r};Rc.exports=$m});var Oc=h((Ib,Lc)=>{"use strict";var Jn=Nt(),Cc=pr(),Mm=re(),Ic=Pn(),Fm=it(),Bm=tu(),jm=su(),Um=au(),Vm=cu(),Wm=du(),Gm=pu(),Xm=mu(),Hm=vu(),zm=fe(),Km=Su(),Zm=Tu(),Ym=ms(),Jm=wu(),Qm=Iu(),eg=mr(),tg=gs(),rg=Fn(),sg=Bn(),ng=vs(),ig=_s(),ag=jn(),og=Mu(),ug=gr(),cg=pe(),lg=_r(),dg=Qu(),fg=tc(),pg=sc(),hg=ac(),mg=uc(),gg=Ss(),vg=hc(),_g=gc(),yg=yc(),Eg=Sc(),Sg=wc();Lc.exports={parse:Fm,valid:Bm,clean:jm,inc:Um,diff:Vm,major:Wm,minor:Gm,patch:Xm,prerelease:Hm,compare:zm,rcompare:Km,compareLoose:Zm,compareBuild:Ym,sort:Jm,rsort:Qm,gt:eg,lt:tg,eq:rg,neq:sg,gte:ng,lte:ig,cmp:ag,coerce:og,Comparator:ug,Range:cg,satisfies:lg,toComparators:dg,maxSatisfying:fg,minSatisfying:pg,minVersion:hg,validRange:mg,outside:gg,gtr:vg,ltr:_g,intersects:yg,simplifyRange:Eg,subset:Sg,SemVer:Mm,re:Jn.re,src:Jn.src,tokens:Jn.t,SEMVER_SPEC_VERSION:Cc.SEMVER_SPEC_VERSION,RELEASE_TYPES:Cc.RELEASE_TYPES,compareIdentifiers:Ic.compareIdentifiers,rcompareIdentifiers:Ic.rcompareIdentifiers}});var ei=h((Lb,Qn)=>{"use strict";var bg=Oc(),Tg=dr(),kt=Ze(),Nc=ee(),kc=V(),qc="2.7.15",xg=function(){return!1},Ag=function(e){if(!bg.gte(e.VERSION,qc))throw new Error("AWS SDK version "+qc+" or greater required.");for(var t in e)if(e[t].serviceIdentifier){var s=e[t];s.prototype.customizeRequests($c)}return e},Rg=function(e){return e.customizeRequests($c),e};function $c(r){var e=kt.resolveSegment(kt.resolveManualSegmentParams(r.params));if(!e){var t=this.serviceIdentifier+"."+r.operation;return kt.isAutomaticMode()?kc.getLogger().info("Call "+t+" is missing the sub/segment context for automatic mode. Ignoring."):kc.getLogger().info("Call "+t+' requires a segment object on the request params as "XRaySegment" for tracing in manual mode. Ignoring.'),r}var s=this.throttledError||xg,n=new Error().stack;let i;e.notTraced?i=e.addNewSubsegmentWithoutSampling(this.serviceIdentifier):i=e.addNewSubsegment(this.serviceIdentifier);var a=e.segment?e.segment.trace_id:e.trace_id;let o=e.segment?e.segment.additionalTraceData:e.additionalTraceData;var u=function(l){if(e.noOp)return;let d="Root="+a+";Parent="+i.id+";Sampled="+(i.notTraced?"0":"1");if(o!=null)for(let[E,f]of Object.entries(o))d+=";"+E+"="+f;l.httpRequest.headers["X-Amzn-Trace-Id"]=d},c=function(l){i.addAttribute("namespace","aws"),i.addAttribute("aws",new Tg(l,i.name));var d=l.httpResponse;if(d&&(i.addAttribute("http",new Pc(d)),(d.statusCode===429||l.error&&s(l.error))&&i.addThrottleFlag()),l.error){var E={message:l.error.message,name:l.error.code,stack:n};d&&d.statusCode?(Nc.getCauseTypeFromHttpStatus(d.statusCode)=="error"&&i.addErrorFlag(),i.close(E,!0)):i.close(E)}else{if(d&&d.statusCode){var f=Nc.getCauseTypeFromHttpStatus(d.statusCode);f&&(i[f]=!0)}i.close()}};r.on("beforePresign",function(l){e.removeSubsegment(i),e.decrementCounter(),l.removeListener("build",u),l.removeListener("complete",c)}),r.on("build",u).on("complete",c),r.__send||(r.__send=r.send,r.send=function(l){if(kt.isAutomaticMode()){var d=kt.getNamespace();d.run(function(){kt.setSegment(i),r.__send(l)})}else r.__send(l)})}function Pc(r){this.init(r)}Pc.prototype.init=function(e){this.response={status:e.statusCode||""},e.headers&&e.headers["content-length"]&&(this.response.content_length=e.headers["content-length"])};Qn.exports.captureAWSClient=Rg;Qn.exports.captureAWS=Ag});var jc=h((Ob,Bc)=>{var bs=Object.defineProperty,wg=Object.getOwnPropertyDescriptor,Cg=Object.getOwnPropertyNames,Ig=Object.prototype.hasOwnProperty,qt=(r,e)=>bs(r,"name",{value:e,configurable:!0}),Lg=(r,e)=>{for(var t in e)bs(r,t,{get:e[t],enumerable:!0})},Og=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of Cg(e))!Ig.call(r,n)&&n!==t&&bs(r,n,{get:()=>e[n],enumerable:!(s=wg(e,n))||s.enumerable});return r},Ng=r=>Og(bs({},"__esModule",{value:!0}),r),Dc={};Lg(Dc,{isClockSkewCorrectedError:()=>Mc,isClockSkewError:()=>Fg,isRetryableByTrait:()=>Mg,isServerError:()=>jg,isThrottlingError:()=>Bg,isTransientError:()=>Fc});Bc.exports=Ng(Dc);var kg=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],qg=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],$g=["TimeoutError","RequestTimeout","RequestTimeoutException"],Pg=[500,502,503,504],Dg=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],Mg=qt(r=>r.$retryable!==void 0,"isRetryableByTrait"),Fg=qt(r=>kg.includes(r.name),"isClockSkewError"),Mc=qt(r=>{var e;return(e=r.$metadata)==null?void 0:e.clockSkewCorrected},"isClockSkewCorrectedError"),Bg=qt(r=>{var e,t;return((e=r.$metadata)==null?void 0:e.httpStatusCode)===429||qg.includes(r.name)||((t=r.$retryable)==null?void 0:t.throttling)==!0},"isThrottlingError"),Fc=qt(r=>{var e;return Mc(r)||$g.includes(r.name)||Dg.includes(r?.code||"")||Pg.includes(((e=r.$metadata)==null?void 0:e.httpStatusCode)||0)},"isTransientError"),jg=qt(r=>{var e;if(((e=r.$metadata)==null?void 0:e.httpStatusCode)!==void 0){let t=r.$metadata.httpStatusCode;return 500<=t&&t<=599&&!Fc(r)}return!1},"isServerError")});var Hc=h($t=>{"use strict";var Gc=$t&&$t.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty($t,"__esModule",{value:!0});$t.captureAWSClient=void 0;var Ug=jc(),Vg=Gc(dr()),Wg=require("querystring"),Gg=Gc(ar()),ti=Ze(),Uc=V(),{safeParseInt:Ts}=ee(),Xg=ee(),Xc="XRaySDKInstrumentation",Vc=async(r,e,t,s,n,i)=>{var a,o,u;let{extendedRequestId:c,requestId:l,httpStatusCode:d,attempts:E}=((a=n?.output)===null||a===void 0?void 0:a.$metadata)||i?.$metadata,f=new Vg.default({extendedRequestId:c,requestId:l,retryCount:E,data:n?.output,request:{operation:e,params:s,httpRequest:{region:t,statusCode:d}}},r),N={};return d&&(N.response={},N.response.status=d),!((o=n?.response)===null||o===void 0)&&o.headers&&((u=n?.response)===null||u===void 0?void 0:u.headers["content-length"])!==void 0&&(N.response||(N.response={}),N.response.content_length=Ts(n.response.headers["content-length"])),[f,N]};function Wc(r,e,t){var s,n,i;(t&&(0,Ug.isThrottlingError)(t)||Ts((s=r.response)===null||s===void 0?void 0:s.status)===429||Ts((n=t?.$metadata)===null||n===void 0?void 0:n.httpStatusCode)===429)&&e.addThrottleFlag();let a=(0,Xg.getCauseTypeFromHttpStatus)(Ts((i=r.response)===null||i===void 0?void 0:i.status));a==="fault"?e.addFaultFlag():a==="error"&&e.addErrorFlag()}var Hg=(r,e)=>(t,s)=>async n=>{var i;let a=ti.isAutomaticMode()?ti.resolveSegment():e,{clientName:o,commandName:u}=s,c=(i=n?.input)!==null&&i!==void 0?i:{},l=u.slice(0,-7),d=l.charAt(0).toLowerCase()+l.slice(1),E=o.slice(0,-6);if(!a){let Q=E+"."+d;return ti.isAutomaticMode()?Uc.getLogger().info("Call "+Q+" is missing the sub/segment context for automatic mode. Ignoring."):Uc.getLogger().info("Call "+Q+" requires a segment object passed to captureAWSv3Client for tracing in manual mode. Ignoring."),t(n)}let f;a.notTraced?f=a.addNewSubsegmentWithoutSampling(E):f=a.addNewSubsegment(E),f.addAttribute("namespace","aws");let N=a instanceof Gg.default?a.segment:a,$=N.segment?N.segment.additionalTraceData:N.additionalTraceData,rt=(0,Wg.stringify)({Root:N.trace_id,Parent:f.id,Sampled:f.notTraced?"0":"1"},";");if($!=null)for(let[Q,Ie]of Object.entries($))rt+=";"+Q+"="+Ie;a.noOp||(n.request.headers["X-Amzn-Trace-Id"]=rt);let Ce;try{if(Ce=await t(n),!Ce)throw new Error("Failed to get response from instrumented AWS Client.");let[Q,Ie]=await Vc(E,d,await r.region(),c,Ce,null);return f.addAttribute("aws",Q),f.addAttribute("http",Ie),Wc(Ie,f),f.close(),Ce}catch(Q){if(Q.$metadata){let[G,ve]=await Vc(E,d,await r.region(),c,null,Q);f.addAttribute("aws",G),f.addAttribute("http",ve),Wc(ve,f,Q)}let Ie={message:Q.message,name:Q.name,stack:Q.stack||new Error().stack};throw f.close(Ie,!0),Q}},zg={name:Xc,step:"build"},Kg=(r,e)=>({applyToStack:t=>{t.add(Hg(r,e),zg)}});function Zg(r,e){return r.middlewareStack.remove(Xc),r.middlewareStack.use(Kg(r.config,e)),r}$t.captureAWSClient=Zg});var si=h((kb,ri)=>{"use strict";var zc=require("url"),Pt=Ze(),xs=ee(),Kc=V(),Yg=require("events"),Jg=function(e,t,s){e.__request||Zc(e,t,s)},Qg=function(e,t,s){if(e.__request)return e;var n={};return Object.keys(e).forEach(function(i){n[i]=e[i]}),Zc(n,t,s),n};function Zc(r,e,t){function s(a,...o){let u,c,l,d,E=o[0];if(typeof o[1]=="object"?(l=!0,d=typeof E=="string"?new zc.URL(E):E,u=o[1],c=o[2]):(l=!1,u=E,c=o[1]),!u||u.headers&&u.headers["X-Amzn-Trace-Id"])return a(...o);typeof u=="string"&&(u=new zc.URL(u)),l||(d=u);let f=Pt.resolveSegment(Pt.resolveManualSegmentParams(u)),N=u.hostname||u.host||d.hostname||d.host||"Unknown host";if(!f){let G="[ host: "+N;return G=u.method?G+", method: "+u.method:G,G+=", path: "+(d.pathname||xs.stripQueryStringFromPath(u.path))+" ]",Pt.isAutomaticMode()?Kc.getLogger().info("Options for request "+G+" is missing the sub/segment context for automatic mode. Ignoring."):Kc.getLogger().info("Options for request "+G+' requires a segment object on the options params as "XRaySegment" for tracing in manual mode. Ignoring.'),a(...o)}let $;f.notTraced?$=f.addNewSubsegmentWithoutSampling(N):$=f.addNewSubsegment(N);let rt=f.segment?f.segment:f;$.namespace="remote",u.headers||(u.headers={}),f.noOp||(u.headers["X-Amzn-Trace-Id"]="Root="+rt.trace_id+";Parent="+$.id+";Sampled="+($.notTraced?"0":"1"));let Ce=function(ve){if(t&&t($,this,null,ve),$.http&&$.http.response)xs.getCauseTypeFromHttpStatus($.http.response.status)==="error"&&$.addErrorFlag(),$.close(ve,!0);else{let Ed=ve.code!=="ECONNREFUSED";$.addRemoteRequestData(this,null,Ed&&e),$.close(ve)}},Q=xs.objectWithoutProperties(u,["Segment"],!0),Ie=a(...l?[E,Q]:[u],function(G){G.on("end",function(){t&&t($,this.req,G),G.statusCode===429&&$.addThrottleFlag();let ve=xs.getCauseTypeFromHttpStatus(G.statusCode);ve&&($[ve]=!0),$.addRemoteRequestData(G.req,G,!!e),$.close()}),typeof c=="function"?Pt.isAutomaticMode()?Pt.getNamespace().run(function(){Pt.setSegment($),c(G)}):c(G):G.req&&G.req.listenerCount("response")===0&&G.resume()});return Ie.on(Yg.errorMonitor||"error",Ce),Ie}r.__request=r.request;function n(...a){return s(r.__request,...a)}r.__get=r.get;function i(...a){return s(r.__get,...a)}Object.defineProperties(r,{request:{value:n,configurable:!0,enumerable:!0,writable:!0},get:{value:i,configurable:!0,enumerable:!0,writable:!0}})}ri.exports.captureHTTPsGlobal=Jg;ri.exports.captureHTTPs=Qg});var el=h((qb,ni)=>{"use strict";var Er=Ze(),As=Symbol("original then"),Rs=Symbol("original catch");function Jc(r){let e=r.prototype.then;e[As]||(r.prototype.then=function(s,n){if(Er.isAutomaticMode()&&Yc()){let i=Er.getNamespace();s=s&&i.bind(s),n=n&&i.bind(n)}return e.call(this,s,n)},r.prototype.then[As]=e);let t=r.prototype.catch;t&&!t[Rs]&&(r.prototype.catch=function(s){if(Er.isAutomaticMode()&&Yc()){let n=Er.getNamespace();s=s&&n.bind(s)}return t.call(this,s)},r.prototype.catch[Rs]=t)}function ev(r){let e=r.prototype.then;e[As]&&(r.prototype.then=e[As]);let t=r.prototype.catch;t&&t[Rs]&&(r.prototype.catch=t[Rs])}function Yc(){try{return Er.getSegment()}catch{return}}function Qc(){Jc(Promise)}function tv(){ev(Promise)}Qc.patchThirdPartyPromise=Jc;ni.exports.capturePromise=Qc;ni.exports.uncapturePromise=tv});var sl=h(($b,rl)=>{"use strict";function tl(r,e,t,s,n){this.init(r,e,t,s,n)}tl.prototype.init=function(e,t,s,n,i){e&&(this.database_version=e),t&&(this.driver_version=t),i&&(this.preparation=i),this.url=n,this.user=s};rl.exports=tl});var al=h((Pb,il)=>{"use strict";var $e=Ze(),ii=V(),Dt=He(),rv=ee(),sv=yo(),br={};try{br=Eo()}catch(r){ii.getLogger().debug("Failed to load SDK data:",r)}var Sr="unknown",nl={plugins:{EC2Plugin:Co(),ECSPlugin:Lo(),ElasticBeanstalkPlugin:No()},config:function(r){var e={};r.forEach(function(t){t.getData(function(s){if(s)for(var n in s)e[n]=s[n]}),Dt.setOrigin(t.originName),Dt.setPluginData(e)})},setAWSWhitelist:dr().setAWSWhitelist,appendAWSWhitelist:dr().appendAWSWhitelist,setStreamingThreshold:Dt.setStreamingThreshold,setLogger:ii.setLogger,getLogger:ii.getLogger,setDaemonAddress:Wr().setDaemonAddress,captureFunc:cs().captureFunc,captureAsyncFunc:cs().captureAsyncFunc,captureCallbackFunc:cs().captureCallbackFunc,captureAWS:ei().captureAWS,captureAWSClient:ei().captureAWSClient,captureAWSv3Client:Hc().captureAWSClient,captureHTTPs:si().captureHTTPs,captureHTTPsGlobal:si().captureHTTPsGlobal,capturePromise:el().capturePromise,utils:rv,database:{SqlData:sl()},middleware:xn(),getNamespace:$e.getNamespace,resolveSegment:$e.resolveSegment,resolveManualSegmentParams:$e.resolveManualSegmentParams,getSegment:$e.getSegment,setSegment:$e.setSegment,isAutomaticMode:$e.isAutomaticMode,enableAutomaticMode:$e.enableAutomaticMode,enableManualMode:$e.enableManualMode,setContextMissingStrategy:$e.setContextMissingStrategy,Segment:or(),Subsegment:ar(),SegmentUtils:Dt};nl.middleware.IncomingRequestData=pn(),function(){var r={runtime:process.release&&process.release.name?process.release.name:Sr,runtime_version:process.version,version:process.env.npm_package_version||Sr,name:process.env.npm_package_name||Sr},e={sdk:"X-Ray for Node.js",sdk_version:br.version?br.version:Sr,package:br.name?br.name:Sr};Dt.setSDKData(e),Dt.setServiceData(r),process.env.LAMBDA_TASK_ROOT&&sv.init()}();il.exports=nl});var ai=h((Db,ol)=>{"use strict";ol.exports=al()});var Ai=h((Ir,Xt)=>{var w_=200,Wl="__lodash_hash_undefined__",C_=800,I_=16,Gl=9007199254740991,Xl="[object Arguments]",L_="[object Array]",O_="[object AsyncFunction]",N_="[object Boolean]",k_="[object Date]",q_="[object Error]",Hl="[object Function]",$_="[object GeneratorFunction]",P_="[object Map]",D_="[object Number]",M_="[object Null]",zl="[object Object]",F_="[object Proxy]",B_="[object RegExp]",j_="[object Set]",U_="[object String]",V_="[object Undefined]",W_="[object WeakMap]",G_="[object ArrayBuffer]",X_="[object DataView]",H_="[object Float32Array]",z_="[object Float64Array]",K_="[object Int8Array]",Z_="[object Int16Array]",Y_="[object Int32Array]",J_="[object Uint8Array]",Q_="[object Uint8ClampedArray]",ey="[object Uint16Array]",ty="[object Uint32Array]",ry=/[\\^$.*+?()[\]{}|]/g,sy=/^\[object .+?Constructor\]$/,ny=/^(?:0|[1-9]\d*)$/,B={};B[H_]=B[z_]=B[K_]=B[Z_]=B[Y_]=B[J_]=B[Q_]=B[ey]=B[ty]=!0;B[Xl]=B[L_]=B[G_]=B[N_]=B[X_]=B[k_]=B[q_]=B[Hl]=B[P_]=B[D_]=B[zl]=B[B_]=B[j_]=B[U_]=B[W_]=!1;var Kl=typeof global=="object"&&global&&global.Object===Object&&global,iy=typeof self=="object"&&self&&self.Object===Object&&self,Nr=Kl||iy||Function("return this")(),Zl=typeof Ir=="object"&&Ir&&!Ir.nodeType&&Ir,Lr=Zl&&typeof Xt=="object"&&Xt&&!Xt.nodeType&&Xt,Yl=Lr&&Lr.exports===Zl,mi=Yl&&Kl.process,$l=function(){try{var r=Lr&&Lr.require&&Lr.require("util").types;return r||mi&&mi.binding&&mi.binding("util")}catch{}}(),Pl=$l&&$l.isTypedArray;function ay(r,e,t){switch(t.length){case 0:return r.call(e);case 1:return r.call(e,t[0]);case 2:return r.call(e,t[0],t[1]);case 3:return r.call(e,t[0],t[1],t[2])}return r.apply(e,t)}function oy(r,e){for(var t=-1,s=Array(r);++t<r;)s[t]=e(t);return s}function uy(r){return function(e){return r(e)}}function cy(r,e){return r?.[e]}function ly(r,e){return function(t){return r(e(t))}}var dy=Array.prototype,fy=Function.prototype,js=Object.prototype,gi=Nr["__core-js_shared__"],Us=fy.toString,je=js.hasOwnProperty,Dl=function(){var r=/[^.]+$/.exec(gi&&gi.keys&&gi.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}(),Jl=js.toString,py=Us.call(Object),hy=RegExp("^"+Us.call(je).replace(ry,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Fs=Yl?Nr.Buffer:void 0,Ml=Nr.Symbol,Fl=Nr.Uint8Array,Bl=Fs?Fs.allocUnsafe:void 0,Ql=ly(Object.getPrototypeOf,Object),jl=Object.create,my=js.propertyIsEnumerable,gy=dy.splice,bt=Ml?Ml.toStringTag:void 0,Bs=function(){try{var r=bi(Object,"defineProperty");return r({},"",{}),r}catch{}}(),vy=Fs?Fs.isBuffer:void 0,Ul=Math.max,_y=Date.now,ed=bi(Nr,"Map"),Or=bi(Object,"create"),yy=function(){function r(){}return function(e){if(!xt(e))return{};if(jl)return jl(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}();function Tt(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Ey(){this.__data__=Or?Or(null):{},this.size=0}function Sy(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}function by(r){var e=this.__data__;if(Or){var t=e[r];return t===Wl?void 0:t}return je.call(e,r)?e[r]:void 0}function Ty(r){var e=this.__data__;return Or?e[r]!==void 0:je.call(e,r)}function xy(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Or&&e===void 0?Wl:e,this}Tt.prototype.clear=Ey;Tt.prototype.delete=Sy;Tt.prototype.get=by;Tt.prototype.has=Ty;Tt.prototype.set=xy;function Ue(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Ay(){this.__data__=[],this.size=0}function Ry(r){var e=this.__data__,t=Vs(e,r);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():gy.call(e,t,1),--this.size,!0}function wy(r){var e=this.__data__,t=Vs(e,r);return t<0?void 0:e[t][1]}function Cy(r){return Vs(this.__data__,r)>-1}function Iy(r,e){var t=this.__data__,s=Vs(t,r);return s<0?(++this.size,t.push([r,e])):t[s][1]=e,this}Ue.prototype.clear=Ay;Ue.prototype.delete=Ry;Ue.prototype.get=wy;Ue.prototype.has=Cy;Ue.prototype.set=Iy;function Ht(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var s=r[e];this.set(s[0],s[1])}}function Ly(){this.size=0,this.__data__={hash:new Tt,map:new(ed||Ue),string:new Tt}}function Oy(r){var e=Gs(this,r).delete(r);return this.size-=e?1:0,e}function Ny(r){return Gs(this,r).get(r)}function ky(r){return Gs(this,r).has(r)}function qy(r,e){var t=Gs(this,r),s=t.size;return t.set(r,e),this.size+=t.size==s?0:1,this}Ht.prototype.clear=Ly;Ht.prototype.delete=Oy;Ht.prototype.get=Ny;Ht.prototype.has=ky;Ht.prototype.set=qy;function zt(r){var e=this.__data__=new Ue(r);this.size=e.size}function $y(){this.__data__=new Ue,this.size=0}function Py(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}function Dy(r){return this.__data__.get(r)}function My(r){return this.__data__.has(r)}function Fy(r,e){var t=this.__data__;if(t instanceof Ue){var s=t.__data__;if(!ed||s.length<w_-1)return s.push([r,e]),this.size=++t.size,this;t=this.__data__=new Ht(s)}return t.set(r,e),this.size=t.size,this}zt.prototype.clear=$y;zt.prototype.delete=Py;zt.prototype.get=Dy;zt.prototype.has=My;zt.prototype.set=Fy;function By(r,e){var t=Ei(r),s=!t&&yi(r),n=!t&&!s&&nd(r),i=!t&&!s&&!n&&ad(r),a=t||s||n||i,o=a?oy(r.length,String):[],u=o.length;for(var c in r)(e||je.call(r,c))&&!(a&&(c=="length"||n&&(c=="offset"||c=="parent")||i&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||rd(c,u)))&&o.push(c);return o}function vi(r,e,t){(t!==void 0&&!Xs(r[e],t)||t===void 0&&!(e in r))&&Si(r,e,t)}function jy(r,e,t){var s=r[e];(!(je.call(r,e)&&Xs(s,t))||t===void 0&&!(e in r))&&Si(r,e,t)}function Vs(r,e){for(var t=r.length;t--;)if(Xs(r[t][0],e))return t;return-1}function Si(r,e,t){e=="__proto__"&&Bs?Bs(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var Uy=tE();function Ws(r){return r==null?r===void 0?V_:M_:bt&&bt in Object(r)?rE(r):uE(r)}function Vl(r){return kr(r)&&Ws(r)==Xl}function Vy(r){if(!xt(r)||aE(r))return!1;var e=xi(r)?hy:sy;return e.test(fE(r))}function Wy(r){return kr(r)&&id(r.length)&&!!B[Ws(r)]}function Gy(r){if(!xt(r))return oE(r);var e=sd(r),t=[];for(var s in r)s=="constructor"&&(e||!je.call(r,s))||t.push(s);return t}function td(r,e,t,s,n){r!==e&&Uy(e,function(i,a){if(n||(n=new zt),xt(i))Xy(r,e,a,t,td,s,n);else{var o=s?s(_i(r,a),i,a+"",r,e,n):void 0;o===void 0&&(o=i),vi(r,a,o)}},od)}function Xy(r,e,t,s,n,i,a){var o=_i(r,t),u=_i(e,t),c=a.get(u);if(c){vi(r,t,c);return}var l=i?i(o,u,t+"",r,e,a):void 0,d=l===void 0;if(d){var E=Ei(u),f=!E&&nd(u),N=!E&&!f&&ad(u);l=u,E||f||N?Ei(o)?l=o:pE(o)?l=Jy(o):f?(d=!1,l=Ky(u,!0)):N?(d=!1,l=Yy(u,!0)):l=[]:hE(u)||yi(u)?(l=o,yi(o)?l=mE(o):(!xt(o)||xi(o))&&(l=sE(u))):d=!1}d&&(a.set(u,l),n(l,u,s,i,a),a.delete(u)),vi(r,t,l)}function Hy(r,e){return lE(cE(r,e,ud),r+"")}var zy=Bs?function(r,e){return Bs(r,"toString",{configurable:!0,enumerable:!1,value:vE(e),writable:!0})}:ud;function Ky(r,e){if(e)return r.slice();var t=r.length,s=Bl?Bl(t):new r.constructor(t);return r.copy(s),s}function Zy(r){var e=new r.constructor(r.byteLength);return new Fl(e).set(new Fl(r)),e}function Yy(r,e){var t=e?Zy(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}function Jy(r,e){var t=-1,s=r.length;for(e||(e=Array(s));++t<s;)e[t]=r[t];return e}function Qy(r,e,t,s){var n=!t;t||(t={});for(var i=-1,a=e.length;++i<a;){var o=e[i],u=s?s(t[o],r[o],o,t,r):void 0;u===void 0&&(u=r[o]),n?Si(t,o,u):jy(t,o,u)}return t}function eE(r){return Hy(function(e,t){var s=-1,n=t.length,i=n>1?t[n-1]:void 0,a=n>2?t[2]:void 0;for(i=r.length>3&&typeof i=="function"?(n--,i):void 0,a&&nE(t[0],t[1],a)&&(i=n<3?void 0:i,n=1),e=Object(e);++s<n;){var o=t[s];o&&r(e,o,s,i)}return e})}function tE(r){return function(e,t,s){for(var n=-1,i=Object(e),a=s(e),o=a.length;o--;){var u=a[r?o:++n];if(t(i[u],u,i)===!1)break}return e}}function Gs(r,e){var t=r.__data__;return iE(e)?t[typeof e=="string"?"string":"hash"]:t.map}function bi(r,e){var t=cy(r,e);return Vy(t)?t:void 0}function rE(r){var e=je.call(r,bt),t=r[bt];try{r[bt]=void 0;var s=!0}catch{}var n=Jl.call(r);return s&&(e?r[bt]=t:delete r[bt]),n}function sE(r){return typeof r.constructor=="function"&&!sd(r)?yy(Ql(r)):{}}function rd(r,e){var t=typeof r;return e=e??Gl,!!e&&(t=="number"||t!="symbol"&&ny.test(r))&&r>-1&&r%1==0&&r<e}function nE(r,e,t){if(!xt(t))return!1;var s=typeof e;return(s=="number"?Ti(t)&&rd(e,t.length):s=="string"&&e in t)?Xs(t[e],r):!1}function iE(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}function aE(r){return!!Dl&&Dl in r}function sd(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||js;return r===t}function oE(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}function uE(r){return Jl.call(r)}function cE(r,e,t){return e=Ul(e===void 0?r.length-1:e,0),function(){for(var s=arguments,n=-1,i=Ul(s.length-e,0),a=Array(i);++n<i;)a[n]=s[e+n];n=-1;for(var o=Array(e+1);++n<e;)o[n]=s[n];return o[e]=t(a),ay(r,this,o)}}function _i(r,e){if(!(e==="constructor"&&typeof r[e]=="function")&&e!="__proto__")return r[e]}var lE=dE(zy);function dE(r){var e=0,t=0;return function(){var s=_y(),n=I_-(s-t);if(t=s,n>0){if(++e>=C_)return arguments[0]}else e=0;return r.apply(void 0,arguments)}}function fE(r){if(r!=null){try{return Us.call(r)}catch{}try{return r+""}catch{}}return""}function Xs(r,e){return r===e||r!==r&&e!==e}var yi=Vl(function(){return arguments}())?Vl:function(r){return kr(r)&&je.call(r,"callee")&&!my.call(r,"callee")},Ei=Array.isArray;function Ti(r){return r!=null&&id(r.length)&&!xi(r)}function pE(r){return kr(r)&&Ti(r)}var nd=vy||_E;function xi(r){if(!xt(r))return!1;var e=Ws(r);return e==Hl||e==$_||e==O_||e==F_}function id(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Gl}function xt(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}function kr(r){return r!=null&&typeof r=="object"}function hE(r){if(!kr(r)||Ws(r)!=zl)return!1;var e=Ql(r);if(e===null)return!0;var t=je.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&Us.call(t)==py}var ad=Pl?uy(Pl):Wy;function mE(r){return Qy(r,od(r))}function od(r){return Ti(r)?By(r,!0):Gy(r)}var gE=eE(function(r,e,t){td(r,e,t)});function vE(r){return function(){return r}}function ud(r){return r}function _E(){return!1}Xt.exports=gE});var xE={};ki(xE,{handler:()=>SE});module.exports=wd(xE);var Ys=require("@aws-sdk/client-eventbridge");var Xe="2.28.1";var Qs=process.env.AWS_EXECUTION_ENV||"NA",Cd={relation:"after",toMiddleware:"getUserAgentMiddleware",name:"addPowertoolsToUserAgent",tags:["POWERTOOLS","USER_AGENT"]},$i=r=>typeof r=="object"&&r!==null&&"send"in r&&typeof r.send=="function"&&"config"in r&&r.config!==void 0&&typeof r.config=="object"&&r.config!==null&&"middlewareStack"in r&&r.middlewareStack!==void 0&&typeof r.middlewareStack=="object"&&r.middlewareStack!==null&&"identify"in r.middlewareStack&&typeof r.middlewareStack.identify=="function"&&"addRelativeTo"in r.middlewareStack&&typeof r.middlewareStack.addRelativeTo=="function",Id=r=>e=>async t=>{let s=t.request.headers["user-agent"]||"";if(s.includes("PT/NO-OP")){let n=s.replace("PT/NO-OP",`PT/${r}/${Xe} PTEnv/${Qs}`);return t.request.headers["user-agent"]=n,await e(t)}return s.includes("PT/")?await e(t):(t.request.headers["user-agent"]=s===""?`PT/${r}/${Xe} PTEnv/${Qs}`:`${s} PT/${r}/${Xe} PTEnv/${Qs}`,await e(t))},Ld=r=>{let e=!1;for(let t of r)t.includes("addPowertoolsToUserAgent")&&(e=!0);return e},en=(r,e)=>{try{if($i(r)){if(Ld(r.middlewareStack.identify()))return;r.middlewareStack.addRelativeTo(Id(e),Cd)}else throw new Error("The client provided does not match the expected interface")}catch(t){console.warn("Failed to add user agent middleware",t)}};var Br="powertools-for-aws",Pi=`${Br}.tracer`,Di=`${Br}.metrics`,Mi=`${Br}.logger`,Fi=`${Br}.idempotency`;var tn=r=>typeof r=="string";var Bi=r=>Object.is(r,null),rn=r=>Bi(r)||Object.is(r,void 0);var Ct,st=class{constructor(){P(this,Ct);C(this,"coldStart",!0);C(this,"defaultServiceName","service_undefined");K(this,Ct,this.getInitializationType()),m(this,Ct)!=="on-demand"&&(this.coldStart=!1)}getInitializationType(){let e=process.env.AWS_LAMBDA_INITIALIZATION_TYPE?.trim();return e==="on-demand"?"on-demand":e==="provisioned-concurrency"?"provisioned-concurrency":"unknown"}getColdStart(){return m(this,Ct)!=="on-demand"?!1:this.coldStart?(this.coldStart=!1,!0):!1}isValidServiceName(e){return typeof e=="string"&&e.trim().length>0}};Ct=new WeakMap;var ji=process.env.AWS_EXECUTION_ENV||"NA";process.env.AWS_SDK_UA_APP_ID?process.env.AWS_SDK_UA_APP_ID=`${process.env.AWS_SDK_UA_APP_ID}/PT/NO-OP/${Xe}/PTEnv/${ji}`:process.env.AWS_SDK_UA_APP_ID=`PT/NO-OP/${Xe}/PTEnv/${ji}`;var Ui="POWERTOOLS_DEV",Vi="POWERTOOLS_SERVICE_NAME",Wi="_X_AMZN_TRACE_ID";var X=({key:r,defaultValue:e,errorMessage:t})=>{let s=process.env[r];if(s===void 0){if(e!==void 0)return e;throw t?new Error(t):new Error(`Environment variable ${r} is required`)}return s.trim()},Gi=({key:r,defaultValue:e,errorMessage:t})=>{let s=X({key:r,defaultValue:String(e),errorMessage:t}),n=Number(s);if(Number.isNaN(n))throw new TypeError(`Environment variable ${r} must be a number`);return n},Od=new Set(["1","y","yes","t","true","on"]),Nd=new Set(["0","n","no","f","false","off"]),sn=({key:r,defaultValue:e,errorMessage:t,extendedParsing:s})=>{let i=X({key:r,defaultValue:String(e),errorMessage:t}).toLowerCase();if(s){if(Od.has(i))return!0;if(Nd.has(i))return!1}if(i!=="true"&&i!=="false")throw new Error(`Environment variable ${r} must be a boolean`);return i==="true"},er=()=>{try{return sn({key:Ui,extendedParsing:!0})}catch{return!1}},Xi=()=>X({key:Vi,defaultValue:""}),Hi=()=>{let r=X({key:Wi,defaultValue:""});if(r==="")return;if(!r.includes("="))return{Root:r};let e={};for(let t of r.split(";")){let[s,n]=t.split("=");e[s]=n}return e},zi=()=>Hi()?.Sampled==="1",Le=()=>Hi()?.Root;var gl=Ge(ai(),1);var pl=Ge(ai(),1),ws=require("diagnostics_channel"),hl=Ge(require("http"),1),ml=Ge(require("https"),1);var oi=require("url"),ul=new TextDecoder,cl=(r,e)=>{let t=-1;for(let s=0;s<r.length;s+=2)if(ul.decode(r[s]).toLowerCase()===e){t=s;break}return t===-1?null:ul.decode(r[t+1])},ui=r=>r!==void 0&&"http"in r&&"parent"in r&&"namespace"in r&&r.namespace==="remote",ll=r=>{if(typeof r.origin=="string")return new oi.URL(`${r.origin}${r.path||""}`);if(r.origin instanceof oi.URL)return r.origin.pathname=r.path||"",r.origin};var{captureAWS:nv,captureAWSClient:iv,captureAWSv3Client:av,captureAsyncFunc:ov,captureFunc:uv,captureHTTPsGlobal:dl,getNamespace:cv,getSegment:lv,setSegment:dv,Segment:fl,setContextMissingStrategy:fv,setDaemonAddress:pv,setLogger:hv}=pl.default,Cs=class{captureAWS(e){return nv(e)}captureAWSClient(e){return iv(e)}captureAWSv3Client(e){return en(e,"tracer"),av(e)}captureAsyncFunc(e,t,s){return ov(e,t)}captureFunc(e,t,s){return uv(e,t)}captureHTTPsGlobal(){dl(hl.default),dl(ml.default)}getNamespace(){return cv()}getSegment(){return lv()}instrumentFetch(){let e=n=>{let{request:i}=n,a=i.method;if(a==="CONNECT")return;let o=this.getSegment(),u=ll(i);if(o&&u){let c=o.addNewSubsegment(u.hostname);c.addAttribute("namespace","remote"),i.addHeader("X-Amzn-Trace-Id",`Root=${Le()};Parent=${c.id};Sampled=${c.notTraced?"0":"1"}`),c.http={request:{url:`${u.protocol}//${u.hostname}${u.pathname}`,method:a}},this.setSegment(c)}},t=n=>{let{response:i}=n,a=this.getSegment();if(ui(a)){let o=i.statusCode,u=cl(i.headers,"content-length");a.http={...a.http,response:{status:o,...u&&{content_length:Number.parseInt(u,10)}}},o===429&&a.addThrottleFlag(),o>=400&&o<500?a.addErrorFlag():o>=500&&o<600&&a.addFaultFlag(),a.close(),this.setSegment(a.parent)}},s=n=>{let{error:i}=n,a=this.getSegment();ui(a)&&(a.addErrorFlag(),i instanceof Error&&a.addError(i,!0),a.close(),this.setSegment(a.parent))};(0,ws.subscribe)("undici:request:create",e),(0,ws.subscribe)("undici:request:headers",t),(0,ws.subscribe)("undici:request:error",s)}putAnnotation(e,t){let s=this.getSegment();if(s===void 0){console.warn("No active segment or subsegment found, skipping annotation");return}if(s instanceof fl){console.warn("You cannot annotate the main segment in a Lambda execution environment");return}s.addAnnotation(e,t)}putMetadata(e,t,s){let n=this.getSegment();if(n===void 0){console.warn("No active segment or subsegment found, skipping metadata addition");return}if(n instanceof fl){console.warn("You cannot add metadata to the main segment in a Lambda execution environment");return}n.addMetadata(e,t,s)}setContextMissingStrategy(e){fv(e)}setDaemonAddress(e){pv(e)}setLogger(e){hv(e)}setSegment(e){dv(e)}};(process.env.AWS_XRAY_CONTEXT_MISSING===""||process.env.AWS_XRAY_CONTEXT_MISSING===void 0)&&(process.env.AWS_XRAY_CONTEXT_MISSING="IGNORE_ERROR");var{Subsegment:mv}=gl.default,H,Is,vl,Tr=class extends st{constructor(t={}){super();P(this,Is);C(this,"provider");C(this,"captureError",!0);C(this,"captureHTTPsRequests",!0);C(this,"captureResponse",!0);C(this,"customConfigService");P(this,H,{awsExecutionEnv:"",samLocal:"",captureError:"",captureHTTPsRequests:"",captureResponse:"",tracingEnabled:"",serviceName:""});C(this,"serviceName");C(this,"tracingEnabled",!0);j(this,Is,vl).call(this),this.setOptions(t),this.provider=new Cs,this.isTracingEnabled()&&this.captureHTTPsRequests&&(this.provider.captureHTTPsGlobal(),this.provider.instrumentFetch()),this.isTracingEnabled()||this.provider.setContextMissingStrategy(()=>({}))}addErrorAsMetadata(t,s){if(!this.isTracingEnabled())return;let n=this.getSegment();if(n!==void 0){if(!this.captureError){n.addErrorFlag();return}n.addError(t,s||!1)}}addResponseAsMetadata(t,s){t===void 0||!this.captureResponse||!this.isTracingEnabled()||this.putMetadata(`${s} response`,t)}addServiceNameAnnotation(){this.isTracingEnabled()&&this.putAnnotation("Service",this.serviceName)}annotateColdStart(){this.isTracingEnabled()&&this.putAnnotation("ColdStart",this.getColdStart())}captureAWS(t){return this.isTracingEnabled()?this.provider.captureAWS(t):t}captureAWSClient(t){if(!this.isTracingEnabled())return t;try{return this.provider.captureAWSClient(t)}catch(s){try{return this.provider.captureAWSClient(t.service),t}catch{throw s}}}captureAWSv3Client(t){return this.isTracingEnabled()?this.provider.captureAWSv3Client(t):t}captureLambdaHandler(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){return o.isTracingEnabled()?o.provider.captureAsyncFunc(`## ${process.env._HANDLER}`,async c=>{o.annotateColdStart(),o.addServiceNameAnnotation();let l;try{l=await a.apply(this,u),(t?.captureResponse??!0)&&o.addResponseAsMetadata(l,process.env._HANDLER)}catch(d){throw o.addErrorAsMetadata(d),d}finally{try{c?.close()}catch(d){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",c?.name,d)}}return l}):a.apply(this,u)},i}}captureMethod(t){return(s,n,i)=>{let a=i.value,o=this;return i.value=function(...u){if(!o.isTracingEnabled())return a.apply(this,[...u]);let c=String(n),l=t?.subSegmentName?t.subSegmentName:`### ${c}`;return o.provider.captureAsyncFunc(l,async d=>{let E;try{E=await a.apply(this,[...u]),(t?.captureResponse??!0)&&o.addResponseAsMetadata(E,c)}catch(f){throw o.addErrorAsMetadata(f),f}finally{try{d?.close()}catch(f){console.warn("Failed to close or serialize segment %s. We are catching the error but data might be lost.",d?.name,f)}}return E})},i}}getRootXrayTraceId(){return Le()}getSegment(){if(!this.isTracingEnabled())return new mv("## Dummy segment");let t=this.provider.getSegment();return t===void 0&&console.warn("Failed to get the current sub/segment from the context, this is likely because you are not using the Tracer in a Lambda function."),t}isTraceSampled(){return this.isTracingEnabled()?zi():!1}isTracingEnabled(){return this.tracingEnabled}putAnnotation(t,s){this.isTracingEnabled()&&this.provider.putAnnotation(t,s)}putMetadata(t,s,n){this.isTracingEnabled()&&this.provider.putMetadata(t,s,n||this.serviceName)}setSegment(t){this.isTracingEnabled()&&this.provider.setSegment(t)}getCustomConfigService(){return this.customConfigService}isAmplifyCli(){return m(this,H).awsExecutionEnv==="AWS_Lambda_amplify-mock"}isLambdaExecutionEnv(){return m(this,H).awsExecutionEnv!==""}isLambdaSamCli(){return m(this,H).samLocal!==""}setCaptureError(){let t=this.getCustomConfigService()?.getTracingCaptureError();if(t!==void 0&&t.toLowerCase()==="false"){this.captureError=!1;return}if(m(this,H).captureError.toLowerCase()==="false"){this.captureError=!1;return}}setCaptureHTTPsRequests(t){if(t!==void 0&&!t){this.captureHTTPsRequests=!1;return}let s=this.getCustomConfigService()?.getCaptureHTTPsRequests();if(s!==void 0&&s.toLowerCase()==="false"){this.captureHTTPsRequests=!1;return}m(this,H).captureHTTPsRequests.toLowerCase()==="false"&&(this.captureHTTPsRequests=!1)}setCaptureResponse(){let t=this.getCustomConfigService()?.getTracingCaptureResponse();if(t!==void 0&&t.toLowerCase()==="false"){this.captureResponse=!1;return}if(m(this,H).captureResponse.toLowerCase()==="false"){this.captureResponse=!1;return}}setCustomConfigService(t){this.customConfigService=t||void 0}setOptions(t){let{enabled:s,serviceName:n,captureHTTPsRequests:i,customConfigService:a}=t;return this.setCustomConfigService(a),this.setTracingEnabled(s),this.setCaptureResponse(),this.setCaptureError(),this.setServiceName(n),this.setCaptureHTTPsRequests(i),this}setServiceName(t){if(t!==void 0&&this.isValidServiceName(t)){this.serviceName=t;return}let s=this.getCustomConfigService()?.getServiceName();if(s!==void 0&&this.isValidServiceName(s)){this.serviceName=s;return}if(m(this,H).serviceName!==void 0&&this.isValidServiceName(m(this,H).serviceName)){this.serviceName=m(this,H).serviceName;return}this.serviceName=this.defaultServiceName}setTracingEnabled(t){if(t!==void 0&&!t){this.tracingEnabled=t;return}let s=this.getCustomConfigService()?.getTracingEnabled();if(s!==void 0&&s.toLowerCase()==="false"){this.tracingEnabled=!1;return}if(m(this,H).tracingEnabled.toLowerCase()==="false"){this.tracingEnabled=!1;return}(this.isAmplifyCli()||this.isLambdaSamCli()||!this.isLambdaExecutionEnv())&&(this.tracingEnabled=!1)}};H=new WeakMap,Is=new WeakSet,vl=function(){m(this,H).awsExecutionEnv=X({key:"AWS_EXECUTION_ENV",defaultValue:""}),m(this,H).samLocal=X({key:"AWS_SAM_LOCAL",defaultValue:""}),m(this,H).captureError=X({key:"POWERTOOLS_TRACER_CAPTURE_ERROR",defaultValue:""}),m(this,H).captureHTTPsRequests=X({key:"POWERTOOLS_TRACER_CAPTURE_HTTPS_REQUESTS",defaultValue:""}),m(this,H).captureResponse=X({key:"POWERTOOLS_TRACER_CAPTURE_RESPONSE",defaultValue:""}),m(this,H).tracingEnabled=X({key:"POWERTOOLS_TRACE_ENABLED",defaultValue:""}),m(this,H).serviceName=Xi()};var Y=[];for(let r=0;r<256;++r)Y.push((r+256).toString(16).slice(1));function _l(r,e=0){return(Y[r[e+0]]+Y[r[e+1]]+Y[r[e+2]]+Y[r[e+3]]+"-"+Y[r[e+4]]+Y[r[e+5]]+"-"+Y[r[e+6]]+Y[r[e+7]]+"-"+Y[r[e+8]]+Y[r[e+9]]+"-"+Y[r[e+10]]+Y[r[e+11]]+Y[r[e+12]]+Y[r[e+13]]+Y[r[e+14]]+Y[r[e+15]]).toLowerCase()}var yl=Ge(require("crypto")),Os=new Uint8Array(256),Ls=Os.length;function ci(){return Ls>Os.length-16&&(yl.default.randomFillSync(Os),Ls=0),Os.slice(Ls,Ls+=16)}var El=Ge(require("crypto")),li={randomUUID:El.default.randomUUID};function gv(r,e,t){if(li.randomUUID&&!e&&!r)return li.randomUUID();r=r||{};let s=r.random||(r.rng||ci)();if(s[6]=s[6]&15|64,s[8]=s[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=s[n];return e}return _l(s)}var xr=gv;var Be={};ki(Be,{BRAND:()=>Uv,DIRTY:()=>at,EMPTY_PATH:()=>Ev,INVALID:()=>b,NEVER:()=>R_,OK:()=>ne,ParseStatus:()=>J,Schema:()=>R,ZodAny:()=>Qe,ZodArray:()=>Fe,ZodBigInt:()=>ut,ZodBoolean:()=>ct,ZodBranded:()=>Rr,ZodCatch:()=>Et,ZodDate:()=>lt,ZodDefault:()=>yt,ZodDiscriminatedUnion:()=>qs,ZodEffects:()=>ge,ZodEnum:()=>vt,ZodError:()=>ue,ZodFirstPartyTypeKind:()=>T,ZodFunction:()=>Ps,ZodIntersection:()=>ht,ZodIssueCode:()=>p,ZodLazy:()=>mt,ZodLiteral:()=>gt,ZodMap:()=>Vt,ZodNaN:()=>Gt,ZodNativeEnum:()=>_t,ZodNever:()=>Ee,ZodNull:()=>ft,ZodNullable:()=>Re,ZodNumber:()=>ot,ZodObject:()=>ce,ZodOptional:()=>he,ZodParsedType:()=>v,ZodPipeline:()=>wr,ZodPromise:()=>et,ZodReadonly:()=>St,ZodRecord:()=>$s,ZodSchema:()=>R,ZodSet:()=>Wt,ZodString:()=>Je,ZodSymbol:()=>jt,ZodTransformer:()=>ge,ZodTuple:()=>Ae,ZodType:()=>R,ZodUndefined:()=>dt,ZodUnion:()=>pt,ZodUnknown:()=>Me,ZodVoid:()=>Ut,addIssueToContext:()=>g,any:()=>Yv,array:()=>t_,bigint:()=>Xv,boolean:()=>Ol,coerce:()=>A_,custom:()=>Cl,date:()=>Hv,datetimeRegex:()=>Rl,defaultErrorMap:()=>Pe,discriminatedUnion:()=>i_,effect:()=>v_,enum:()=>h_,function:()=>d_,getErrorMap:()=>Mt,getParsedType:()=>xe,instanceof:()=>Wv,intersection:()=>a_,isAborted:()=>Ns,isAsync:()=>Ft,isDirty:()=>ks,isValid:()=>Ye,late:()=>Vv,lazy:()=>f_,literal:()=>p_,makeIssue:()=>Ar,map:()=>c_,nan:()=>Gv,nativeEnum:()=>m_,never:()=>Qv,null:()=>Zv,nullable:()=>y_,number:()=>Ll,object:()=>r_,objectUtil:()=>di,oboolean:()=>x_,onumber:()=>T_,optional:()=>__,ostring:()=>b_,pipeline:()=>S_,preprocess:()=>E_,promise:()=>g_,quotelessJson:()=>vv,record:()=>u_,set:()=>l_,setErrorMap:()=>yv,strictObject:()=>s_,string:()=>Il,symbol:()=>zv,transformer:()=>v_,tuple:()=>o_,undefined:()=>Kv,union:()=>n_,unknown:()=>Jv,util:()=>w,void:()=>e_});var w;(function(r){r.assertEqual=n=>{};function e(n){}r.assertIs=e;function t(n){throw new Error}r.assertNever=t,r.arrayToEnum=n=>{let i={};for(let a of n)i[a]=a;return i},r.getValidEnumValues=n=>{let i=r.objectKeys(n).filter(o=>typeof n[n[o]]!="number"),a={};for(let o of i)a[o]=n[o];return r.objectValues(a)},r.objectValues=n=>r.objectKeys(n).map(function(i){return n[i]}),r.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let a in n)Object.prototype.hasOwnProperty.call(n,a)&&i.push(a);return i},r.find=(n,i)=>{for(let a of n)if(i(a))return a},r.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(a=>typeof a=="string"?`'${a}'`:a).join(i)}r.joinValues=s,r.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(w||(w={}));var di;(function(r){r.mergeShapes=(e,t)=>({...e,...t})})(di||(di={}));var v=w.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),xe=r=>{switch(typeof r){case"undefined":return v.undefined;case"string":return v.string;case"number":return Number.isNaN(r)?v.nan:v.number;case"boolean":return v.boolean;case"function":return v.function;case"bigint":return v.bigint;case"symbol":return v.symbol;case"object":return Array.isArray(r)?v.array:r===null?v.null:r.then&&typeof r.then=="function"&&r.catch&&typeof r.catch=="function"?v.promise:typeof Map<"u"&&r instanceof Map?v.map:typeof Set<"u"&&r instanceof Set?v.set:typeof Date<"u"&&r instanceof Date?v.date:v.object;default:return v.unknown}};var p=w.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),vv=r=>JSON.stringify(r,null,2).replace(/"([^"]+)":/g,"$1:"),ue=class r extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let a of i.issues)if(a.code==="invalid_union")a.unionErrors.map(n);else if(a.code==="invalid_return_type")n(a.returnTypeError);else if(a.code==="invalid_arguments")n(a.argumentsError);else if(a.path.length===0)s._errors.push(t(a));else{let o=s,u=0;for(;u<a.path.length;){let c=a.path[u];u===a.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(a))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return n(this),s}static assert(e){if(!(e instanceof r))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,w.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){let t={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];t[i]=t[i]||[],t[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:t}}get formErrors(){return this.flatten()}};ue.create=r=>new ue(r);var _v=(r,e)=>{let t;switch(r.code){case p.invalid_type:r.received===v.undefined?t="Required":t=`Expected ${r.expected}, received ${r.received}`;break;case p.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(r.expected,w.jsonStringifyReplacer)}`;break;case p.unrecognized_keys:t=`Unrecognized key(s) in object: ${w.joinValues(r.keys,", ")}`;break;case p.invalid_union:t="Invalid input";break;case p.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${w.joinValues(r.options)}`;break;case p.invalid_enum_value:t=`Invalid enum value. Expected ${w.joinValues(r.options)}, received '${r.received}'`;break;case p.invalid_arguments:t="Invalid function arguments";break;case p.invalid_return_type:t="Invalid function return type";break;case p.invalid_date:t="Invalid date";break;case p.invalid_string:typeof r.validation=="object"?"includes"in r.validation?(t=`Invalid input: must include "${r.validation.includes}"`,typeof r.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${r.validation.position}`)):"startsWith"in r.validation?t=`Invalid input: must start with "${r.validation.startsWith}"`:"endsWith"in r.validation?t=`Invalid input: must end with "${r.validation.endsWith}"`:w.assertNever(r.validation):r.validation!=="regex"?t=`Invalid ${r.validation}`:t="Invalid";break;case p.too_small:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at least":"more than"} ${r.minimum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at least":"over"} ${r.minimum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="bigint"?t=`Number must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${r.minimum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly equal to ":r.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(r.minimum))}`:t="Invalid input";break;case p.too_big:r.type==="array"?t=`Array must contain ${r.exact?"exactly":r.inclusive?"at most":"less than"} ${r.maximum} element(s)`:r.type==="string"?t=`String must contain ${r.exact?"exactly":r.inclusive?"at most":"under"} ${r.maximum} character(s)`:r.type==="number"?t=`Number must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="bigint"?t=`BigInt must be ${r.exact?"exactly":r.inclusive?"less than or equal to":"less than"} ${r.maximum}`:r.type==="date"?t=`Date must be ${r.exact?"exactly":r.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(r.maximum))}`:t="Invalid input";break;case p.custom:t="Invalid input";break;case p.invalid_intersection_types:t="Intersection results could not be merged";break;case p.not_multiple_of:t=`Number must be a multiple of ${r.multipleOf}`;break;case p.not_finite:t="Number must be finite";break;default:t=e.defaultError,w.assertNever(r)}return{message:t}},Pe=_v;var Sl=Pe;function yv(r){Sl=r}function Mt(){return Sl}var Ar=r=>{let{data:e,path:t,errorMaps:s,issueData:n}=r,i=[...t,...n.path||[]],a={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let o="",u=s.filter(c=>!!c).slice().reverse();for(let c of u)o=c(a,{data:e,defaultError:o}).message;return{...n,path:i,message:o}},Ev=[];function g(r,e){let t=Mt(),s=Ar({issueData:e,data:r.data,path:r.path,errorMaps:[r.common.contextualErrorMap,r.schemaErrorMap,t,t===Pe?void 0:Pe].filter(n=>!!n)});r.common.issues.push(s)}var J=class r{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){let s=[];for(let n of t){if(n.status==="aborted")return b;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,t){let s=[];for(let n of t){let i=await n.key,a=await n.value;s.push({key:i,value:a})}return r.mergeObjectSync(e,s)}static mergeObjectSync(e,t){let s={};for(let n of t){let{key:i,value:a}=n;if(i.status==="aborted"||a.status==="aborted")return b;i.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof a.value<"u"||n.alwaysSet)&&(s[i.value]=a.value)}return{status:e.value,value:s}}},b=Object.freeze({status:"aborted"}),at=r=>({status:"dirty",value:r}),ne=r=>({status:"valid",value:r}),Ns=r=>r.status==="aborted",ks=r=>r.status==="dirty",Ye=r=>r.status==="valid",Ft=r=>typeof Promise<"u"&&r instanceof Promise;var S;(function(r){r.errToObj=e=>typeof e=="string"?{message:e}:e||{},r.toString=e=>typeof e=="string"?e:e?.message})(S||(S={}));var me=class{constructor(e,t,s,n){this._cachedPath=[],this.parent=e,this.data=t,this._path=s,this._key=n}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},bl=(r,e)=>{if(Ye(e))return{success:!0,data:e.value};if(!r.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new ue(r.common.issues);return this._error=t,this._error}}};function A(r){if(!r)return{};let{errorMap:e,invalid_type_error:t,required_error:s,description:n}=r;if(e&&(t||s))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(a,o)=>{let{message:u}=r;return a.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??s??o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:n}}var R=class{get description(){return this._def.description}_getType(e){return xe(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:xe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new J,ctx:{common:e.parent.common,data:e.data,parsedType:xe(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(Ft(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let s=this.safeParse(e,t);if(s.success)return s.data;throw s.error}safeParse(e,t){let s={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xe(e)},n=this._parseSync({data:e,path:s.path,parent:s});return bl(s,n)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xe(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:t});return Ye(s)?{value:s.value}:{issues:t.common.issues}}catch(s){s?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(s=>Ye(s)?{value:s.value}:{issues:t.common.issues})}async parseAsync(e,t){let s=await this.safeParseAsync(e,t);if(s.success)return s.data;throw s.error}async safeParseAsync(e,t){let s={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:xe(e)},n=this._parse({data:e,path:s.path,parent:s}),i=await(Ft(n)?n:Promise.resolve(n));return bl(s,i)}refine(e,t){let s=n=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(n):t;return this._refinement((n,i)=>{let a=e(n),o=()=>i.addIssue({code:p.custom,...s(n)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,t){return this._refinement((s,n)=>e(s)?!0:(n.addIssue(typeof t=="function"?t(s,n):t),!1))}_refinement(e){return new ge({schema:this,typeName:T.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return he.create(this,this._def)}nullable(){return Re.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Fe.create(this)}promise(){return et.create(this,this._def)}or(e){return pt.create([this,e],this._def)}and(e){return ht.create(this,e,this._def)}transform(e){return new ge({...A(this._def),schema:this,typeName:T.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let t=typeof e=="function"?e:()=>e;return new yt({...A(this._def),innerType:this,defaultValue:t,typeName:T.ZodDefault})}brand(){return new Rr({typeName:T.ZodBranded,type:this,...A(this._def)})}catch(e){let t=typeof e=="function"?e:()=>e;return new Et({...A(this._def),innerType:this,catchValue:t,typeName:T.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return wr.create(this,e)}readonly(){return St.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Sv=/^c[^\s-]{8,}$/i,bv=/^[0-9a-z]+$/,Tv=/^[0-9A-HJKMNP-TV-Z]{26}$/i,xv=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Av=/^[a-z0-9_-]{21}$/i,Rv=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,wv=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Cv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Iv="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",fi,Lv=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ov=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Nv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,kv=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,qv=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,$v=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,xl="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Pv=new RegExp(`^${xl}$`);function Al(r){let e="[0-5]\\d";r.precision?e=`${e}\\.\\d{${r.precision}}`:r.precision==null&&(e=`${e}(\\.\\d+)?`);let t=r.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Dv(r){return new RegExp(`^${Al(r)}$`)}function Rl(r){let e=`${xl}T${Al(r)}`,t=[];return t.push(r.local?"Z?":"Z"),r.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Mv(r,e){return!!((e==="v4"||!e)&&Lv.test(r)||(e==="v6"||!e)&&Nv.test(r))}function Fv(r,e){if(!Rv.test(r))return!1;try{let[t]=r.split(".");if(!t)return!1;let s=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||n===null||"typ"in n&&n?.typ!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function Bv(r,e){return!!((e==="v4"||!e)&&Ov.test(r)||(e==="v6"||!e)&&kv.test(r))}var Je=class r extends R{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==v.string){let i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:v.string,received:i.parsedType}),b}let s=new J,n;for(let i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="max")e.data.length>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),s.dirty());else if(i.kind==="length"){let a=e.data.length>i.value,o=e.data.length<i.value;(a||o)&&(n=this._getOrReturnCtx(e,n),a?g(n,{code:p.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&g(n,{code:p.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),s.dirty())}else if(i.kind==="email")Cv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"email",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="emoji")fi||(fi=new RegExp(Iv,"u")),fi.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"emoji",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="uuid")xv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"uuid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="nanoid")Av.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"nanoid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid")Sv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="cuid2")bv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cuid2",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="ulid")Tv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ulid",code:p.invalid_string,message:i.message}),s.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{n=this._getOrReturnCtx(e,n),g(n,{validation:"url",code:p.invalid_string,message:i.message}),s.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"regex",code:p.invalid_string,message:i.message}),s.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),s.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{startsWith:i.value},message:i.message}),s.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:{endsWith:i.value},message:i.message}),s.dirty()):i.kind==="datetime"?Rl(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"datetime",message:i.message}),s.dirty()):i.kind==="date"?Pv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"date",message:i.message}),s.dirty()):i.kind==="time"?Dv(i).test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{code:p.invalid_string,validation:"time",message:i.message}),s.dirty()):i.kind==="duration"?wv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"duration",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="ip"?Mv(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"ip",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="jwt"?Fv(e.data,i.alg)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"jwt",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="cidr"?Bv(e.data,i.version)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"cidr",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="base64"?qv.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64",code:p.invalid_string,message:i.message}),s.dirty()):i.kind==="base64url"?$v.test(e.data)||(n=this._getOrReturnCtx(e,n),g(n,{validation:"base64url",code:p.invalid_string,message:i.message}),s.dirty()):w.assertNever(i);return{status:s.value,value:e.data}}_regex(e,t,s){return this.refinement(n=>e.test(n),{validation:t,code:p.invalid_string,...S.errToObj(s)})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...S.errToObj(e)})}url(e){return this._addCheck({kind:"url",...S.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...S.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...S.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...S.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...S.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...S.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...S.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...S.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...S.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...S.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...S.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...S.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...S.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...S.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...S.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...S.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...S.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...S.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...S.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...S.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...S.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...S.errToObj(t)})}nonempty(e){return this.min(1,S.errToObj(e))}trim(){return new r({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new r({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};Je.create=r=>new Je({checks:[],typeName:T.ZodString,coerce:r?.coerce??!1,...A(r)});function jv(r,e){let t=(r.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=t>s?t:s,i=Number.parseInt(r.toFixed(n).replace(".","")),a=Number.parseInt(e.toFixed(n).replace(".",""));return i%a/10**n}var ot=class r extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==v.number){let i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:v.number,received:i.parsedType}),b}let s,n=new J;for(let i of this._def.checks)i.kind==="int"?w.isInteger(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:p.invalid_type,expected:"integer",received:"float",message:i.message}),n.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),n.dirty()):i.kind==="multipleOf"?jv(e.data,i.value)!==0&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_finite,message:i.message}),n.dirty()):w.assertNever(i);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:S.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:S.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:S.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:S.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&w.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(t===null||s.value>t)&&(t=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ot.create=r=>new ot({checks:[],typeName:T.ZodNumber,coerce:r?.coerce||!1,...A(r)});var ut=class r extends R{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==v.bigint)return this._getInvalidInput(e);let s,n=new J;for(let i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),n.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(s=this._getOrReturnCtx(e,s),g(s,{code:p.not_multiple_of,multipleOf:i.value,message:i.message}),n.dirty()):w.assertNever(i);return{status:n.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return g(t,{code:p.invalid_type,expected:v.bigint,received:t.parsedType}),b}gte(e,t){return this.setLimit("min",e,!0,S.toString(t))}gt(e,t){return this.setLimit("min",e,!1,S.toString(t))}lte(e,t){return this.setLimit("max",e,!0,S.toString(t))}lt(e,t){return this.setLimit("max",e,!1,S.toString(t))}setLimit(e,t,s,n){return new r({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:s,message:S.toString(n)}]})}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:S.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:S.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:S.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:S.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:S.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}};ut.create=r=>new ut({checks:[],typeName:T.ZodBigInt,coerce:r?.coerce??!1,...A(r)});var ct=class extends R{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==v.boolean){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.boolean,received:s.parsedType}),b}return ne(e.data)}};ct.create=r=>new ct({typeName:T.ZodBoolean,coerce:r?.coerce||!1,...A(r)});var lt=class r extends R{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==v.date){let i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_type,expected:v.date,received:i.parsedType}),b}if(Number.isNaN(e.data.getTime())){let i=this._getOrReturnCtx(e);return g(i,{code:p.invalid_date}),b}let s=new J,n;for(let i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),s.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(n=this._getOrReturnCtx(e,n),g(n,{code:p.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),s.dirty()):w.assertNever(i);return{status:s.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:S.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:S.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}};lt.create=r=>new lt({checks:[],coerce:r?.coerce||!1,typeName:T.ZodDate,...A(r)});var jt=class extends R{_parse(e){if(this._getType(e)!==v.symbol){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.symbol,received:s.parsedType}),b}return ne(e.data)}};jt.create=r=>new jt({typeName:T.ZodSymbol,...A(r)});var dt=class extends R{_parse(e){if(this._getType(e)!==v.undefined){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.undefined,received:s.parsedType}),b}return ne(e.data)}};dt.create=r=>new dt({typeName:T.ZodUndefined,...A(r)});var ft=class extends R{_parse(e){if(this._getType(e)!==v.null){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.null,received:s.parsedType}),b}return ne(e.data)}};ft.create=r=>new ft({typeName:T.ZodNull,...A(r)});var Qe=class extends R{constructor(){super(...arguments),this._any=!0}_parse(e){return ne(e.data)}};Qe.create=r=>new Qe({typeName:T.ZodAny,...A(r)});var Me=class extends R{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ne(e.data)}};Me.create=r=>new Me({typeName:T.ZodUnknown,...A(r)});var Ee=class extends R{_parse(e){let t=this._getOrReturnCtx(e);return g(t,{code:p.invalid_type,expected:v.never,received:t.parsedType}),b}};Ee.create=r=>new Ee({typeName:T.ZodNever,...A(r)});var Ut=class extends R{_parse(e){if(this._getType(e)!==v.undefined){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.void,received:s.parsedType}),b}return ne(e.data)}};Ut.create=r=>new Ut({typeName:T.ZodVoid,...A(r)});var Fe=class r extends R{_parse(e){let{ctx:t,status:s}=this._processInputParams(e),n=this._def;if(t.parsedType!==v.array)return g(t,{code:p.invalid_type,expected:v.array,received:t.parsedType}),b;if(n.exactLength!==null){let a=t.data.length>n.exactLength.value,o=t.data.length<n.exactLength.value;(a||o)&&(g(t,{code:a?p.too_big:p.too_small,minimum:o?n.exactLength.value:void 0,maximum:a?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&t.data.length<n.minLength.value&&(g(t,{code:p.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&t.data.length>n.maxLength.value&&(g(t,{code:p.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),t.common.async)return Promise.all([...t.data].map((a,o)=>n.type._parseAsync(new me(t,a,t.path,o)))).then(a=>J.mergeArray(s,a));let i=[...t.data].map((a,o)=>n.type._parseSync(new me(t,a,t.path,o)));return J.mergeArray(s,i)}get element(){return this._def.type}min(e,t){return new r({...this._def,minLength:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxLength:{value:e,message:S.toString(t)}})}length(e,t){return new r({...this._def,exactLength:{value:e,message:S.toString(t)}})}nonempty(e){return this.min(1,e)}};Fe.create=(r,e)=>new Fe({type:r,minLength:null,maxLength:null,exactLength:null,typeName:T.ZodArray,...A(e)});function Bt(r){if(r instanceof ce){let e={};for(let t in r.shape){let s=r.shape[t];e[t]=he.create(Bt(s))}return new ce({...r._def,shape:()=>e})}else return r instanceof Fe?new Fe({...r._def,type:Bt(r.element)}):r instanceof he?he.create(Bt(r.unwrap())):r instanceof Re?Re.create(Bt(r.unwrap())):r instanceof Ae?Ae.create(r.items.map(e=>Bt(e))):r}var ce=class r extends R{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),t=w.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==v.object){let c=this._getOrReturnCtx(e);return g(c,{code:p.invalid_type,expected:v.object,received:c.parsedType}),b}let{status:s,ctx:n}=this._processInputParams(e),{shape:i,keys:a}=this._getCached(),o=[];if(!(this._def.catchall instanceof Ee&&this._def.unknownKeys==="strip"))for(let c in n.data)a.includes(c)||o.push(c);let u=[];for(let c of a){let l=i[c],d=n.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new me(n,d,n.path,c)),alwaysSet:c in n.data})}if(this._def.catchall instanceof Ee){let c=this._def.unknownKeys;if(c==="passthrough")for(let l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:n.data[l]}});else if(c==="strict")o.length>0&&(g(n,{code:p.unrecognized_keys,keys:o}),s.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let l of o){let d=n.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new me(n,d,n.path,l)),alwaysSet:l in n.data})}}return n.common.async?Promise.resolve().then(async()=>{let c=[];for(let l of u){let d=await l.key,E=await l.value;c.push({key:d,value:E,alwaysSet:l.alwaysSet})}return c}).then(c=>J.mergeObjectSync(s,c)):J.mergeObjectSync(s,u)}get shape(){return this._def.shape()}strict(e){return S.errToObj,new r({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,s)=>{let n=this._def.errorMap?.(t,s).message??s.defaultError;return t.code==="unrecognized_keys"?{message:S.errToObj(e).message??n}:{message:n}}}:{}})}strip(){return new r({...this._def,unknownKeys:"strip"})}passthrough(){return new r({...this._def,unknownKeys:"passthrough"})}extend(e){return new r({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new r({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:T.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new r({...this._def,catchall:e})}pick(e){let t={};for(let s of w.objectKeys(e))e[s]&&this.shape[s]&&(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}omit(e){let t={};for(let s of w.objectKeys(this.shape))e[s]||(t[s]=this.shape[s]);return new r({...this._def,shape:()=>t})}deepPartial(){return Bt(this)}partial(e){let t={};for(let s of w.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?t[s]=n:t[s]=n.optional()}return new r({...this._def,shape:()=>t})}required(e){let t={};for(let s of w.objectKeys(this.shape))if(e&&!e[s])t[s]=this.shape[s];else{let i=this.shape[s];for(;i instanceof he;)i=i._def.innerType;t[s]=i}return new r({...this._def,shape:()=>t})}keyof(){return wl(w.objectKeys(this.shape))}};ce.create=(r,e)=>new ce({shape:()=>r,unknownKeys:"strip",catchall:Ee.create(),typeName:T.ZodObject,...A(e)});ce.strictCreate=(r,e)=>new ce({shape:()=>r,unknownKeys:"strict",catchall:Ee.create(),typeName:T.ZodObject,...A(e)});ce.lazycreate=(r,e)=>new ce({shape:r,unknownKeys:"strip",catchall:Ee.create(),typeName:T.ZodObject,...A(e)});var pt=class extends R{_parse(e){let{ctx:t}=this._processInputParams(e),s=this._def.options;function n(i){for(let o of i)if(o.result.status==="valid")return o.result;for(let o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;let a=i.map(o=>new ue(o.ctx.common.issues));return g(t,{code:p.invalid_union,unionErrors:a}),b}if(t.common.async)return Promise.all(s.map(async i=>{let a={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:a}),ctx:a}})).then(n);{let i,a=[];for(let u of s){let c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&a.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;let o=a.map(u=>new ue(u));return g(t,{code:p.invalid_union,unionErrors:o}),b}}get options(){return this._def.options}};pt.create=(r,e)=>new pt({options:r,typeName:T.ZodUnion,...A(e)});var De=r=>r instanceof mt?De(r.schema):r instanceof ge?De(r.innerType()):r instanceof gt?[r.value]:r instanceof vt?r.options:r instanceof _t?w.objectValues(r.enum):r instanceof yt?De(r._def.innerType):r instanceof dt?[void 0]:r instanceof ft?[null]:r instanceof he?[void 0,...De(r.unwrap())]:r instanceof Re?[null,...De(r.unwrap())]:r instanceof Rr||r instanceof St?De(r.unwrap()):r instanceof Et?De(r._def.innerType):[],qs=class r extends R{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.object)return g(t,{code:p.invalid_type,expected:v.object,received:t.parsedType}),b;let s=this.discriminator,n=t.data[s],i=this.optionsMap.get(n);return i?t.common.async?i._parseAsync({data:t.data,path:t.path,parent:t}):i._parseSync({data:t.data,path:t.path,parent:t}):(g(t,{code:p.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),b)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,s){let n=new Map;for(let i of t){let a=De(i.shape[e]);if(!a.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of a){if(n.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);n.set(o,i)}}return new r({typeName:T.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:n,...A(s)})}};function pi(r,e){let t=xe(r),s=xe(e);if(r===e)return{valid:!0,data:r};if(t===v.object&&s===v.object){let n=w.objectKeys(e),i=w.objectKeys(r).filter(o=>n.indexOf(o)!==-1),a={...r,...e};for(let o of i){let u=pi(r[o],e[o]);if(!u.valid)return{valid:!1};a[o]=u.data}return{valid:!0,data:a}}else if(t===v.array&&s===v.array){if(r.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<r.length;i++){let a=r[i],o=e[i],u=pi(a,o);if(!u.valid)return{valid:!1};n.push(u.data)}return{valid:!0,data:n}}else return t===v.date&&s===v.date&&+r==+e?{valid:!0,data:r}:{valid:!1}}var ht=class extends R{_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=(i,a)=>{if(Ns(i)||Ns(a))return b;let o=pi(i.value,a.value);return o.valid?((ks(i)||ks(a))&&t.dirty(),{status:t.value,value:o.data}):(g(s,{code:p.invalid_intersection_types}),b)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([i,a])=>n(i,a)):n(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};ht.create=(r,e,t)=>new ht({left:r,right:e,typeName:T.ZodIntersection,...A(t)});var Ae=class r extends R{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.array)return g(s,{code:p.invalid_type,expected:v.array,received:s.parsedType}),b;if(s.data.length<this._def.items.length)return g(s,{code:p.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b;!this._def.rest&&s.data.length>this._def.items.length&&(g(s,{code:p.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let i=[...s.data].map((a,o)=>{let u=this._def.items[o]||this._def.rest;return u?u._parse(new me(s,a,s.path,o)):null}).filter(a=>!!a);return s.common.async?Promise.all(i).then(a=>J.mergeArray(t,a)):J.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new r({...this._def,rest:e})}};Ae.create=(r,e)=>{if(!Array.isArray(r))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ae({items:r,typeName:T.ZodTuple,rest:null,...A(e)})};var $s=class r extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.object)return g(s,{code:p.invalid_type,expected:v.object,received:s.parsedType}),b;let n=[],i=this._def.keyType,a=this._def.valueType;for(let o in s.data)n.push({key:i._parse(new me(s,o,s.path,o)),value:a._parse(new me(s,s.data[o],s.path,o)),alwaysSet:o in s.data});return s.common.async?J.mergeObjectAsync(t,n):J.mergeObjectSync(t,n)}get element(){return this._def.valueType}static create(e,t,s){return t instanceof R?new r({keyType:e,valueType:t,typeName:T.ZodRecord,...A(s)}):new r({keyType:Je.create(),valueType:e,typeName:T.ZodRecord,...A(t)})}},Vt=class extends R{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.map)return g(s,{code:p.invalid_type,expected:v.map,received:s.parsedType}),b;let n=this._def.keyType,i=this._def.valueType,a=[...s.data.entries()].map(([o,u],c)=>({key:n._parse(new me(s,o,s.path,[c,"key"])),value:i._parse(new me(s,u,s.path,[c,"value"]))}));if(s.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let u of a){let c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return b;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{let o=new Map;for(let u of a){let c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return b;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}};Vt.create=(r,e,t)=>new Vt({valueType:e,keyType:r,typeName:T.ZodMap,...A(t)});var Wt=class r extends R{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.parsedType!==v.set)return g(s,{code:p.invalid_type,expected:v.set,received:s.parsedType}),b;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(g(s,{code:p.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),t.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(g(s,{code:p.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),t.dirty());let i=this._def.valueType;function a(u){let c=new Set;for(let l of u){if(l.status==="aborted")return b;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}let o=[...s.data.values()].map((u,c)=>i._parse(new me(s,u,s.path,c)));return s.common.async?Promise.all(o).then(u=>a(u)):a(o)}min(e,t){return new r({...this._def,minSize:{value:e,message:S.toString(t)}})}max(e,t){return new r({...this._def,maxSize:{value:e,message:S.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};Wt.create=(r,e)=>new Wt({valueType:r,minSize:null,maxSize:null,typeName:T.ZodSet,...A(e)});var Ps=class r extends R{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.function)return g(t,{code:p.invalid_type,expected:v.function,received:t.parsedType}),b;function s(o,u){return Ar({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Mt(),Pe].filter(c=>!!c),issueData:{code:p.invalid_arguments,argumentsError:u}})}function n(o,u){return Ar({data:o,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Mt(),Pe].filter(c=>!!c),issueData:{code:p.invalid_return_type,returnTypeError:u}})}let i={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof et){let o=this;return ne(async function(...u){let c=new ue([]),l=await o._def.args.parseAsync(u,i).catch(f=>{throw c.addIssue(s(u,f)),c}),d=await Reflect.apply(a,this,l);return await o._def.returns._def.type.parseAsync(d,i).catch(f=>{throw c.addIssue(n(d,f)),c})})}else{let o=this;return ne(function(...u){let c=o._def.args.safeParse(u,i);if(!c.success)throw new ue([s(u,c.error)]);let l=Reflect.apply(a,this,c.data),d=o._def.returns.safeParse(l,i);if(!d.success)throw new ue([n(l,d.error)]);return d.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new r({...this._def,args:Ae.create(e).rest(Me.create())})}returns(e){return new r({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,s){return new r({args:e||Ae.create([]).rest(Me.create()),returns:t||Me.create(),typeName:T.ZodFunction,...A(s)})}},mt=class extends R{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}};mt.create=(r,e)=>new mt({getter:r,typeName:T.ZodLazy,...A(e)});var gt=class extends R{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return g(t,{received:t.data,code:p.invalid_literal,expected:this._def.value}),b}return{status:"valid",value:e.data}}get value(){return this._def.value}};gt.create=(r,e)=>new gt({value:r,typeName:T.ZodLiteral,...A(e)});function wl(r,e){return new vt({values:r,typeName:T.ZodEnum,...A(e)})}var vt=class r extends R{_parse(e){if(typeof e.data!="string"){let t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{expected:w.joinValues(s),received:t.parsedType,code:p.invalid_type}),b}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),s=this._def.values;return g(t,{received:t.data,code:p.invalid_enum_value,options:s}),b}return ne(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r.create(e,{...this._def,...t})}exclude(e,t=this._def){return r.create(this.options.filter(s=>!e.includes(s)),{...this._def,...t})}};vt.create=wl;var _t=class extends R{_parse(e){let t=w.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(e);if(s.parsedType!==v.string&&s.parsedType!==v.number){let n=w.objectValues(t);return g(s,{expected:w.joinValues(n),received:s.parsedType,code:p.invalid_type}),b}if(this._cache||(this._cache=new Set(w.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let n=w.objectValues(t);return g(s,{received:s.data,code:p.invalid_enum_value,options:n}),b}return ne(e.data)}get enum(){return this._def.values}};_t.create=(r,e)=>new _t({values:r,typeName:T.ZodNativeEnum,...A(e)});var et=class extends R{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==v.promise&&t.common.async===!1)return g(t,{code:p.invalid_type,expected:v.promise,received:t.parsedType}),b;let s=t.parsedType===v.promise?t.data:Promise.resolve(t.data);return ne(s.then(n=>this._def.type.parseAsync(n,{path:t.path,errorMap:t.common.contextualErrorMap})))}};et.create=(r,e)=>new et({type:r,typeName:T.ZodPromise,...A(e)});var ge=class extends R{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===T.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:s}=this._processInputParams(e),n=this._def.effect||null,i={addIssue:a=>{g(s,a),a.fatal?t.abort():t.dirty()},get path(){return s.path}};if(i.addIssue=i.addIssue.bind(i),n.type==="preprocess"){let a=n.transform(s.data,i);if(s.common.async)return Promise.resolve(a).then(async o=>{if(t.value==="aborted")return b;let u=await this._def.schema._parseAsync({data:o,path:s.path,parent:s});return u.status==="aborted"?b:u.status==="dirty"?at(u.value):t.value==="dirty"?at(u.value):u});{if(t.value==="aborted")return b;let o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return o.status==="aborted"?b:o.status==="dirty"?at(o.value):t.value==="dirty"?at(o.value):o}}if(n.type==="refinement"){let a=o=>{let u=n.refinement(o,i);if(s.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(s.common.async===!1){let o=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return o.status==="aborted"?b:(o.status==="dirty"&&t.dirty(),a(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(o=>o.status==="aborted"?b:(o.status==="dirty"&&t.dirty(),a(o.value).then(()=>({status:t.value,value:o.value}))))}if(n.type==="transform")if(s.common.async===!1){let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!Ye(a))return b;let o=n.transform(a.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>Ye(a)?Promise.resolve(n.transform(a.value,i)).then(o=>({status:t.value,value:o})):b);w.assertNever(n)}};ge.create=(r,e,t)=>new ge({schema:r,typeName:T.ZodEffects,effect:e,...A(t)});ge.createWithPreprocess=(r,e,t)=>new ge({schema:e,effect:{type:"preprocess",transform:r},typeName:T.ZodEffects,...A(t)});var he=class extends R{_parse(e){return this._getType(e)===v.undefined?ne(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};he.create=(r,e)=>new he({innerType:r,typeName:T.ZodOptional,...A(e)});var Re=class extends R{_parse(e){return this._getType(e)===v.null?ne(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};Re.create=(r,e)=>new Re({innerType:r,typeName:T.ZodNullable,...A(e)});var yt=class extends R{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return t.parsedType===v.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};yt.create=(r,e)=>new yt({innerType:r,typeName:T.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...A(e)});var Et=class extends R{_parse(e){let{ctx:t}=this._processInputParams(e),s={...t,common:{...t.common,issues:[]}},n=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return Ft(n)?n.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new ue(s.common.issues)},input:s.data})})):{status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new ue(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};Et.create=(r,e)=>new Et({innerType:r,typeName:T.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...A(e)});var Gt=class extends R{_parse(e){if(this._getType(e)!==v.nan){let s=this._getOrReturnCtx(e);return g(s,{code:p.invalid_type,expected:v.nan,received:s.parsedType}),b}return{status:"valid",value:e.data}}};Gt.create=r=>new Gt({typeName:T.ZodNaN,...A(r)});var Uv=Symbol("zod_brand"),Rr=class extends R{_parse(e){let{ctx:t}=this._processInputParams(e),s=t.data;return this._def.type._parse({data:s,path:t.path,parent:t})}unwrap(){return this._def.type}},wr=class r extends R{_parse(e){let{status:t,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let i=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return i.status==="aborted"?b:i.status==="dirty"?(t.dirty(),at(i.value)):this._def.out._parseAsync({data:i.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?b:n.status==="dirty"?(t.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,t){return new r({in:e,out:t,typeName:T.ZodPipeline})}},St=class extends R{_parse(e){let t=this._def.innerType._parse(e),s=n=>(Ye(n)&&(n.value=Object.freeze(n.value)),n);return Ft(t)?t.then(n=>s(n)):s(t)}unwrap(){return this._def.innerType}};St.create=(r,e)=>new St({innerType:r,typeName:T.ZodReadonly,...A(e)});function Tl(r,e){let t=typeof r=="function"?r(e):typeof r=="string"?{message:r}:r;return typeof t=="string"?{message:t}:t}function Cl(r,e={},t){return r?Qe.create().superRefine((s,n)=>{let i=r(s);if(i instanceof Promise)return i.then(a=>{if(!a){let o=Tl(e,s),u=o.fatal??t??!0;n.addIssue({code:"custom",...o,fatal:u})}});if(!i){let a=Tl(e,s),o=a.fatal??t??!0;n.addIssue({code:"custom",...a,fatal:o})}}):Qe.create()}var Vv={object:ce.lazycreate},T;(function(r){r.ZodString="ZodString",r.ZodNumber="ZodNumber",r.ZodNaN="ZodNaN",r.ZodBigInt="ZodBigInt",r.ZodBoolean="ZodBoolean",r.ZodDate="ZodDate",r.ZodSymbol="ZodSymbol",r.ZodUndefined="ZodUndefined",r.ZodNull="ZodNull",r.ZodAny="ZodAny",r.ZodUnknown="ZodUnknown",r.ZodNever="ZodNever",r.ZodVoid="ZodVoid",r.ZodArray="ZodArray",r.ZodObject="ZodObject",r.ZodUnion="ZodUnion",r.ZodDiscriminatedUnion="ZodDiscriminatedUnion",r.ZodIntersection="ZodIntersection",r.ZodTuple="ZodTuple",r.ZodRecord="ZodRecord",r.ZodMap="ZodMap",r.ZodSet="ZodSet",r.ZodFunction="ZodFunction",r.ZodLazy="ZodLazy",r.ZodLiteral="ZodLiteral",r.ZodEnum="ZodEnum",r.ZodEffects="ZodEffects",r.ZodNativeEnum="ZodNativeEnum",r.ZodOptional="ZodOptional",r.ZodNullable="ZodNullable",r.ZodDefault="ZodDefault",r.ZodCatch="ZodCatch",r.ZodPromise="ZodPromise",r.ZodBranded="ZodBranded",r.ZodPipeline="ZodPipeline",r.ZodReadonly="ZodReadonly"})(T||(T={}));var Wv=(r,e={message:`Input not instance of ${r.name}`})=>Cl(t=>t instanceof r,e),Il=Je.create,Ll=ot.create,Gv=Gt.create,Xv=ut.create,Ol=ct.create,Hv=lt.create,zv=jt.create,Kv=dt.create,Zv=ft.create,Yv=Qe.create,Jv=Me.create,Qv=Ee.create,e_=Ut.create,t_=Fe.create,r_=ce.create,s_=ce.strictCreate,n_=pt.create,i_=qs.create,a_=ht.create,o_=Ae.create,u_=$s.create,c_=Vt.create,l_=Wt.create,d_=Ps.create,f_=mt.create,p_=gt.create,h_=vt.create,m_=_t.create,g_=et.create,v_=ge.create,__=he.create,y_=Re.create,E_=ge.createWithPreprocess,S_=wr.create,b_=()=>Il().optional(),T_=()=>Ll().optional(),x_=()=>Ol().optional(),A_={string:r=>Je.create({...r,coerce:!0}),number:r=>ot.create({...r,coerce:!0}),boolean:r=>ct.create({...r,coerce:!0}),bigint:r=>ut.create({...r,coerce:!0}),date:r=>lt.create({...r,coerce:!0})};var R_=b;var hi={PRETTY:4,COMPACT:0};var k={TRACE:6,DEBUG:8,INFO:12,WARN:16,ERROR:20,CRITICAL:24,SILENT:28},Nl=["level","message","sampling_rate","service","timestamp"],kl="Uncaught error detected, flushing log buffer before exit";var Ds,Ms,ql,Cr=class{constructor(){P(this,Ms);P(this,Ds,e=>{let t="2-digit",s=Intl.supportedValuesOf("timeZone").includes(e)?e:"UTC";return new Intl.DateTimeFormat("en",{hourCycle:"h23",year:"numeric",month:t,day:t,hour:t,minute:t,second:t,timeZone:s})})}formatError(e){let{name:t,message:s,stack:n,cause:i,...a}=e,o={name:t,location:this.getCodeLocation(e.stack),message:s,stack:er()&&typeof n=="string"?n?.split(`
`):n,cause:i instanceof Error?this.formatError(i):i};for(let u in e)typeof u=="string"&&!["name","message","stack","cause"].includes(u)&&(o[u]=a[u]);return o}formatTimestamp(e){let t="UTC",s=X({key:"TZ",defaultValue:""});return s&&!s.includes(t)?j(this,Ms,ql).call(this,e,s):e.toISOString()}getCodeLocation(e){if(!e)return"";let t=e.split(`
`),s=/\(([^()]*?):(\d+?):(\d+?)\)\\?$/;for(let n of t){let i=s.exec(n);if(Array.isArray(i))return`${i[1]}:${Number(i[2])}`}return""}};Ds=new WeakMap,Ms=new WeakSet,ql=function(e,t){let{year:s,month:n,day:i,hour:a,minute:o,second:u}=m(this,Ds).call(this,t).formatToParts(e).reduce((rt,Ce)=>(rt[Ce.type]=Ce.value,rt),{}),c=`${s}-${n}-${i}T${a}:${o}:${u}`,l=-e.getTimezoneOffset(),d=l>=0?"+":"-",E=Math.abs(Math.floor(l/60)).toString().padStart(2,"0"),f=Math.abs(l%60).toString().padStart(2,"0"),N=e.getMilliseconds().toString().padStart(3,"0"),$=`${d}${E}:${f}`;return`${c}.${N}${$}`};var cd=Ge(Ai(),1);var Kt=class{constructor(e){C(this,"attributes",{});this.setAttributes(e.attributes)}addAttributes(e){return(0,cd.default)(this.attributes,e),this}getAttributes(){return this.attributes}prepareForPrint(){this.attributes=this.removeEmptyKeys(this.getAttributes())}removeEmptyKeys(e){let t={};for(let s in e)e[s]!==void 0&&e[s]!==""&&e[s]!==null&&(t[s]=e[s]);return t}setAttributes(e){this.attributes=e}};var dd=require("console"),fd=require("crypto");var qr=Ge(Ai(),1);var Zt,Hs=class extends Cr{constructor(t){super();P(this,Zt);K(this,Zt,t?.logRecordOrder)}formatAttributes(t,s){let n={level:t.logLevel,message:t.message,timestamp:this.formatTimestamp(t.timestamp),service:t.serviceName,cold_start:t.lambdaContext?.coldStart,function_arn:t.lambdaContext?.invokedFunctionArn,function_memory_size:t.lambdaContext?.memoryLimitInMB,function_name:t.lambdaContext?.functionName,function_request_id:t.lambdaContext?.awsRequestId,sampling_rate:t.sampleRateValue,xray_trace_id:t.xRayTraceId};if(m(this,Zt)===void 0)return new Kt({attributes:n}).addAttributes(s);let i={};for(let o of m(this,Zt))o in n&&!(o in i)?i[o]=n[o]:o in s&&!(o in i)&&(i[o]=s[o]);for(let o in n)o in i||(i[o]=n[o]);for(let o in s)o in i||(i[o]=s[o]);return new Kt({attributes:i})}};Zt=new WeakMap;var Ri=class{constructor(e,t){C(this,"value");C(this,"logLevel");C(this,"byteSize");if(!tn(e))throw new Error("Value should be a string");this.value=e,this.logLevel=t,this.byteSize=Buffer.byteLength(e)}},wi=class extends Set{constructor(){super(...arguments);C(this,"currentBytesSize",0);C(this,"hasEvictedLog",!1)}add(t){return this.currentBytesSize+=t.byteSize,super.add(t),this}delete(t){let s=super.delete(t);return s&&(this.currentBytesSize-=t.byteSize),s}clear(){super.clear(),this.currentBytesSize=0}shift(){let t=this.values().next().value;return t&&this.delete(t),t}},At,Yt,Ks,ld,zs=class extends Map{constructor({maxBytesSize:t,onBufferOverflow:s}){super();P(this,Ks);P(this,At);P(this,Yt);K(this,At,t),K(this,Yt,s)}setItem(t,s,n){let i=new Ri(s,n);if(i.byteSize>m(this,At))throw new Error("Item too big");let a=this.get(t)||new wi;return a.currentBytesSize+i.byteSize>=m(this,At)&&(j(this,Ks,ld).call(this,a,i),m(this,Yt)&&m(this,Yt).call(this)),a.add(i),super.set(t,a),this}};At=new WeakMap,Yt=new WeakMap,Ks=new WeakSet,ld=function(t,s){for(;t.currentBytesSize+s.byteSize>=m(this,At);)t.shift(),t.hasEvictedLog=!0};var Se,Jt,Mr,be,tt,Rt,z,we,wt,Ve,Fr,q,$r,Ci,pd,hd,md,gd,Ii,Pr,vd,Li=class Li extends st{constructor(t={}){super();P(this,q);C(this,"console");C(this,"customConfigService");C(this,"logEvent",!1);C(this,"logFormatter");C(this,"logIndentation",hi.COMPACT);C(this,"logLevel",k.INFO);P(this,Se);C(this,"persistentLogAttributes",{});C(this,"powertoolsLogData",{sampleRateValue:0});C(this,"temporaryLogAttributes",{});P(this,Jt,[]);P(this,Mr,!1);P(this,be,new Map);P(this,tt,k.INFO);P(this,Rt);P(this,z,{enabled:!1,flushOnErrorLog:!0,maxBytes:20480,bufferAtVerbosity:k.DEBUG});P(this,we);P(this,wt);P(this,Ve,{sampleRateValue:0,refreshedTimes:0});P(this,Fr,new Map);let{customConfigService:s,...n}=t;this.customConfigService=s||void 0,this.setOptions(n),K(this,Mr,!0);for(let[i,a]of m(this,Jt))this.printLog(i,this.createAndPopulateLogItem(...a));K(this,Jt,[])}get level(){return this.logLevel}addContext(t){this.addToPowertoolsLogData({lambdaContext:{invokedFunctionArn:t.invokedFunctionArn,coldStart:this.getColdStart(),awsRequestId:t.awsRequestId,memoryLimitInMB:t.memoryLimitInMB,functionName:t.functionName,functionVersion:t.functionVersion}})}addPersistentLogAttributes(t){this.appendPersistentKeys(t)}appendKeys(t){j(this,q,Ci).call(this,t,"temp")}appendPersistentKeys(t){j(this,q,Ci).call(this,t,"persistent")}createChild(t={}){let s=this.createLogger((0,qr.default)({},{logLevel:this.getLevelName(),serviceName:this.powertoolsLogData.serviceName,sampleRateValue:m(this,Ve).sampleRateValue,logFormatter:this.getLogFormatter(),customConfigService:this.getCustomConfigService(),environment:this.powertoolsLogData.environment,persistentLogAttributes:this.persistentLogAttributes,jsonReplacerFn:m(this,Rt),correlationIdSearchFn:m(this,wt),...m(this,z).enabled&&{logBufferOptions:{maxBytes:m(this,z).maxBytes,bufferAtVerbosity:this.getLogLevelNameFromNumber(m(this,z).bufferAtVerbosity),flushOnErrorLog:m(this,z).flushOnErrorLog}}},t));return this.powertoolsLogData.lambdaContext&&s.addContext(this.powertoolsLogData.lambdaContext),this.temporaryLogAttributes&&s.appendKeys(this.temporaryLogAttributes),s}critical(t,...s){this.processLogItem(k.CRITICAL,t,s)}debug(t,...s){this.processLogItem(k.DEBUG,t,s)}error(t,...s){m(this,z).enabled&&m(this,z).flushOnErrorLog&&this.flushBuffer(),this.processLogItem(k.ERROR,t,s)}getLevelName(){return this.getLogLevelNameFromNumber(this.logLevel)}getLogEvent(){return this.logEvent}getPersistentLogAttributes(){return this.persistentLogAttributes}info(t,...s){this.processLogItem(k.INFO,t,s)}injectLambdaContext(t){return(s,n,i)=>{let a=i.value,o=this;i.value=async function(...u){o.refreshSampleRateCalculation(),o.addContext(u[1]),o.logEventIfEnabled(u[0],t?.logEvent),t?.correlationIdPath&&o.setCorrelationId(u[0],t?.correlationIdPath);try{return await a.apply(this,u)}catch(c){throw t?.flushBufferOnUncaughtError&&(o.flushBuffer(),o.error({message:kl,error:c})),c}finally{(t?.clearState||t?.resetKeys)&&o.resetKeys(),o.clearBuffer()}}}}static injectLambdaContextAfterOrOnError(t,s,n){n&&(n.clearState||n?.resetKeys)&&t.resetKeys()}static injectLambdaContextBefore(t,s,n,i){t.addContext(n),t.logEventIfEnabled(s,i?.logEvent)}logEventIfEnabled(t,s){this.shouldLogEvent(s)&&this.info("Lambda invocation event",{event:t})}refreshSampleRateCalculation(){if(m(this,Ve).refreshedTimes===0){m(this,Ve).refreshedTimes++;return}j(this,q,Ii).call(this)&&this.logLevel>k.TRACE?(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate")):this.setLogLevel(this.getLogLevelNameFromNumber(m(this,tt)))}removeKeys(t){for(let s of t)this.temporaryLogAttributes[s]=void 0,this.persistentLogAttributes[s]?m(this,be).set(s,"persistent"):m(this,be).delete(s)}removePersistentKeys(t){for(let s of t)this.persistentLogAttributes[s]=void 0,this.temporaryLogAttributes[s]?m(this,be).set(s,"temp"):m(this,be).delete(s)}removePersistentLogAttributes(t){this.removePersistentKeys(t)}resetKeys(){for(let t of Object.keys(this.temporaryLogAttributes))this.persistentLogAttributes[t]?m(this,be).set(t,"persistent"):m(this,be).delete(t);this.temporaryLogAttributes={}}setLogLevel(t){if(!this.awsLogLevelShortCircuit(t))if(this.isValidLogLevel(t))this.logLevel=k[t];else throw new Error(`Invalid log level: ${t}`)}setPersistentLogAttributes(t){this.persistentLogAttributes=t}shouldLogEvent(t){return typeof t=="boolean"?t:this.getLogEvent()}trace(t,...s){this.processLogItem(k.TRACE,t,s)}warn(t,...s){this.processLogItem(k.WARN,t,s)}createLogger(t){return new Li(t)}getJsonReplacer(){let t=new WeakSet;return(s,n)=>{var a;let i=n;if(m(this,Rt)&&(i=(a=m(this,Rt))==null?void 0:a.call(this,s,i)),i instanceof Error&&(i=this.getLogFormatter().formatError(i)),typeof i=="bigint")return i.toString();if(typeof i=="object"&&i!==null){if(t.has(i))return;t.add(i)}return i}}addToPowertoolsLogData(t){(0,qr.default)(this.powertoolsLogData,t)}awsLogLevelShortCircuit(t){return m(this,Se)!==void 0?(this.logLevel=k[m(this,Se)],this.isValidLogLevel(t)&&this.logLevel>k[t]&&j(this,q,$r).call(this,`Current log level (${t}) does not match AWS Lambda Advanced Logging Controls minimum log level (${m(this,Se)}). This can lead to data loss, consider adjusting them.`),!0):!1}createAndPopulateLogItem(t,s,n){let i={logLevel:this.getLogLevelNameFromNumber(t),timestamp:new Date,xRayTraceId:Le(),...this.getPowertoolsLogData(),message:""},a=j(this,q,pd).call(this);return j(this,q,hd).call(this,s,i,a),j(this,q,md).call(this,n,a),this.getLogFormatter().formatAttributes(i,a)}getCustomConfigService(){return this.customConfigService}getLogFormatter(){return this.logFormatter}getLogLevelNameFromNumber(t){let s;for(let[n,i]of Object.entries(k))if(i===t){s=n;break}return s}getPowertoolsLogData(){return this.powertoolsLogData}isValidLogLevel(t){return typeof t=="string"&&t in k}isValidSampleRate(t){return typeof t=="number"&&0<=t&&t<=1}printLog(t,s){s.prepareForPrint();let n=t===k.CRITICAL?"error":this.getLogLevelNameFromNumber(t).toLowerCase();this.console[n](JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation))}processLogItem(t,s,n){let i=Le();if(i!==void 0&&this.shouldBufferLog(i,t)){try{this.bufferLogItem(i,this.createAndPopulateLogItem(t,s,n),t)}catch(a){this.printLog(k.WARN,this.createAndPopulateLogItem(k.WARN,`Unable to buffer log: ${a.message}`,[a])),this.printLog(t,this.createAndPopulateLogItem(t,s,n))}return}t>=this.logLevel&&(m(this,Mr)?this.printLog(t,this.createAndPopulateLogItem(t,s,n)):m(this,Jt).push([t,[t,s,n]]))}setConsole(){er()?this.console=console:this.console=new dd.Console({stdout:process.stdout,stderr:process.stderr}),this.console.trace=(t,...s)=>{this.console.log(t,...s)}}setInitialLogLevel(t){let s=t?.toUpperCase();if(this.awsLogLevelShortCircuit(s)){K(this,tt,this.logLevel);return}if(this.isValidLogLevel(s)){this.logLevel=k[s],K(this,tt,this.logLevel);return}let n=this.getCustomConfigService()?.getLogLevel()?.toUpperCase();if(this.isValidLogLevel(n)){this.logLevel=k[n],K(this,tt,this.logLevel);return}let i=X({key:"POWERTOOLS_LOG_LEVEL",defaultValue:""}),a=X({key:"LOG_LEVEL",defaultValue:""}),o=i!==""?i:a;this.isValidLogLevel(o)&&(this.logLevel=k[o],K(this,tt,this.logLevel))}setInitialSampleRate(t){let s=t,n=this.getCustomConfigService()?.getSampleRateValue(),i=Gi({key:"POWERTOOLS_LOGGER_SAMPLE_RATE",defaultValue:0});for(let a of[s,n,i])if(this.isValidSampleRate(a)){m(this,Ve).sampleRateValue=a,this.powertoolsLogData.sampleRateValue=a,j(this,q,Ii).call(this)&&this.logLevel>k.TRACE&&(this.setLogLevel("DEBUG"),this.debug("Setting log level to DEBUG due to sampling rate"));break}}setLogEvent(){this.logEvent=sn({key:"POWERTOOLS_LOGGER_LOG_EVENT",defaultValue:!1})}setLogFormatter(t,s){this.logFormatter=t??new Hs({logRecordOrder:s})}setLogIndentation(){er()&&(this.logIndentation=hi.PRETTY)}setOptions(t){let{logLevel:s,serviceName:n,sampleRateValue:i,logFormatter:a,persistentKeys:o,persistentLogAttributes:u,environment:c,jsonReplacerFn:l,logRecordOrder:d,logBufferOptions:E,correlationIdSearchFn:f}=t;u&&Object.keys(u).length>0&&o&&Object.keys(o).length>0&&this.warn("Both persistentLogAttributes and persistentKeys options were provided. Using persistentKeys as persistentLogAttributes is deprecated and will be removed in future releases"),this.setPowertoolsLogData(n,c,o||u);let N=X({key:"AWS_LAMBDA_LOG_LEVEL",defaultValue:""}),$=N==="FATAL"?"CRITICAL":N;return this.isValidLogLevel($)&&K(this,Se,$),this.setLogEvent(),this.setInitialLogLevel(s),this.setInitialSampleRate(i),this.setLogFormatter(a,d),this.setConsole(),this.setLogIndentation(),K(this,Rt,l),j(this,q,vd).call(this,E),K(this,wt,f),this}setPowertoolsLogData(t,s,n){this.addToPowertoolsLogData({awsRegion:X({key:"AWS_REGION",defaultValue:""}),environment:s||this.getCustomConfigService()?.getCurrentEnvironment()||X({key:"ENVIRONMENT",defaultValue:""}),serviceName:t||this.getCustomConfigService()?.getServiceName()||X({key:"POWERTOOLS_SERVICE_NAME",defaultValue:""})||this.defaultServiceName}),n&&this.appendPersistentKeys(n)}bufferLogItem(t,s,n){s.prepareForPrint(),m(this,we)?.has(t)===!1&&m(this,we)?.clear(),m(this,we)?.setItem(t,JSON.stringify(s.getAttributes(),this.getJsonReplacer(),this.logIndentation),n)}flushBuffer(){let t=Le();if(t===void 0)return;let s=m(this,we)?.get(t);if(s!==void 0){for(let n of s){let i=this.getLogLevelNameFromNumber(n.logLevel).toLowerCase();this.console[i](n.value)}s.hasEvictedLog&&this.printLog(k.WARN,this.createAndPopulateLogItem(k.WARN,"Some logs are not displayed because they were evicted from the buffer. Increase buffer size to store more logs in the buffer",[])),m(this,Se)!==void 0&&k[m(this,Se)]>m(this,z).bufferAtVerbosity&&j(this,q,$r).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Some logs might be missing."),m(this,we)?.delete(t)}}clearBuffer(){let t=Le();t!==void 0&&m(this,we)?.delete(t)}shouldBufferLog(t,s){return m(this,z).enabled&&t!==void 0&&s<=m(this,z).bufferAtVerbosity}setCorrelationId(t,s){if(typeof s=="string"){if(!m(this,wt)){j(this,q,$r).call(this,"correlationIdPath is set but no search function was provided. The correlation ID will not be added to the log attributes.");return}let n=m(this,wt).call(this,s,t);n&&this.appendKeys({correlation_id:n});return}this.appendKeys({correlation_id:t})}getCorrelationId(){return this.temporaryLogAttributes.correlation_id}};Se=new WeakMap,Jt=new WeakMap,Mr=new WeakMap,be=new WeakMap,tt=new WeakMap,Rt=new WeakMap,z=new WeakMap,we=new WeakMap,wt=new WeakMap,Ve=new WeakMap,Fr=new WeakMap,q=new WeakSet,$r=function(t){m(this,Fr).has(t)||(m(this,Fr).set(t,!0),this.warn(t))},Ci=function(t,s){for(let n of Object.keys(t))j(this,q,Pr).call(this,n)===!1&&m(this,be).set(n,s);s==="temp"?(0,qr.default)(this.temporaryLogAttributes,t):(0,qr.default)(this.persistentLogAttributes,t)},pd=function(){let t={};for(let[s,n]of m(this,be))j(this,q,Pr).call(this,s)||(t[s]=n==="persistent"?this.persistentLogAttributes[s]:this.temporaryLogAttributes[s]);return t},hd=function(t,s,n){if(typeof t=="string"){s.message=t;return}let{message:i,...a}=t;s.message=i;for(let[o,u]of Object.entries(a))j(this,q,Pr).call(this,o)||(n[o]=u)},md=function(t,s){for(let n of t)rn(n)||(n instanceof Error?s.error=n:typeof n=="string"?s.extra=n:j(this,q,gd).call(this,n,s))},gd=function(t,s){for(let[n,i]of Object.entries(t))j(this,q,Pr).call(this,n)||(s[n]=i)},Ii=function(){return m(this,Ve).sampleRateValue&&(0,fd.randomInt)(0,100)/100<=m(this,Ve).sampleRateValue},Pr=function(t){return Nl.includes(t)?(this.warn(`The key "${t}" is a reserved key and will be dropped.`),!0):!1},vd=function(t){if(t===void 0||(m(this,z).enabled=t?.enabled!==!1,m(this,z).enabled===!1))return;t?.maxBytes!==void 0&&(m(this,z).maxBytes=t.maxBytes),K(this,we,new zs({maxBytesSize:m(this,z).maxBytes})),t?.flushOnErrorLog===!1&&(m(this,z).flushOnErrorLog=!1);let s=t?.bufferAtVerbosity?.toUpperCase();this.isValidLogLevel(s)&&(m(this,z).bufferAtVerbosity=k[s]),m(this,Se)!==void 0&&k[m(this,Se)]>m(this,z).bufferAtVerbosity&&j(this,q,$r).call(this,"Advanced Loggging Controls (ALC) Log Level is less verbose than Log Buffering Log Level. Buffered logs will be filtered by ALC")};var Dr=Li;var Zs=class r{constructor(e,t){this.logger=new Dr({serviceName:e||process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",logLevel:process.env.LOG_LEVEL||"INFO",sampleRateValue:.1}),this.context={traceId:t?.traceId||xr(),...t},this.context.agent&&this.logger.appendKeys({agent:this.context.agent}),this.context.leadId&&this.logger.appendKeys({leadId:this.context.leadId}),this.context.tenantId&&this.logger.appendKeys({tenantId:this.context.tenantId})}getTraceId(){return this.context.traceId||""}setTraceId(e){this.context.traceId=e}getContext(){return{...this.context}}updateContext(e){this.context={...this.context,...e};let t={};e.agent&&(t.agent=e.agent),e.leadId&&(t.leadId=e.leadId),e.tenantId&&(t.tenantId=e.tenantId),e.campaignId&&(t.campaignId=e.campaignId),Object.keys(t).length>0&&this.logger.appendKeys(t)}info(e,t){this.logger.info(e,{trace_id:this.context.traceId,...t})}warn(e,t){this.logger.warn(e,{trace_id:this.context.traceId,...t})}error(e,t,s){let n=t?{error:{name:t.name,message:t.message,stack:t.stack}}:{};this.logger.error(e,{trace_id:this.context.traceId,...n,...s})}debug(e,t){this.logger.debug(e,{trace_id:this.context.traceId,...t})}appendKeys(e){this.logger.appendKeys(e)}removeKeys(e){this.logger.removeKeys(e)}createChild(e){return new r(process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-service",{...this.context,...e})}logCustomMetric(e,t,s){this.info(`Custom metric: ${e}`,{metric:e,value:t,...s})}logApiRequest(e,t,s){this.info(`API Request: ${e} ${t}`,{method:e,path:t,...s})}finishOperation(e,t){e?this.info("Operation completed successfully",t):this.error("Operation failed",void 0,t)}};function _d(r,e){return new Zs(r,e)}var ix=new Zs;var yd=new Tr({serviceName:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-api"}),yE=yd.captureAWSv3Client(new Ys.EventBridgeClient({})),Oi=process.env.EVENT_BUS_NAME||"fibonacci-bus-dev",EE=Be.object({source:Be.string().min(1,"Source is required"),type:Be.string().min(1,"Type is required"),detail:Be.record(Be.any()).or(Be.object({}))}),SE=async(r,e)=>{let t=xr(),s=_d("fibonacci-api",{traceId:t}),i=yd.getSegment()?.addNewSubsegment("ProcessRequest");try{if(i?.addAnnotation("path",r.path),i?.addAnnotation("method",r.httpMethod),i?.addAnnotation("traceId",t),s.info("Processing request",{path:r.path,method:r.httpMethod,requestId:e.awsRequestId}),r.httpMethod==="OPTIONS")return We(200,{message:"OK"},t);if(r.path==="/health"&&r.httpMethod==="GET"){let a=bE(s,t);return i?.close(),a}if(r.path==="/events"&&r.httpMethod==="POST"){let a=await TE(r,s,t,i);return i?.close(),a}return s.warn("Route not found",{path:r.path,method:r.httpMethod}),i?.close(),We(404,{error:"Not Found",message:`Route ${r.httpMethod} ${r.path} not found`},t)}catch(a){let o=a instanceof Error?{name:a.name,message:a.message,stack:a.stack}:{error:a};return s.error("Error processing request",a,o),i&&a instanceof Error&&i.addError(a),i?.close(),We(500,{error:"Internal Server Error",message:"An error occurred processing your request"},t)}};function bE(r,e){return r.info("Health check requested"),We(200,{ok:!0,service:process.env.POWERTOOLS_SERVICE_NAME||"fibonacci-api",timestamp:new Date().toISOString()},e)}async function TE(r,e,t,s){if(!r.body)return e.warn("Request body missing"),We(400,{error:"Bad Request",message:"Request body is required"},t);let n;try{n=JSON.parse(r.body)}catch(u){return e.warn("Invalid JSON in request body",{error:u}),We(400,{error:"Bad Request",message:"Invalid JSON in request body"},t)}let i=EE.safeParse(n);if(!i.success)return e.warn("Payload validation failed",{errors:i.error.errors}),We(400,{error:"Validation Error",message:"Invalid payload structure",details:i.error.errors.map(u=>({path:u.path.join("."),message:u.message}))},t);let a=i.data,o=s?.addNewSubsegment("PublishToEventBridge");o?.addAnnotation("source",a.source),o?.addAnnotation("type",a.type);try{let u=new Ys.PutEventsCommand({Entries:[{Source:a.source,DetailType:a.type,Detail:JSON.stringify({...a.detail,traceId:t,timestamp:new Date().toISOString()}),EventBusName:Oi}]}),c=await yE.send(u);if(e.info("Event published to EventBridge",{source:a.source,type:a.type,eventBusName:Oi,failedEntryCount:c.FailedEntryCount||0}),c.FailedEntryCount&&c.FailedEntryCount>0){let l=new Error("Failed to publish some events");return e.error("Failed to publish some events",l,{failedEntries:c.Entries}),o?.addMetadata("failedEntries",c.Entries),o?.close(),We(500,{error:"Event Publication Failed",message:"Failed to publish event to EventBridge"},t)}return o?.close(),We(202,{message:"Event accepted for processing",eventBusName:Oi,source:a.source,type:a.type},t)}catch(u){let c=u instanceof Error?{name:u.name,message:u.message,stack:u.stack}:{error:u};throw e.error("Error publishing event to EventBridge",u,c),o&&u instanceof Error&&o.addError(u),o?.close(),u}}function We(r,e,t){return{statusCode:r,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"Content-Type,Authorization","Access-Control-Allow-Methods":"GET,POST,OPTIONS","X-Trace-Id":t||""},body:JSON.stringify({...e,traceId:t})}}0&&(module.exports={handler});
//# sourceMappingURL=index.js.map
